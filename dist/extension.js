"use strict";var jp=Object.create;var Sn=Object.defineProperty;var Fp=Object.getOwnPropertyDescriptor;var Bp=Object.getOwnPropertyNames;var Up=Object.getPrototypeOf,qp=Object.prototype.hasOwnProperty;var _=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports),Gp=(e,s)=>{for(var t in s)Sn(e,t,{get:s[t],enumerable:!0})},wa=(e,s,t,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of Bp(s))!qp.call(e,i)&&i!==t&&Sn(e,i,{get:()=>s[i],enumerable:!(n=Fp(s,i))||n.enumerable});return e};var q=(e,s,t)=>(t=e!=null?jp(Up(e)):{},wa(s||!e||!e.__esModule?Sn(t,"default",{value:e,enumerable:!0}):t,e)),Hp=e=>wa(Sn({},"__esModule",{value:!0}),e);var G=_(he=>{"use strict";var Hr=Symbol.for("yaml.alias"),Ra=Symbol.for("yaml.document"),vn=Symbol.for("yaml.map"),Ca=Symbol.for("yaml.pair"),Wr=Symbol.for("yaml.scalar"),En=Symbol.for("yaml.seq"),at=Symbol.for("yaml.node.type"),Vp=e=>!!e&&typeof e=="object"&&e[at]===Hr,Yp=e=>!!e&&typeof e=="object"&&e[at]===Ra,Zp=e=>!!e&&typeof e=="object"&&e[at]===vn,Xp=e=>!!e&&typeof e=="object"&&e[at]===Ca,Pa=e=>!!e&&typeof e=="object"&&e[at]===Wr,Qp=e=>!!e&&typeof e=="object"&&e[at]===En;function Ia(e){if(e&&typeof e=="object")switch(e[at]){case vn:case En:return!0}return!1}function eg(e){if(e&&typeof e=="object")switch(e[at]){case Hr:case vn:case Wr:case En:return!0}return!1}var tg=e=>(Pa(e)||Ia(e))&&!!e.anchor;he.ALIAS=Hr;he.DOC=Ra;he.MAP=vn;he.NODE_TYPE=at;he.PAIR=Ca;he.SCALAR=Wr;he.SEQ=En;he.hasAnchor=tg;he.isAlias=Vp;he.isCollection=Ia;he.isDocument=Yp;he.isMap=Zp;he.isNode=eg;he.isPair=Xp;he.isScalar=Pa;he.isSeq=Qp});var Ts=_(Jr=>{"use strict";var ue=G(),Re=Symbol("break visit"),_a=Symbol("skip children"),Ze=Symbol("remove node");function An(e,s){let t=Ta(s);ue.isDocument(e)?Xt(null,e.contents,t,Object.freeze([e]))===Ze&&(e.contents=null):Xt(null,e,t,Object.freeze([]))}An.BREAK=Re;An.SKIP=_a;An.REMOVE=Ze;function Xt(e,s,t,n){let i=xa(e,s,t,n);if(ue.isNode(i)||ue.isPair(i))return Oa(e,n,i),Xt(e,i,t,n);if(typeof i!="symbol"){if(ue.isCollection(s)){n=Object.freeze(n.concat(s));for(let r=0;r<s.items.length;++r){let o=Xt(r,s.items[r],t,n);if(typeof o=="number")r=o-1;else{if(o===Re)return Re;o===Ze&&(s.items.splice(r,1),r-=1)}}}else if(ue.isPair(s)){n=Object.freeze(n.concat(s));let r=Xt("key",s.key,t,n);if(r===Re)return Re;r===Ze&&(s.key=null);let o=Xt("value",s.value,t,n);if(o===Re)return Re;o===Ze&&(s.value=null)}}return i}async function Rn(e,s){let t=Ta(s);ue.isDocument(e)?await Qt(null,e.contents,t,Object.freeze([e]))===Ze&&(e.contents=null):await Qt(null,e,t,Object.freeze([]))}Rn.BREAK=Re;Rn.SKIP=_a;Rn.REMOVE=Ze;async function Qt(e,s,t,n){let i=await xa(e,s,t,n);if(ue.isNode(i)||ue.isPair(i))return Oa(e,n,i),Qt(e,i,t,n);if(typeof i!="symbol"){if(ue.isCollection(s)){n=Object.freeze(n.concat(s));for(let r=0;r<s.items.length;++r){let o=await Qt(r,s.items[r],t,n);if(typeof o=="number")r=o-1;else{if(o===Re)return Re;o===Ze&&(s.items.splice(r,1),r-=1)}}}else if(ue.isPair(s)){n=Object.freeze(n.concat(s));let r=await Qt("key",s.key,t,n);if(r===Re)return Re;r===Ze&&(s.key=null);let o=await Qt("value",s.value,t,n);if(o===Re)return Re;o===Ze&&(s.value=null)}}return i}function Ta(e){return typeof e=="object"&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function xa(e,s,t,n){if(typeof t=="function")return t(e,s,n);if(ue.isMap(s))return t.Map?.(e,s,n);if(ue.isSeq(s))return t.Seq?.(e,s,n);if(ue.isPair(s))return t.Pair?.(e,s,n);if(ue.isScalar(s))return t.Scalar?.(e,s,n);if(ue.isAlias(s))return t.Alias?.(e,s,n)}function Oa(e,s,t){let n=s[s.length-1];if(ue.isCollection(n))n.items[e]=t;else if(ue.isPair(n))e==="key"?n.key=t:n.value=t;else if(ue.isDocument(n))n.contents=t;else{let i=ue.isAlias(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}Jr.visit=An;Jr.visitAsync=Rn});var Kr=_(Na=>{"use strict";var La=G(),sg=Ts(),ng={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},rg=e=>e.replace(/[!,[\]{}]/g,s=>ng[s]),xs=class e{constructor(s,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},e.defaultYaml,s),this.tags=Object.assign({},e.defaultTags,t)}clone(){let s=new e(this.yaml,this.tags);return s.docStart=this.docStart,s}atDocument(){let s=new e(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:e.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},e.defaultTags);break}return s}add(s,t){this.atNextDocument&&(this.yaml={explicit:e.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},e.defaultTags),this.atNextDocument=!1);let n=s.trim().split(/[ \t]+/),i=n.shift();switch(i){case"%TAG":{if(n.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;let[r,o]=n;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;let[r]=n;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{let o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(s,t){if(s==="!")return"!";if(s[0]!=="!")return t(`Not a valid tag: ${s}`),null;if(s[1]==="<"){let o=s.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${s} is invalid.`),null):(s[s.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}let[,n,i]=s.match(/^(.*!)([^!]*)$/s);i||t(`The ${s} tag has no suffix`);let r=this.tags[n];if(r)try{return r+decodeURIComponent(i)}catch(o){return t(String(o)),null}return n==="!"?s:(t(`Could not resolve tag: ${s}`),null)}tagString(s){for(let[t,n]of Object.entries(this.tags))if(s.startsWith(n))return t+rg(s.substring(n.length));return s[0]==="!"?s:`!<${s}>`}toString(s){let t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags),i;if(s&&n.length>0&&La.isNode(s.contents)){let r={};sg.visit(s.contents,(o,a)=>{La.isNode(a)&&a.tag&&(r[a.tag]=!0)}),i=Object.keys(r)}else i=[];for(let[r,o]of n)r==="!!"&&o==="tag:yaml.org,2002:"||(!s||i.some(a=>a.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}};xs.defaultYaml={explicit:!1,version:"1.2"};xs.defaultTags={"!!":"tag:yaml.org,2002:"};Na.Directives=xs});var Cn=_(Os=>{"use strict";var Da=G(),ig=Ts();function og(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){let t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(e)}`;throw new Error(t)}return!0}function Ma(e){let s=new Set;return ig.visit(e,{Value(t,n){n.anchor&&s.add(n.anchor)}}),s}function $a(e,s){for(let t=1;;++t){let n=`${e}${t}`;if(!s.has(n))return n}}function ag(e,s){let t=[],n=new Map,i=null;return{onAnchor:r=>{t.push(r),i??(i=Ma(e));let o=$a(s,i);return i.add(o),o},setAnchors:()=>{for(let r of t){let o=n.get(r);if(typeof o=="object"&&o.anchor&&(Da.isScalar(o.node)||Da.isCollection(o.node)))o.node.anchor=o.anchor;else{let a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=r,a}}},sourceObjects:n}}Os.anchorIsValid=og;Os.anchorNames=Ma;Os.createNodeAnchors=ag;Os.findNewAnchor=$a});var zr=_(ja=>{"use strict";function Ls(e,s,t,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let i=0,r=n.length;i<r;++i){let o=n[i],a=Ls(e,n,String(i),o);a===void 0?delete n[i]:a!==o&&(n[i]=a)}else if(n instanceof Map)for(let i of Array.from(n.keys())){let r=n.get(i),o=Ls(e,n,i,r);o===void 0?n.delete(i):o!==r&&n.set(i,o)}else if(n instanceof Set)for(let i of Array.from(n)){let r=Ls(e,n,i,i);r===void 0?n.delete(i):r!==i&&(n.delete(i),n.add(r))}else for(let[i,r]of Object.entries(n)){let o=Ls(e,n,i,r);o===void 0?delete n[i]:o!==r&&(n[i]=o)}return e.call(s,t,n)}ja.applyReviver=Ls});var ht=_(Ba=>{"use strict";var cg=G();function Fa(e,s,t){if(Array.isArray(e))return e.map((n,i)=>Fa(n,String(i),t));if(e&&typeof e.toJSON=="function"){if(!t||!cg.hasAnchor(e))return e.toJSON(s,t);let n={aliasCount:0,count:1,res:void 0};t.anchors.set(e,n),t.onCreate=r=>{n.res=r,delete t.onCreate};let i=e.toJSON(s,t);return t.onCreate&&t.onCreate(i),i}return typeof e=="bigint"&&!t?.keep?Number(e):e}Ba.toJS=Fa});var Pn=_(qa=>{"use strict";var lg=zr(),Ua=G(),ug=ht(),Vr=class{constructor(s){Object.defineProperty(this,Ua.NODE_TYPE,{value:s})}clone(){let s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(s.range=this.range.slice()),s}toJS(s,{mapAsMap:t,maxAliasCount:n,onAnchor:i,reviver:r}={}){if(!Ua.isDocument(s))throw new TypeError("A document argument is required");let o={anchors:new Map,doc:s,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},a=ug.toJS(this,"",o);if(typeof i=="function")for(let{count:c,res:l}of o.anchors.values())i(l,c);return typeof r=="function"?lg.applyReviver(r,{"":a},"",a):a}};qa.NodeBase=Vr});var Ns=_(Ga=>{"use strict";var dg=Cn(),fg=Ts(),es=G(),pg=Pn(),gg=ht(),Yr=class extends pg.NodeBase{constructor(s){super(es.ALIAS),this.source=s,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(s,t){let n;t?.aliasResolveCache?n=t.aliasResolveCache:(n=[],fg.visit(s,{Node:(r,o)=>{(es.isAlias(o)||es.hasAnchor(o))&&n.push(o)}}),t&&(t.aliasResolveCache=n));let i;for(let r of n){if(r===this)break;r.anchor===this.source&&(i=r)}return i}toJSON(s,t){if(!t)return{source:this.source};let{anchors:n,doc:i,maxAliasCount:r}=t,o=this.resolve(i,t);if(!o){let c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let a=n.get(o);if(a||(gg.toJS(o,null,t),a=n.get(o)),a?.res===void 0){let c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(r>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=In(i,o,n)),a.count*a.aliasCount>r)){let c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return a.res}toString(s,t,n){let i=`*${this.source}`;if(s){if(dg.anchorIsValid(this.source),s.options.verifyAliasOrder&&!s.anchors.has(this.source)){let r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(s.implicitKey)return`${i} `}return i}};function In(e,s,t){if(es.isAlias(s)){let n=s.resolve(e),i=t&&n&&t.get(n);return i?i.count*i.aliasCount:0}else if(es.isCollection(s)){let n=0;for(let i of s.items){let r=In(e,i,t);r>n&&(n=r)}return n}else if(es.isPair(s)){let n=In(e,s.key,t),i=In(e,s.value,t);return Math.max(n,i)}return 1}Ga.Alias=Yr});var le=_(Zr=>{"use strict";var hg=G(),mg=Pn(),yg=ht(),wg=e=>!e||typeof e!="function"&&typeof e!="object",mt=class extends mg.NodeBase{constructor(s){super(hg.SCALAR),this.value=s}toJSON(s,t){return t?.keep?this.value:yg.toJS(this.value,s,t)}toString(){return String(this.value)}};mt.BLOCK_FOLDED="BLOCK_FOLDED";mt.BLOCK_LITERAL="BLOCK_LITERAL";mt.PLAIN="PLAIN";mt.QUOTE_DOUBLE="QUOTE_DOUBLE";mt.QUOTE_SINGLE="QUOTE_SINGLE";Zr.Scalar=mt;Zr.isScalarValue=wg});var Ds=_(Wa=>{"use strict";var bg=Ns(),Mt=G(),Ha=le(),Sg="tag:yaml.org,2002:";function kg(e,s,t){if(s){let n=t.filter(r=>r.tag===s),i=n.find(r=>!r.format)??n[0];if(!i)throw new Error(`Tag ${s} not found`);return i}return t.find(n=>n.identify?.(e)&&!n.format)}function vg(e,s,t){if(Mt.isDocument(e)&&(e=e.contents),Mt.isNode(e))return e;if(Mt.isPair(e)){let d=t.schema[Mt.MAP].createNode?.(t.schema,null,t);return d.items.push(e),d}(e instanceof String||e instanceof Number||e instanceof Boolean||typeof BigInt<"u"&&e instanceof BigInt)&&(e=e.valueOf());let{aliasDuplicateObjects:n,onAnchor:i,onTagObj:r,schema:o,sourceObjects:a}=t,c;if(n&&e&&typeof e=="object"){if(c=a.get(e),c)return c.anchor??(c.anchor=i(e)),new bg.Alias(c.anchor);c={anchor:null,node:null},a.set(e,c)}s?.startsWith("!!")&&(s=Sg+s.slice(2));let l=kg(e,s,o.tags);if(!l){if(e&&typeof e.toJSON=="function"&&(e=e.toJSON()),!e||typeof e!="object"){let d=new Ha.Scalar(e);return c&&(c.node=d),d}l=e instanceof Map?o[Mt.MAP]:Symbol.iterator in Object(e)?o[Mt.SEQ]:o[Mt.MAP]}r&&(r(l),delete t.onTagObj);let u=l?.createNode?l.createNode(t.schema,e,t):typeof l?.nodeClass?.from=="function"?l.nodeClass.from(t.schema,e,t):new Ha.Scalar(e);return s?u.tag=s:l.default||(u.tag=l.tag),c&&(c.node=u),u}Wa.createNode=vg});var Tn=_(_n=>{"use strict";var Eg=Ds(),Xe=G(),Ag=Pn();function Xr(e,s,t){let n=t;for(let i=s.length-1;i>=0;--i){let r=s[i];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){let o=[];o[r]=n,n=o}else n=new Map([[r,n]])}return Eg.createNode(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}var Ja=e=>e==null||typeof e=="object"&&!!e[Symbol.iterator]().next().done,Qr=class extends Ag.NodeBase{constructor(s,t){super(s),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(s){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return s&&(t.schema=s),t.items=t.items.map(n=>Xe.isNode(n)||Xe.isPair(n)?n.clone(s):n),this.range&&(t.range=this.range.slice()),t}addIn(s,t){if(Ja(s))this.add(t);else{let[n,...i]=s,r=this.get(n,!0);if(Xe.isCollection(r))r.addIn(i,t);else if(r===void 0&&this.schema)this.set(n,Xr(this.schema,i,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}deleteIn(s){let[t,...n]=s;if(n.length===0)return this.delete(t);let i=this.get(t,!0);if(Xe.isCollection(i))return i.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(s,t){let[n,...i]=s,r=this.get(n,!0);return i.length===0?!t&&Xe.isScalar(r)?r.value:r:Xe.isCollection(r)?r.getIn(i,t):void 0}hasAllNullValues(s){return this.items.every(t=>{if(!Xe.isPair(t))return!1;let n=t.value;return n==null||s&&Xe.isScalar(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(s){let[t,...n]=s;if(n.length===0)return this.has(t);let i=this.get(t,!0);return Xe.isCollection(i)?i.hasIn(n):!1}setIn(s,t){let[n,...i]=s;if(i.length===0)this.set(n,t);else{let r=this.get(n,!0);if(Xe.isCollection(r))r.setIn(i,t);else if(r===void 0&&this.schema)this.set(n,Xr(this.schema,i,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}};_n.Collection=Qr;_n.collectionFromPath=Xr;_n.isEmptyPath=Ja});var Ms=_(xn=>{"use strict";var Rg=e=>e.replace(/^(?!$)(?: $)?/gm,"#");function ei(e,s){return/^\n+$/.test(e)?e.substring(1):s?e.replace(/^(?! *$)/gm,s):e}var Cg=(e,s,t)=>e.endsWith(`
`)?ei(t,s):t.includes(`
`)?`
`+ei(t,s):(e.endsWith(" ")?"":" ")+t;xn.indentComment=ei;xn.lineComment=Cg;xn.stringifyComment=Rg});var za=_($s=>{"use strict";var Pg="flow",ti="block",On="quoted";function Ig(e,s,t="flow",{indentAtStart:n,lineWidth:i=80,minContentWidth:r=20,onFold:o,onOverflow:a}={}){if(!i||i<0)return e;i<r&&(r=0);let c=Math.max(1+r,1+i-s.length);if(e.length<=c)return e;let l=[],u={},d=i-s.length;typeof n=="number"&&(n>i-Math.max(2,r)?l.push(0):d=i-n);let h,f,p=!1,g=-1,y=-1,w=-1;t===ti&&(g=Ka(e,g,s.length),g!==-1&&(d=g+c));for(let m;m=e[g+=1];){if(t===On&&m==="\\"){switch(y=g,e[g+1]){case"x":g+=3;break;case"u":g+=5;break;case"U":g+=9;break;default:g+=1}w=g}if(m===`
`)t===ti&&(g=Ka(e,g,s.length)),d=g+s.length+c,h=void 0;else{if(m===" "&&f&&f!==" "&&f!==`
`&&f!=="	"){let b=e[g+1];b&&b!==" "&&b!==`
`&&b!=="	"&&(h=g)}if(g>=d)if(h)l.push(h),d=h+c,h=void 0;else if(t===On){for(;f===" "||f==="	";)f=m,m=e[g+=1],p=!0;let b=g>w+1?g-2:y-1;if(u[b])return e;l.push(b),u[b]=!0,d=b+c,h=void 0}else p=!0}f=m}if(p&&a&&a(),l.length===0)return e;o&&o();let S=e.slice(0,l[0]);for(let m=0;m<l.length;++m){let b=l[m],k=l[m+1]||e.length;b===0?S=`
${s}${e.slice(0,k)}`:(t===On&&u[b]&&(S+=`${e[b]}\\`),S+=`
${s}${e.slice(b+1,k)}`)}return S}function Ka(e,s,t){let n=s,i=s+1,r=e[i];for(;r===" "||r==="	";)if(s<i+t)r=e[++s];else{do r=e[++s];while(r&&r!==`
`);n=s,i=s+1,r=e[i]}return n}$s.FOLD_BLOCK=ti;$s.FOLD_FLOW=Pg;$s.FOLD_QUOTED=On;$s.foldFlowLines=Ig});var Fs=_(Va=>{"use strict";var Je=le(),yt=za(),Nn=(e,s)=>({indentAtStart:s?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),Dn=e=>/^(%|---|\.\.\.)/m.test(e);function _g(e,s,t){if(!s||s<0)return!1;let n=s-t,i=e.length;if(i<=n)return!1;for(let r=0,o=0;r<i;++r)if(e[r]===`
`){if(r-o>n)return!0;if(o=r+1,i-o<=n)return!1}return!0}function js(e,s){let t=JSON.stringify(e);if(s.options.doubleQuotedAsJSON)return t;let{implicitKey:n}=s,i=s.options.doubleQuotedMinMultiLineLength,r=s.indent||(Dn(e)?"  ":""),o="",a=0;for(let c=0,l=t[c];l;l=t[++c])if(l===" "&&t[c+1]==="\\"&&t[c+2]==="n"&&(o+=t.slice(a,c)+"\\ ",c+=1,a=c,l="\\"),l==="\\")switch(t[c+1]){case"u":{o+=t.slice(a,c);let u=t.substr(c+2,4);switch(u){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:u.substr(0,2)==="00"?o+="\\x"+u.substr(2):o+=t.substr(c,6)}c+=5,a=c+1}break;case"n":if(n||t[c+2]==='"'||t.length<i)c+=1;else{for(o+=t.slice(a,c)+`

`;t[c+2]==="\\"&&t[c+3]==="n"&&t[c+4]!=='"';)o+=`
`,c+=2;o+=r,t[c+2]===" "&&(o+="\\"),c+=1,a=c+1}break;default:c+=1}return o=a?o+t.slice(a):t,n?o:yt.foldFlowLines(o,r,yt.FOLD_QUOTED,Nn(s,!1))}function si(e,s){if(s.options.singleQuote===!1||s.implicitKey&&e.includes(`
`)||/[ \t]\n|\n[ \t]/.test(e))return js(e,s);let t=s.indent||(Dn(e)?"  ":""),n="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return s.implicitKey?n:yt.foldFlowLines(n,t,yt.FOLD_FLOW,Nn(s,!1))}function ts(e,s){let{singleQuote:t}=s.options,n;if(t===!1)n=js;else{let i=e.includes('"'),r=e.includes("'");i&&!r?n=si:r&&!i?n=js:n=t?si:js}return n(e,s)}var ni;try{ni=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{ni=/\n+(?!\n|$)/g}function Ln({comment:e,type:s,value:t},n,i,r){let{blockQuote:o,commentString:a,lineWidth:c}=n.options;if(!o||/\n[\t ]+$/.test(t))return ts(t,n);let l=n.indent||(n.forceBlockIndent||Dn(t)?"  ":""),u=o==="literal"?!0:o==="folded"||s===Je.Scalar.BLOCK_FOLDED?!1:s===Je.Scalar.BLOCK_LITERAL?!0:!_g(t,c,l.length);if(!t)return u?`|
`:`>
`;let d,h;for(h=t.length;h>0;--h){let k=t[h-1];if(k!==`
`&&k!=="	"&&k!==" ")break}let f=t.substring(h),p=f.indexOf(`
`);p===-1?d="-":t===f||p!==f.length-1?(d="+",r&&r()):d="",f&&(t=t.slice(0,-f.length),f[f.length-1]===`
`&&(f=f.slice(0,-1)),f=f.replace(ni,`$&${l}`));let g=!1,y,w=-1;for(y=0;y<t.length;++y){let k=t[y];if(k===" ")g=!0;else if(k===`
`)w=y;else break}let S=t.substring(0,w<y?w+1:y);S&&(t=t.substring(S.length),S=S.replace(/\n+/g,`$&${l}`));let b=(g?l?"2":"1":"")+d;if(e&&(b+=" "+a(e.replace(/ ?[\r\n]+/g," ")),i&&i()),!u){let k=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${l}`),v=!1,E=Nn(n,!0);o!=="folded"&&s!==Je.Scalar.BLOCK_FOLDED&&(E.onOverflow=()=>{v=!0});let A=yt.foldFlowLines(`${S}${k}${f}`,l,yt.FOLD_BLOCK,E);if(!v)return`>${b}
${l}${A}`}return t=t.replace(/\n+/g,`$&${l}`),`|${b}
${l}${S}${t}${f}`}function Tg(e,s,t,n){let{type:i,value:r}=e,{actualString:o,implicitKey:a,indent:c,indentStep:l,inFlow:u}=s;if(a&&r.includes(`
`)||u&&/[[\]{},]/.test(r))return ts(r,s);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return a||u||!r.includes(`
`)?ts(r,s):Ln(e,s,t,n);if(!a&&!u&&i!==Je.Scalar.PLAIN&&r.includes(`
`))return Ln(e,s,t,n);if(Dn(r)){if(c==="")return s.forceBlockIndent=!0,Ln(e,s,t,n);if(a&&c===l)return ts(r,s)}let d=r.replace(/\n+/g,`$&
${c}`);if(o){let h=g=>g.default&&g.tag!=="tag:yaml.org,2002:str"&&g.test?.test(d),{compat:f,tags:p}=s.doc.schema;if(p.some(h)||f?.some(h))return ts(r,s)}return a?d:yt.foldFlowLines(d,c,yt.FOLD_FLOW,Nn(s,!1))}function xg(e,s,t,n){let{implicitKey:i,inFlow:r}=s,o=typeof e.value=="string"?e:Object.assign({},e,{value:String(e.value)}),{type:a}=e;a!==Je.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=Je.Scalar.QUOTE_DOUBLE);let c=u=>{switch(u){case Je.Scalar.BLOCK_FOLDED:case Je.Scalar.BLOCK_LITERAL:return i||r?ts(o.value,s):Ln(o,s,t,n);case Je.Scalar.QUOTE_DOUBLE:return js(o.value,s);case Je.Scalar.QUOTE_SINGLE:return si(o.value,s);case Je.Scalar.PLAIN:return Tg(o,s,t,n);default:return null}},l=c(a);if(l===null){let{defaultKeyType:u,defaultStringType:d}=s.options,h=i&&u||d;if(l=c(h),l===null)throw new Error(`Unsupported default string type ${h}`)}return l}Va.stringifyString=xg});var Bs=_(ri=>{"use strict";var Og=Cn(),wt=G(),Lg=Ms(),Ng=Fs();function Dg(e,s){let t=Object.assign({blockQuote:!0,commentString:Lg.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,s),n;switch(t.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:e,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:n,options:t}}function Mg(e,s){if(s.tag){let i=e.filter(r=>r.tag===s.tag);if(i.length>0)return i.find(r=>r.format===s.format)??i[0]}let t,n;if(wt.isScalar(s)){n=s.value;let i=e.filter(r=>r.identify?.(n));if(i.length>1){let r=i.filter(o=>o.test);r.length>0&&(i=r)}t=i.find(r=>r.format===s.format)??i.find(r=>!r.format)}else n=s,t=e.find(i=>i.nodeClass&&n instanceof i.nodeClass);if(!t){let i=n?.constructor?.name??(n===null?"null":typeof n);throw new Error(`Tag not resolved for ${i} value`)}return t}function $g(e,s,{anchors:t,doc:n}){if(!n.directives)return"";let i=[],r=(wt.isScalar(e)||wt.isCollection(e))&&e.anchor;r&&Og.anchorIsValid(r)&&(t.add(r),i.push(`&${r}`));let o=e.tag??(s.default?null:s.tag);return o&&i.push(n.directives.tagString(o)),i.join(" ")}function jg(e,s,t,n){if(wt.isPair(e))return e.toString(s,t,n);if(wt.isAlias(e)){if(s.doc.directives)return e.toString(s);if(s.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");s.resolvedAliases?s.resolvedAliases.add(e):s.resolvedAliases=new Set([e]),e=e.resolve(s.doc)}let i,r=wt.isNode(e)?e:s.doc.createNode(e,{onTagObj:c=>i=c});i??(i=Mg(s.doc.schema.tags,r));let o=$g(r,i,s);o.length>0&&(s.indentAtStart=(s.indentAtStart??0)+o.length+1);let a=typeof i.stringify=="function"?i.stringify(r,s,t,n):wt.isScalar(r)?Ng.stringifyString(r,s,t,n):r.toString(s,t,n);return o?wt.isScalar(r)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${s.indent}${a}`:a}ri.createStringifyContext=Dg;ri.stringify=jg});var Qa=_(Xa=>{"use strict";var ct=G(),Ya=le(),Za=Bs(),Us=Ms();function Fg({key:e,value:s},t,n,i){let{allNullValues:r,doc:o,indent:a,indentStep:c,options:{commentString:l,indentSeq:u,simpleKeys:d}}=t,h=ct.isNode(e)&&e.comment||null;if(d){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(ct.isCollection(e)||!ct.isNode(e)&&typeof e=="object"){let E="With simple keys, collection cannot be used as a key value";throw new Error(E)}}let f=!d&&(!e||h&&s==null&&!t.inFlow||ct.isCollection(e)||(ct.isScalar(e)?e.type===Ya.Scalar.BLOCK_FOLDED||e.type===Ya.Scalar.BLOCK_LITERAL:typeof e=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!f&&(d||!r),indent:a+c});let p=!1,g=!1,y=Za.stringify(e,t,()=>p=!0,()=>g=!0);if(!f&&!t.inFlow&&y.length>1024){if(d)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");f=!0}if(t.inFlow){if(r||s==null)return p&&n&&n(),y===""?"?":f?`? ${y}`:y}else if(r&&!d||s==null&&f)return y=`? ${y}`,h&&!p?y+=Us.lineComment(y,t.indent,l(h)):g&&i&&i(),y;p&&(h=null),f?(h&&(y+=Us.lineComment(y,t.indent,l(h))),y=`? ${y}
${a}:`):(y=`${y}:`,h&&(y+=Us.lineComment(y,t.indent,l(h))));let w,S,m;ct.isNode(s)?(w=!!s.spaceBefore,S=s.commentBefore,m=s.comment):(w=!1,S=null,m=null,s&&typeof s=="object"&&(s=o.createNode(s))),t.implicitKey=!1,!f&&!h&&ct.isScalar(s)&&(t.indentAtStart=y.length+1),g=!1,!u&&c.length>=2&&!t.inFlow&&!f&&ct.isSeq(s)&&!s.flow&&!s.tag&&!s.anchor&&(t.indent=t.indent.substring(2));let b=!1,k=Za.stringify(s,t,()=>b=!0,()=>g=!0),v=" ";if(h||w||S){if(v=w?`
`:"",S){let E=l(S);v+=`
${Us.indentComment(E,t.indent)}`}k===""&&!t.inFlow?v===`
`&&m&&(v=`

`):v+=`
${t.indent}`}else if(!f&&ct.isCollection(s)){let E=k[0],A=k.indexOf(`
`),R=A!==-1,x=t.inFlow??s.flow??s.items.length===0;if(R||!x){let P=!1;if(R&&(E==="&"||E==="!")){let I=k.indexOf(" ");E==="&"&&I!==-1&&I<A&&k[I+1]==="!"&&(I=k.indexOf(" ",I+1)),(I===-1||A<I)&&(P=!0)}P||(v=`
${t.indent}`)}}else(k===""||k[0]===`
`)&&(v="");return y+=v+k,t.inFlow?b&&n&&n():m&&!b?y+=Us.lineComment(y,t.indent,l(m)):g&&i&&i(),y}Xa.stringifyPair=Fg});var oi=_(ii=>{"use strict";var ec=require("process");function Bg(e,...s){e==="debug"&&console.log(...s)}function Ug(e,s){(e==="debug"||e==="warn")&&(typeof ec.emitWarning=="function"?ec.emitWarning(s):console.warn(s))}ii.debug=Bg;ii.warn=Ug});var Fn=_(jn=>{"use strict";var qs=G(),tc=le(),Mn="<<",$n={identify:e=>e===Mn||typeof e=="symbol"&&e.description===Mn,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new tc.Scalar(Symbol(Mn)),{addToJSMap:sc}),stringify:()=>Mn},qg=(e,s)=>($n.identify(s)||qs.isScalar(s)&&(!s.type||s.type===tc.Scalar.PLAIN)&&$n.identify(s.value))&&e?.doc.schema.tags.some(t=>t.tag===$n.tag&&t.default);function sc(e,s,t){if(t=e&&qs.isAlias(t)?t.resolve(e.doc):t,qs.isSeq(t))for(let n of t.items)ai(e,s,n);else if(Array.isArray(t))for(let n of t)ai(e,s,n);else ai(e,s,t)}function ai(e,s,t){let n=e&&qs.isAlias(t)?t.resolve(e.doc):t;if(!qs.isMap(n))throw new Error("Merge sources must be maps or map aliases");let i=n.toJSON(null,e,Map);for(let[r,o]of i)s instanceof Map?s.has(r)||s.set(r,o):s instanceof Set?s.add(r):Object.prototype.hasOwnProperty.call(s,r)||Object.defineProperty(s,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return s}jn.addMergeToJSMap=sc;jn.isMergeKey=qg;jn.merge=$n});var li=_(ic=>{"use strict";var Gg=oi(),nc=Fn(),Hg=Bs(),rc=G(),ci=ht();function Wg(e,s,{key:t,value:n}){if(rc.isNode(t)&&t.addToJSMap)t.addToJSMap(e,s,n);else if(nc.isMergeKey(e,t))nc.addMergeToJSMap(e,s,n);else{let i=ci.toJS(t,"",e);if(s instanceof Map)s.set(i,ci.toJS(n,i,e));else if(s instanceof Set)s.add(i);else{let r=Jg(t,i,e),o=ci.toJS(n,r,e);r in s?Object.defineProperty(s,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):s[r]=o}}return s}function Jg(e,s,t){if(s===null)return"";if(typeof s!="object")return String(s);if(rc.isNode(e)&&t?.doc){let n=Hg.createStringifyContext(t.doc,{});n.anchors=new Set;for(let r of t.anchors.keys())n.anchors.add(r.anchor);n.inFlow=!0,n.inStringifyKey=!0;let i=e.toString(n);if(!t.mapKeyWarned){let r=JSON.stringify(i);r.length>40&&(r=r.substring(0,36)+'..."'),Gg.warn(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return i}return JSON.stringify(s)}ic.addPairToJSMap=Wg});var bt=_(ui=>{"use strict";var oc=Ds(),Kg=Qa(),zg=li(),Bn=G();function Vg(e,s,t){let n=oc.createNode(e,void 0,t),i=oc.createNode(s,void 0,t);return new Un(n,i)}var Un=class e{constructor(s,t=null){Object.defineProperty(this,Bn.NODE_TYPE,{value:Bn.PAIR}),this.key=s,this.value=t}clone(s){let{key:t,value:n}=this;return Bn.isNode(t)&&(t=t.clone(s)),Bn.isNode(n)&&(n=n.clone(s)),new e(t,n)}toJSON(s,t){let n=t?.mapAsMap?new Map:{};return zg.addPairToJSMap(t,n,this)}toString(s,t,n){return s?.doc?Kg.stringifyPair(this,s,t,n):JSON.stringify(this)}};ui.Pair=Un;ui.createPair=Vg});var di=_(cc=>{"use strict";var $t=G(),ac=Bs(),qn=Ms();function Yg(e,s,t){return(s.inFlow??e.flow?Xg:Zg)(e,s,t)}function Zg({comment:e,items:s},t,{blockItemPrefix:n,flowChars:i,itemIndent:r,onChompKeep:o,onComment:a}){let{indent:c,options:{commentString:l}}=t,u=Object.assign({},t,{indent:r,type:null}),d=!1,h=[];for(let p=0;p<s.length;++p){let g=s[p],y=null;if($t.isNode(g))!d&&g.spaceBefore&&h.push(""),Gn(t,h,g.commentBefore,d),g.comment&&(y=g.comment);else if($t.isPair(g)){let S=$t.isNode(g.key)?g.key:null;S&&(!d&&S.spaceBefore&&h.push(""),Gn(t,h,S.commentBefore,d))}d=!1;let w=ac.stringify(g,u,()=>y=null,()=>d=!0);y&&(w+=qn.lineComment(w,r,l(y))),d&&y&&(d=!1),h.push(n+w)}let f;if(h.length===0)f=i.start+i.end;else{f=h[0];for(let p=1;p<h.length;++p){let g=h[p];f+=g?`
${c}${g}`:`
`}}return e?(f+=`
`+qn.indentComment(l(e),c),a&&a()):d&&o&&o(),f}function Xg({items:e},s,{flowChars:t,itemIndent:n}){let{indent:i,indentStep:r,flowCollectionPadding:o,options:{commentString:a}}=s;n+=r;let c=Object.assign({},s,{indent:n,inFlow:!0,type:null}),l=!1,u=0,d=[];for(let p=0;p<e.length;++p){let g=e[p],y=null;if($t.isNode(g))g.spaceBefore&&d.push(""),Gn(s,d,g.commentBefore,!1),g.comment&&(y=g.comment);else if($t.isPair(g)){let S=$t.isNode(g.key)?g.key:null;S&&(S.spaceBefore&&d.push(""),Gn(s,d,S.commentBefore,!1),S.comment&&(l=!0));let m=$t.isNode(g.value)?g.value:null;m?(m.comment&&(y=m.comment),m.commentBefore&&(l=!0)):g.value==null&&S?.comment&&(y=S.comment)}y&&(l=!0);let w=ac.stringify(g,c,()=>y=null);p<e.length-1&&(w+=","),y&&(w+=qn.lineComment(w,n,a(y))),!l&&(d.length>u||w.includes(`
`))&&(l=!0),d.push(w),u=d.length}let{start:h,end:f}=t;if(d.length===0)return h+f;if(!l){let p=d.reduce((g,y)=>g+y.length+2,2);l=s.options.lineWidth>0&&p>s.options.lineWidth}if(l){let p=h;for(let g of d)p+=g?`
${r}${i}${g}`:`
`;return`${p}
${i}${f}`}else return`${h}${o}${d.join(" ")}${o}${f}`}function Gn({indent:e,options:{commentString:s}},t,n,i){if(n&&i&&(n=n.replace(/^\n+/,"")),n){let r=qn.indentComment(s(n),e);t.push(r.trimStart())}}cc.stringifyCollection=Yg});var kt=_(pi=>{"use strict";var Qg=di(),eh=li(),th=Tn(),St=G(),Hn=bt(),sh=le();function Gs(e,s){let t=St.isScalar(s)?s.value:s;for(let n of e)if(St.isPair(n)&&(n.key===s||n.key===t||St.isScalar(n.key)&&n.key.value===t))return n}var fi=class extends th.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(s){super(St.MAP,s),this.items=[]}static from(s,t,n){let{keepUndefined:i,replacer:r}=n,o=new this(s),a=(c,l)=>{if(typeof r=="function")l=r.call(t,c,l);else if(Array.isArray(r)&&!r.includes(c))return;(l!==void 0||i)&&o.items.push(Hn.createPair(c,l,n))};if(t instanceof Map)for(let[c,l]of t)a(c,l);else if(t&&typeof t=="object")for(let c of Object.keys(t))a(c,t[c]);return typeof s.sortMapEntries=="function"&&o.items.sort(s.sortMapEntries),o}add(s,t){let n;St.isPair(s)?n=s:!s||typeof s!="object"||!("key"in s)?n=new Hn.Pair(s,s?.value):n=new Hn.Pair(s.key,s.value);let i=Gs(this.items,n.key),r=this.schema?.sortMapEntries;if(i){if(!t)throw new Error(`Key ${n.key} already set`);St.isScalar(i.value)&&sh.isScalarValue(n.value)?i.value.value=n.value:i.value=n.value}else if(r){let o=this.items.findIndex(a=>r(n,a)<0);o===-1?this.items.push(n):this.items.splice(o,0,n)}else this.items.push(n)}delete(s){let t=Gs(this.items,s);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(s,t){let i=Gs(this.items,s)?.value;return(!t&&St.isScalar(i)?i.value:i)??void 0}has(s){return!!Gs(this.items,s)}set(s,t){this.add(new Hn.Pair(s,t),!0)}toJSON(s,t,n){let i=n?new n:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(i);for(let r of this.items)eh.addPairToJSMap(t,i,r);return i}toString(s,t,n){if(!s)return JSON.stringify(this);for(let i of this.items)if(!St.isPair(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!s.allNullValues&&this.hasAllNullValues(!1)&&(s=Object.assign({},s,{allNullValues:!0})),Qg.stringifyCollection(this,s,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:s.indent||"",onChompKeep:n,onComment:t})}};pi.YAMLMap=fi;pi.findPair=Gs});var ss=_(uc=>{"use strict";var nh=G(),lc=kt(),rh={collection:"map",default:!0,nodeClass:lc.YAMLMap,tag:"tag:yaml.org,2002:map",resolve(e,s){return nh.isMap(e)||s("Expected a mapping for this tag"),e},createNode:(e,s,t)=>lc.YAMLMap.from(e,s,t)};uc.map=rh});var vt=_(dc=>{"use strict";var ih=Ds(),oh=di(),ah=Tn(),Jn=G(),ch=le(),lh=ht(),gi=class extends ah.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(s){super(Jn.SEQ,s),this.items=[]}add(s){this.items.push(s)}delete(s){let t=Wn(s);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(s,t){let n=Wn(s);if(typeof n!="number")return;let i=this.items[n];return!t&&Jn.isScalar(i)?i.value:i}has(s){let t=Wn(s);return typeof t=="number"&&t<this.items.length}set(s,t){let n=Wn(s);if(typeof n!="number")throw new Error(`Expected a valid index, not ${s}.`);let i=this.items[n];Jn.isScalar(i)&&ch.isScalarValue(t)?i.value=t:this.items[n]=t}toJSON(s,t){let n=[];t?.onCreate&&t.onCreate(n);let i=0;for(let r of this.items)n.push(lh.toJS(r,String(i++),t));return n}toString(s,t,n){return s?oh.stringifyCollection(this,s,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(s.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(s,t,n){let{replacer:i}=n,r=new this(s);if(t&&Symbol.iterator in Object(t)){let o=0;for(let a of t){if(typeof i=="function"){let c=t instanceof Set?a:String(o++);a=i.call(t,c,a)}r.items.push(ih.createNode(a,void 0,n))}}return r}};function Wn(e){let s=Jn.isScalar(e)?e.value:e;return s&&typeof s=="string"&&(s=Number(s)),typeof s=="number"&&Number.isInteger(s)&&s>=0?s:null}dc.YAMLSeq=gi});var ns=_(pc=>{"use strict";var uh=G(),fc=vt(),dh={collection:"seq",default:!0,nodeClass:fc.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve(e,s){return uh.isSeq(e)||s("Expected a sequence for this tag"),e},createNode:(e,s,t)=>fc.YAMLSeq.from(e,s,t)};pc.seq=dh});var Hs=_(gc=>{"use strict";var fh=Fs(),ph={identify:e=>typeof e=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify(e,s,t,n){return s=Object.assign({actualString:!0},s),fh.stringifyString(e,s,t,n)}};gc.string=ph});var Kn=_(yc=>{"use strict";var hc=le(),mc={identify:e=>e==null,createNode:()=>new hc.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new hc.Scalar(null),stringify:({source:e},s)=>typeof e=="string"&&mc.test.test(e)?e:s.options.nullStr};yc.nullTag=mc});var hi=_(bc=>{"use strict";var gh=le(),wc={identify:e=>typeof e=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new gh.Scalar(e[0]==="t"||e[0]==="T"),stringify({source:e,value:s},t){if(e&&wc.test.test(e)){let n=e[0]==="t"||e[0]==="T";if(s===n)return e}return s?t.options.trueStr:t.options.falseStr}};bc.boolTag=wc});var rs=_(Sc=>{"use strict";function hh({format:e,minFractionDigits:s,tag:t,value:n}){if(typeof n=="bigint")return String(n);let i=typeof n=="number"?n:Number(n);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=Object.is(n,-0)?"-0":JSON.stringify(n);if(!e&&s&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let a=s-(r.length-o-1);for(;a-- >0;)r+="0"}return r}Sc.stringifyNumber=hh});var yi=_(zn=>{"use strict";var mh=le(),mi=rs(),yh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>e.slice(-3).toLowerCase()==="nan"?NaN:e[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:mi.stringifyNumber},wh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){let s=Number(e.value);return isFinite(s)?s.toExponential():mi.stringifyNumber(e)}},bh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){let s=new mh.Scalar(parseFloat(e)),t=e.indexOf(".");return t!==-1&&e[e.length-1]==="0"&&(s.minFractionDigits=e.length-t-1),s},stringify:mi.stringifyNumber};zn.float=bh;zn.floatExp=wh;zn.floatNaN=yh});var bi=_(Yn=>{"use strict";var kc=rs(),Vn=e=>typeof e=="bigint"||Number.isInteger(e),wi=(e,s,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e.substring(s),t);function vc(e,s,t){let{value:n}=e;return Vn(n)&&n>=0?t+n.toString(s):kc.stringifyNumber(e)}var Sh={identify:e=>Vn(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,s,t)=>wi(e,2,8,t),stringify:e=>vc(e,8,"0o")},kh={identify:Vn,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,s,t)=>wi(e,0,10,t),stringify:kc.stringifyNumber},vh={identify:e=>Vn(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,s,t)=>wi(e,2,16,t),stringify:e=>vc(e,16,"0x")};Yn.int=kh;Yn.intHex=vh;Yn.intOct=Sh});var Ac=_(Ec=>{"use strict";var Eh=ss(),Ah=Kn(),Rh=ns(),Ch=Hs(),Ph=hi(),Si=yi(),ki=bi(),Ih=[Eh.map,Rh.seq,Ch.string,Ah.nullTag,Ph.boolTag,ki.intOct,ki.int,ki.intHex,Si.floatNaN,Si.floatExp,Si.float];Ec.schema=Ih});var Pc=_(Cc=>{"use strict";var _h=le(),Th=ss(),xh=ns();function Rc(e){return typeof e=="bigint"||Number.isInteger(e)}var Zn=({value:e})=>JSON.stringify(e),Oh=[{identify:e=>typeof e=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:Zn},{identify:e=>e==null,createNode:()=>new _h.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Zn},{identify:e=>typeof e=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>e==="true",stringify:Zn},{identify:Rc,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,s,{intAsBigInt:t})=>t?BigInt(e):parseInt(e,10),stringify:({value:e})=>Rc(e)?e.toString():JSON.stringify(e)},{identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:Zn}],Lh={default:!0,tag:"",test:/^/,resolve(e,s){return s(`Unresolved plain scalar ${JSON.stringify(e)}`),e}},Nh=[Th.map,xh.seq].concat(Oh,Lh);Cc.schema=Nh});var Ei=_(Ic=>{"use strict";var Ws=require("buffer"),vi=le(),Dh=Fs(),Mh={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,s){if(typeof Ws.Buffer=="function")return Ws.Buffer.from(e,"base64");if(typeof atob=="function"){let t=atob(e.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}else return s("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:s,value:t},n,i,r){if(!t)return"";let o=t,a;if(typeof Ws.Buffer=="function")a=o instanceof Ws.Buffer?o.toString("base64"):Ws.Buffer.from(o.buffer).toString("base64");else if(typeof btoa=="function"){let c="";for(let l=0;l<o.length;++l)c+=String.fromCharCode(o[l]);a=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(s??(s=vi.Scalar.BLOCK_LITERAL),s!==vi.Scalar.QUOTE_DOUBLE){let c=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),l=Math.ceil(a.length/c),u=new Array(l);for(let d=0,h=0;d<l;++d,h+=c)u[d]=a.substr(h,c);a=u.join(s===vi.Scalar.BLOCK_LITERAL?`
`:" ")}return Dh.stringifyString({comment:e,type:s,value:a},n,i,r)}};Ic.binary=Mh});var er=_(Qn=>{"use strict";var Xn=G(),Ai=bt(),$h=le(),jh=vt();function _c(e,s){if(Xn.isSeq(e))for(let t=0;t<e.items.length;++t){let n=e.items[t];if(!Xn.isPair(n)){if(Xn.isMap(n)){n.items.length>1&&s("Each pair must have its own sequence indicator");let i=n.items[0]||new Ai.Pair(new $h.Scalar(null));if(n.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${n.commentBefore}
${i.key.commentBefore}`:n.commentBefore),n.comment){let r=i.value??i.key;r.comment=r.comment?`${n.comment}
${r.comment}`:n.comment}n=i}e.items[t]=Xn.isPair(n)?n:new Ai.Pair(n)}}else s("Expected a sequence for this tag");return e}function Tc(e,s,t){let{replacer:n}=t,i=new jh.YAMLSeq(e);i.tag="tag:yaml.org,2002:pairs";let r=0;if(s&&Symbol.iterator in Object(s))for(let o of s){typeof n=="function"&&(o=n.call(s,String(r++),o));let a,c;if(Array.isArray(o))if(o.length===2)a=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){let l=Object.keys(o);if(l.length===1)a=l[0],c=o[a];else throw new TypeError(`Expected tuple with one key, not ${l.length} keys`)}else a=o;i.items.push(Ai.createPair(a,c,t))}return i}var Fh={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:_c,createNode:Tc};Qn.createPairs=Tc;Qn.pairs=Fh;Qn.resolvePairs=_c});var Pi=_(Ci=>{"use strict";var xc=G(),Ri=ht(),Js=kt(),Bh=vt(),Oc=er(),jt=class e extends Bh.YAMLSeq{constructor(){super(),this.add=Js.YAMLMap.prototype.add.bind(this),this.delete=Js.YAMLMap.prototype.delete.bind(this),this.get=Js.YAMLMap.prototype.get.bind(this),this.has=Js.YAMLMap.prototype.has.bind(this),this.set=Js.YAMLMap.prototype.set.bind(this),this.tag=e.tag}toJSON(s,t){if(!t)return super.toJSON(s);let n=new Map;t?.onCreate&&t.onCreate(n);for(let i of this.items){let r,o;if(xc.isPair(i)?(r=Ri.toJS(i.key,"",t),o=Ri.toJS(i.value,r,t)):r=Ri.toJS(i,"",t),n.has(r))throw new Error("Ordered maps must not include duplicate keys");n.set(r,o)}return n}static from(s,t,n){let i=Oc.createPairs(s,t,n),r=new this;return r.items=i.items,r}};jt.tag="tag:yaml.org,2002:omap";var Uh={collection:"seq",identify:e=>e instanceof Map,nodeClass:jt,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,s){let t=Oc.resolvePairs(e,s),n=[];for(let{key:i}of t.items)xc.isScalar(i)&&(n.includes(i.value)?s(`Ordered maps must not include duplicate keys: ${i.value}`):n.push(i.value));return Object.assign(new jt,t)},createNode:(e,s,t)=>jt.from(e,s,t)};Ci.YAMLOMap=jt;Ci.omap=Uh});var $c=_(Ii=>{"use strict";var Lc=le();function Nc({value:e,source:s},t){return s&&(e?Dc:Mc).test.test(s)?s:e?t.options.trueStr:t.options.falseStr}var Dc={identify:e=>e===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Lc.Scalar(!0),stringify:Nc},Mc={identify:e=>e===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Lc.Scalar(!1),stringify:Nc};Ii.falseTag=Mc;Ii.trueTag=Dc});var jc=_(tr=>{"use strict";var qh=le(),_i=rs(),Gh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>e.slice(-3).toLowerCase()==="nan"?NaN:e[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:_i.stringifyNumber},Hh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){let s=Number(e.value);return isFinite(s)?s.toExponential():_i.stringifyNumber(e)}},Wh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){let s=new qh.Scalar(parseFloat(e.replace(/_/g,""))),t=e.indexOf(".");if(t!==-1){let n=e.substring(t+1).replace(/_/g,"");n[n.length-1]==="0"&&(s.minFractionDigits=n.length)}return s},stringify:_i.stringifyNumber};tr.float=Wh;tr.floatExp=Hh;tr.floatNaN=Gh});var Bc=_(zs=>{"use strict";var Fc=rs(),Ks=e=>typeof e=="bigint"||Number.isInteger(e);function sr(e,s,t,{intAsBigInt:n}){let i=e[0];if((i==="-"||i==="+")&&(s+=1),e=e.substring(s).replace(/_/g,""),n){switch(t){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`;break}let o=BigInt(e);return i==="-"?BigInt(-1)*o:o}let r=parseInt(e,t);return i==="-"?-1*r:r}function Ti(e,s,t){let{value:n}=e;if(Ks(n)){let i=n.toString(s);return n<0?"-"+t+i.substr(1):t+i}return Fc.stringifyNumber(e)}var Jh={identify:Ks,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,s,t)=>sr(e,2,2,t),stringify:e=>Ti(e,2,"0b")},Kh={identify:Ks,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,s,t)=>sr(e,1,8,t),stringify:e=>Ti(e,8,"0")},zh={identify:Ks,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,s,t)=>sr(e,0,10,t),stringify:Fc.stringifyNumber},Vh={identify:Ks,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,s,t)=>sr(e,2,16,t),stringify:e=>Ti(e,16,"0x")};zs.int=zh;zs.intBin=Jh;zs.intHex=Vh;zs.intOct=Kh});var Oi=_(xi=>{"use strict";var ir=G(),nr=bt(),rr=kt(),Ft=class e extends rr.YAMLMap{constructor(s){super(s),this.tag=e.tag}add(s){let t;ir.isPair(s)?t=s:s&&typeof s=="object"&&"key"in s&&"value"in s&&s.value===null?t=new nr.Pair(s.key,null):t=new nr.Pair(s,null),rr.findPair(this.items,t.key)||this.items.push(t)}get(s,t){let n=rr.findPair(this.items,s);return!t&&ir.isPair(n)?ir.isScalar(n.key)?n.key.value:n.key:n}set(s,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);let n=rr.findPair(this.items,s);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new nr.Pair(s))}toJSON(s,t){return super.toJSON(s,t,Set)}toString(s,t,n){if(!s)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},s,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(s,t,n){let{replacer:i}=n,r=new this(s);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof i=="function"&&(o=i.call(t,o,o)),r.items.push(nr.createPair(o,null,n));return r}};Ft.tag="tag:yaml.org,2002:set";var Yh={collection:"map",identify:e=>e instanceof Set,nodeClass:Ft,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,s,t)=>Ft.from(e,s,t),resolve(e,s){if(ir.isMap(e)){if(e.hasAllNullValues(!0))return Object.assign(new Ft,e);s("Set items must all have null values")}else s("Expected a mapping for this tag");return e}};xi.YAMLSet=Ft;xi.set=Yh});var Ni=_(or=>{"use strict";var Zh=rs();function Li(e,s){let t=e[0],n=t==="-"||t==="+"?e.substring(1):e,i=o=>s?BigInt(o):Number(o),r=n.replace(/_/g,"").split(":").reduce((o,a)=>o*i(60)+i(a),i(0));return t==="-"?i(-1)*r:r}function Uc(e){let{value:s}=e,t=o=>o;if(typeof s=="bigint")t=o=>BigInt(o);else if(isNaN(s)||!isFinite(s))return Zh.stringifyNumber(e);let n="";s<0&&(n="-",s*=t(-1));let i=t(60),r=[s%i];return s<60?r.unshift(0):(s=(s-r[0])/i,r.unshift(s%i),s>=60&&(s=(s-r[0])/i,r.unshift(s))),n+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var Xh={identify:e=>typeof e=="bigint"||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,s,{intAsBigInt:t})=>Li(e,t),stringify:Uc},Qh={identify:e=>typeof e=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>Li(e,!1),stringify:Uc},qc={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){let s=e.match(qc.test);if(!s)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,t,n,i,r,o,a]=s.map(Number),c=s[7]?Number((s[7]+"00").substr(1,3)):0,l=Date.UTC(t,n-1,i,r||0,o||0,a||0,c),u=s[8];if(u&&u!=="Z"){let d=Li(u,!1);Math.abs(d)<30&&(d*=60),l-=6e4*d}return new Date(l)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""};or.floatTime=Qh;or.intTime=Xh;or.timestamp=qc});var Wc=_(Hc=>{"use strict";var em=ss(),tm=Kn(),sm=ns(),nm=Hs(),rm=Ei(),Gc=$c(),Di=jc(),ar=Bc(),im=Fn(),om=Pi(),am=er(),cm=Oi(),Mi=Ni(),lm=[em.map,sm.seq,nm.string,tm.nullTag,Gc.trueTag,Gc.falseTag,ar.intBin,ar.intOct,ar.int,ar.intHex,Di.floatNaN,Di.floatExp,Di.float,rm.binary,im.merge,om.omap,am.pairs,cm.set,Mi.intTime,Mi.floatTime,Mi.timestamp];Hc.schema=lm});var tl=_(Fi=>{"use strict";var Vc=ss(),um=Kn(),Yc=ns(),dm=Hs(),fm=hi(),$i=yi(),ji=bi(),pm=Ac(),gm=Pc(),Zc=Ei(),Vs=Fn(),Xc=Pi(),Qc=er(),Jc=Wc(),el=Oi(),cr=Ni(),Kc=new Map([["core",pm.schema],["failsafe",[Vc.map,Yc.seq,dm.string]],["json",gm.schema],["yaml11",Jc.schema],["yaml-1.1",Jc.schema]]),zc={binary:Zc.binary,bool:fm.boolTag,float:$i.float,floatExp:$i.floatExp,floatNaN:$i.floatNaN,floatTime:cr.floatTime,int:ji.int,intHex:ji.intHex,intOct:ji.intOct,intTime:cr.intTime,map:Vc.map,merge:Vs.merge,null:um.nullTag,omap:Xc.omap,pairs:Qc.pairs,seq:Yc.seq,set:el.set,timestamp:cr.timestamp},hm={"tag:yaml.org,2002:binary":Zc.binary,"tag:yaml.org,2002:merge":Vs.merge,"tag:yaml.org,2002:omap":Xc.omap,"tag:yaml.org,2002:pairs":Qc.pairs,"tag:yaml.org,2002:set":el.set,"tag:yaml.org,2002:timestamp":cr.timestamp};function mm(e,s,t){let n=Kc.get(s);if(n&&!e)return t&&!n.includes(Vs.merge)?n.concat(Vs.merge):n.slice();let i=n;if(!i)if(Array.isArray(e))i=[];else{let r=Array.from(Kc.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${s}"; use one of ${r} or define customTags array`)}if(Array.isArray(e))for(let r of e)i=i.concat(r);else typeof e=="function"&&(i=e(i.slice()));return t&&(i=i.concat(Vs.merge)),i.reduce((r,o)=>{let a=typeof o=="string"?zc[o]:o;if(!a){let c=JSON.stringify(o),l=Object.keys(zc).map(u=>JSON.stringify(u)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${l}`)}return r.includes(a)||r.push(a),r},[])}Fi.coreKnownTags=hm;Fi.getTags=mm});var qi=_(sl=>{"use strict";var Bi=G(),ym=ss(),wm=ns(),bm=Hs(),lr=tl(),Sm=(e,s)=>e.key<s.key?-1:e.key>s.key?1:0,Ui=class e{constructor({compat:s,customTags:t,merge:n,resolveKnownTags:i,schema:r,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(s)?lr.getTags(s,"compat"):s?lr.getTags(null,s):null,this.name=typeof r=="string"&&r||"core",this.knownTags=i?lr.coreKnownTags:{},this.tags=lr.getTags(t,this.name,n),this.toStringOptions=a??null,Object.defineProperty(this,Bi.MAP,{value:ym.map}),Object.defineProperty(this,Bi.SCALAR,{value:bm.string}),Object.defineProperty(this,Bi.SEQ,{value:wm.seq}),this.sortMapEntries=typeof o=="function"?o:o===!0?Sm:null}clone(){let s=Object.create(e.prototype,Object.getOwnPropertyDescriptors(this));return s.tags=this.tags.slice(),s}};sl.Schema=Ui});var rl=_(nl=>{"use strict";var km=G(),Gi=Bs(),Ys=Ms();function vm(e,s){let t=[],n=s.directives===!0;if(s.directives!==!1&&e.directives){let c=e.directives.toString(e);c?(t.push(c),n=!0):e.directives.docStart&&(n=!0)}n&&t.push("---");let i=Gi.createStringifyContext(e,s),{commentString:r}=i.options;if(e.commentBefore){t.length!==1&&t.unshift("");let c=r(e.commentBefore);t.unshift(Ys.indentComment(c,""))}let o=!1,a=null;if(e.contents){if(km.isNode(e.contents)){if(e.contents.spaceBefore&&n&&t.push(""),e.contents.commentBefore){let u=r(e.contents.commentBefore);t.push(Ys.indentComment(u,""))}i.forceBlockIndent=!!e.comment,a=e.contents.comment}let c=a?void 0:()=>o=!0,l=Gi.stringify(e.contents,i,()=>a=null,c);a&&(l+=Ys.lineComment(l,"",r(a))),(l[0]==="|"||l[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${l}`:t.push(l)}else t.push(Gi.stringify(e.contents,i));if(e.directives?.docEnd)if(e.comment){let c=r(e.comment);c.includes(`
`)?(t.push("..."),t.push(Ys.indentComment(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=e.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||a)&&t[t.length-1]!==""&&t.push(""),t.push(Ys.indentComment(r(c),"")))}return t.join(`
`)+`
`}nl.stringifyDocument=vm});var Zs=_(il=>{"use strict";var Em=Ns(),is=Tn(),Fe=G(),Am=bt(),Rm=ht(),Cm=qi(),Pm=rl(),Hi=Cn(),Im=zr(),_m=Ds(),Wi=Kr(),Ji=class e{constructor(s,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,Fe.NODE_TYPE,{value:Fe.DOC});let i=null;typeof t=="function"||Array.isArray(t)?i=t:n===void 0&&t&&(n=t,t=void 0);let r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=r;let{version:o}=r;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new Wi.Directives({version:o}),this.setSchema(o,n),this.contents=s===void 0?null:this.createNode(s,i,n)}clone(){let s=Object.create(e.prototype,{[Fe.NODE_TYPE]:{value:Fe.DOC}});return s.commentBefore=this.commentBefore,s.comment=this.comment,s.errors=this.errors.slice(),s.warnings=this.warnings.slice(),s.options=Object.assign({},this.options),this.directives&&(s.directives=this.directives.clone()),s.schema=this.schema.clone(),s.contents=Fe.isNode(this.contents)?this.contents.clone(s.schema):this.contents,this.range&&(s.range=this.range.slice()),s}add(s){os(this.contents)&&this.contents.add(s)}addIn(s,t){os(this.contents)&&this.contents.addIn(s,t)}createAlias(s,t){if(!s.anchor){let n=Hi.anchorNames(this);s.anchor=!t||n.has(t)?Hi.findNewAnchor(t||"a",n):t}return new Em.Alias(s.anchor)}createNode(s,t,n){let i;if(typeof t=="function")s=t.call({"":s},"",s),i=t;else if(Array.isArray(t)){let y=S=>typeof S=="number"||S instanceof String||S instanceof Number,w=t.filter(y).map(String);w.length>0&&(t=t.concat(w)),i=t}else n===void 0&&t&&(n=t,t=void 0);let{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:c,onTagObj:l,tag:u}=n??{},{onAnchor:d,setAnchors:h,sourceObjects:f}=Hi.createNodeAnchors(this,o||"a"),p={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:d,onTagObj:l,replacer:i,schema:this.schema,sourceObjects:f},g=_m.createNode(s,u,p);return a&&Fe.isCollection(g)&&(g.flow=!0),h(),g}createPair(s,t,n={}){let i=this.createNode(s,null,n),r=this.createNode(t,null,n);return new Am.Pair(i,r)}delete(s){return os(this.contents)?this.contents.delete(s):!1}deleteIn(s){return is.isEmptyPath(s)?this.contents==null?!1:(this.contents=null,!0):os(this.contents)?this.contents.deleteIn(s):!1}get(s,t){return Fe.isCollection(this.contents)?this.contents.get(s,t):void 0}getIn(s,t){return is.isEmptyPath(s)?!t&&Fe.isScalar(this.contents)?this.contents.value:this.contents:Fe.isCollection(this.contents)?this.contents.getIn(s,t):void 0}has(s){return Fe.isCollection(this.contents)?this.contents.has(s):!1}hasIn(s){return is.isEmptyPath(s)?this.contents!==void 0:Fe.isCollection(this.contents)?this.contents.hasIn(s):!1}set(s,t){this.contents==null?this.contents=is.collectionFromPath(this.schema,[s],t):os(this.contents)&&this.contents.set(s,t)}setIn(s,t){is.isEmptyPath(s)?this.contents=t:this.contents==null?this.contents=is.collectionFromPath(this.schema,Array.from(s),t):os(this.contents)&&this.contents.setIn(s,t)}setSchema(s,t={}){typeof s=="number"&&(s=String(s));let n;switch(s){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Wi.Directives({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=s:this.directives=new Wi.Directives({version:s}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{let i=JSON.stringify(s);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(n)this.schema=new Cm.Schema(Object.assign(n,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:s,jsonArg:t,mapAsMap:n,maxAliasCount:i,onAnchor:r,reviver:o}={}){let a={anchors:new Map,doc:this,keep:!s,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=Rm.toJS(this.contents,t??"",a);if(typeof r=="function")for(let{count:l,res:u}of a.anchors.values())r(u,l);return typeof o=="function"?Im.applyReviver(o,{"":c},"",c):c}toJSON(s,t){return this.toJS({json:!0,jsonArg:s,mapAsMap:!1,onAnchor:t})}toString(s={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in s&&(!Number.isInteger(s.indent)||Number(s.indent)<=0)){let t=JSON.stringify(s.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Pm.stringifyDocument(this,s)}};function os(e){if(Fe.isCollection(e))return!0;throw new Error("Expected a YAML collection as document contents")}il.Document=Ji});var en=_(Qs=>{"use strict";var Xs=class extends Error{constructor(s,t,n,i){super(),this.name=s,this.code=n,this.message=i,this.pos=t}},Ki=class extends Xs{constructor(s,t,n){super("YAMLParseError",s,t,n)}},zi=class extends Xs{constructor(s,t,n){super("YAMLWarning",s,t,n)}},Tm=(e,s)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(a=>s.linePos(a));let{line:n,col:i}=t.linePos[0];t.message+=` at line ${n}, column ${i}`;let r=i-1,o=e.substring(s.lineStarts[n-1],s.lineStarts[n]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){let a=Math.min(r-39,o.length-79);o="\u2026"+o.substring(a),r-=a-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),n>1&&/^ *$/.test(o.substring(0,r))){let a=e.substring(s.lineStarts[n-2],s.lineStarts[n-1]);a.length>80&&(a=a.substring(0,79)+`\u2026
`),o=a+o}if(/[^ ]/.test(o)){let a=1,c=t.linePos[1];c?.line===n&&c.col>i&&(a=Math.max(1,Math.min(c.col-i,80-r)));let l=" ".repeat(r)+"^".repeat(a);t.message+=`:

${o}
${l}
`}};Qs.YAMLError=Xs;Qs.YAMLParseError=Ki;Qs.YAMLWarning=zi;Qs.prettifyError=Tm});var tn=_(ol=>{"use strict";function xm(e,{flow:s,indicator:t,next:n,offset:i,onError:r,parentIndent:o,startOnNewline:a}){let c=!1,l=a,u=a,d="",h="",f=!1,p=!1,g=null,y=null,w=null,S=null,m=null,b=null,k=null;for(let A of e)switch(p&&(A.type!=="space"&&A.type!=="newline"&&A.type!=="comma"&&r(A.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p=!1),g&&(l&&A.type!=="comment"&&A.type!=="newline"&&r(g,"TAB_AS_INDENT","Tabs are not allowed as indentation"),g=null),A.type){case"space":!s&&(t!=="doc-start"||n?.type!=="flow-collection")&&A.source.includes("	")&&(g=A),u=!0;break;case"comment":{u||r(A,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let R=A.source.substring(1)||" ";d?d+=h+R:d=R,h="",l=!1;break}case"newline":l?d?d+=A.source:(!b||t!=="seq-item-ind")&&(c=!0):h+=A.source,l=!0,f=!0,(y||w)&&(S=A),u=!0;break;case"anchor":y&&r(A,"MULTIPLE_ANCHORS","A node can have at most one anchor"),A.source.endsWith(":")&&r(A.offset+A.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),y=A,k??(k=A.offset),l=!1,u=!1,p=!0;break;case"tag":{w&&r(A,"MULTIPLE_TAGS","A node can have at most one tag"),w=A,k??(k=A.offset),l=!1,u=!1,p=!0;break}case t:(y||w)&&r(A,"BAD_PROP_ORDER",`Anchors and tags must be after the ${A.source} indicator`),b&&r(A,"UNEXPECTED_TOKEN",`Unexpected ${A.source} in ${s??"collection"}`),b=A,l=t==="seq-item-ind"||t==="explicit-key-ind",u=!1;break;case"comma":if(s){m&&r(A,"UNEXPECTED_TOKEN",`Unexpected , in ${s}`),m=A,l=!1,u=!1;break}default:r(A,"UNEXPECTED_TOKEN",`Unexpected ${A.type} token`),l=!1,u=!1}let v=e[e.length-1],E=v?v.offset+v.source.length:i;return p&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&r(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g&&(l&&g.indent<=o||n?.type==="block-map"||n?.type==="block-seq")&&r(g,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:m,found:b,spaceBefore:c,comment:d,hasNewline:f,anchor:y,tag:w,newlineAfterProp:S,end:E,start:k??E}}ol.resolveProps=xm});var ur=_(al=>{"use strict";function Vi(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(e.source.includes(`
`))return!0;if(e.end){for(let s of e.end)if(s.type==="newline")return!0}return!1;case"flow-collection":for(let s of e.items){for(let t of s.start)if(t.type==="newline")return!0;if(s.sep){for(let t of s.sep)if(t.type==="newline")return!0}if(Vi(s.key)||Vi(s.value))return!0}return!1;default:return!0}}al.containsNewline=Vi});var Yi=_(cl=>{"use strict";var Om=ur();function Lm(e,s,t){if(s?.type==="flow-collection"){let n=s.end[0];n.indent===e&&(n.source==="]"||n.source==="}")&&Om.containsNewline(s)&&t(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}cl.flowIndentCheck=Lm});var Zi=_(ul=>{"use strict";var ll=G();function Nm(e,s,t){let{uniqueKeys:n}=e.options;if(n===!1)return!1;let i=typeof n=="function"?n:(r,o)=>r===o||ll.isScalar(r)&&ll.isScalar(o)&&r.value===o.value;return s.some(r=>i(r.key,t))}ul.mapIncludes=Nm});var ml=_(hl=>{"use strict";var dl=bt(),Dm=kt(),fl=tn(),Mm=ur(),pl=Yi(),$m=Zi(),gl="All mapping items must start at the same column";function jm({composeNode:e,composeEmptyNode:s},t,n,i,r){let o=r?.nodeClass??Dm.YAMLMap,a=new o(t.schema);t.atRoot&&(t.atRoot=!1);let c=n.offset,l=null;for(let u of n.items){let{start:d,key:h,sep:f,value:p}=u,g=fl.resolveProps(d,{indicator:"explicit-key-ind",next:h??f?.[0],offset:c,onError:i,parentIndent:n.indent,startOnNewline:!0}),y=!g.found;if(y){if(h&&(h.type==="block-seq"?i(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in h&&h.indent!==n.indent&&i(c,"BAD_INDENT",gl)),!g.anchor&&!g.tag&&!f){l=g.end,g.comment&&(a.comment?a.comment+=`
`+g.comment:a.comment=g.comment);continue}(g.newlineAfterProp||Mm.containsNewline(h))&&i(h??d[d.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else g.found?.indent!==n.indent&&i(c,"BAD_INDENT",gl);t.atKey=!0;let w=g.end,S=h?e(t,h,g,i):s(t,w,d,null,g,i);t.schema.compat&&pl.flowIndentCheck(n.indent,h,i),t.atKey=!1,$m.mapIncludes(t,a.items,S)&&i(w,"DUPLICATE_KEY","Map keys must be unique");let m=fl.resolveProps(f??[],{indicator:"map-value-ind",next:p,offset:S.range[2],onError:i,parentIndent:n.indent,startOnNewline:!h||h.type==="block-scalar"});if(c=m.end,m.found){y&&(p?.type==="block-map"&&!m.hasNewline&&i(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&g.start<m.found.offset-1024&&i(S.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let b=p?e(t,p,m,i):s(t,c,f,null,m,i);t.schema.compat&&pl.flowIndentCheck(n.indent,p,i),c=b.range[2];let k=new dl.Pair(S,b);t.options.keepSourceTokens&&(k.srcToken=u),a.items.push(k)}else{y&&i(S.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),m.comment&&(S.comment?S.comment+=`
`+m.comment:S.comment=m.comment);let b=new dl.Pair(S);t.options.keepSourceTokens&&(b.srcToken=u),a.items.push(b)}}return l&&l<c&&i(l,"IMPOSSIBLE","Map comment with trailing content"),a.range=[n.offset,c,l??c],a}hl.resolveBlockMap=jm});var wl=_(yl=>{"use strict";var Fm=vt(),Bm=tn(),Um=Yi();function qm({composeNode:e,composeEmptyNode:s},t,n,i,r){let o=r?.nodeClass??Fm.YAMLSeq,a=new o(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let c=n.offset,l=null;for(let{start:u,value:d}of n.items){let h=Bm.resolveProps(u,{indicator:"seq-item-ind",next:d,offset:c,onError:i,parentIndent:n.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||d)d?.type==="block-seq"?i(h.end,"BAD_INDENT","All sequence items must start at the same column"):i(c,"MISSING_CHAR","Sequence item without - indicator");else{l=h.end,h.comment&&(a.comment=h.comment);continue}let f=d?e(t,d,h,i):s(t,h.end,u,null,h,i);t.schema.compat&&Um.flowIndentCheck(n.indent,d,i),c=f.range[2],a.items.push(f)}return a.range=[n.offset,c,l??c],a}yl.resolveBlockSeq=qm});var as=_(bl=>{"use strict";function Gm(e,s,t,n){let i="";if(e){let r=!1,o="";for(let a of e){let{source:c,type:l}=a;switch(l){case"space":r=!0;break;case"comment":{t&&!r&&n(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let u=c.substring(1)||" ";i?i+=o+u:i=u,o="";break}case"newline":i&&(o+=c),r=!0;break;default:n(a,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}s+=c.length}}return{comment:i,offset:s}}bl.resolveEnd=Gm});var El=_(vl=>{"use strict";var Hm=G(),Wm=bt(),Sl=kt(),Jm=vt(),Km=as(),kl=tn(),zm=ur(),Vm=Zi(),Xi="Block collections are not allowed within flow collections",Qi=e=>e&&(e.type==="block-map"||e.type==="block-seq");function Ym({composeNode:e,composeEmptyNode:s},t,n,i,r){let o=n.start.source==="{",a=o?"flow map":"flow sequence",c=r?.nodeClass??(o?Sl.YAMLMap:Jm.YAMLSeq),l=new c(t.schema);l.flow=!0;let u=t.atRoot;u&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let d=n.offset+n.start.source.length;for(let y=0;y<n.items.length;++y){let w=n.items[y],{start:S,key:m,sep:b,value:k}=w,v=kl.resolveProps(S,{flow:a,indicator:"explicit-key-ind",next:m??b?.[0],offset:d,onError:i,parentIndent:n.indent,startOnNewline:!1});if(!v.found){if(!v.anchor&&!v.tag&&!b&&!k){y===0&&v.comma?i(v.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):y<n.items.length-1&&i(v.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),v.comment&&(l.comment?l.comment+=`
`+v.comment:l.comment=v.comment),d=v.end;continue}!o&&t.options.strict&&zm.containsNewline(m)&&i(m,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(y===0)v.comma&&i(v.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(v.comma||i(v.start,"MISSING_CHAR",`Missing , between ${a} items`),v.comment){let E="";e:for(let A of S)switch(A.type){case"comma":case"space":break;case"comment":E=A.source.substring(1);break e;default:break e}if(E){let A=l.items[l.items.length-1];Hm.isPair(A)&&(A=A.value??A.key),A.comment?A.comment+=`
`+E:A.comment=E,v.comment=v.comment.substring(E.length+1)}}if(!o&&!b&&!v.found){let E=k?e(t,k,v,i):s(t,v.end,b,null,v,i);l.items.push(E),d=E.range[2],Qi(k)&&i(E.range,"BLOCK_IN_FLOW",Xi)}else{t.atKey=!0;let E=v.end,A=m?e(t,m,v,i):s(t,E,S,null,v,i);Qi(m)&&i(A.range,"BLOCK_IN_FLOW",Xi),t.atKey=!1;let R=kl.resolveProps(b??[],{flow:a,indicator:"map-value-ind",next:k,offset:A.range[2],onError:i,parentIndent:n.indent,startOnNewline:!1});if(R.found){if(!o&&!v.found&&t.options.strict){if(b)for(let I of b){if(I===R.found)break;if(I.type==="newline"){i(I,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}v.start<R.found.offset-1024&&i(R.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else k&&("source"in k&&k.source?.[0]===":"?i(k,"MISSING_CHAR",`Missing space after : in ${a}`):i(R.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let x=k?e(t,k,R,i):R.found?s(t,R.end,b,null,R,i):null;x?Qi(k)&&i(x.range,"BLOCK_IN_FLOW",Xi):R.comment&&(A.comment?A.comment+=`
`+R.comment:A.comment=R.comment);let P=new Wm.Pair(A,x);if(t.options.keepSourceTokens&&(P.srcToken=w),o){let I=l;Vm.mapIncludes(t,I.items,A)&&i(E,"DUPLICATE_KEY","Map keys must be unique"),I.items.push(P)}else{let I=new Sl.YAMLMap(t.schema);I.flow=!0,I.items.push(P);let B=(x??A).range;I.range=[A.range[0],B[1],B[2]],l.items.push(I)}d=x?x.range[2]:R.end}}let h=o?"}":"]",[f,...p]=n.end,g=d;if(f?.source===h)g=f.offset+f.source.length;else{let y=a[0].toUpperCase()+a.substring(1),w=u?`${y} must end with a ${h}`:`${y} in block collection must be sufficiently indented and end with a ${h}`;i(d,u?"MISSING_CHAR":"BAD_INDENT",w),f&&f.source.length!==1&&p.unshift(f)}if(p.length>0){let y=Km.resolveEnd(p,g,t.options.strict,i);y.comment&&(l.comment?l.comment+=`
`+y.comment:l.comment=y.comment),l.range=[n.offset,g,y.offset]}else l.range=[n.offset,g,g];return l}vl.resolveFlowCollection=Ym});var Rl=_(Al=>{"use strict";var Zm=G(),Xm=le(),Qm=kt(),ey=vt(),ty=ml(),sy=wl(),ny=El();function eo(e,s,t,n,i,r){let o=t.type==="block-map"?ty.resolveBlockMap(e,s,t,n,r):t.type==="block-seq"?sy.resolveBlockSeq(e,s,t,n,r):ny.resolveFlowCollection(e,s,t,n,r),a=o.constructor;return i==="!"||i===a.tagName?(o.tag=a.tagName,o):(i&&(o.tag=i),o)}function ry(e,s,t,n,i){let r=n.tag,o=r?s.directives.tagName(r.source,h=>i(r,"TAG_RESOLVE_FAILED",h)):null;if(t.type==="block-seq"){let{anchor:h,newlineAfterProp:f}=n,p=h&&r?h.offset>r.offset?h:r:h??r;p&&(!f||f.offset<p.offset)&&i(p,"MISSING_CHAR","Missing newline after block sequence props")}let a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!o||o==="!"||o===Qm.YAMLMap.tagName&&a==="map"||o===ey.YAMLSeq.tagName&&a==="seq")return eo(e,s,t,i,o);let c=s.schema.tags.find(h=>h.tag===o&&h.collection===a);if(!c){let h=s.schema.knownTags[o];if(h?.collection===a)s.schema.tags.push(Object.assign({},h,{default:!1})),c=h;else return h?i(r,"BAD_COLLECTION_TYPE",`${h.tag} used for ${a} collection, but expects ${h.collection??"scalar"}`,!0):i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),eo(e,s,t,i,o)}let l=eo(e,s,t,i,o,c),u=c.resolve?.(l,h=>i(r,"TAG_RESOLVE_FAILED",h),s.options)??l,d=Zm.isNode(u)?u:new Xm.Scalar(u);return d.range=l.range,d.tag=o,c?.format&&(d.format=c.format),d}Al.composeCollection=ry});var so=_(Cl=>{"use strict";var to=le();function iy(e,s,t){let n=s.offset,i=oy(s,e.options.strict,t);if(!i)return{value:"",type:null,comment:"",range:[n,n,n]};let r=i.mode===">"?to.Scalar.BLOCK_FOLDED:to.Scalar.BLOCK_LITERAL,o=s.source?ay(s.source):[],a=o.length;for(let g=o.length-1;g>=0;--g){let y=o[g][1];if(y===""||y==="\r")a=g;else break}if(a===0){let g=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"",y=n+i.length;return s.source&&(y+=s.source.length),{value:g,type:r,comment:i.comment,range:[n,y,y]}}let c=s.indent+i.indent,l=s.offset+i.length,u=0;for(let g=0;g<a;++g){let[y,w]=o[g];if(w===""||w==="\r")i.indent===0&&y.length>c&&(c=y.length);else{y.length<c&&t(l+y.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(c=y.length),u=g,c===0&&!e.atRoot&&t(l,"BAD_INDENT","Block scalar values in collections must be indented");break}l+=y.length+w.length+1}for(let g=o.length-1;g>=a;--g)o[g][0].length>c&&(a=g+1);let d="",h="",f=!1;for(let g=0;g<u;++g)d+=o[g][0].slice(c)+`
`;for(let g=u;g<a;++g){let[y,w]=o[g];l+=y.length+w.length+1;let S=w[w.length-1]==="\r";if(S&&(w=w.slice(0,-1)),w&&y.length<c){let b=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;t(l-w.length-(S?2:1),"BAD_INDENT",b),y=""}r===to.Scalar.BLOCK_LITERAL?(d+=h+y.slice(c)+w,h=`
`):y.length>c||w[0]==="	"?(h===" "?h=`
`:!f&&h===`
`&&(h=`

`),d+=h+y.slice(c)+w,h=`
`,f=!0):w===""?h===`
`?d+=`
`:h=`
`:(d+=h+w,h=" ",f=!1)}switch(i.chomp){case"-":break;case"+":for(let g=a;g<o.length;++g)d+=`
`+o[g][0].slice(c);d[d.length-1]!==`
`&&(d+=`
`);break;default:d+=`
`}let p=n+i.length+s.source.length;return{value:d,type:r,comment:i.comment,range:[n,p,p]}}function oy({offset:e,props:s},t,n){if(s[0].type!=="block-scalar-header")return n(s[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:i}=s[0],r=i[0],o=0,a="",c=-1;for(let h=1;h<i.length;++h){let f=i[h];if(!a&&(f==="-"||f==="+"))a=f;else{let p=Number(f);!o&&p?o=p:c===-1&&(c=e+h)}}c!==-1&&n(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let l=!1,u="",d=i.length;for(let h=1;h<s.length;++h){let f=s[h];switch(f.type){case"space":l=!0;case"newline":d+=f.source.length;break;case"comment":t&&!l&&n(f,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),d+=f.source.length,u=f.source.substring(1);break;case"error":n(f,"UNEXPECTED_TOKEN",f.message),d+=f.source.length;break;default:{let p=`Unexpected token in block scalar header: ${f.type}`;n(f,"UNEXPECTED_TOKEN",p);let g=f.source;g&&typeof g=="string"&&(d+=g.length)}}}return{mode:r,indent:o,chomp:a,comment:u,length:d}}function ay(e){let s=e.split(/\n( *)/),t=s[0],n=t.match(/^( *)/),r=[n?.[1]?[n[1],t.slice(n[1].length)]:["",t]];for(let o=1;o<s.length;o+=2)r.push([s[o],s[o+1]]);return r}Cl.resolveBlockScalar=iy});var ro=_(Il=>{"use strict";var no=le(),cy=as();function ly(e,s,t){let{offset:n,type:i,source:r,end:o}=e,a,c,l=(h,f,p)=>t(n+h,f,p);switch(i){case"scalar":a=no.Scalar.PLAIN,c=uy(r,l);break;case"single-quoted-scalar":a=no.Scalar.QUOTE_SINGLE,c=dy(r,l);break;case"double-quoted-scalar":a=no.Scalar.QUOTE_DOUBLE,c=fy(r,l);break;default:return t(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[n,n+r.length,n+r.length]}}let u=n+r.length,d=cy.resolveEnd(o,u,s,t);return{value:c,type:a,comment:d.comment,range:[n,u,d.offset]}}function uy(e,s){let t="";switch(e[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${e[0]}`;break}case"@":case"`":{t=`reserved character ${e[0]}`;break}}return t&&s(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),Pl(e)}function dy(e,s){return(e[e.length-1]!=="'"||e.length===1)&&s(e.length,"MISSING_CHAR","Missing closing 'quote"),Pl(e.slice(1,-1)).replace(/''/g,"'")}function Pl(e){let s,t;try{s=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{s=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=s.exec(e);if(!n)return e;let i=n[1],r=" ",o=s.lastIndex;for(t.lastIndex=o;n=t.exec(e);)n[1]===""?r===`
`?i+=r:r=`
`:(i+=r+n[1],r=" "),o=t.lastIndex;let a=/[ \t]*(.*)/sy;return a.lastIndex=o,n=a.exec(e),i+r+(n?.[1]??"")}function fy(e,s){let t="";for(let n=1;n<e.length-1;++n){let i=e[n];if(!(i==="\r"&&e[n+1]===`
`))if(i===`
`){let{fold:r,offset:o}=py(e,n);t+=r,n=o}else if(i==="\\"){let r=e[++n],o=gy[r];if(o)t+=o;else if(r===`
`)for(r=e[n+1];r===" "||r==="	";)r=e[++n+1];else if(r==="\r"&&e[n+1]===`
`)for(r=e[++n+1];r===" "||r==="	";)r=e[++n+1];else if(r==="x"||r==="u"||r==="U"){let a={x:2,u:4,U:8}[r];t+=hy(e,n+1,a,s),n+=a}else{let a=e.substr(n-1,2);s(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),t+=a}}else if(i===" "||i==="	"){let r=n,o=e[n+1];for(;o===" "||o==="	";)o=e[++n+1];o!==`
`&&!(o==="\r"&&e[n+2]===`
`)&&(t+=n>r?e.slice(r,n+1):i)}else t+=i}return(e[e.length-1]!=='"'||e.length===1)&&s(e.length,"MISSING_CHAR",'Missing closing "quote'),t}function py(e,s){let t="",n=e[s+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&e[s+2]!==`
`);)n===`
`&&(t+=`
`),s+=1,n=e[s+1];return t||(t=" "),{fold:t,offset:s}}var gy={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function hy(e,s,t,n){let i=e.substr(s,t),o=i.length===t&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){let a=e.substr(s-2,t+2);return n(s-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}Il.resolveFlowScalar=ly});var xl=_(Tl=>{"use strict";var Bt=G(),_l=le(),my=so(),yy=ro();function wy(e,s,t,n){let{value:i,type:r,comment:o,range:a}=s.type==="block-scalar"?my.resolveBlockScalar(e,s,n):yy.resolveFlowScalar(s,e.options.strict,n),c=t?e.directives.tagName(t.source,d=>n(t,"TAG_RESOLVE_FAILED",d)):null,l;e.options.stringKeys&&e.atKey?l=e.schema[Bt.SCALAR]:c?l=by(e.schema,i,c,t,n):s.type==="scalar"?l=Sy(e,i,s,n):l=e.schema[Bt.SCALAR];let u;try{let d=l.resolve(i,h=>n(t??s,"TAG_RESOLVE_FAILED",h),e.options);u=Bt.isScalar(d)?d:new _l.Scalar(d)}catch(d){let h=d instanceof Error?d.message:String(d);n(t??s,"TAG_RESOLVE_FAILED",h),u=new _l.Scalar(i)}return u.range=a,u.source=i,r&&(u.type=r),c&&(u.tag=c),l.format&&(u.format=l.format),o&&(u.comment=o),u}function by(e,s,t,n,i){if(t==="!")return e[Bt.SCALAR];let r=[];for(let a of e.tags)if(!a.collection&&a.tag===t)if(a.default&&a.test)r.push(a);else return a;for(let a of r)if(a.test?.test(s))return a;let o=e.knownTags[t];return o&&!o.collection?(e.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),e[Bt.SCALAR])}function Sy({atKey:e,directives:s,schema:t},n,i,r){let o=t.tags.find(a=>(a.default===!0||e&&a.default==="key")&&a.test?.test(n))||t[Bt.SCALAR];if(t.compat){let a=t.compat.find(c=>c.default&&c.test?.test(n))??t[Bt.SCALAR];if(o.tag!==a.tag){let c=s.tagString(o.tag),l=s.tagString(a.tag),u=`Value may be parsed as either ${c} or ${l}`;r(i,"TAG_RESOLVE_FAILED",u,!0)}}return o}Tl.composeScalar=wy});var Ll=_(Ol=>{"use strict";function ky(e,s,t){if(s){t??(t=s.length);for(let n=t-1;n>=0;--n){let i=s[n];switch(i.type){case"space":case"comment":case"newline":e-=i.source.length;continue}for(i=s[++n];i?.type==="space";)e+=i.source.length,i=s[++n];break}}return e}Ol.emptyScalarPosition=ky});var Ml=_(oo=>{"use strict";var vy=Ns(),Ey=G(),Ay=Rl(),Nl=xl(),Ry=as(),Cy=Ll(),Py={composeNode:Dl,composeEmptyNode:io};function Dl(e,s,t,n){let i=e.atKey,{spaceBefore:r,comment:o,anchor:a,tag:c}=t,l,u=!0;switch(s.type){case"alias":l=Iy(e,s,n),(a||c)&&n(s,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=Nl.composeScalar(e,s,c,n),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=Ay.composeCollection(Py,e,s,t,n),a&&(l.anchor=a.source.substring(1));break;default:{let d=s.type==="error"?s.message:`Unsupported token (type: ${s.type})`;n(s,"UNEXPECTED_TOKEN",d),l=io(e,s.offset,void 0,null,t,n),u=!1}}return a&&l.anchor===""&&n(a,"BAD_ALIAS","Anchor cannot be an empty string"),i&&e.options.stringKeys&&(!Ey.isScalar(l)||typeof l.value!="string"||l.tag&&l.tag!=="tag:yaml.org,2002:str")&&n(c??s,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(l.spaceBefore=!0),o&&(s.type==="scalar"&&s.source===""?l.comment=o:l.commentBefore=o),e.options.keepSourceTokens&&u&&(l.srcToken=s),l}function io(e,s,t,n,{spaceBefore:i,comment:r,anchor:o,tag:a,end:c},l){let u={type:"scalar",offset:Cy.emptyScalarPosition(s,t,n),indent:-1,source:""},d=Nl.composeScalar(e,u,a,l);return o&&(d.anchor=o.source.substring(1),d.anchor===""&&l(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(d.spaceBefore=!0),r&&(d.comment=r,d.range[2]=c),d}function Iy({options:e},{offset:s,source:t,end:n},i){let r=new vy.Alias(t.substring(1));r.source===""&&i(s,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&i(s+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let o=s+t.length,a=Ry.resolveEnd(n,o,e.strict,i);return r.range=[s,o,a.offset],a.comment&&(r.comment=a.comment),r}oo.composeEmptyNode=io;oo.composeNode=Dl});var Fl=_(jl=>{"use strict";var _y=Zs(),$l=Ml(),Ty=as(),xy=tn();function Oy(e,s,{offset:t,start:n,value:i,end:r},o){let a=Object.assign({_directives:s},e),c=new _y.Document(void 0,a),l={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},u=xy.resolveProps(n,{indicator:"doc-start",next:i??r?.[0],offset:t,onError:o,parentIndent:0,startOnNewline:!0});u.found&&(c.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!u.hasNewline&&o(u.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=i?$l.composeNode(l,i,u,o):$l.composeEmptyNode(l,u.end,n,null,u,o);let d=c.contents.range[2],h=Ty.resolveEnd(r,d,!1,o);return h.comment&&(c.comment=h.comment),c.range=[t,d,h.offset],c}jl.composeDoc=Oy});var co=_(ql=>{"use strict";var Ly=require("process"),Ny=Kr(),Dy=Zs(),sn=en(),Bl=G(),My=Fl(),$y=as();function nn(e){if(typeof e=="number")return[e,e+1];if(Array.isArray(e))return e.length===2?e:[e[0],e[1]];let{offset:s,source:t}=e;return[s,s+(typeof t=="string"?t.length:1)]}function Ul(e){let s="",t=!1,n=!1;for(let i=0;i<e.length;++i){let r=e[i];switch(r[0]){case"#":s+=(s===""?"":n?`

`:`
`)+(r.substring(1)||" "),t=!0,n=!1;break;case"%":e[i+1]?.[0]!=="#"&&(i+=1),t=!1;break;default:t||(n=!0),t=!1}}return{comment:s,afterEmptyLine:n}}var ao=class{constructor(s={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,n,i,r)=>{let o=nn(t);r?this.warnings.push(new sn.YAMLWarning(o,n,i)):this.errors.push(new sn.YAMLParseError(o,n,i))},this.directives=new Ny.Directives({version:s.version||"1.2"}),this.options=s}decorate(s,t){let{comment:n,afterEmptyLine:i}=Ul(this.prelude);if(n){let r=s.contents;if(t)s.comment=s.comment?`${s.comment}
${n}`:n;else if(i||s.directives.docStart||!r)s.commentBefore=n;else if(Bl.isCollection(r)&&!r.flow&&r.items.length>0){let o=r.items[0];Bl.isPair(o)&&(o=o.key);let a=o.commentBefore;o.commentBefore=a?`${n}
${a}`:n}else{let o=r.commentBefore;r.commentBefore=o?`${n}
${o}`:n}}t?(Array.prototype.push.apply(s.errors,this.errors),Array.prototype.push.apply(s.warnings,this.warnings)):(s.errors=this.errors,s.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Ul(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(s,t=!1,n=-1){for(let i of s)yield*this.next(i);yield*this.end(t,n)}*next(s){switch(Ly.env.LOG_STREAM&&console.dir(s,{depth:null}),s.type){case"directive":this.directives.add(s.source,(t,n,i)=>{let r=nn(s);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",n,i)}),this.prelude.push(s.source),this.atDirectives=!0;break;case"document":{let t=My.composeDoc(this.options,this.directives,s,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(s,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(s.source);break;case"error":{let t=s.source?`${s.message}: ${JSON.stringify(s.source)}`:s.message,n=new sn.YAMLParseError(nn(s),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){let n="Unexpected doc-end without preceding document";this.errors.push(new sn.YAMLParseError(nn(s),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;let t=$y.resolveEnd(s.end,s.offset+s.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){let n=this.doc.comment;this.doc.comment=n?`${n}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new sn.YAMLParseError(nn(s),"UNEXPECTED_TOKEN",`Unsupported token ${s.type}`))}}*end(s=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(s){let n=Object.assign({_directives:this.directives},this.options),i=new Dy.Document(void 0,n);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}};ql.Composer=ao});var Wl=_(dr=>{"use strict";var jy=so(),Fy=ro(),By=en(),Gl=Fs();function Uy(e,s=!0,t){if(e){let n=(i,r,o)=>{let a=typeof i=="number"?i:Array.isArray(i)?i[0]:i.offset;if(t)t(a,r,o);else throw new By.YAMLParseError([a,a+1],r,o)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Fy.resolveFlowScalar(e,s,n);case"block-scalar":return jy.resolveBlockScalar({options:{strict:s}},e,n)}}return null}function qy(e,s){let{implicitKey:t=!1,indent:n,inFlow:i=!1,offset:r=-1,type:o="PLAIN"}=s,a=Gl.stringifyString({type:o,value:e},{implicitKey:t,indent:n>0?" ".repeat(n):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}}),c=s.end??[{type:"newline",offset:-1,indent:n,source:`
`}];switch(a[0]){case"|":case">":{let l=a.indexOf(`
`),u=a.substring(0,l),d=a.substring(l+1)+`
`,h=[{type:"block-scalar-header",offset:r,indent:n,source:u}];return Hl(h,c)||h.push({type:"newline",offset:-1,indent:n,source:`
`}),{type:"block-scalar",offset:r,indent:n,props:h,source:d}}case'"':return{type:"double-quoted-scalar",offset:r,indent:n,source:a,end:c};case"'":return{type:"single-quoted-scalar",offset:r,indent:n,source:a,end:c};default:return{type:"scalar",offset:r,indent:n,source:a,end:c}}}function Gy(e,s,t={}){let{afterKey:n=!1,implicitKey:i=!1,inFlow:r=!1,type:o}=t,a="indent"in e?e.indent:null;if(n&&typeof a=="number"&&(a+=2),!o)switch(e.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{let l=e.props[0];if(l.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=l.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}let c=Gl.stringifyString({type:o,value:s},{implicitKey:i||a===null,indent:a!==null&&a>0?" ".repeat(a):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":Hy(e,c);break;case'"':lo(e,c,"double-quoted-scalar");break;case"'":lo(e,c,"single-quoted-scalar");break;default:lo(e,c,"scalar")}}function Hy(e,s){let t=s.indexOf(`
`),n=s.substring(0,t),i=s.substring(t+1)+`
`;if(e.type==="block-scalar"){let r=e.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=n,e.source=i}else{let{offset:r}=e,o="indent"in e?e.indent:-1,a=[{type:"block-scalar-header",offset:r,indent:o,source:n}];Hl(a,"end"in e?e.end:void 0)||a.push({type:"newline",offset:-1,indent:o,source:`
`});for(let c of Object.keys(e))c!=="type"&&c!=="offset"&&delete e[c];Object.assign(e,{type:"block-scalar",indent:o,props:a,source:i})}}function Hl(e,s){if(s)for(let t of s)switch(t.type){case"space":case"comment":e.push(t);break;case"newline":return e.push(t),!0}return!1}function lo(e,s,t){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=t,e.source=s;break;case"block-scalar":{let n=e.props.slice(1),i=s.length;e.props[0].type==="block-scalar-header"&&(i-=e.props[0].source.length);for(let r of n)r.offset+=i;delete e.props,Object.assign(e,{type:t,source:s,end:n});break}case"block-map":case"block-seq":{let i={type:"newline",offset:e.offset+s.length,indent:e.indent,source:`
`};delete e.items,Object.assign(e,{type:t,source:s,end:[i]});break}default:{let n="indent"in e?e.indent:-1,i="end"in e&&Array.isArray(e.end)?e.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(let r of Object.keys(e))r!=="type"&&r!=="offset"&&delete e[r];Object.assign(e,{type:t,indent:n,source:s,end:i})}}}dr.createScalarToken=qy;dr.resolveAsScalar=Uy;dr.setScalarValue=Gy});var Kl=_(Jl=>{"use strict";var Wy=e=>"type"in e?pr(e):fr(e);function pr(e){switch(e.type){case"block-scalar":{let s="";for(let t of e.props)s+=pr(t);return s+e.source}case"block-map":case"block-seq":{let s="";for(let t of e.items)s+=fr(t);return s}case"flow-collection":{let s=e.start.source;for(let t of e.items)s+=fr(t);for(let t of e.end)s+=t.source;return s}case"document":{let s=fr(e);if(e.end)for(let t of e.end)s+=t.source;return s}default:{let s=e.source;if("end"in e&&e.end)for(let t of e.end)s+=t.source;return s}}}function fr({start:e,key:s,sep:t,value:n}){let i="";for(let r of e)i+=r.source;if(s&&(i+=pr(s)),t)for(let r of t)i+=r.source;return n&&(i+=pr(n)),i}Jl.stringify=Wy});var Zl=_(Yl=>{"use strict";var uo=Symbol("break visit"),Jy=Symbol("skip children"),zl=Symbol("remove item");function Ut(e,s){"type"in e&&e.type==="document"&&(e={start:e.start,value:e.value}),Vl(Object.freeze([]),e,s)}Ut.BREAK=uo;Ut.SKIP=Jy;Ut.REMOVE=zl;Ut.itemAtPath=(e,s)=>{let t=e;for(let[n,i]of s){let r=t?.[n];if(r&&"items"in r)t=r.items[i];else return}return t};Ut.parentCollection=(e,s)=>{let t=Ut.itemAtPath(e,s.slice(0,-1)),n=s[s.length-1][0],i=t?.[n];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};function Vl(e,s,t){let n=t(s,e);if(typeof n=="symbol")return n;for(let i of["key","value"]){let r=s[i];if(r&&"items"in r){for(let o=0;o<r.items.length;++o){let a=Vl(Object.freeze(e.concat([[i,o]])),r.items[o],t);if(typeof a=="number")o=a-1;else{if(a===uo)return uo;a===zl&&(r.items.splice(o,1),o-=1)}}typeof n=="function"&&i==="key"&&(n=n(s,e))}}return typeof n=="function"?n(s,e):n}Yl.visit=Ut});var gr=_(Ce=>{"use strict";var fo=Wl(),Ky=Kl(),zy=Zl(),po="\uFEFF",go="",ho="",mo="",Vy=e=>!!e&&"items"in e,Yy=e=>!!e&&(e.type==="scalar"||e.type==="single-quoted-scalar"||e.type==="double-quoted-scalar"||e.type==="block-scalar");function Zy(e){switch(e){case po:return"<BOM>";case go:return"<DOC>";case ho:return"<FLOW_END>";case mo:return"<SCALAR>";default:return JSON.stringify(e)}}function Xy(e){switch(e){case po:return"byte-order-mark";case go:return"doc-mode";case ho:return"flow-error-end";case mo:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}Ce.createScalarToken=fo.createScalarToken;Ce.resolveAsScalar=fo.resolveAsScalar;Ce.setScalarValue=fo.setScalarValue;Ce.stringify=Ky.stringify;Ce.visit=zy.visit;Ce.BOM=po;Ce.DOCUMENT=go;Ce.FLOW_END=ho;Ce.SCALAR=mo;Ce.isCollection=Vy;Ce.isScalar=Yy;Ce.prettyToken=Zy;Ce.tokenType=Xy});var bo=_(Ql=>{"use strict";var rn=gr();function Ke(e){switch(e){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Xl=new Set("0123456789ABCDEFabcdef"),Qy=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),hr=new Set(",[]{}"),ew=new Set(` ,[]{}
\r	`),yo=e=>!e||ew.has(e),wo=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(s,t=!1){if(s){if(typeof s!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+s:s,this.lineEndPos=null}this.atEnd=!t;let n=this.next??"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let s=this.pos,t=this.buffer[s];for(;t===" "||t==="	";)t=this.buffer[++s];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[s+1]===`
`:!1}charAt(s){return this.buffer[this.pos+s]}continueScalar(s){let t=this.buffer[s];if(this.indentNext>0){let n=0;for(;t===" ";)t=this.buffer[++n+s];if(t==="\r"){let i=this.buffer[n+s+1];if(i===`
`||!i&&!this.atEnd)return s+n+1}return t===`
`||n>=this.indentNext||!t&&!this.atEnd?s+n:-1}if(t==="-"||t==="."){let n=this.buffer.substr(s,3);if((n==="---"||n==="...")&&Ke(this.buffer[s+3]))return-1}return s}getLine(){let s=this.lineEndPos;return(typeof s!="number"||s!==-1&&s<this.pos)&&(s=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=s),s===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[s-1]==="\r"&&(s-=1),this.buffer.substring(this.pos,s))}hasChars(s){return this.pos+s<=this.buffer.length}setNext(s){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=s,null}peek(s){return this.buffer.substr(this.pos,s)}*parseNext(s){switch(s){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let s=this.getLine();if(s===null)return this.setNext("stream");if(s[0]===rn.BOM&&(yield*this.pushCount(1),s=s.substring(1)),s[0]==="%"){let t=s.length,n=s.indexOf("#");for(;n!==-1;){let r=s[n-1];if(r===" "||r==="	"){t=n-1;break}else n=s.indexOf("#",n+1)}for(;;){let r=s[t-1];if(r===" "||r==="	")t-=1;else break}let i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(s.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){let t=yield*this.pushSpaces(!0);return yield*this.pushCount(s.length-t),yield*this.pushNewline(),"stream"}return yield rn.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){let s=this.charAt(0);if(!s&&!this.atEnd)return this.setNext("line-start");if(s==="-"||s==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let t=this.peek(3);if((t==="---"||t==="...")&&Ke(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Ke(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[s,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((s==="-"||s==="?"||s===":")&&Ke(t)){let n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let s=this.getLine();if(s===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(s[t]){case"#":yield*this.pushCount(s.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(yo),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(s.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let s,t,n=-1;do s=yield*this.pushNewline(),s>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=yield*this.pushSpaces(!0);while(s+t>0);let i=this.getLine();if(i===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&i[0]!=="#"||n===0&&(i.startsWith("---")||i.startsWith("..."))&&Ke(i[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield rn.FLOW_END,yield*this.parseLineStart();let r=0;for(;i[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),i[r]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(yo),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let o=this.charAt(1);if(this.flowKey||Ke(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let s=this.charAt(0),t=this.buffer.indexOf(s,this.pos+1);if(s==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}let n=this.buffer.substring(0,t),i=n.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){let r=this.continueScalar(i+1);if(r===-1)break;i=n.indexOf(`
`,r)}i!==-1&&(t=i-(n[i-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let s=this.pos;for(;;){let t=this.buffer[++s];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>Ke(t)||t==="#")}*parseBlockScalar(){let s=this.pos-1,t=0,n;e:for(let r=this.pos;n=this.buffer[r];++r)switch(n){case" ":t+=1;break;case`
`:s=r,t=0;break;case"\r":{let o=this.buffer[r+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{let r=this.continueScalar(s+1);if(r===-1)break;s=this.buffer.indexOf(`
`,r)}while(s!==-1);if(s===-1){if(!this.atEnd)return this.setNext("block-scalar");s=this.buffer.length}}let i=s+1;for(n=this.buffer[i];n===" ";)n=this.buffer[++i];if(n==="	"){for(;n==="	"||n===" "||n==="\r"||n===`
`;)n=this.buffer[++i];s=i-1}else if(!this.blockScalarKeep)do{let r=s-1,o=this.buffer[r];o==="\r"&&(o=this.buffer[--r]);let a=r;for(;o===" ";)o=this.buffer[--r];if(o===`
`&&r>=this.pos&&r+1+t>a)s=r;else break}while(!0);return yield rn.SCALAR,yield*this.pushToIndex(s+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let s=this.flowLevel>0,t=this.pos-1,n=this.pos-1,i;for(;i=this.buffer[++n];)if(i===":"){let r=this.buffer[n+1];if(Ke(r)||s&&hr.has(r))break;t=n}else if(Ke(i)){let r=this.buffer[n+1];if(i==="\r"&&(r===`
`?(n+=1,i=`
`,r=this.buffer[n+1]):t=n),r==="#"||s&&hr.has(r))break;if(i===`
`){let o=this.continueScalar(n+1);if(o===-1)break;n=Math.max(n,o-2)}}else{if(s&&hr.has(i))break;t=n}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield rn.SCALAR,yield*this.pushToIndex(t+1,!0),s?"flow":"doc")}*pushCount(s){return s>0?(yield this.buffer.substr(this.pos,s),this.pos+=s,s):0}*pushToIndex(s,t){let n=this.buffer.slice(this.pos,s);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(yo))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let s=this.flowLevel>0,t=this.charAt(1);if(Ke(t)||s&&hr.has(t))return s?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let s=this.pos+2,t=this.buffer[s];for(;!Ke(t)&&t!==">";)t=this.buffer[++s];return yield*this.pushToIndex(t===">"?s+1:s,!1)}else{let s=this.pos+1,t=this.buffer[s];for(;t;)if(Qy.has(t))t=this.buffer[++s];else if(t==="%"&&Xl.has(this.buffer[s+1])&&Xl.has(this.buffer[s+2]))t=this.buffer[s+=3];else break;return yield*this.pushToIndex(s,!1)}}*pushNewline(){let s=this.buffer[this.pos];return s===`
`?yield*this.pushCount(1):s==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(s){let t=this.pos-1,n;do n=this.buffer[++t];while(n===" "||s&&n==="	");let i=t-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=t),i}*pushUntil(s){let t=this.pos,n=this.buffer[t];for(;!s(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}};Ql.Lexer=wo});var ko=_(eu=>{"use strict";var So=class{constructor(){this.lineStarts=[],this.addNewLine=s=>this.lineStarts.push(s),this.linePos=s=>{let t=0,n=this.lineStarts.length;for(;t<n;){let r=t+n>>1;this.lineStarts[r]<s?t=r+1:n=r}if(this.lineStarts[t]===s)return{line:t+1,col:1};if(t===0)return{line:0,col:s};let i=this.lineStarts[t-1];return{line:t,col:s-i+1}}}};eu.LineCounter=So});var Eo=_(iu=>{"use strict";var tw=require("process"),tu=gr(),sw=bo();function Et(e,s){for(let t=0;t<e.length;++t)if(e[t].type===s)return!0;return!1}function su(e){for(let s=0;s<e.length;++s)switch(e[s].type){case"space":case"comment":case"newline":break;default:return s}return-1}function ru(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function mr(e){switch(e.type){case"document":return e.start;case"block-map":{let s=e.items[e.items.length-1];return s.sep??s.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function cs(e){if(e.length===0)return[];let s=e.length;e:for(;--s>=0;)switch(e[s].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;e[++s]?.type==="space";);return e.splice(s,e.length)}function nu(e){if(e.start.type==="flow-seq-start")for(let s of e.items)s.sep&&!s.value&&!Et(s.start,"explicit-key-ind")&&!Et(s.sep,"map-value-ind")&&(s.key&&(s.value=s.key),delete s.key,ru(s.value)?s.value.end?Array.prototype.push.apply(s.value.end,s.sep):s.value.end=s.sep:Array.prototype.push.apply(s.start,s.sep),delete s.sep)}var vo=class{constructor(s){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new sw.Lexer,this.onNewLine=s}*parse(s,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let n of this.lexer.lex(s,t))yield*this.next(n);t||(yield*this.end())}*next(s){if(this.source=s,tw.env.LOG_TOKENS&&console.log("|",tu.prettyToken(s)),this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=s.length;return}let t=tu.tokenType(s);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+s.length);break;case"space":this.atNewLine&&s[0]===" "&&(this.indent+=s.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=s.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=s.length}else{let n=`Not a YAML token: ${s}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:s}),this.offset+=s.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let s=this.peek(1);if(this.type==="doc-end"&&s?.type!=="doc-end"){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!s)return yield*this.stream();switch(s.type){case"document":return yield*this.document(s);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(s);case"block-scalar":return yield*this.blockScalar(s);case"block-map":return yield*this.blockMap(s);case"block-seq":return yield*this.blockSequence(s);case"flow-collection":return yield*this.flowCollection(s);case"doc-end":return yield*this.documentEnd(s)}yield*this.pop()}peek(s){return this.stack[this.stack.length-s]}*pop(s){let t=s??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{let n=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in n?n.indent:0:t.type==="flow-collection"&&n.type==="document"&&(t.indent=0),t.type==="flow-collection"&&nu(t),n.type){case"document":n.value=t;break;case"block-scalar":n.props.push(t);break;case"block-map":{let i=n.items[n.items.length-1];if(i.value){n.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=t;else{Object.assign(i,{key:t,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{let i=n.items[n.items.length-1];i.value?n.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{let i=n.items[n.items.length-1];!i||i.value?n.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){let i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&su(i.start)===-1&&(t.indent===0||i.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(n.type==="document"?n.end=i.start:n.items.push({start:i.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let s={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&s.start.push(this.sourceToken),this.stack.push(s);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(s){if(s.value)return yield*this.lineEnd(s);switch(this.type){case"doc-start":{su(s.start)!==-1?(yield*this.pop(),yield*this.step()):s.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":s.start.push(this.sourceToken);return}let t=this.startBlockValue(s);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(s){if(this.type==="map-value-ind"){let t=mr(this.peek(2)),n=cs(t),i;s.end?(i=s.end,i.push(this.sourceToken),delete s.end):i=[this.sourceToken];let r={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:n,key:s,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(s)}*blockScalar(s){switch(this.type){case"space":case"comment":case"newline":s.props.push(this.sourceToken);return;case"scalar":if(s.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(s){let t=s.items[s.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){let n="end"in t.value?t.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)s.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,s.indent)){let i=s.items[s.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),s.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=s.indent){let n=!this.onKeyLine&&this.indent===s.indent,i=n&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind",r=[];if(i&&t.sep&&!t.value){let o=[];for(let a=0;a<t.sep.length;++a){let c=t.sep[a];switch(c.type){case"newline":o.push(a);break;case"space":break;case"comment":c.indent>s.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(r=t.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":i||t.value?(r.push(this.sourceToken),s.items.push({start:r}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):i||t.value?(r.push(this.sourceToken),s.items.push({start:r,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)s.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Et(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(ru(t.key)&&!Et(t.sep,"newline")){let o=cs(t.start),a=t.key,c=t.sep;c.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:a,sep:c}]})}else r.length>0?t.sep=t.sep.concat(r,this.sourceToken):t.sep.push(this.sourceToken);else if(Et(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{let o=cs(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||i?s.items.push({start:r,key:null,sep:[this.sourceToken]}):Et(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let o=this.flowScalar(this.type);i||t.value?(s.items.push({start:r,key:o,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(o):(Object.assign(t,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{let o=this.startBlockValue(s);if(o){if(o.type==="block-seq"){if(!t.explicitKey&&t.sep&&!Et(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&s.items.push({start:r});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(s){let t=s.items[s.items.length-1];switch(this.type){case"newline":if(t.value){let n="end"in t.value?t.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)s.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,s.indent)){let i=s.items[s.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),s.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=s.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==s.indent)break;t.value||Et(t.start,"seq-item-ind")?s.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>s.indent){let n=this.startBlockValue(s);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(s){let t=s.items[s.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n?.type==="flow-collection")}else if(s.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?s.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?s.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?s.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let i=this.flowScalar(this.type);!t||t.value?s.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":s.end.push(this.sourceToken);return}let n=this.startBlockValue(s);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{let n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===s.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){let i=mr(n),r=cs(i);nu(s);let o=s.end.splice(1,s.end.length);o.push(this.sourceToken);let a={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:r,key:s,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(s)}}flowScalar(s){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:s,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(s){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let t=mr(s),n=cs(t);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let t=mr(s),n=cs(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(s,t){return this.type!=="comment"||this.indent<=t?!1:s.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(s){this.type!=="doc-mode"&&(s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(s){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};iu.Parser=vo});var uu=_(an=>{"use strict";var ou=co(),nw=Zs(),on=en(),rw=oi(),iw=G(),ow=ko(),au=Eo();function cu(e){let s=e.prettyErrors!==!1;return{lineCounter:e.lineCounter||s&&new ow.LineCounter||null,prettyErrors:s}}function aw(e,s={}){let{lineCounter:t,prettyErrors:n}=cu(s),i=new au.Parser(t?.addNewLine),r=new ou.Composer(s),o=Array.from(r.compose(i.parse(e)));if(n&&t)for(let a of o)a.errors.forEach(on.prettifyError(e,t)),a.warnings.forEach(on.prettifyError(e,t));return o.length>0?o:Object.assign([],{empty:!0},r.streamInfo())}function lu(e,s={}){let{lineCounter:t,prettyErrors:n}=cu(s),i=new au.Parser(t?.addNewLine),r=new ou.Composer(s),o=null;for(let a of r.compose(i.parse(e),!0,e.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new on.YAMLParseError(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&t&&(o.errors.forEach(on.prettifyError(e,t)),o.warnings.forEach(on.prettifyError(e,t))),o}function cw(e,s,t){let n;typeof s=="function"?n=s:t===void 0&&s&&typeof s=="object"&&(t=s);let i=lu(e,t);if(!i)return null;if(i.warnings.forEach(r=>rw.warn(i.options.logLevel,r)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:n},t))}function lw(e,s,t){let n=null;if(typeof s=="function"||Array.isArray(s)?n=s:t===void 0&&s&&(t=s),typeof t=="string"&&(t=t.length),typeof t=="number"){let i=Math.round(t);t=i<1?void 0:i>8?{indent:8}:{indent:i}}if(e===void 0){let{keepUndefined:i}=t??s??{};if(!i)return}return iw.isDocument(e)&&!n?e.toString(t):new nw.Document(e,n,t).toString(t)}an.parse=cw;an.parseAllDocuments=aw;an.parseDocument=lu;an.stringify=lw});var Ro=_(z=>{"use strict";var uw=co(),dw=Zs(),fw=qi(),Ao=en(),pw=Ns(),At=G(),gw=bt(),hw=le(),mw=kt(),yw=vt(),ww=gr(),bw=bo(),Sw=ko(),kw=Eo(),yr=uu(),du=Ts();z.Composer=uw.Composer;z.Document=dw.Document;z.Schema=fw.Schema;z.YAMLError=Ao.YAMLError;z.YAMLParseError=Ao.YAMLParseError;z.YAMLWarning=Ao.YAMLWarning;z.Alias=pw.Alias;z.isAlias=At.isAlias;z.isCollection=At.isCollection;z.isDocument=At.isDocument;z.isMap=At.isMap;z.isNode=At.isNode;z.isPair=At.isPair;z.isScalar=At.isScalar;z.isSeq=At.isSeq;z.Pair=gw.Pair;z.Scalar=hw.Scalar;z.YAMLMap=mw.YAMLMap;z.YAMLSeq=yw.YAMLSeq;z.CST=ww;z.Lexer=bw.Lexer;z.LineCounter=Sw.LineCounter;z.Parser=kw.Parser;z.parse=yr.parse;z.parseAllDocuments=yr.parseAllDocuments;z.parseDocument=yr.parseDocument;z.stringify=yr.stringify;z.visit=du.visit;z.visitAsync=du.visitAsync});var Qo=_((h0,ef)=>{ef.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var Cr=_(sf=>{var tf={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function Wb(e){return function(...s){return s.length&&(e=e.replace(/\{(\d)\}/g,(t,n)=>s[n]||"")),new Error("ADM-ZIP: "+e)}}for(let e of Object.keys(tf))sf[e]=Wb(tf[e])});var cf=_((y0,af)=>{var Jb=require("fs"),fe=require("path"),nf=Qo(),Kb=Cr(),zb=typeof process=="object"&&process.platform==="win32",rf=e=>typeof e=="object"&&e!==null,of=new Uint32Array(256).map((e,s)=>{for(let t=0;t<8;t++)s&1?s=3988292384^s>>>1:s>>>=1;return s>>>0});function ie(e){this.sep=fe.sep,this.fs=Jb,rf(e)&&rf(e.fs)&&typeof e.fs.statSync=="function"&&(this.fs=e.fs)}af.exports=ie;ie.prototype.makeDir=function(e){let s=this;function t(n){let i=n.split(s.sep)[0];n.split(s.sep).forEach(function(r){if(!(!r||r.substr(-1,1)===":")){i+=s.sep+r;var o;try{o=s.fs.statSync(i)}catch{s.fs.mkdirSync(i)}if(o&&o.isFile())throw Kb.FILE_IN_THE_WAY(`"${i}"`)}})}t(e)};ie.prototype.writeFileTo=function(e,s,t,n){let i=this;if(i.fs.existsSync(e)){if(!t)return!1;var r=i.fs.statSync(e);if(r.isDirectory())return!1}var o=fe.dirname(e);i.fs.existsSync(o)||i.makeDir(o);var a;try{a=i.fs.openSync(e,"w",438)}catch{i.fs.chmodSync(e,438),a=i.fs.openSync(e,"w",438)}if(a)try{i.fs.writeSync(a,s,0,s.length,0)}finally{i.fs.closeSync(a)}return i.fs.chmodSync(e,n||438),!0};ie.prototype.writeFileToAsync=function(e,s,t,n,i){typeof n=="function"&&(i=n,n=void 0);let r=this;r.fs.exists(e,function(o){if(o&&!t)return i(!1);r.fs.stat(e,function(a,c){if(o&&c.isDirectory())return i(!1);var l=fe.dirname(e);r.fs.exists(l,function(u){u||r.makeDir(l),r.fs.open(e,"w",438,function(d,h){d?r.fs.chmod(e,438,function(){r.fs.open(e,"w",438,function(f,p){r.fs.write(p,s,0,s.length,0,function(){r.fs.close(p,function(){r.fs.chmod(e,n||438,function(){i(!0)})})})})}):h?r.fs.write(h,s,0,s.length,0,function(){r.fs.close(h,function(){r.fs.chmod(e,n||438,function(){i(!0)})})}):r.fs.chmod(e,n||438,function(){i(!0)})})})})})};ie.prototype.findFiles=function(e){let s=this;function t(n,i,r){typeof i=="boolean"&&(r=i,i=void 0);let o=[];return s.fs.readdirSync(n).forEach(function(a){let c=fe.join(n,a),l=s.fs.statSync(c);(!i||i.test(c))&&o.push(fe.normalize(c)+(l.isDirectory()?s.sep:"")),l.isDirectory()&&r&&(o=o.concat(t(c,i,r)))}),o}return t(e,void 0,!0)};ie.prototype.findFilesAsync=function(e,s){let t=this,n=[];t.fs.readdir(e,function(i,r){if(i)return s(i);let o=r.length;if(!o)return s(null,n);r.forEach(function(a){a=fe.join(e,a),t.fs.stat(a,function(c,l){if(c)return s(c);l&&(n.push(fe.normalize(a)+(l.isDirectory()?t.sep:"")),l.isDirectory()?t.findFilesAsync(a,function(u,d){if(u)return s(u);n=n.concat(d),--o||s(null,n)}):--o||s(null,n))})})})};ie.prototype.getAttributes=function(){};ie.prototype.setAttributes=function(){};ie.crc32update=function(e,s){return of[(e^s)&255]^e>>>8};ie.crc32=function(e){typeof e=="string"&&(e=Buffer.from(e,"utf8"));let s=e.length,t=-1;for(let n=0;n<s;)t=ie.crc32update(t,e[n++]);return~t>>>0};ie.methodToString=function(e){switch(e){case nf.STORED:return"STORED ("+e+")";case nf.DEFLATED:return"DEFLATED ("+e+")";default:return"UNSUPPORTED ("+e+")"}};ie.canonical=function(e){if(!e)return"";let s=fe.posix.normalize("/"+e.split("\\").join("/"));return fe.join(".",s)};ie.zipnamefix=function(e){if(!e)return"";let s=fe.posix.normalize("/"+e.split("\\").join("/"));return fe.posix.join(".",s)};ie.findLast=function(e,s){if(!Array.isArray(e))throw new TypeError("arr is not array");let t=e.length>>>0;for(let n=t-1;n>=0;n--)if(s(e[n],n,e))return e[n]};ie.sanitize=function(e,s){e=fe.resolve(fe.normalize(e));for(var t=s.split("/"),n=0,i=t.length;n<i;n++){var r=fe.normalize(fe.join(e,t.slice(n,i).join(fe.sep)));if(r.indexOf(e)===0)return r}return fe.normalize(fe.join(e,fe.basename(s)))};ie.toBuffer=function(s,t){return Buffer.isBuffer(s)?s:s instanceof Uint8Array?Buffer.from(s):typeof s=="string"?t(s):Buffer.alloc(0)};ie.readBigUInt64LE=function(e,s){var t=Buffer.from(e.slice(s,s+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};ie.fromDOS2Date=function(e){return new Date((e>>25&127)+1980,Math.max((e>>21&15)-1,0),Math.max(e>>16&31,1),e>>11&31,e>>5&63,(e&31)<<1)};ie.fromDate2DOS=function(e){let s=0,t=0;return e.getFullYear()>1979&&(s=(e.getFullYear()-1980&127)<<9|e.getMonth()+1<<5|e.getDate(),t=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1),s<<16|t};ie.isWin=zb;ie.crcTable=of});var uf=_((w0,lf)=>{var Vb=require("path");lf.exports=function(e,{fs:s}){var t=e||"",n=r(),i=null;function r(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&s.existsSync(t)?(i=s.statSync(t),n.directory=i.isDirectory(),n.mtime=i.mtime,n.atime=i.atime,n.executable=(73&i.mode)!==0,n.readonly=(128&i.mode)===0,n.hidden=Vb.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return n.directory},get readOnly(){return n.readonly},get hidden(){return n.hidden},get mtime(){return n.mtime},get atime(){return n.atime},get executable(){return n.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:n.directory,isReadOnly:n.readonly,isHidden:n.hidden,isExecutable:n.executable,mTime:n.mtime,aTime:n.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ff=_((b0,df)=>{df.exports={efs:!0,encode:e=>Buffer.from(e,"utf8"),decode:e=>e.toString("utf8")}});var Ss=_((S0,bs)=>{bs.exports=cf();bs.exports.Constants=Qo();bs.exports.Errors=Cr();bs.exports.FileAttr=uf();bs.exports.decoder=ff()});var gf=_((k0,pf)=>{var _t=Ss(),O=_t.Constants;pf.exports=function(){var e=20,s=10,t=0,n=0,i=0,r=0,o=0,a=0,c=0,l=0,u=0,d=0,h=0,f=0,p=0;e|=_t.isWin?2560:768,t|=O.FLG_EFS;let g={extraLen:0},y=m=>Math.max(0,m)>>>0,w=m=>Math.max(0,m)&65535,S=m=>Math.max(0,m)&255;return i=_t.fromDate2DOS(new Date),{get made(){return e},set made(m){e=m},get version(){return s},set version(m){s=m},get flags(){return t},set flags(m){t=m},get flags_efs(){return(t&O.FLG_EFS)>0},set flags_efs(m){m?t|=O.FLG_EFS:t&=~O.FLG_EFS},get flags_desc(){return(t&O.FLG_DESC)>0},set flags_desc(m){m?t|=O.FLG_DESC:t&=~O.FLG_DESC},get method(){return n},set method(m){switch(m){case O.STORED:this.version=10;case O.DEFLATED:default:this.version=20}n=m},get time(){return _t.fromDOS2Date(this.timeval)},set time(m){this.timeval=_t.fromDate2DOS(m)},get timeval(){return i},set timeval(m){i=y(m)},get timeHighByte(){return S(i>>>8)},get crc(){return r},set crc(m){r=y(m)},get compressedSize(){return o},set compressedSize(m){o=y(m)},get size(){return a},set size(m){a=y(m)},get fileNameLength(){return c},set fileNameLength(m){c=m},get extraLength(){return l},set extraLength(m){l=m},get extraLocalLength(){return g.extraLen},set extraLocalLength(m){g.extraLen=m},get commentLength(){return u},set commentLength(m){u=m},get diskNumStart(){return d},set diskNumStart(m){d=y(m)},get inAttr(){return h},set inAttr(m){h=y(m)},get attr(){return f},set attr(m){f=y(m)},get fileAttr(){return(f||0)>>16&4095},get offset(){return p},set offset(m){p=y(m)},get encrypted(){return(t&O.FLG_ENC)===O.FLG_ENC},get centralHeaderSize(){return O.CENHDR+c+l+u},get realDataOffset(){return p+O.LOCHDR+g.fnameLen+g.extraLen},get localHeader(){return g},loadLocalHeaderFromBinary:function(m){var b=m.slice(p,p+O.LOCHDR);if(b.readUInt32LE(0)!==O.LOCSIG)throw _t.Errors.INVALID_LOC();g.version=b.readUInt16LE(O.LOCVER),g.flags=b.readUInt16LE(O.LOCFLG),g.method=b.readUInt16LE(O.LOCHOW),g.time=b.readUInt32LE(O.LOCTIM),g.crc=b.readUInt32LE(O.LOCCRC),g.compressedSize=b.readUInt32LE(O.LOCSIZ),g.size=b.readUInt32LE(O.LOCLEN),g.fnameLen=b.readUInt16LE(O.LOCNAM),g.extraLen=b.readUInt16LE(O.LOCEXT);let k=p+O.LOCHDR+g.fnameLen,v=k+g.extraLen;return m.slice(k,v)},loadFromBinary:function(m){if(m.length!==O.CENHDR||m.readUInt32LE(0)!==O.CENSIG)throw _t.Errors.INVALID_CEN();e=m.readUInt16LE(O.CENVEM),s=m.readUInt16LE(O.CENVER),t=m.readUInt16LE(O.CENFLG),n=m.readUInt16LE(O.CENHOW),i=m.readUInt32LE(O.CENTIM),r=m.readUInt32LE(O.CENCRC),o=m.readUInt32LE(O.CENSIZ),a=m.readUInt32LE(O.CENLEN),c=m.readUInt16LE(O.CENNAM),l=m.readUInt16LE(O.CENEXT),u=m.readUInt16LE(O.CENCOM),d=m.readUInt16LE(O.CENDSK),h=m.readUInt16LE(O.CENATT),f=m.readUInt32LE(O.CENATX),p=m.readUInt32LE(O.CENOFF)},localHeaderToBinary:function(){var m=Buffer.alloc(O.LOCHDR);return m.writeUInt32LE(O.LOCSIG,0),m.writeUInt16LE(s,O.LOCVER),m.writeUInt16LE(t,O.LOCFLG),m.writeUInt16LE(n,O.LOCHOW),m.writeUInt32LE(i,O.LOCTIM),m.writeUInt32LE(r,O.LOCCRC),m.writeUInt32LE(o,O.LOCSIZ),m.writeUInt32LE(a,O.LOCLEN),m.writeUInt16LE(c,O.LOCNAM),m.writeUInt16LE(g.extraLen,O.LOCEXT),m},centralHeaderToBinary:function(){var m=Buffer.alloc(O.CENHDR+c+l+u);return m.writeUInt32LE(O.CENSIG,0),m.writeUInt16LE(e,O.CENVEM),m.writeUInt16LE(s,O.CENVER),m.writeUInt16LE(t,O.CENFLG),m.writeUInt16LE(n,O.CENHOW),m.writeUInt32LE(i,O.CENTIM),m.writeUInt32LE(r,O.CENCRC),m.writeUInt32LE(o,O.CENSIZ),m.writeUInt32LE(a,O.CENLEN),m.writeUInt16LE(c,O.CENNAM),m.writeUInt16LE(l,O.CENEXT),m.writeUInt16LE(u,O.CENCOM),m.writeUInt16LE(d,O.CENDSK),m.writeUInt16LE(h,O.CENATT),m.writeUInt32LE(f,O.CENATX),m.writeUInt32LE(p,O.CENOFF),m},toJSON:function(){let m=function(b){return b+" bytes"};return{made:e,version:s,flags:t,method:_t.methodToString(n),time:this.time,crc:"0x"+r.toString(16).toUpperCase(),compressedSize:m(o),size:m(a),fileNameLength:m(c),extraLength:m(l),commentLength:m(u),diskNumStart:d,inAttr:h,attr:f,offset:p,centralHeaderSize:m(O.CENHDR+c+l+u)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var mf=_((v0,hf)=>{var ks=Ss(),te=ks.Constants;hf.exports=function(){var e=0,s=0,t=0,n=0,i=0;return{get diskEntries(){return e},set diskEntries(r){e=s=r},get totalEntries(){return s},set totalEntries(r){s=e=r},get size(){return t},set size(r){t=r},get offset(){return n},set offset(r){n=r},get commentLength(){return i},set commentLength(r){i=r},get mainHeaderSize(){return te.ENDHDR+i},loadFromBinary:function(r){if((r.length!==te.ENDHDR||r.readUInt32LE(0)!==te.ENDSIG)&&(r.length<te.ZIP64HDR||r.readUInt32LE(0)!==te.ZIP64SIG))throw ks.Errors.INVALID_END();r.readUInt32LE(0)===te.ENDSIG?(e=r.readUInt16LE(te.ENDSUB),s=r.readUInt16LE(te.ENDTOT),t=r.readUInt32LE(te.ENDSIZ),n=r.readUInt32LE(te.ENDOFF),i=r.readUInt16LE(te.ENDCOM)):(e=ks.readBigUInt64LE(r,te.ZIP64SUB),s=ks.readBigUInt64LE(r,te.ZIP64TOT),t=ks.readBigUInt64LE(r,te.ZIP64SIZE),n=ks.readBigUInt64LE(r,te.ZIP64OFF),i=0)},toBinary:function(){var r=Buffer.alloc(te.ENDHDR+i);return r.writeUInt32LE(te.ENDSIG,0),r.writeUInt32LE(0,4),r.writeUInt16LE(e,te.ENDSUB),r.writeUInt16LE(s,te.ENDTOT),r.writeUInt32LE(t,te.ENDSIZ),r.writeUInt32LE(n,te.ENDOFF),r.writeUInt16LE(i,te.ENDCOM),r.fill(" ",te.ENDHDR),r},toJSON:function(){let r=function(o,a){let c=o.toString(16).toUpperCase();for(;c.length<a;)c="0"+c;return"0x"+c};return{diskEntries:e,totalEntries:s,size:t+" bytes",offset:r(n,4),commentLength:i}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ta=_(ea=>{ea.EntryHeader=gf();ea.MainHeader=mf()});var wf=_((A0,yf)=>{yf.exports=function(e){var s=require("zlib"),t={chunkSize:(parseInt(e.length/1024)+1)*1024};return{deflate:function(){return s.deflateRawSync(e,t)},deflateAsync:function(n){var i=s.createDeflateRaw(t),r=[],o=0;i.on("data",function(a){r.push(a),o+=a.length}),i.on("end",function(){var a=Buffer.alloc(o),c=0;a.fill(0);for(var l=0;l<r.length;l++){var u=r[l];u.copy(a,c),c+=u.length}n&&n(a)}),i.end(e)}}}});var Sf=_((R0,bf)=>{var Yb=+(process.versions?process.versions.node:"").split(".")[0]||0;bf.exports=function(e,s){var t=require("zlib");let n=Yb>=15&&s>0?{maxOutputLength:s}:{};return{inflate:function(){return t.inflateRawSync(e,n)},inflateAsync:function(i){var r=t.createInflateRaw(n),o=[],a=0;r.on("data",function(c){o.push(c),a+=c.length}),r.on("end",function(){var c=Buffer.alloc(a),l=0;c.fill(0);for(var u=0;u<o.length;u++){var d=o[u];d.copy(c,l),l+=d.length}i&&i(c)}),r.end(e)}}}});var Rf=_((C0,Af)=>{"use strict";var{randomFillSync:kf}=require("crypto"),Zb=Cr(),Xb=new Uint32Array(256).map((e,s)=>{for(let t=0;t<8;t++)s&1?s=s>>>1^3988292384:s>>>=1;return s>>>0}),Ef=(e,s)=>Math.imul(e,s)>>>0,vf=(e,s)=>Xb[(e^s)&255]^e>>>8,pn=()=>typeof kf=="function"?kf(Buffer.alloc(12)):pn.node();pn.node=()=>{let e=Buffer.alloc(12),s=e.length;for(let t=0;t<s;t++)e[t]=Math.random()*256&255;return e};var Pr={genSalt:pn};function Ir(e){let s=Buffer.isBuffer(e)?e:Buffer.from(e);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<s.length;t++)this.updateKeys(s[t])}Ir.prototype.updateKeys=function(e){let s=this.keys;return s[0]=vf(s[0],e),s[1]+=s[0]&255,s[1]=Ef(s[1],134775813)+1,s[2]=vf(s[2],s[1]>>>24),e};Ir.prototype.next=function(){let e=(this.keys[2]|2)>>>0;return Ef(e,e^1)>>8&255};function Qb(e){let s=new Ir(e);return function(t){let n=Buffer.alloc(t.length),i=0;for(let r of t)n[i++]=s.updateKeys(r^s.next());return n}}function eS(e){let s=new Ir(e);return function(t,n,i=0){n||(n=Buffer.alloc(t.length));for(let r of t){let o=s.next();n[i++]=r^o,s.updateKeys(r)}return n}}function tS(e,s,t){if(!e||!Buffer.isBuffer(e)||e.length<12)return Buffer.alloc(0);let n=Qb(t),i=n(e.slice(0,12)),r=(s.flags&8)===8?s.timeHighByte:s.crc>>>24;if(i[11]!==r)throw Zb.WRONG_PASSWORD();return n(e.slice(12))}function sS(e){Buffer.isBuffer(e)&&e.length>=12?Pr.genSalt=function(){return e.slice(0,12)}:e==="node"?Pr.genSalt=pn.node:Pr.genSalt=pn}function nS(e,s,t,n=!1){e==null&&(e=Buffer.alloc(0)),Buffer.isBuffer(e)||(e=Buffer.from(e.toString()));let i=eS(t),r=Pr.genSalt();r[11]=s.crc>>>24&255,n&&(r[10]=s.crc>>>16&255);let o=Buffer.alloc(e.length+12);return i(r,o),i(e,o,12)}Af.exports={decrypt:tS,encrypt:nS,_salter:sS}});var Cf=_(_r=>{_r.Deflater=wf();_r.Inflater=Sf();_r.ZipCrypto=Rf()});var na=_((I0,Pf)=>{var V=Ss(),rS=ta(),oe=V.Constants,sa=Cf();Pf.exports=function(e,s){var t=new rS.EntryHeader,n=Buffer.alloc(0),i=Buffer.alloc(0),r=!1,o=null,a=Buffer.alloc(0),c=Buffer.alloc(0),l=!0;let u=e,d=typeof u.decoder=="object"?u.decoder:V.decoder;l=d.hasOwnProperty("efs")?d.efs:!1;function h(){return!s||!(s instanceof Uint8Array)?Buffer.alloc(0):(c=t.loadLocalHeaderFromBinary(s),s.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function f(m){if(t.flags_desc){let b={},k=t.realDataOffset+t.compressedSize;if(s.readUInt32LE(k)==oe.LOCSIG||s.readUInt32LE(k)==oe.CENSIG)throw V.Errors.DESCRIPTOR_NOT_EXIST();if(s.readUInt32LE(k)==oe.EXTSIG)b.crc=s.readUInt32LE(k+oe.EXTCRC),b.compressedSize=s.readUInt32LE(k+oe.EXTSIZ),b.size=s.readUInt32LE(k+oe.EXTLEN);else if(s.readUInt16LE(k+12)===19280)b.crc=s.readUInt32LE(k+oe.EXTCRC-4),b.compressedSize=s.readUInt32LE(k+oe.EXTSIZ-4),b.size=s.readUInt32LE(k+oe.EXTLEN-4);else throw V.Errors.DESCRIPTOR_UNKNOWN();if(b.compressedSize!==t.compressedSize||b.size!==t.size||b.crc!==t.crc)throw V.Errors.DESCRIPTOR_FAULTY();if(V.crc32(m)!==b.crc)return!1}else if(V.crc32(m)!==t.localHeader.crc)return!1;return!0}function p(m,b,k){if(typeof b>"u"&&typeof m=="string"&&(k=m,m=void 0),r)return m&&b&&b(Buffer.alloc(0),V.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var v=h();if(v.length===0)return m&&b&&b(v),v;if(t.encrypted){if(typeof k!="string"&&!Buffer.isBuffer(k))throw V.Errors.INVALID_PASS_PARAM();v=sa.ZipCrypto.decrypt(v,t,k)}var E=Buffer.alloc(t.size);switch(t.method){case V.Constants.STORED:if(v.copy(E),f(E))return m&&b&&b(E),E;throw m&&b&&b(E,V.Errors.BAD_CRC()),V.Errors.BAD_CRC();case V.Constants.DEFLATED:var A=new sa.Inflater(v,t.size);if(m)A.inflateAsync(function(R){R.copy(R,0),b&&(f(R)?b(R):b(R,V.Errors.BAD_CRC()))});else{if(A.inflate(E).copy(E,0),!f(E))throw V.Errors.BAD_CRC(`"${d.decode(n)}"`);return E}break;default:throw m&&b&&b(Buffer.alloc(0),V.Errors.UNKNOWN_METHOD()),V.Errors.UNKNOWN_METHOD()}}function g(m,b){if((!o||!o.length)&&Buffer.isBuffer(s))return m&&b&&b(h()),h();if(o.length&&!r){var k;switch(t.method){case V.Constants.STORED:return t.compressedSize=t.size,k=Buffer.alloc(o.length),o.copy(k),m&&b&&b(k),k;default:case V.Constants.DEFLATED:var v=new sa.Deflater(o);if(m)v.deflateAsync(function(A){k=Buffer.alloc(A.length),t.compressedSize=A.length,A.copy(k),b&&b(k)});else{var E=v.deflate();return t.compressedSize=E.length,E}v=null;break}}else if(m&&b)b(Buffer.alloc(0));else return Buffer.alloc(0)}function y(m,b){return(m.readUInt32LE(b+4)<<4)+m.readUInt32LE(b)}function w(m){try{for(var b=0,k,v,E;b+4<m.length;)k=m.readUInt16LE(b),b+=2,v=m.readUInt16LE(b),b+=2,E=m.slice(b,b+v),b+=v,oe.ID_ZIP64===k&&S(E)}catch{throw V.Errors.EXTRA_FIELD_PARSE_ERROR()}}function S(m){var b,k,v,E;m.length>=oe.EF_ZIP64_SCOMP&&(b=y(m,oe.EF_ZIP64_SUNCOMP),t.size===oe.EF_ZIP64_OR_32&&(t.size=b)),m.length>=oe.EF_ZIP64_RHO&&(k=y(m,oe.EF_ZIP64_SCOMP),t.compressedSize===oe.EF_ZIP64_OR_32&&(t.compressedSize=k)),m.length>=oe.EF_ZIP64_DSN&&(v=y(m,oe.EF_ZIP64_RHO),t.offset===oe.EF_ZIP64_OR_32&&(t.offset=v)),m.length>=oe.EF_ZIP64_DSN+4&&(E=m.readUInt32LE(oe.EF_ZIP64_DSN),t.diskNumStart===oe.EF_ZIP64_OR_16&&(t.diskNumStart=E))}return{get entryName(){return d.decode(n)},get rawEntryName(){return n},set entryName(m){n=V.toBuffer(m,d.encode);var b=n[n.length-1];r=b===47||b===92,t.fileNameLength=n.length},get efs(){return typeof l=="function"?l(this.entryName):l},get extra(){return a},set extra(m){a=m,t.extraLength=m.length,w(m)},get comment(){return d.decode(i)},set comment(m){if(i=V.toBuffer(m,d.encode),t.commentLength=i.length,i.length>65535)throw V.Errors.COMMENT_TOO_LONG()},get name(){var m=d.decode(n);return r?m.substr(m.length-1).split("/").pop():m.split("/").pop()},get isDirectory(){return r},getCompressedData:function(){return g(!1,null)},getCompressedDataAsync:function(m){g(!0,m)},setData:function(m){o=V.toBuffer(m,V.decoder.encode),!r&&o.length?(t.size=o.length,t.method=V.Constants.DEFLATED,t.crc=V.crc32(m),t.changed=!0):t.method=V.Constants.STORED},getData:function(m){return t.changed?o:p(!1,null,m)},getDataAsync:function(m,b){t.changed?m(o):p(!0,m,b)},set attr(m){t.attr=m},get attr(){return t.attr},set header(m){t.loadFromBinary(m)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=a.length;var m=t.centralHeaderToBinary(),b=V.Constants.CENHDR;return n.copy(m,b),b+=n.length,a.copy(m,b),b+=t.extraLength,i.copy(m,b),m},packLocalHeader:function(){let m=0;t.flags_efs=this.efs,t.extraLocalLength=c.length;let b=t.localHeaderToBinary(),k=Buffer.alloc(b.length+n.length+t.extraLocalLength);return b.copy(k,m),m+=b.length,n.copy(k,m),m+=n.length,c.copy(k,m),m+=c.length,k},toJSON:function(){let m=function(b){return"<"+(b&&b.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:m(s),data:m(o)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Tf=_((_0,_f)=>{var If=na(),iS=ta(),me=Ss();_f.exports=function(e,s){var t=[],n={},i=Buffer.alloc(0),r=new iS.MainHeader,o=!1,a=null;let c=new Set,l=s,{noSort:u,decoder:d}=l;e?p(l.readEntries):o=!0;function h(){let y=new Set;for(let w of Object.keys(n)){let S=w.split("/");if(S.pop(),!!S.length)for(let m=0;m<S.length;m++){let b=S.slice(0,m+1).join("/")+"/";y.add(b)}}for(let w of y)if(!(w in n)){let S=new If(l);S.entryName=w,S.attr=16,S.temporary=!0,t.push(S),n[S.entryName]=S,c.add(S)}}function f(){if(o=!0,n={},r.diskEntries>(e.length-r.offset)/me.Constants.CENHDR)throw me.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(r.diskEntries);for(var y=r.offset,w=0;w<t.length;w++){var S=y,m=new If(l,e);m.header=e.slice(S,S+=me.Constants.CENHDR),m.entryName=e.slice(S,S+=m.header.fileNameLength),m.header.extraLength&&(m.extra=e.slice(S,S+=m.header.extraLength)),m.header.commentLength&&(m.comment=e.slice(S,S+m.header.commentLength)),y+=m.header.centralHeaderSize,t[w]=m,n[m.entryName]=m}c.clear(),h()}function p(y){var w=e.length-me.Constants.ENDHDR,S=Math.max(0,w-65535),m=S,b=e.length,k=-1,v=0;for((typeof l.trailingSpace=="boolean"?l.trailingSpace:!1)&&(S=0),w;w>=m;w--)if(e[w]===80){if(e.readUInt32LE(w)===me.Constants.ENDSIG){k=w,v=w,b=w+me.Constants.ENDHDR,m=w-me.Constants.END64HDR;continue}if(e.readUInt32LE(w)===me.Constants.END64SIG){m=S;continue}if(e.readUInt32LE(w)===me.Constants.ZIP64SIG){k=w,b=w+me.readBigUInt64LE(e,w+me.Constants.ZIP64SIZE)+me.Constants.ZIP64LEAD;break}}if(k==-1)throw me.Errors.INVALID_FORMAT();r.loadFromBinary(e.slice(k,b)),r.commentLength&&(i=e.slice(v+me.Constants.ENDHDR)),y&&f()}function g(){t.length>1&&!u&&t.sort((y,w)=>y.entryName.toLowerCase().localeCompare(w.entryName.toLowerCase()))}return{get entries(){return o||f(),t.filter(y=>!c.has(y))},get comment(){return d.decode(i)},set comment(y){i=me.toBuffer(y,d.encode),r.commentLength=i.length},getEntryCount:function(){return o?t.length:r.diskEntries},forEach:function(y){this.entries.forEach(y)},getEntry:function(y){return o||f(),n[y]||null},setEntry:function(y){o||f(),t.push(y),n[y.entryName]=y,r.totalEntries=t.length},deleteFile:function(y,w=!0){o||f();let S=n[y];this.getEntryChildren(S,w).map(b=>b.entryName).forEach(this.deleteEntry)},deleteEntry:function(y){o||f();let w=n[y],S=t.indexOf(w);S>=0&&(t.splice(S,1),delete n[y],r.totalEntries=t.length)},getEntryChildren:function(y,w=!0){if(o||f(),typeof y=="object")if(y.isDirectory&&w){let S=[],m=y.entryName;for(let b of t)b.entryName.startsWith(m)&&S.push(b);return S}else return[y];return[]},getChildCount:function(y){if(y&&y.isDirectory){let w=this.getEntryChildren(y);return w.includes(y)?w.length-1:w.length}return 0},compressToBuffer:function(){o||f(),g();let y=[],w=[],S=0,m=0;r.size=0,r.offset=0;let b=0;for(let E of this.entries){let A=E.getCompressedData();E.header.offset=m;let R=E.packLocalHeader(),x=R.length+A.length;m+=x,y.push(R),y.push(A);let P=E.packCentralHeader();w.push(P),r.size+=P.length,S+=x+P.length,b++}S+=r.mainHeaderSize,r.offset=m,r.totalEntries=b,m=0;let k=Buffer.alloc(S);for(let E of y)E.copy(k,m),m+=E.length;for(let E of w)E.copy(k,m),m+=E.length;let v=r.toBinary();return i&&i.copy(v,me.Constants.ENDHDR),v.copy(k,m),e=k,o=!1,k},toAsyncBuffer:function(y,w,S,m){try{o||f(),g();let b=[],k=[],v=0,E=0,A=0;r.size=0,r.offset=0;let R=function(x){if(x.length>0){let P=x.shift(),I=P.entryName+P.extra.toString();S&&S(I),P.getCompressedDataAsync(function(B){m&&m(I),P.header.offset=E;let D=P.packLocalHeader(),$=D.length+B.length;E+=$,b.push(D),b.push(B);let U=P.packCentralHeader();k.push(U),r.size+=U.length,v+=$+U.length,A++,R(x)})}else{v+=r.mainHeaderSize,r.offset=E,r.totalEntries=A,E=0;let P=Buffer.alloc(v);b.forEach(function(B){B.copy(P,E),E+=B.length}),k.forEach(function(B){B.copy(P,E),E+=B.length});let I=r.toBinary();i&&i.copy(I,me.Constants.ENDHDR),I.copy(P,E),e=P,o=!1,y(P)}};R(Array.from(this.entries))}catch(b){w(b)}}}}});var Lf=_((T0,Of)=>{var se=Ss(),ae=require("path"),oS=na(),aS=Tf(),Ht=(...e)=>se.findLast(e,s=>typeof s=="boolean"),xf=(...e)=>se.findLast(e,s=>typeof s=="string"),cS=(...e)=>se.findLast(e,s=>typeof s=="function"),lS={noSort:!1,readEntries:!1,method:se.Constants.NONE,fs:null};Of.exports=function(e,s){let t=null,n=Object.assign(Object.create(null),lS);e&&typeof e=="object"&&(e instanceof Uint8Array||(Object.assign(n,e),e=n.input?n.input:void 0,n.input&&delete n.input),Buffer.isBuffer(e)&&(t=e,n.method=se.Constants.BUFFER,e=void 0)),Object.assign(n,s);let i=new se(n);if((typeof n.decoder!="object"||typeof n.decoder.encode!="function"||typeof n.decoder.decode!="function")&&(n.decoder=se.decoder),e&&typeof e=="string")if(i.fs.existsSync(e))n.method=se.Constants.FILE,n.filename=e,t=i.fs.readFileSync(e);else throw se.Errors.INVALID_FILENAME();let r=new aS(t,n),{canonical:o,sanitize:a,zipnamefix:c}=se;function l(f){if(f&&r){var p;if(typeof f=="string"&&(p=r.getEntry(ae.posix.normalize(f))),typeof f=="object"&&typeof f.entryName<"u"&&typeof f.header<"u"&&(p=r.getEntry(f.entryName)),p)return p}return null}function u(f){let{join:p,normalize:g,sep:y}=ae.posix;return p(".",g(y+f.split("\\").join(y)+y))}function d(f){return f instanceof RegExp?function(p){return function(g){return p.test(g)}}(f):typeof f!="function"?()=>!0:f}let h=(f,p)=>{let g=p.slice(-1);return g=g===i.sep?i.sep:"",ae.relative(f,p)+g};return{readFile:function(f,p){var g=l(f);return g&&g.getData(p)||null},childCount:function(f){let p=l(f);if(p)return r.getChildCount(p)},readFileAsync:function(f,p){var g=l(f);g?g.getDataAsync(p):p(null,"getEntry failed for:"+f)},readAsText:function(f,p){var g=l(f);if(g){var y=g.getData();if(y&&y.length)return y.toString(p||"utf8")}return""},readAsTextAsync:function(f,p,g){var y=l(f);y?y.getDataAsync(function(w,S){if(S){p(w,S);return}w&&w.length?p(w.toString(g||"utf8")):p("")}):p("")},deleteFile:function(f,p=!0){var g=l(f);g&&r.deleteFile(g.entryName,p)},deleteEntry:function(f){var p=l(f);p&&r.deleteEntry(p.entryName)},addZipComment:function(f){r.comment=f},getZipComment:function(){return r.comment||""},addZipEntryComment:function(f,p){var g=l(f);g&&(g.comment=p)},getZipEntryComment:function(f){var p=l(f);return p&&p.comment||""},updateFile:function(f,p){var g=l(f);g&&g.setData(p)},addLocalFile:function(f,p,g,y){if(i.fs.existsSync(f)){p=p?u(p):"";let w=ae.win32.basename(ae.win32.normalize(f));p+=g||w;let S=i.fs.statSync(f),m=S.isFile()?i.fs.readFileSync(f):Buffer.alloc(0);S.isDirectory()&&(p+=i.sep),this.addFile(p,m,y,S)}else throw se.Errors.FILE_NOT_FOUND(f)},addLocalFileAsync:function(f,p){f=typeof f=="object"?f:{localPath:f};let g=ae.resolve(f.localPath),{comment:y}=f,{zipPath:w,zipName:S}=f,m=this;i.fs.stat(g,function(b,k){if(b)return p(b,!1);w=w?u(w):"";let v=ae.win32.basename(ae.win32.normalize(g));if(w+=S||v,k.isFile())i.fs.readFile(g,function(E,A){return E?p(E,!1):(m.addFile(w,A,y,k),setImmediate(p,void 0,!0))});else if(k.isDirectory())return w+=i.sep,m.addFile(w,Buffer.alloc(0),y,k),setImmediate(p,void 0,!0)})},addLocalFolder:function(f,p,g){if(g=d(g),p=p?u(p):"",f=ae.normalize(f),i.fs.existsSync(f)){let y=i.findFiles(f),w=this;if(y.length)for(let S of y){let m=ae.join(p,h(f,S));g(m)&&w.addLocalFile(S,ae.dirname(m))}}else throw se.Errors.FILE_NOT_FOUND(f)},addLocalFolderAsync:function(f,p,g,y){y=d(y),g=g?u(g):"",f=ae.normalize(f);var w=this;i.fs.open(f,"r",function(S){if(S&&S.code==="ENOENT")p(void 0,se.Errors.FILE_NOT_FOUND(f));else if(S)p(void 0,S);else{var m=i.findFiles(f),b=-1,k=function(){if(b+=1,b<m.length){var v=m[b],E=h(f,v).split("\\").join("/");E=E.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),y(E)?i.fs.stat(v,function(A,R){A&&p(void 0,A),R.isFile()?i.fs.readFile(v,function(x,P){x?p(void 0,x):(w.addFile(g+E,P,"",R),k())}):(w.addFile(g+E+"/",Buffer.alloc(0),"",R),k())}):process.nextTick(()=>{k()})}else p(!0,void 0)};k()}})},addLocalFolderAsync2:function(f,p){let g=this;f=typeof f=="object"?f:{localPath:f},localPath=ae.resolve(u(f.localPath));let{zipPath:y,filter:w,namefix:S}=f;w instanceof RegExp?w=function(k){return function(v){return k.test(v)}}(w):typeof w!="function"&&(w=function(){return!0}),y=y?u(y):"",S=="latin1"&&(S=k=>k.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof S!="function"&&(S=k=>k);let m=k=>ae.join(y,S(h(localPath,k))),b=k=>ae.win32.basename(ae.win32.normalize(S(k)));i.fs.open(localPath,"r",function(k){k&&k.code==="ENOENT"?p(void 0,se.Errors.FILE_NOT_FOUND(localPath)):k?p(void 0,k):i.findFilesAsync(localPath,function(v,E){if(v)return p(v);E=E.filter(A=>w(m(A))),E.length||p(void 0,!1),setImmediate(E.reverse().reduce(function(A,R){return function(x,P){if(x||P===!1)return setImmediate(A,x,!1);g.addLocalFileAsync({localPath:R,zipPath:ae.dirname(m(R)),zipName:b(R)},A)}},p))})})},addLocalFolderPromise:function(f,p){return new Promise((g,y)=>{this.addLocalFolderAsync2(Object.assign({localPath:f},p),(w,S)=>{w&&y(w),S&&g(this)})})},addFile:function(f,p,g,y){f=c(f);let w=l(f),S=w!=null;S||(w=new oS(n),w.entryName=f),w.comment=g||"";let m=typeof y=="object"&&y instanceof i.fs.Stats;m&&(w.header.time=y.mtime);var b=w.isDirectory?16:0;let k=w.isDirectory?16384:32768;return m?k|=4095&y.mode:typeof y=="number"?k|=4095&y:k|=w.isDirectory?493:420,b=(b|k<<16)>>>0,w.attr=b,w.setData(p),S||r.setEntry(w),w},getEntries:function(f){return r.password=f,r?r.entries:[]},getEntry:function(f){return l(f)},getEntryCount:function(){return r.getEntryCount()},forEach:function(f){return r.forEach(f)},extractEntryTo:function(f,p,g,y,w,S){y=Ht(!1,y),w=Ht(!1,w),g=Ht(!0,g),S=xf(w,S);var m=l(f);if(!m)throw se.Errors.NO_ENTRY();var b=o(m.entryName),k=a(p,S&&!m.isDirectory?S:g?b:ae.basename(b));if(m.isDirectory){var v=r.getEntryChildren(m);return v.forEach(function(R){if(R.isDirectory)return;var x=R.getData();if(!x)throw se.Errors.CANT_EXTRACT_FILE();var P=o(R.entryName),I=a(p,g?P:ae.basename(P));let B=w?R.header.fileAttr:void 0;i.writeFileTo(I,x,y,B)}),!0}var E=m.getData(r.password);if(!E)throw se.Errors.CANT_EXTRACT_FILE();if(i.fs.existsSync(k)&&!y)throw se.Errors.CANT_OVERRIDE();let A=w?f.header.fileAttr:void 0;return i.writeFileTo(k,E,y,A),!0},test:function(f){if(!r)return!1;for(var p in r.entries)try{if(p.isDirectory)continue;var g=r.entries[p].getData(f);if(!g)return!1}catch{return!1}return!0},extractAllTo:function(f,p,g,y){if(g=Ht(!1,g),y=xf(g,y),p=Ht(!1,p),!r)throw se.Errors.NO_ZIP();r.entries.forEach(function(w){var S=a(f,o(w.entryName));if(w.isDirectory){i.makeDir(S);return}var m=w.getData(y);if(!m)throw se.Errors.CANT_EXTRACT_FILE();let b=g?w.header.fileAttr:void 0;i.writeFileTo(S,m,p,b);try{i.fs.utimesSync(S,w.header.time,w.header.time)}catch{throw se.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(f,p,g,y){if(y=cS(p,g,y),g=Ht(!1,g),p=Ht(!1,p),!y)return new Promise((k,v)=>{this.extractAllToAsync(f,p,g,function(E){E?v(E):k(this)})});if(!r){y(se.Errors.NO_ZIP());return}f=ae.resolve(f);let w=k=>a(f,ae.normalize(o(k.entryName))),S=(k,v)=>new Error(k+': "'+v+'"'),m=[],b=[];r.entries.forEach(k=>{k.isDirectory?m.push(k):b.push(k)});for(let k of m){let v=w(k),E=g?k.header.fileAttr:void 0;try{i.makeDir(v),E&&i.fs.chmodSync(v,E),i.fs.utimesSync(v,k.header.time,k.header.time)}catch{y(S("Unable to create folder",v))}}b.reverse().reduce(function(k,v){return function(E){if(E)k(E);else{let A=ae.normalize(o(v.entryName)),R=a(f,A);v.getDataAsync(function(x,P){if(P)k(P);else if(!x)k(se.Errors.CANT_EXTRACT_FILE());else{let I=g?v.header.fileAttr:void 0;i.writeFileToAsync(R,x,p,I,function(B){B||k(S("Unable to write file",R)),i.fs.utimes(R,v.header.time,v.header.time,function(D){D?k(S("Unable to set times",R)):k()})})}})}}},y)()},writeZip:function(f,p){if(arguments.length===1&&typeof f=="function"&&(p=f,f=""),!f&&n.filename&&(f=n.filename),!!f){var g=r.compressToBuffer();if(g){var y=i.writeFileTo(f,g,!0);typeof p=="function"&&p(y?null:new Error("failed"),"")}}},writeZipPromise:function(f,p){let{overwrite:g,perm:y}=Object.assign({overwrite:!0},p);return new Promise((w,S)=>{!f&&n.filename&&(f=n.filename),f||S("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(m=>{let b=k=>k?w(k):S("ADM-ZIP: Wasn't able to write zip file");i.writeFileToAsync(f,m,g,y,b)},S)})},toBufferPromise:function(){return new Promise((f,p)=>{r.toAsyncBuffer(f,p)})},toBuffer:function(f,p,g,y){return typeof f=="function"?(r.toAsyncBuffer(f,p,g,y),null):r.compressToBuffer()}}}});var Ck={};Gp(Ck,{activate:()=>Ak,deactivate:()=>Rk});module.exports=Hp(Ck);var L=q(require("vscode"));var zt=q(require("vscode"));var T=q(require("vscode")),Se=q(require("os")),Y=q(require("path")),Kt=q(require("fs")),Nr=require("child_process"),kp=require("util");var xe=q(require("vscode")),kn=q(require("os")),Q=q(require("path")),ot=q(require("fs")),qr=require("child_process"),Gr=require("child_process");var ba=require("node:child_process");async function Sa(e){e=Object.assign({hostname:"127.0.0.1",port:4096,timeout:5e3},e??{});let s=["serve",`--hostname=${e.hostname}`,`--port=${e.port}`];e.config?.logLevel&&s.push(`--log-level=${e.config.logLevel}`);let t=(0,ba.spawn)("opencode",s,{signal:e.signal,env:{...process.env,OPENCODE_CONFIG_CONTENT:JSON.stringify(e.config??{})}});return{url:await new Promise((i,r)=>{let o=setTimeout(()=>{r(new Error(`Timeout waiting for server to start after ${e.timeout}ms`))},e.timeout),a="";t.stdout?.on("data",c=>{a+=c.toString();let l=a.split(`
`);for(let u of l)if(u.startsWith("opencode server listening")){let d=u.match(/on\s+(https?:\/\/[^\s]+)/);if(!d)throw new Error(`Failed to parse server url from output: ${u}`);clearTimeout(o),i(d[1]);return}}),t.stderr?.on("data",c=>{a+=c.toString()}),t.on("exit",c=>{clearTimeout(o);let l=`Server exited with code ${c}`;a.trim()&&(l+=`
Server output: ${a}`),r(new Error(l))}),t.on("error",c=>{clearTimeout(o),r(c)}),e.signal&&e.signal.addEventListener("abort",()=>{clearTimeout(o),r(new Error("Aborted"))})}),close(){t.kill()}}}var ka=3e4;function Wp(e){try{let s=new URL(e);return s.port?parseInt(s.port,10):null}catch{return null}}function Dt(e){if(!e)return!1;try{if(!ot.statSync(e).isFile())return!1;if(process.platform==="win32"){let t=Q.extname(e).toLowerCase();return t?[".exe",".cmd",".bat",".com"].includes(t):!0}return ot.accessSync(e,ot.constants.X_OK),!0}catch{return!1}}function Jp(e){let s=(e||"").trim();if(!s)return;let n=(process.env.PATH||"").split(Q.delimiter).filter(Boolean);n.includes(s)||(process.env.PATH=[s,...n].join(Q.delimiter))}function va(){let e=(()=>{try{let u=(xe.workspace.getConfiguration("openchamber").get("opencodeBinary")||"").trim();if(!u)return null;try{if(ot.statSync(u).isDirectory())return Q.join(u,process.platform==="win32"?"opencode.exe":"opencode")}catch{}return u}catch{return null}})();if(e&&Dt(e))return e;let s=(()=>{try{let c=Q.join(kn.homedir(),".config","openchamber","settings.json"),l=ot.readFileSync(c,"utf8"),u=JSON.parse(l);if(!u||typeof u!="object"||Array.isArray(u))return null;let d=u.opencodeBinary;if(typeof d!="string")return null;let h=d.trim();return h.length>0?h:null}catch{return null}})();if(s&&Dt(s))return s;let t=[process.env.OPENCODE_BINARY,process.env.OPENCODE_PATH,process.env.OPENCHAMBER_OPENCODE_PATH,process.env.OPENCHAMBER_OPENCODE_BIN].map(c=>typeof c=="string"?c.trim():"").filter(Boolean);for(let c of t)if(Dt(c))return c;let n=kn.homedir(),i=[Q.join(n,".opencode","bin","opencode"),Q.join(n,".bun","bin","opencode"),Q.join(n,".local","bin","opencode"),Q.join(n,"bin","opencode")],r=(()=>{let c=process.env.USERPROFILE||n,l=process.env.APPDATA||"",u=process.env.LOCALAPPDATA||"",d=process.env.ProgramData||"C:\\ProgramData";return[Q.join(c,".opencode","bin","opencode.exe"),Q.join(c,".opencode","bin","opencode.cmd"),Q.join(l,"npm","opencode.cmd"),Q.join(c,"scoop","shims","opencode.cmd"),Q.join(d,"chocolatey","bin","opencode.exe"),Q.join(d,"chocolatey","bin","opencode.cmd"),Q.join(c,".bun","bin","opencode.exe"),Q.join(c,".bun","bin","opencode.cmd"),u?Q.join(u,"Programs","opencode","opencode.exe"):""].filter(Boolean)})(),o=process.platform==="win32"?r:i;for(let c of o)if(Dt(c))return c;if(process.platform==="win32"){try{let c=(0,Gr.spawnSync)("where",["opencode"],{encoding:"utf8",stdio:["ignore","pipe","pipe"]});if(c.status===0){let u=(c.stdout||"").split(/\r?\n/).map(d=>d.trim()).filter(Boolean).find(d=>Dt(d));if(u)return u}}catch{}return null}let a=[process.env.SHELL,"/bin/zsh","/bin/bash","/bin/sh"].filter(Boolean);for(let c of a)if(Dt(c))try{let l=(0,Gr.spawnSync)(c,["-lic","command -v opencode"],{encoding:"utf8",stdio:["ignore","pipe","pipe"]});if(l.status===0){let u=(l.stdout||"").trim().split(/\s+/).pop()||"";if(u&&Dt(u))return u}}catch{}return null}function Ea(e){return e.replace(/\/+$/,"")}function Kp(e){let s=Ea(e);try{let t=new URL(s),n=t.origin,i=[],r=a=>{let c=Ea(a);i.includes(c)||i.push(c)},o=t.pathname.replace(/\/+$/,"");return r(n),(o===""||o==="/")&&r(s),i}catch{return[s]}}async function zp(e,s=15e3){let t=xe.window.createOutputChannel("OpenChamberManager"),n=Date.now(),i=Kp(e),r=0;for(;Date.now()-n<s;){for(let o of i){r+=1;try{let a=new AbortController,c=setTimeout(()=>a.abort(),3e3),l=new URL(`${o}/global/health`),u=await fetch(l.toString(),{method:"GET",headers:{Accept:"application/json"},signal:a.signal}),d=null;try{d=await u.json()}catch{d=null}if(clearTimeout(c),t?.appendLine(`Health check to ${l.toString()} returned ${u.status} with body: ${JSON.stringify(d)}`),u.ok&&d?.healthy===!0)return{ok:!0,baseUrl:o,elapsedMs:Date.now()-n,attempts:r,version:d?.version??null}}catch{}}await new Promise(o=>setTimeout(o,100))}return{ok:!1,elapsedMs:Date.now()-n,attempts:r,version:null}}function Aa(e){let s=null,t=null,n="disconnected",i,r=new Set,o=()=>xe.workspace.workspaceFolders?.[0]?.uri.fsPath||kn.homedir(),a=o(),c=0,l=0,u=null,d=null,h=null,f=null,p=null,g=null,y=null,w=null,S=!1,m=null,b=null,v=xe.workspace.getConfiguration("openchamber").get("apiUrl")||"",E=v&&v.trim().length>0,A=null;if(E)try{let j=new URL(v);j.port&&(A=parseInt(j.port,10))}catch{}let R=(j,J)=>{(n!==j||i!==J)&&(n=j,i=J,j==="connected"&&(d=Date.now()),r.forEach(Z=>Z(n,J)))},x=()=>E&&v?v.replace(/\/+$/,""):t?t.replace(/\/+$/,""):s?.url?s.url.replace(/\/+$/,""):w?`http://127.0.0.1:${w}`:null;async function P(j){if(c+=1,R("connecting"),u=Date.now(),g=c,typeof j=="string"&&j.trim().length>0?a=j.trim():a=o(),E&&v){R("connecting"),R("connected");return}if(s){n!=="connected"&&R("connected");return}R("connecting"),S=!1,m=null,w=null,h=null,t=null;try{let J=va();J&&(m=J,Jp(Q.dirname(J)),process.env.OPENCODE_BINARY=J);let Z=process.cwd();try{process.chdir(a),s=await Sa({hostname:"127.0.0.1",port:0,timeout:ka,signal:void 0})}finally{try{process.chdir(Z)}catch{}}if(s&&s.url){let re=await zp(s.url,ka);if(f=re.elapsedMs,p=re.attempts,re.ok)t=re.baseUrl,w=Wp(re.baseUrl),y=re.version,R("connected");else{try{s.close()}catch{}throw s=null,new Error("Server started but health check failed")}}else throw new Error("Server started but URL is missing")}catch(J){let Z=J instanceof Error?J.message:String(J);Z.includes("ENOENT")||Z.includes("spawn opencode")?(S=!0,m||(m=va()),R("error","OpenCode CLI not found. Install it and ensure it's in PATH."),xe.window.showErrorMessage("OpenCode CLI not found. Please install it and ensure it's in PATH.","More Info").then(re=>{re==="More Info"&&xe.env.openExternal(xe.Uri.parse("https://github.com/anomalyco/opencode"))})):R("error",`Failed to start OpenCode: ${Z}`)}}async function I(){let j=w;if(s){try{s.close()}catch{}s=null}if(j)try{let J=(0,qr.execSync)(`lsof -ti:${j} 2>/dev/null || true`,{encoding:"utf8",timeout:5e3}),Z=process.pid;for(let re of J.split(/\s+/)){let we=parseInt(re.trim(),10);if(we&&we!==Z)try{(0,qr.execSync)(`kill -9 ${we} 2>/dev/null || true`,{stdio:"ignore",timeout:2e3})}catch{}}}catch{}t=null,w=null,y=null,R("disconnected")}async function B(){l+=1,await I(),await new Promise(j=>setTimeout(j,250)),await P()}async function D(j){if(!(b&&(await b,s))){g=1,b=P(j);try{await b}finally{b=null}}}async function $(){if(b&&await b,!!s){b=I();try{await b}finally{b=null}}}async function U(){b&&await b,g=1,b=B();try{await b}finally{b=null}}async function X(j){let Z=o();return a===Z?{success:!0,restarted:!1,path:Z}:(a=Z,E&&v?{success:!0,restarted:!1,path:Z}:{success:!0,restarted:!1,path:Z})}return{start:D,stop:$,restart:U,setWorkingDirectory:X,getStatus:()=>n,getApiUrl:x,getWorkingDirectory:()=>a,isCliAvailable:()=>!S,getDebugInfo:()=>({mode:E&&v?"external":"managed",status:n,lastError:i,workingDirectory:a,cliAvailable:!S,cliPath:m,configuredApiUrl:E&&v?v.replace(/\/+$/,""):null,configuredPort:A,detectedPort:w,apiPrefix:"",apiPrefixDetected:!0,startCount:c,restartCount:l,lastStartAt:u,lastConnectedAt:d,lastExitCode:h,serverUrl:x(),lastReadyElapsedMs:f,lastReadyAttempts:p,lastStartAttempts:g,version:y}),onStatusChange(j){return r.add(j),j(n,i),new xe.Disposable(()=>r.delete(j))}}}var C=q(require("node:fs")),M=q(require("node:path")),bu=q(require("node:os")),xo=q(Ro());function wr(e,s=!1){let t=e.length,n=0,i="",r=0,o=16,a=0,c=0,l=0,u=0,d=0;function h(m,b){let k=0,v=0;for(;k<m||!b;){let E=e.charCodeAt(n);if(E>=48&&E<=57)v=v*16+E-48;else if(E>=65&&E<=70)v=v*16+E-65+10;else if(E>=97&&E<=102)v=v*16+E-97+10;else break;n++,k++}return k<m&&(v=-1),v}function f(m){n=m,i="",r=0,o=16,d=0}function p(){let m=n;if(e.charCodeAt(n)===48)n++;else for(n++;n<e.length&&ls(e.charCodeAt(n));)n++;if(n<e.length&&e.charCodeAt(n)===46)if(n++,n<e.length&&ls(e.charCodeAt(n)))for(n++;n<e.length&&ls(e.charCodeAt(n));)n++;else return d=3,e.substring(m,n);let b=n;if(n<e.length&&(e.charCodeAt(n)===69||e.charCodeAt(n)===101))if(n++,(n<e.length&&e.charCodeAt(n)===43||e.charCodeAt(n)===45)&&n++,n<e.length&&ls(e.charCodeAt(n))){for(n++;n<e.length&&ls(e.charCodeAt(n));)n++;b=n}else d=3;return e.substring(m,b)}function g(){let m="",b=n;for(;;){if(n>=t){m+=e.substring(b,n),d=2;break}let k=e.charCodeAt(n);if(k===34){m+=e.substring(b,n),n++;break}if(k===92){if(m+=e.substring(b,n),n++,n>=t){d=2;break}switch(e.charCodeAt(n++)){case 34:m+='"';break;case 92:m+="\\";break;case 47:m+="/";break;case 98:m+="\b";break;case 102:m+="\f";break;case 110:m+=`
`;break;case 114:m+="\r";break;case 116:m+="	";break;case 117:let E=h(4,!0);E>=0?m+=String.fromCharCode(E):d=4;break;default:d=5}b=n;continue}if(k>=0&&k<=31)if(cn(k)){m+=e.substring(b,n),d=2;break}else d=6;n++}return m}function y(){if(i="",d=0,r=n,c=a,u=l,n>=t)return r=t,o=17;let m=e.charCodeAt(n);if(Co(m)){do n++,i+=String.fromCharCode(m),m=e.charCodeAt(n);while(Co(m));return o=15}if(cn(m))return n++,i+=String.fromCharCode(m),m===13&&e.charCodeAt(n)===10&&(n++,i+=`
`),a++,l=n,o=14;switch(m){case 123:return n++,o=1;case 125:return n++,o=2;case 91:return n++,o=3;case 93:return n++,o=4;case 58:return n++,o=6;case 44:return n++,o=5;case 34:return n++,i=g(),o=10;case 47:let b=n-1;if(e.charCodeAt(n+1)===47){for(n+=2;n<t&&!cn(e.charCodeAt(n));)n++;return i=e.substring(b,n),o=12}if(e.charCodeAt(n+1)===42){n+=2;let k=t-1,v=!1;for(;n<k;){let E=e.charCodeAt(n);if(E===42&&e.charCodeAt(n+1)===47){n+=2,v=!0;break}n++,cn(E)&&(E===13&&e.charCodeAt(n)===10&&n++,a++,l=n)}return v||(n++,d=1),i=e.substring(b,n),o=13}return i+=String.fromCharCode(m),n++,o=16;case 45:if(i+=String.fromCharCode(m),n++,n===t||!ls(e.charCodeAt(n)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=p(),o=11;default:for(;n<t&&w(m);)n++,m=e.charCodeAt(n);if(r!==n){switch(i=e.substring(r,n),i){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return i+=String.fromCharCode(m),n++,o=16}}function w(m){if(Co(m)||cn(m))return!1;switch(m){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function S(){let m;do m=y();while(m>=12&&m<=15);return m}return{setPosition:f,getPosition:()=>n,scan:s?S:y,getToken:()=>o,getTokenValue:()=>i,getTokenOffset:()=>r,getTokenLength:()=>n-r,getTokenStartLine:()=>c,getTokenStartCharacter:()=>r-u,getTokenError:()=>d}}function Co(e){return e===32||e===9}function cn(e){return e===10||e===13}function ls(e){return e>=48&&e<=57}var fu;(function(e){e[e.lineFeed=10]="lineFeed",e[e.carriageReturn=13]="carriageReturn",e[e.space=32]="space",e[e._0=48]="_0",e[e._1=49]="_1",e[e._2=50]="_2",e[e._3=51]="_3",e[e._4=52]="_4",e[e._5=53]="_5",e[e._6=54]="_6",e[e._7=55]="_7",e[e._8=56]="_8",e[e._9=57]="_9",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.asterisk=42]="asterisk",e[e.backslash=92]="backslash",e[e.closeBrace=125]="closeBrace",e[e.closeBracket=93]="closeBracket",e[e.colon=58]="colon",e[e.comma=44]="comma",e[e.dot=46]="dot",e[e.doubleQuote=34]="doubleQuote",e[e.minus=45]="minus",e[e.openBrace=123]="openBrace",e[e.openBracket=91]="openBracket",e[e.plus=43]="plus",e[e.slash=47]="slash",e[e.formFeed=12]="formFeed",e[e.tab=9]="tab"})(fu||(fu={}));var Ew=new Array(20).fill(0).map((e,s)=>" ".repeat(s)),us=200,Aw={" ":{"\n":new Array(us).fill(0).map((e,s)=>`
`+" ".repeat(s)),"\r":new Array(us).fill(0).map((e,s)=>"\r"+" ".repeat(s)),"\r\n":new Array(us).fill(0).map((e,s)=>`\r
`+" ".repeat(s))},"	":{"\n":new Array(us).fill(0).map((e,s)=>`
`+"	".repeat(s)),"\r":new Array(us).fill(0).map((e,s)=>"\r"+"	".repeat(s)),"\r\n":new Array(us).fill(0).map((e,s)=>`\r
`+"	".repeat(s))}};var br;(function(e){e.DEFAULT={allowTrailingComma:!1}})(br||(br={}));function pu(e,s=[],t=br.DEFAULT){let n=null,i=[],r=[];function o(c){Array.isArray(i)?i.push(c):n!==null&&(i[n]=c)}return gu(e,{onObjectBegin:()=>{let c={};o(c),r.push(i),i=c,n=null},onObjectProperty:c=>{n=c},onObjectEnd:()=>{i=r.pop()},onArrayBegin:()=>{let c=[];o(c),r.push(i),i=c,n=null},onArrayEnd:()=>{i=r.pop()},onLiteralValue:o,onError:(c,l,u)=>{s.push({error:c,offset:l,length:u})}},t),i[0]}function gu(e,s,t=br.DEFAULT){let n=wr(e,!1),i=[],r=0;function o(D){return D?()=>r===0&&D(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function a(D){return D?$=>r===0&&D($,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function c(D){return D?$=>r===0&&D($,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>i.slice()):()=>!0}function l(D){return D?()=>{r>0?r++:D(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>i.slice())===!1&&(r=1)}:()=>!0}function u(D){return D?()=>{r>0&&r--,r===0&&D(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:()=>!0}let d=l(s.onObjectBegin),h=c(s.onObjectProperty),f=u(s.onObjectEnd),p=l(s.onArrayBegin),g=u(s.onArrayEnd),y=c(s.onLiteralValue),w=a(s.onSeparator),S=o(s.onComment),m=a(s.onError),b=t&&t.disallowComments,k=t&&t.allowTrailingComma;function v(){for(;;){let D=n.scan();switch(n.getTokenError()){case 4:E(14);break;case 5:E(15);break;case 3:E(13);break;case 1:b||E(11);break;case 2:E(12);break;case 6:E(16);break}switch(D){case 12:case 13:b?E(10):S();break;case 16:E(1);break;case 15:case 14:break;default:return D}}}function E(D,$=[],U=[]){if(m(D),$.length+U.length>0){let X=n.getToken();for(;X!==17;){if($.indexOf(X)!==-1){v();break}else if(U.indexOf(X)!==-1)break;X=v()}}}function A(D){let $=n.getTokenValue();return D?y($):(h($),i.push($)),v(),!0}function R(){switch(n.getToken()){case 11:let D=n.getTokenValue(),$=Number(D);isNaN($)&&(E(2),$=0),y($);break;case 7:y(null);break;case 8:y(!0);break;case 9:y(!1);break;default:return!1}return v(),!0}function x(){return n.getToken()!==10?(E(3,[],[2,5]),!1):(A(!1),n.getToken()===6?(w(":"),v(),B()||E(4,[],[2,5])):E(5,[],[2,5]),i.pop(),!0)}function P(){d(),v();let D=!1;for(;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(D||E(4,[],[]),w(","),v(),n.getToken()===2&&k)break}else D&&E(6,[],[]);x()||E(4,[],[2,5]),D=!0}return f(),n.getToken()!==2?E(7,[2],[]):v(),!0}function I(){p(),v();let D=!0,$=!1;for(;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if($||E(4,[],[]),w(","),v(),n.getToken()===4&&k)break}else $&&E(6,[],[]);D?(i.push(0),D=!1):i[i.length-1]++,B()||E(4,[],[4,5]),$=!0}return g(),D||i.pop(),n.getToken()!==4?E(8,[4],[]):v(),!0}function B(){switch(n.getToken()){case 3:return I();case 1:return P();case 10:return A(!0);default:return R()}}return v(),n.getToken()===17?t.allowEmptyContent?!0:(E(4,[],[]),!1):B()?(n.getToken()!==17&&E(9,[],[]),!0):(E(4,[],[]),!1)}var hu;(function(e){e[e.None=0]="None",e[e.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=2]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",e[e.InvalidUnicode=4]="InvalidUnicode",e[e.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",e[e.InvalidCharacter=6]="InvalidCharacter"})(hu||(hu={}));var mu;(function(e){e[e.OpenBraceToken=1]="OpenBraceToken",e[e.CloseBraceToken=2]="CloseBraceToken",e[e.OpenBracketToken=3]="OpenBracketToken",e[e.CloseBracketToken=4]="CloseBracketToken",e[e.CommaToken=5]="CommaToken",e[e.ColonToken=6]="ColonToken",e[e.NullKeyword=7]="NullKeyword",e[e.TrueKeyword=8]="TrueKeyword",e[e.FalseKeyword=9]="FalseKeyword",e[e.StringLiteral=10]="StringLiteral",e[e.NumericLiteral=11]="NumericLiteral",e[e.LineCommentTrivia=12]="LineCommentTrivia",e[e.BlockCommentTrivia=13]="BlockCommentTrivia",e[e.LineBreakTrivia=14]="LineBreakTrivia",e[e.Trivia=15]="Trivia",e[e.Unknown=16]="Unknown",e[e.EOF=17]="EOF"})(mu||(mu={}));var wu=pu;var yu;(function(e){e[e.InvalidSymbol=1]="InvalidSymbol",e[e.InvalidNumberFormat=2]="InvalidNumberFormat",e[e.PropertyNameExpected=3]="PropertyNameExpected",e[e.ValueExpected=4]="ValueExpected",e[e.ColonExpected=5]="ColonExpected",e[e.CommaExpected=6]="CommaExpected",e[e.CloseBraceExpected=7]="CloseBraceExpected",e[e.CloseBracketExpected=8]="CloseBracketExpected",e[e.EndOfFileExpected=9]="EndOfFileExpected",e[e.InvalidCommentToken=10]="InvalidCommentToken",e[e.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",e[e.UnexpectedEndOfString=12]="UnexpectedEndOfString",e[e.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",e[e.InvalidUnicode=14]="InvalidUnicode",e[e.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",e[e.InvalidCharacter=16]="InvalidCharacter"})(yu||(yu={}));var Oe=M.default.join(bu.default.homedir(),".config","opencode"),Io=M.default.join(Oe,"agents"),_o=M.default.join(Oe,"commands"),Rt=M.default.join(Oe,"opencode.json"),xw=process.env.OPENCODE_CONFIG?M.default.resolve(process.env.OPENCODE_CONFIG):null,Su=/^\{file:(.+)\}$/i,de={USER:"user",PROJECT:"project"},be={USER:"user",PROJECT:"project"},Sr=()=>{C.default.existsSync(Oe)||C.default.mkdirSync(Oe,{recursive:!0}),C.default.existsSync(Io)||C.default.mkdirSync(Io,{recursive:!0}),C.default.existsSync(_o)||C.default.mkdirSync(_o,{recursive:!0})},Ow=e=>{let s=M.default.join(e,".opencode","agents");C.default.existsSync(s)||C.default.mkdirSync(s,{recursive:!0});let t=M.default.join(e,".opencode","agent");return C.default.existsSync(t)||C.default.mkdirSync(t,{recursive:!0}),s},ln=(e,s)=>{let t=M.default.join(e,".opencode","agents",`${s}.md`),n=M.default.join(e,".opencode","agent",`${s}.md`);return C.default.existsSync(n)&&!C.default.existsSync(t)?n:t},fs=e=>{let s=M.default.join(Io,`${e}.md`),t=M.default.join(Oe,"agent",`${e}.md`);return C.default.existsSync(t)&&!C.default.existsSync(s)?t:s},Lw=(e,s)=>{if(s){let n=ln(s,e);if(C.default.existsSync(n))return{scope:de.PROJECT,path:n}}let t=fs(e);return C.default.existsSync(t)?{scope:de.USER,path:t}:{scope:null,path:null}},Nw=(e,s,t)=>{let n=Lw(e,s);return n.path?{scope:n.scope,path:n.path}:(t||de.USER)===de.PROJECT&&s?{scope:de.PROJECT,path:ln(s,e)}:{scope:de.USER,path:fs(e)}},Dw=e=>{let s=M.default.join(e,".opencode","commands");C.default.existsSync(s)||C.default.mkdirSync(s,{recursive:!0});let t=M.default.join(e,".opencode","command");return C.default.existsSync(t)||C.default.mkdirSync(t,{recursive:!0}),s},un=(e,s)=>{let t=M.default.join(e,".opencode","commands",`${s}.md`),n=M.default.join(e,".opencode","command",`${s}.md`);return C.default.existsSync(n)&&!C.default.existsSync(t)?n:t},ps=e=>{let s=M.default.join(_o,`${e}.md`),t=M.default.join(Oe,"command",`${e}.md`);return C.default.existsSync(t)&&!C.default.existsSync(s)?t:s},Mw=(e,s)=>{if(s){let n=un(s,e);if(C.default.existsSync(n))return{scope:be.PROJECT,path:n}}let t=ps(e);return C.default.existsSync(t)?{scope:be.USER,path:t}:{scope:null,path:null}},$w=(e,s,t)=>{let n=Mw(e,s);return n.path?{scope:n.scope,path:n.path}:(t||be.USER)===be.PROJECT&&s?{scope:be.PROJECT,path:un(s,e)}:{scope:be.USER,path:ps(e)}},ku=e=>typeof e=="string"&&Su.test(e.trim()),vu=e=>{let s=e.trim().match(Su);if(!s?.[1])return null;let t=s[1].trim();return t?(t.startsWith("./")?t=M.default.join(Oe,t.slice(2)):M.default.isAbsolute(t)||(t=M.default.join(Oe,t)),t):null},Eu=(e,s)=>{C.default.mkdirSync(M.default.dirname(e),{recursive:!0}),C.default.writeFileSync(e,s,"utf8")},jw=e=>e?[M.default.join(e,"opencode.json"),M.default.join(e,"opencode.jsonc"),M.default.join(e,".opencode","opencode.json"),M.default.join(e,".opencode","opencode.jsonc")]:[],Fw=e=>{if(!e)return null;let s=jw(e);for(let t of s)if(C.default.existsSync(t))return t;return s[0]||null},Bw=e=>({userPath:Rt,projectPath:Fw(e),customPath:xw}),Po=e=>{if(!e||!C.default.existsSync(e))return{};let t=C.default.readFileSync(e,"utf8").trim();return t?wu(t,[],{allowTrailingComma:!0}):{}},Qe=e=>!!e&&typeof e=="object"&&!Array.isArray(e),To=(e,s)=>{let t={...e};for(let[n,i]of Object.entries(s))if(n in t){let r=t[n];Qe(r)&&Qe(i)?t[n]=To(r,i):t[n]=i}else t[n]=i;return t},et=e=>{let{userPath:s,projectPath:t,customPath:n}=Bw(e),i=Po(s),r=Po(t),o=Po(n),a=To(To(i,r),o);return{userConfig:i,projectConfig:r,customConfig:o,mergedConfig:a,paths:{userPath:s,projectPath:t,customPath:n}}};var Uw=(e,s)=>s?e.paths.customPath&&s===e.paths.customPath?e.customConfig:e.paths.projectPath&&s===e.paths.projectPath?e.projectConfig:e.userConfig:e.userConfig,ds=(e,s=Rt)=>{if(C.default.existsSync(s)){let t=`${s}.openchamber.backup`;try{C.default.copyFileSync(s,t)}catch{}}C.default.mkdirSync(M.default.dirname(s),{recursive:!0}),C.default.writeFileSync(s,JSON.stringify(e,null,2),"utf8")},Ct=(e,s,t)=>{let{userConfig:n,projectConfig:i,customConfig:r,paths:o}=e,a=r?.[s];if(a?.[t]!==void 0)return{section:a[t],config:r,path:o.customPath,exists:!0};let c=i?.[s];if(c?.[t]!==void 0)return{section:c[t],config:i,path:o.projectPath,exists:!0};let l=n?.[s];return l?.[t]!==void 0?{section:l[t],config:n,path:o.userPath,exists:!0}:{section:null,config:null,path:null,exists:!1}},Oo=(e,s)=>{let{userConfig:t,projectConfig:n,customConfig:i,paths:r}=e;return r.customPath?{config:i,path:r.customPath}:s===de.PROJECT&&r.projectPath?{config:n,path:r.projectPath}:r.projectPath?{config:n,path:r.projectPath}:{config:t,path:r.userPath}},gs=e=>{let s=C.default.readFileSync(e,"utf8"),t=s.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n([\s\S]*)$/);if(!t)return{frontmatter:{},body:s.trim()};let n={};try{n=xo.default.parse(t[1])||{}}catch(i){console.warn(`[OpenChamber][VSCode] Failed to parse frontmatter for ${e}, treating as empty:`,i),n={}}return{frontmatter:n,body:(t[2]||"").trim()}},hs=(e,s,t)=>{let n=Object.fromEntries(Object.entries(s??{}).filter(([,o])=>o!=null)),r=`---
${xo.default.stringify(n)}---

${t??""}`.trimEnd();C.default.writeFileSync(e,r,"utf8")},Au=(e,s)=>{let t=s?ln(s,e):null,n=t?C.default.existsSync(t):!1,i=fs(e),r=C.default.existsSync(i),o=n?t:r?i:null,a=!!o,c=n?de.PROJECT:r?de.USER:null,l=et(s),u=Ct(l,"agent",e),d=u.section,h=u.path||l.paths.customPath||l.paths.projectPath||l.paths.userPath,f=u.path===l.paths.projectPath?de.PROJECT:de.USER,p={md:{exists:a,path:o,scope:c,fields:[]},json:{exists:u.exists,path:h||Rt,scope:u.exists?f:null,fields:[]},projectMd:{exists:n,path:t},userMd:{exists:r,path:i}};if(a&&o){let{frontmatter:g,body:y}=gs(o);p.md.fields=Object.keys(g),y&&p.md.fields.push("prompt")}return d&&(p.json.fields=Object.keys(d)),p},Ru=(e,s,t,n)=>{Sr();let i=t?ln(t,e):null,r=fs(e);if(i&&C.default.existsSync(i))throw new Error(`Agent ${e} already exists as project-level .md file`);if(C.default.existsSync(r))throw new Error(`Agent ${e} already exists as user-level .md file`);let o=et(t);if(Ct(o,"agent",e).exists)throw new Error(`Agent ${e} already exists in opencode.json`);let c;n===de.PROJECT&&t?(Ow(t),c=i):c=r;let{prompt:l,scope:u,...d}=s;hs(c,d,typeof l=="string"?l:"")},Cu=(e,s,t)=>{Sr();let{path:n}=Nw(e,t),i=n?C.default.existsSync(n):!1,r=et(t),o=Ct(r,"agent",e),a=o.section,c=!!(o.exists&&a&&Object.keys(a).length>0),l=o.exists?{config:o.config,path:o.path}:Oo(r,t?de.PROJECT:de.USER),u=l.config||{},d=!i&&!c,h=n;!i&&d&&(h=fs(e));let f=i&&n?gs(n):d?{frontmatter:{},body:""}:null,p=!1,g=!1,y=d;for(let[w,S]of Object.entries(s||{})){if(w==="prompt"){let k=typeof S=="string"?S:S==null?"":String(S);if(i||y){f&&(f.body=k,p=!0);continue}if(ku(a?.prompt)){let E=vu(a.prompt);if(!E)throw new Error(`Invalid prompt file reference for agent ${e}`);Eu(E,k);continue}u.agent||(u.agent={});let v=u.agent[e]??{};u.agent[e]={...v,prompt:k},g=!0;continue}let m=f?.frontmatter?.[w]!==void 0;if(a?.[w]!==void 0){u.agent||(u.agent={});let k=u.agent[e]??{};u.agent[e]={...k,[w]:S},g=!0;continue}if(m||y){f&&(f.frontmatter[w]=S,p=!0);continue}if((i||y)&&f)f.frontmatter[w]=S,p=!0;else{u.agent||(u.agent={});let k=u.agent[e]??{};u.agent[e]={...k,[w]:S},g=!0}}p&&f&&h&&hs(h,f.frontmatter,f.body),g&&ds(u,l.path||Rt)},Pu=(e,s)=>{let t=!1;if(s){let o=ln(s,e);C.default.existsSync(o)&&(C.default.unlinkSync(o),t=!0)}let n=fs(e);C.default.existsSync(n)&&(C.default.unlinkSync(n),t=!0);let i=et(s),r=Ct(i,"agent",e);if(r.exists&&r.config&&r.path){let o=r.config,a=o.agent??{};delete a[e],o.agent=a,ds(o,r.path),t=!0}if(!t){let o=Oo(i,s?de.PROJECT:de.USER),a=o.config||{},c=a.agent??{};c[e]={disable:!0},a.agent=c,ds(a,o.path||Rt)}},Iu=(e,s)=>{let t=s?un(s,e):null,n=t?C.default.existsSync(t):!1,i=ps(e),r=C.default.existsSync(i),o=n?t:r?i:null,a=!!o,c=n?be.PROJECT:r?be.USER:null,l=et(s),u=Ct(l,"command",e),d=u.section,h=u.path||l.paths.customPath||l.paths.projectPath||l.paths.userPath,f=u.path===l.paths.projectPath?be.PROJECT:be.USER,p={md:{exists:a,path:o,scope:c,fields:[]},json:{exists:u.exists,path:h||Rt,scope:u.exists?f:null,fields:[]},projectMd:{exists:n,path:t},userMd:{exists:r,path:i}};if(a&&o){let{frontmatter:g,body:y}=gs(o);p.md.fields=Object.keys(g),y&&p.md.fields.push("template")}return d&&(p.json.fields=Object.keys(d)),p},_u=(e,s,t,n)=>{Sr();let i=t?un(t,e):null,r=ps(e);if(i&&C.default.existsSync(i))throw new Error(`Command ${e} already exists as project-level .md file`);if(C.default.existsSync(r))throw new Error(`Command ${e} already exists as user-level .md file`);let o=et(t);if(Ct(o,"command",e).exists)throw new Error(`Command ${e} already exists in opencode.json`);let c;n===be.PROJECT&&t?(Dw(t),c=i):c=r;let{template:l,scope:u,...d}=s;hs(c,d,typeof l=="string"?l:"")},Tu=(e,s,t)=>{Sr();let{path:n}=$w(e,t),i=n?C.default.existsSync(n):!1,r=et(t),o=Ct(r,"command",e),a=o.section,c=!!(o.exists&&a&&Object.keys(a).length>0),l=o.exists?{config:o.config,path:o.path}:Oo(r,t?be.PROJECT:be.USER),u=l.config||{},d=!i&&!c,h=n;!i&&d&&(h=ps(e));let f=i&&n?gs(n):d?{frontmatter:{},body:""}:null,p=!1,g=!1,y=d;for(let[w,S]of Object.entries(s||{})){if(w==="template"){let k=typeof S=="string"?S:S==null?"":String(S);if(i||y){f&&(f.body=k,p=!0);continue}if(ku(a?.template)){let E=vu(a.template);if(!E)throw new Error(`Invalid template file reference for command ${e}`);Eu(E,k);continue}u.command||(u.command={});let v=u.command[e]??{};u.command[e]={...v,template:k},g=!0;continue}let m=f?.frontmatter?.[w]!==void 0;if(a?.[w]!==void 0){u.command||(u.command={});let k=u.command[e]??{};u.command[e]={...k,[w]:S},g=!0;continue}if(m||y){f&&(f.frontmatter[w]=S,p=!0);continue}if((i||y)&&f)f.frontmatter[w]=S,p=!0;else{u.command||(u.command={});let k=u.command[e]??{};u.command[e]={...k,[w]:S},g=!0}}p&&f&&h&&hs(h,f.frontmatter,f.body),g&&ds(u,l.path||Rt)},xu=(e,s)=>{let t=et(s),n=Qe(t.customConfig?.provider)?t.customConfig.provider:{},i=Qe(t.customConfig?.providers)?t.customConfig.providers:{},r=Qe(t.projectConfig?.provider)?t.projectConfig.provider:{},o=Qe(t.projectConfig?.providers)?t.projectConfig.providers:{},a=Qe(t.userConfig?.provider)?t.userConfig.provider:{},c=Qe(t.userConfig?.providers)?t.userConfig.providers:{},l=Object.prototype.hasOwnProperty.call(n,e)||Object.prototype.hasOwnProperty.call(i,e),u=Object.prototype.hasOwnProperty.call(r,e)||Object.prototype.hasOwnProperty.call(o,e),d=Object.prototype.hasOwnProperty.call(a,e)||Object.prototype.hasOwnProperty.call(c,e);return{auth:{exists:!1},user:{exists:d,path:t.paths.userPath},project:{exists:u,path:t.paths.projectPath??null},custom:{exists:l,path:t.paths.customPath}}},dn=(e,s,t="user")=>{if(!e)throw new Error("Provider ID is required");let n=et(s),i=n.paths.userPath;if(t==="project"){if(!s)throw new Error("Working directory is required for project scope");i=n.paths.projectPath??i}if(t==="custom"){if(!n.paths.customPath)return!1;i=n.paths.customPath}let r=Uw(n,i),o=Qe(r.provider)?r.provider:{},a=Qe(r.providers)?r.providers:{},c=Object.prototype.hasOwnProperty.call(o,e),l=Object.prototype.hasOwnProperty.call(a,e);return!c&&!l?!1:(c&&(delete o[e],Object.keys(o).length===0?delete r.provider:r.provider=o),l&&(delete a[e],Object.keys(a).length===0?delete r.providers:r.providers=a),ds(r,i||Rt),!0)},Ou=(e,s)=>{let t=!1;if(s){let o=un(s,e);C.default.existsSync(o)&&(C.default.unlinkSync(o),t=!0)}let n=ps(e);C.default.existsSync(n)&&(C.default.unlinkSync(n),t=!0);let i=et(s),r=Ct(i,"command",e);if(r.exists&&r.config&&r.path){let o=r.config,a=o.command??{};delete a[e],o.command=a,ds(o,r.path),t=!0}if(!t)throw new Error(`Command "${e}" not found`)},qt=M.default.join(Oe,"skills"),ve={USER:"user",PROJECT:"project"},Lu=()=>{C.default.existsSync(qt)||C.default.mkdirSync(qt,{recursive:!0})},Lo=e=>{let s=M.default.join(qt,e),t=M.default.join(Oe,"skill",e);return C.default.existsSync(t)&&!C.default.existsSync(s)?t:s},Nu=e=>{let s=M.default.join(qt,e,"SKILL.md"),t=M.default.join(Oe,"skill",e,"SKILL.md");return C.default.existsSync(t)&&!C.default.existsSync(s)?t:s},No=(e,s)=>{let t=M.default.join(e,".opencode","skills",s),n=M.default.join(e,".opencode","skill",s);return C.default.existsSync(n)&&!C.default.existsSync(t)?n:t},Du=(e,s)=>{let t=M.default.join(e,".opencode","skills",s,"SKILL.md"),n=M.default.join(e,".opencode","skill",s,"SKILL.md");return C.default.existsSync(n)&&!C.default.existsSync(t)?n:t},Do=(e,s)=>M.default.join(e,".claude","skills",s),Mu=(e,s)=>M.default.join(Do(e,s),"SKILL.md"),$u=(e,s)=>{if(s){let n=Du(s,e);if(C.default.existsSync(n))return{scope:ve.PROJECT,path:n,source:"opencode"};let i=Mu(s,e);if(C.default.existsSync(i))return{scope:ve.PROJECT,path:i,source:"claude"}}let t=Nu(e);return C.default.existsSync(t)?{scope:ve.USER,path:t,source:"opencode"}:{scope:null,path:null,source:null}},qw=e=>{if(!C.default.existsSync(e))return[];let s=[],t=(n,i="")=>{let r=C.default.readdirSync(n,{withFileTypes:!0});for(let o of r){let a=M.default.join(n,o.name),c=i?M.default.join(i,o.name):o.name;o.isDirectory()?t(a,c):o.name!=="SKILL.md"&&s.push({name:o.name,path:c,fullPath:a})}};return t(e),s},kr=e=>{let s=new Map,t=(i,r,o,a)=>{s.has(i)||s.set(i,{name:i,path:r,scope:o,source:a})};if(e){let i=M.default.join(e,".opencode","skills");if(C.default.existsSync(i)){let a=C.default.readdirSync(i,{withFileTypes:!0});for(let c of a)if(c.isDirectory()){let l=M.default.join(i,c.name,"SKILL.md");C.default.existsSync(l)&&t(c.name,l,ve.PROJECT,"opencode")}}let r=M.default.join(e,".opencode","skill");if(C.default.existsSync(r)){let a=C.default.readdirSync(r,{withFileTypes:!0});for(let c of a)if(c.isDirectory()){let l=M.default.join(r,c.name,"SKILL.md");C.default.existsSync(l)&&t(c.name,l,ve.PROJECT,"opencode")}}let o=M.default.join(e,".claude","skills");if(C.default.existsSync(o)){let a=C.default.readdirSync(o,{withFileTypes:!0});for(let c of a)if(c.isDirectory()){let l=M.default.join(o,c.name,"SKILL.md");C.default.existsSync(l)&&t(c.name,l,ve.PROJECT,"claude")}}}if(C.default.existsSync(qt)){let i=C.default.readdirSync(qt,{withFileTypes:!0});for(let r of i)if(r.isDirectory()){let o=M.default.join(qt,r.name,"SKILL.md");C.default.existsSync(o)&&t(r.name,o,ve.USER,"opencode")}}let n=M.default.join(Oe,"skill");if(C.default.existsSync(n)){let i=C.default.readdirSync(n,{withFileTypes:!0});for(let r of i)if(r.isDirectory()){let o=M.default.join(n,r.name,"SKILL.md");C.default.existsSync(o)&&t(r.name,o,ve.USER,"opencode")}}return Array.from(s.values())},Mo=(e,s)=>{Lu();let t=s?Du(s,e):null,n=t?C.default.existsSync(t):!1,i=n&&s?No(s,e):null,r=s?Mu(s,e):null,o=r?C.default.existsSync(r):!1,a=o&&s?Do(s,e):null,c=Nu(e),l=C.default.existsSync(c),u=l?Lo(e):null,d=null,h=null,f=null,p=null;n?(d=t,h=ve.PROJECT,f="opencode",p=i):o?(d=r,h=ve.PROJECT,f="claude",p=a):l&&(d=c,h=ve.USER,f="opencode",p=u);let g=!!d,y=[],w=[];if(g&&d){let{frontmatter:S,body:m}=gs(d);y=Object.keys(S),m&&y.push("instructions"),p&&(w=qw(p))}return{md:{exists:g,path:d,dir:p,fields:y,scope:h,source:f,supportingFiles:w},projectMd:{exists:n,path:t},claudeMd:{exists:o,path:r},userMd:{exists:l,path:c}}},ju=(e,s)=>{let t=M.default.join(e,s);return C.default.existsSync(t)?C.default.readFileSync(t,"utf8"):null},vr=(e,s,t)=>{let n=M.default.join(e,s);C.default.mkdirSync(M.default.dirname(n),{recursive:!0}),C.default.writeFileSync(n,t,"utf8")},$o=(e,s)=>{let t=M.default.join(e,s);if(C.default.existsSync(t)){C.default.unlinkSync(t);let n=M.default.dirname(t);for(;n!==e;)try{if(C.default.readdirSync(n).length===0)C.default.rmdirSync(n),n=M.default.dirname(n);else break}catch{break}}},Gw=e=>{if(!/^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$/.test(e)||e.length>64)throw new Error(`Invalid skill name "${e}". Must be 1-64 lowercase alphanumeric characters with hyphens, cannot start or end with hyphen.`)},Fu=(e,s,t,n)=>{Lu(),Gw(e);let i=$u(e,t);if(i.path)throw new Error(`Skill ${e} already exists at ${i.path}`);let r;n===ve.PROJECT&&t?r=No(t,e):r=Lo(e),C.default.mkdirSync(r,{recursive:!0});let o=M.default.join(r,"SKILL.md"),{instructions:a,scope:c,supportingFiles:l,...u}=s;if(u.name||(u.name=e),!u.description)throw new Error("Skill description is required");if(hs(o,u,typeof a=="string"?a:""),l&&Array.isArray(l))for(let d of l)d.path&&d.content!==void 0&&vr(r,d.path,d.content)},Bu=(e,s,t)=>{let n=$u(e,t);if(!n.path)throw new Error(`Skill "${e}" not found`);let i=n.path,r=M.default.dirname(i),o=gs(i),a=!1;for(let[c,l]of Object.entries(s||{}))if(c!=="scope"){if(c==="instructions"){let u=typeof l=="string"?l:l==null?"":String(l);o.body=u,a=!0;continue}if(c==="supportingFiles"&&Array.isArray(l)){for(let u of l)u.delete&&u.path?$o(r,u.path):u.path&&u.content!==void 0&&vr(r,u.path,u.content);continue}o.frontmatter[c]=l,a=!0}a&&hs(i,o.frontmatter,o.body)},Uu=(e,s)=>{let t=!1;if(s){let i=No(s,e);C.default.existsSync(i)&&(C.default.rmSync(i,{recursive:!0,force:!0}),t=!0);let r=Do(s,e);C.default.existsSync(r)&&(C.default.rmSync(r,{recursive:!0,force:!0}),t=!0)}let n=Lo(e);if(C.default.existsSync(n)&&(C.default.rmSync(n,{recursive:!0,force:!0}),t=!0),!t)throw new Error(`Skill "${e}" not found`)};var Pt=q(require("node:fs")),Fo=q(require("node:path")),qu=q(require("node:os")),jo=Fo.default.join(qu.default.homedir(),".local","share","opencode"),ms=Fo.default.join(jo,"auth.json"),Gu=()=>{if(!Pt.default.existsSync(ms))return{};try{let s=Pt.default.readFileSync(ms,"utf8").trim();return s?JSON.parse(s):{}}catch(e){throw console.error("Failed to read auth file:",e),new Error("Failed to read OpenCode auth configuration")}},Hw=e=>{try{if(Pt.default.existsSync(jo)||Pt.default.mkdirSync(jo,{recursive:!0}),Pt.default.existsSync(ms)){let s=`${ms}.openchamber.backup`;Pt.default.copyFileSync(ms,s)}Pt.default.writeFileSync(ms,JSON.stringify(e,null,2),"utf8")}catch(s){throw console.error("Failed to write auth file:",s),new Error("Failed to write OpenCode auth configuration")}},Bo=e=>{if(!e||typeof e!="string")throw new Error("Provider ID is required");let s=Gu();return s[e]?(delete s[e],Hw(s),!0):!1},Hu=e=>Gu()[e]||null;var fn=q(require("node:fs")),ys=q(require("node:path")),qo=q(require("node:os")),Ww=ys.default.join(qo.default.homedir(),".config","opencode"),zu=ys.default.join(qo.default.homedir(),".local","share","opencode"),Wu=ys.default.join(zu,"auth.json"),Jw=[ys.default.join(Ww,"antigravity-accounts.json"),ys.default.join(zu,"antigravity-accounts.json")],Kw="1071006060591-tmhssin2h21lcre235vtolojh4g403ep.apps.googleusercontent.com",zw="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",Vw="681255809395-oo8ft2oprdrnp9e3aqf6av3hmdib135j.apps.googleusercontent.com",Yw="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",Zw="rising-fact-p41fc",Xw=5*60*60,Uo=24*60*60,Vu="https://cloudcode-pa.googleapis.com",Qw=["https://daily-cloudcode-pa.sandbox.googleapis.com","https://autopush-cloudcode-pa.sandbox.googleapis.com",Vu],eb={"User-Agent":"antigravity/1.11.5 windows/amd64","X-Goog-Api-Client":"google-cloud-sdk vscode_cloudshelleditor/0.1","Client-Metadata":'{"ideType":"IDE_UNSPECIFIED","platform":"PLATFORM_UNSPECIFIED","pluginType":"GEMINI"}'},Ju=(e,s)=>{if(e==="gemini")return{label:"daily",seconds:Uo};if(e==="antigravity"){let t=typeof s=="number"?Math.max(0,Math.round((s-Date.now())/1e3)):null;return t!==null&&t>10*60*60?{label:"daily",seconds:Uo}:{label:"5h",seconds:Xw}}return{label:"daily",seconds:Uo}},tb={3:3600},lt=()=>{if(!fn.default.existsSync(Wu))return{};try{let s=fn.default.readFileSync(Wu,"utf8").trim();return s?JSON.parse(s):{}}catch(e){throw console.error("Failed to read auth file:",e),new Error("Failed to read OpenCode auth configuration")}},sb=e=>{if(!fn.default.existsSync(e))return null;try{let t=fn.default.readFileSync(e,"utf8").trim();if(!t)return null;let n=JSON.parse(t);return!n||typeof n!="object"?null:n}catch(s){return console.warn(`Failed to read JSON file: ${e}`,s),null}},Pe=(e,s)=>{for(let t of s)if(e[t])return e[t];return null},Ie=e=>e?typeof e=="string"?{token:e}:typeof e=="object"?e:null:null,Ku=e=>e&&typeof e=="object"?e:null,tt=e=>{if(typeof e!="string")return null;let s=e.trim();return s||null},Yu=e=>{let s=tt(e);if(!s)return{refreshToken:null,projectId:null,managedProjectId:null};let[t="",n="",i=""]=s.split("|");return{refreshToken:tt(t),projectId:tt(n),managedProjectId:tt(i)}},pe=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){let s=Number(e);return Number.isFinite(s)?s:null}return null},ze=e=>{if(!e)return null;if(typeof e=="number")return e<1e12?e*1e3:e;if(typeof e=="string"){let s=Date.parse(e);return Number.isNaN(s)?null:s}return null},nb=e=>{try{let s=new Date(e),t=new Date;return s.toDateString()===t.toDateString()?s.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}):s.toLocaleString(void 0,{month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"2-digit"})}catch{return null}},rb=e=>{if(!e)return null;let s=Math.floor((e-Date.now())/1e3);return s<0?0:s},_e=e=>{let s=rb(e.resetAt),t=e.resetAt?nb(e.resetAt):null;return{usedPercent:e.usedPercent,remainingPercent:e.usedPercent!==null?Math.max(0,100-e.usedPercent):null,windowSeconds:e.windowSeconds??null,resetAfterSeconds:s,resetAt:e.resetAt,resetAtFormatted:t,resetAfterFormatted:t,...e.valueLabel?{valueLabel:e.valueLabel}:{}}},W=e=>({providerId:e.providerId,providerName:e.providerName,ok:e.ok,configured:e.configured,usage:e.usage??null,...e.error?{error:e.error}:{},fetchedAt:Date.now()}),Zu=e=>e===null||!Number.isFinite(e)?null:e.toFixed(2),ib=(e,s)=>!e||!s?"limit":s==="TIME_UNIT_MINUTE"?`${e}m`:s==="TIME_UNIT_HOUR"?`${e}h`:s==="TIME_UNIT_DAY"?`${e}d`:"limit",ob=(e,s)=>!e||!s?null:s==="TIME_UNIT_MINUTE"?e*60:s==="TIME_UNIT_HOUR"?e*3600:s==="TIME_UNIT_DAY"?e*86400:null,Xu=()=>{let e=lt(),s=new Set,t=Ie(Pe(e,["anthropic","claude"]));t&&(t.access||t.token)&&s.add("claude");let n=Ie(Pe(e,["openai","codex","chatgpt"]));n&&(n.access||n.token)&&s.add("codex"),(Qu(e)||ed())&&s.add("google");let i=Ie(Pe(e,["zai-coding-plan","zai","z.ai"]));i&&(i.key||i.token)&&s.add("zai-coding-plan");let r=Ie(Pe(e,["kimi-for-coding","kimi"]));r&&(r.key||r.token)&&s.add("kimi-for-coding");let o=Ie(Pe(e,["openrouter"]));o&&(o.key||o.token)&&s.add("openrouter");let a=Ie(Pe(e,["github-copilot","copilot"]));return a&&(a.access||a.token)&&(s.add("github-copilot"),s.add("github-copilot-addon")),Array.from(s)},ab=async()=>{let e=lt(),s=Ie(Pe(e,["openai","codex","chatgpt"])),t=s?.access??s?.token,n=s?.accountId;if(!t)return W({providerId:"codex",providerName:"Codex",ok:!1,configured:!1,error:"Not configured"});try{let i=await fetch("https://chatgpt.com/backend-api/wham/usage",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json",...n?{"ChatGPT-Account-Id":n}:{}}});if(!i.ok)return W({providerId:"codex",providerName:"Codex",ok:!1,configured:!0,error:`API error: ${i.status}`});let r=await i.json(),o=r?.rate_limit?.primary_window??null,a=r?.rate_limit?.secondary_window??null,c=r?.credits??null,l={};if(o&&(l["5h"]=_e({usedPercent:pe(o.used_percent),windowSeconds:pe(o.limit_window_seconds),resetAt:ze(o.reset_at)})),a&&(l.weekly=_e({usedPercent:pe(a.used_percent),windowSeconds:pe(a.limit_window_seconds),resetAt:ze(a.reset_at)})),c){let u=pe(c.balance),h=!!c.unlimited?"Unlimited":u!==null?`$${Zu(u)} remaining`:null;l.credits=_e({usedPercent:null,windowSeconds:null,resetAt:null,valueLabel:h})}return W({providerId:"codex",providerName:"Codex",ok:!0,configured:!0,usage:{windows:l}})}catch(i){return W({providerId:"codex",providerName:"Codex",ok:!1,configured:!0,error:i instanceof Error?i.message:"Request failed"})}},Qu=e=>{let s=Ie(Pe(e,["google","google.oauth"])),t=Ku(s);if(!t)return null;let n=Ku(t.oauth)??t,i=tt(n.access)??tt(n.token),r=Yu(n.refresh);return!i&&!r.refreshToken?null:{sourceId:"gemini",sourceLabel:"Gemini",accessToken:i??void 0,refreshToken:r.refreshToken??void 0,projectId:r.projectId??r.managedProjectId??void 0,expires:ze(n.expires)??void 0}},ed=()=>{for(let e of Jw){let s=sb(e),t=s?.accounts;if(Array.isArray(t)&&t.length>0){let n=typeof s?.activeIndex=="number"?s.activeIndex:0,i=t[n]??t[0];if(i?.refreshToken){let r=Yu(i.refreshToken);return{sourceId:"antigravity",sourceLabel:"Antigravity",refreshToken:r.refreshToken??void 0,projectId:tt(i.projectId)??tt(i.managedProjectId)??r.projectId??r.managedProjectId??void 0,email:tt(i.email)??void 0}}}}return null},cb=()=>{let e=lt(),s=[],t=Qu(e);t&&s.push(t);let n=ed();return n&&s.push(n),s},lb=e=>e==="gemini"?{clientId:Vw,clientSecret:Yw}:{clientId:Kw,clientSecret:zw},ub=async(e,s,t)=>{let n=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:s,client_secret:t,refresh_token:e,grant_type:"refresh_token"})});if(!n.ok)return null;let i=await n.json();return typeof i?.access_token=="string"?i.access_token:null},db=async(e,s)=>{let t=s?{project:s}:{},n=typeof AbortController<"u"?new AbortController:null,i=n?setTimeout(()=>n.abort(),15e3):null;try{let r=await fetch(`${Vu}/v1internal:retrieveUserQuota`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),signal:n?.signal});return r.ok?await r.json():null}catch{return null}finally{i&&clearTimeout(i)}},fb=async(e,s)=>{let t=s?{project:s}:{};for(let n of Qw){let i=typeof AbortController<"u"?new AbortController:null,r=i?setTimeout(()=>i.abort(),15e3):null;try{let o=await fetch(`${n}/v1internal:fetchAvailableModels`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",...eb},body:JSON.stringify(t),signal:i?.signal});if(o.ok)return await o.json()}catch{}finally{r&&clearTimeout(r)}}return null},pb=async()=>{let e=cb();if(!e.length)return W({providerId:"google",providerName:"Google",ok:!1,configured:!1,error:"Not configured"});let s={},t=[];for(let n of e){let i=Date.now(),r=n.accessToken;if(!r||typeof n.expires=="number"&&n.expires<=i){if(!n.refreshToken){t.push(`${n.sourceLabel}: Missing refresh token`);continue}let{clientId:l,clientSecret:u}=lb(n.sourceId);r=await ub(n.refreshToken,l,u)??void 0}if(!r){t.push(`${n.sourceLabel}: Failed to refresh OAuth token`);continue}let o=n.projectId??Zw,a=!1;if(n.sourceId==="gemini"){let l=await db(r,o),u=Array.isArray(l?.buckets)?l.buckets:[];for(let d of u){let h=tt(d.modelId);if(!h)continue;let f=h.startsWith(`${n.sourceId}/`)?h:`${n.sourceId}/${h}`,p=pe(d.remainingFraction),g=p!==null?Math.round(p*100):null,y=g!==null?Math.max(0,100-g):null,w=ze(d.resetTime),S=Ju(n.sourceId,w);s[f]={windows:{[S.label]:_e({usedPercent:y,windowSeconds:S.seconds,resetAt:w})}},a=!0}}let c=await fb(r,o);if(c&&typeof c=="object"){let l=c.models??{};for(let[u,d]of Object.entries(l)){let h=u.startsWith(`${n.sourceId}/`)?u:`${n.sourceId}/${u}`,f=d?.quotaInfo,p=f?.remainingFraction,g=typeof p=="number"?Math.round(p*100):null,y=g!==null?Math.max(0,100-g):null,w=f?.resetTime?new Date(f.resetTime).getTime():null,S=Ju(n.sourceId,w);s[h]={windows:{[S.label]:_e({usedPercent:y,windowSeconds:S.seconds,resetAt:w})}},a=!0}}a||t.push(`${n.sourceLabel}: Failed to fetch models`)}return Object.keys(s).length?W({providerId:"google",providerName:"Google",ok:!0,configured:!0,usage:{windows:{},models:Object.keys(s).length?s:void 0}}):W({providerId:"google",providerName:"Google",ok:!1,configured:!0,error:t[0]??"Failed to fetch models"})},gb=async()=>{let e=lt(),s=Ie(Pe(e,["anthropic","claude"])),t=s?.access??s?.token;if(!t)return W({providerId:"claude",providerName:"Claude",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://api.anthropic.com/api/oauth/usage",{method:"GET",headers:{Authorization:`Bearer ${t}`,"anthropic-beta":"oauth-2025-04-20"}});if(!n.ok)return W({providerId:"claude",providerName:"Claude",ok:!1,configured:!0,error:`API error: ${n.status}`});let i=await n.json(),r={},o=i.five_hour,a=i.seven_day,c=i.seven_day_sonnet,l=i.seven_day_opus;return o&&(r["5h"]=_e({usedPercent:pe(o.utilization),windowSeconds:null,resetAt:ze(o.resets_at)})),a&&(r["7d"]=_e({usedPercent:pe(a.utilization),windowSeconds:null,resetAt:ze(a.resets_at)})),c&&(r["7d-sonnet"]=_e({usedPercent:pe(c.utilization),windowSeconds:null,resetAt:ze(c.resets_at)})),l&&(r["7d-opus"]=_e({usedPercent:pe(l.utilization),windowSeconds:null,resetAt:ze(l.resets_at)})),W({providerId:"claude",providerName:"Claude",ok:!0,configured:!0,usage:{windows:r}})}catch(n){return W({providerId:"claude",providerName:"Claude",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},td=e=>{let s=e.quota_snapshots??{},t=ze(e.quota_reset_date),n={},i=(r,o)=>{if(!o)return;let a=pe(o.entitlement),c=pe(o.remaining),l=a&&c!==null?Math.max(0,Math.min(100,100-c/a*100)):null,u=a!==null&&c!==null?`${c.toFixed(0)} / ${a.toFixed(0)} left`:null;n[r]=_e({usedPercent:l,windowSeconds:null,resetAt:t,valueLabel:u})};return i("chat",s.chat),i("completions",s.completions),i("premium",s.premium_interactions),n},hb=async()=>{let e=lt(),s=Ie(Pe(e,["github-copilot","copilot"])),t=s?.access??s?.token;if(!t)return W({providerId:"github-copilot",providerName:"GitHub Copilot",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://api.github.com/copilot_internal/user",{method:"GET",headers:{Authorization:`token ${t}`,Accept:"application/json","Editor-Version":"vscode/1.96.2","X-Github-Api-Version":"2025-04-01"}});if(!n.ok)return W({providerId:"github-copilot",providerName:"GitHub Copilot",ok:!1,configured:!0,error:`API error: ${n.status}`});let i=await n.json();return W({providerId:"github-copilot",providerName:"GitHub Copilot",ok:!0,configured:!0,usage:{windows:td(i)}})}catch(n){return W({providerId:"github-copilot",providerName:"GitHub Copilot",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},mb=async()=>{let e=lt(),s=Ie(Pe(e,["github-copilot","copilot"])),t=s?.access??s?.token;if(!t)return W({providerId:"github-copilot-addon",providerName:"GitHub Copilot Add-on",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://api.github.com/copilot_internal/user",{method:"GET",headers:{Authorization:`token ${t}`,Accept:"application/json","Editor-Version":"vscode/1.96.2","X-Github-Api-Version":"2025-04-01"}});if(!n.ok)return W({providerId:"github-copilot-addon",providerName:"GitHub Copilot Add-on",ok:!1,configured:!0,error:`API error: ${n.status}`});let i=await n.json(),r=td(i),o=r.premium?{premium:r.premium}:r;return W({providerId:"github-copilot-addon",providerName:"GitHub Copilot Add-on",ok:!0,configured:!0,usage:{windows:o}})}catch(n){return W({providerId:"github-copilot-addon",providerName:"GitHub Copilot Add-on",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},yb=async()=>{let e=lt(),s=Ie(Pe(e,["kimi-for-coding","kimi"])),t=s?.key??s?.token;if(!t)return W({providerId:"kimi-for-coding",providerName:"Kimi for Coding",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://api.kimi.com/coding/v1/usages",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)return W({providerId:"kimi-for-coding",providerName:"Kimi for Coding",ok:!1,configured:!0,error:`API error: ${n.status}`});let i=await n.json(),r={},o=i.usage;if(o){let c=pe(o.limit),l=pe(o.remaining),u=c&&l!==null?Math.max(0,Math.min(100,100-l/c*100)):null;r.weekly=_e({usedPercent:u,windowSeconds:null,resetAt:ze(o.resetTime)})}let a=Array.isArray(i.limits)?i.limits:[];for(let c of a){let l=c?.window,u=c?.detail,d=ib(l?.duration,l?.timeUnit),h=ob(l?.duration,l?.timeUnit),f=h===5*60*60?`Rate Limit (${d})`:d,p=pe(u?.limit),g=pe(u?.remaining),y=p&&g!==null?Math.max(0,Math.min(100,100-g/p*100)):null;r[f]=_e({usedPercent:y,windowSeconds:h,resetAt:ze(u?.resetTime)})}return W({providerId:"kimi-for-coding",providerName:"Kimi for Coding",ok:!0,configured:!0,usage:{windows:r}})}catch(n){return W({providerId:"kimi-for-coding",providerName:"Kimi for Coding",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},wb=async()=>{let e=lt(),s=Ie(Pe(e,["openrouter"])),t=s?.key??s?.token;if(!t)return W({providerId:"openrouter",providerName:"OpenRouter",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://openrouter.ai/api/v1/credits",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)return W({providerId:"openrouter",providerName:"OpenRouter",ok:!1,configured:!0,error:`API error: ${n.status}`});let r=(await n.json()).data,o=pe(r?.total_credits),a=pe(r?.total_usage),c=o!==null&&a!==null?Math.max(0,o-a):null,l=o&&a!==null?Math.max(0,Math.min(100,a/o*100)):null,u=c!==null?`$${Zu(c)} remaining`:null;return W({providerId:"openrouter",providerName:"OpenRouter",ok:!0,configured:!0,usage:{windows:{credits:_e({usedPercent:l,windowSeconds:null,resetAt:null,valueLabel:u})}}})}catch(n){return W({providerId:"openrouter",providerName:"OpenRouter",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},bb=e=>typeof e!="number"?null:e<1e12?e*1e3:e,Sb=e=>{if(!e||typeof e.number!="number")return null;let s=tb[Number(e.unit)];return s?s*e.number:null},kb=e=>{if(!e)return"tokens";if(e%86400===0){let s=e/86400;return s===7?"weekly":`${s}d`}return e%3600===0?`${e/3600}h`:`${e}s`},vb=async()=>{let e=lt(),s=Ie(Pe(e,["zai-coding-plan","zai","z.ai"])),t=s?.key??s?.token;if(!t)return W({providerId:"zai-coding-plan",providerName:"z.ai",ok:!1,configured:!1,error:"Not configured"});try{let n=await fetch("https://api.z.ai/api/monitor/usage/quota/limit",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)return W({providerId:"zai-coding-plan",providerName:"z.ai",ok:!1,configured:!0,error:`API error: ${n.status}`});let i=await n.json(),o=(Array.isArray(i?.data?.limits)?i.data.limits:[]).find(h=>h?.type==="TOKENS_LIMIT"),a=Sb(o),c=kb(a),l=o?.nextResetTime?bb(o.nextResetTime):null,u=typeof o?.percentage=="number"?o.percentage:null,d={};return o&&(d[c]=_e({usedPercent:u,windowSeconds:a,resetAt:l})),W({providerId:"zai-coding-plan",providerName:"z.ai",ok:!0,configured:!0,usage:{windows:d}})}catch(n){return W({providerId:"zai-coding-plan",providerName:"z.ai",ok:!1,configured:!0,error:n instanceof Error?n.message:"Request failed"})}},sd=async e=>{switch(e){case"claude":return gb();case"codex":return ab();case"github-copilot":return hb();case"github-copilot-addon":return mb();case"google":return pb();case"kimi-for-coding":return yb();case"openrouter":return wb();case"zai-coding-plan":return vb();default:return W({providerId:e,providerName:e,ok:!1,configured:!1,error:"Unsupported provider"})}};var ut=q(require("vscode")),H=q(require("path")),ws=q(require("os")),ee=q(require("fs")),Rr=require("child_process"),ud=require("util"),It=null,Er=!1,Ko=(0,ud.promisify)(Rr.execFile),Eb=["gpgconf","/opt/homebrew/bin/gpgconf","/usr/local/bin/gpgconf"];async function Go(e){if(!e)return!1;try{let s=await ee.promises.stat(e);return typeof s.isSocket=="function"&&s.isSocket()}catch{return!1}}async function Ab(){let e=(process.env.SSH_AUTH_SOCK||"").trim();if(e)return e;if(process.platform==="win32")return;let s=H.join(ws.homedir(),".gnupg","S.gpg-agent.ssh");if(await Go(s))return s;let t=async i=>{for(let r of Eb)try{let{stdout:o}=await Ko(r,i);return String(o||"")}catch{continue}return""},n=(await t(["--list-dirs","agent-ssh-socket"])).trim();if(n&&await Go(n))return n;if(n){await t(["--launch","gpg-agent"]);let i=(await t(["--list-dirs","agent-ssh-socket"])).trim();if(i&&await Go(i))return i}}async function dd(){let e={...process.env,GIT_TERMINAL_PROMPT:"0"};if(!e.SSH_AUTH_SOCK||!e.SSH_AUTH_SOCK.trim()){let s=await Ab();s&&(e.SSH_AUTH_SOCK=s)}return e}async function Rb(){if(It&&Er)return It;try{let e=ut.extensions.getExtension("vscode.git");if(!e)return console.warn("[GitService] Git extension not found"),null;e.isActive||await e.activate();let s=e.exports;return s.enabled?(It=s.getAPI(1),Er=!0,s.onDidChangeEnablement(t=>{Er=t,t||(It=null)}),It):(console.warn("[GitService] Git extension is disabled"),null)}catch(e){return console.error("[GitService] Failed to initialize git extension:",e),null}}async function Cb(){return It&&Er?It:Rb()}async function Be(e){let s=await Cb();if(!s)return null;let t=fd(e),n=ut.Uri.file(t),i=s.getRepository(n);return i||(i=await s.openRepository(n),i)}function fd(e){let s=e;return s.startsWith("~")&&(s=H.join(ws.homedir(),s.slice(1))),s=s.replace(/\\/g,"/"),s}function Yo(e){if(typeof e!="string")return e;let s=e.trim();return s&&(s==="~"?ws.homedir():s.startsWith("~/")||s.startsWith("~\\")?H.join(ws.homedir(),s.slice(2)):s)}function dt(e){return e&&(e.startsWith("refs/heads/")?e.substring(11):e.startsWith("heads/")?e.substring(6):e.startsWith("refs/")?e.substring(5):e)}async function F(e,s){return new Promise(t=>{let n=fd(s),i=It?.git.path||"git";dd().then(r=>{let o=(0,Rr.spawn)(i,e,{cwd:n,env:r}),a="",c="";o.stdout?.on("data",l=>{a+=l.toString()}),o.stderr?.on("data",l=>{c+=l.toString()}),o.on("close",l=>{t({stdout:a,stderr:c,exitCode:l??0})}),o.on("error",l=>{t({stdout:"",stderr:l.message,exitCode:1})})}).catch(r=>{t({stdout:"",stderr:r instanceof Error?r.message:String(r),exitCode:1})})})}async function pd(e){let s=await F(["rev-parse","--is-inside-work-tree"],e);return s.exitCode===0&&s.stdout.trim()==="true"}async function gd(e){let s=await F(["rev-parse","--git-dir"],e),t=await F(["rev-parse","--git-common-dir"],e);if(s.exitCode!==0||t.exitCode!==0)return!1;let n=H.resolve(e,s.stdout.trim()),i=H.resolve(e,t.stdout.trim());return n!==i}function Ho(e){return{0:"M",1:"A",2:"D",3:"R",4:"C",5:"M",6:"D",7:"?",8:"!",9:"A",10:"R",11:"T",12:"U",13:"U",14:"U",15:"U",16:"U",17:"U",18:"U"}[e]||" "}async function hd(e){let s=await Be(e);if(!s)return Pb(e);let t=s.state,n=t.HEAD,i=[];for(let o of t.indexChanges){let a=ut.workspace.asRelativePath(o.uri,!1);i.push({path:a,index:Ho(o.status),working_dir:" "})}for(let o of t.workingTreeChanges){let a=ut.workspace.asRelativePath(o.uri,!1),c=i.find(l=>l.path===a);c?c.working_dir=Ho(o.status):i.push({path:a,index:" ",working_dir:Ho(o.status)})}let r=await md(e);return{current:n?.name||"",tracking:n?.upstream?`${n.upstream.remote}/${n.upstream.name}`:null,ahead:n?.ahead||0,behind:n?.behind||0,files:i,isClean:i.length===0,...r}}async function md(e){let s={},t=H.join(e,".git");try{let n=H.join(t,"MERGE_HEAD");if(await ee.promises.stat(n).then(()=>!0).catch(()=>!1)){let o=(await ee.promises.readFile(n,"utf8").catch(()=>"")).trim().slice(0,7);if(o){let a=await ee.promises.readFile(H.join(t,"MERGE_MSG"),"utf8").catch(()=>"");s.mergeInProgress={head:o,message:a.split(`
`)[0]||""}}}}catch{}try{let n=await ee.promises.stat(H.join(t,"rebase-merge")).then(()=>!0).catch(()=>!1),i=await ee.promises.stat(H.join(t,"rebase-apply")).then(()=>!0).catch(()=>!1);if(n||i){let r=n?"rebase-merge":"rebase-apply",o=await ee.promises.readFile(H.join(t,r,"head-name"),"utf8").catch(()=>""),a=await ee.promises.readFile(H.join(t,r,"onto"),"utf8").catch(()=>""),c=o.trim().replace("refs/heads/",""),l=a.trim().slice(0,7);(c||l)&&(s.rebaseInProgress={headName:c,onto:l})}}catch{}return s}async function Pb(e){let s=await F(["status","--porcelain=v1","-b","-uall"],e);if(s.exitCode!==0)return{current:"",tracking:null,ahead:0,behind:0,files:[],isClean:!0};let t=s.stdout.trim().split(`
`).filter(Boolean),n=[],i="",r=null,o=0,a=0;for(let l of t)if(l.startsWith("##")){let u=l.match(/^## (.+?)(?:\.\.\.(.+?))?(?:\s+\[(.+)\])?$/);if(u){i=u[1]||"",r=u[2]||null;let d=u[3]||"",h=d.match(/ahead (\d+)/),f=d.match(/behind (\d+)/);o=h?parseInt(h[1],10):0,a=f?parseInt(f[1],10):0}}else{let u=l[0]||" ",d=l[1]||" ",h=l.slice(3).trim();n.push({path:h,index:u,working_dir:d})}let c=await md(e);return{current:i,tracking:r,ahead:o,behind:a,files:n,isClean:n.length===0,...c}}async function yd(e){let s=await Be(e);if(!s)return Ib(e);let t=s.state,n=t.HEAD?.name||"",i={},r=[],o=await s.getBranches({remote:!1});for(let c of o)c.name&&(r.push(c.name),i[c.name]={current:c.name===n,name:c.name,commit:c.commit||"",label:c.name});let a=await s.getBranches({remote:!0});for(let c of a)if(c.name){let l=`remotes/${c.name}`;r.push(l),i[l]={current:!1,name:l,commit:c.commit||"",label:c.name}}if(t.HEAD?.name&&t.HEAD?.upstream){let c=i[t.HEAD.name];c&&(c.tracking=`${t.HEAD.upstream.remote}/${t.HEAD.upstream.name}`,c.ahead=t.HEAD.ahead,c.behind=t.HEAD.behind)}return{all:r,current:n,branches:i}}async function Ib(e){let s=await F(["branch","-a","-v","--format=%(refname:short)|%(objectname:short)|%(upstream:short)|%(HEAD)"],e);if(s.exitCode!==0)return{all:[],current:"",branches:{}};let t=s.stdout.trim().split(`
`).filter(Boolean),n={},i=[],r="";for(let o of t){let[a,c,l,u]=o.split("|");if(a){i.push(a);let d=u==="*";d&&(r=a),n[a]={current:d,name:a,commit:c||"",label:a.replace(/^remotes\//,""),tracking:l||void 0}}}return{all:i,current:r,branches:n}}async function wd(e,s){let t=await Be(e);if(t)try{return await t.checkout(s),{success:!0,branch:s}}catch(i){console.error("[GitService] Failed to checkout branch:",i)}return{success:(await F(["checkout",s],e)).exitCode===0,branch:s}}async function bd(e,s,t){let n=await Be(e);if(n)try{return await n.createBranch(s,!1,t),{success:!0,branch:s}}catch(o){console.error("[GitService] Failed to create branch:",o)}let i=["branch",s];return t&&i.push(t),{success:(await F(i,e)).exitCode===0,branch:s}}async function Sd(e,s,t=!1){let n=await Be(e);if(n)try{return await n.deleteBranch(s,t),{success:!0}}catch(o){console.error("[GitService] Failed to delete branch:",o)}return{success:(await F(["branch",t?"-D":"-d",s],e)).exitCode===0}}async function kd(e,s,t="origin"){return{success:(await F(["push",t,"--delete",s],e)).exitCode===0}}var _b=["brave","calm","clever","cosmic","crisp","curious","eager","gentle","glowing","happy","hidden","jolly","kind","lucky","mighty","misty","neon","nimble","playful","proud","quick","quiet","shiny","silent","stellar","sunny","swift","tidy","witty"],Tb=["cabin","cactus","canyon","circuit","comet","eagle","engine","falcon","forest","garden","harbor","island","knight","lagoon","meadow","moon","mountain","nebula","orchid","otter","panda","pixel","planet","river","rocket","sailor","squid","star","tiger","wizard","wolf"],nd=26,Zo=()=>{let e=process.env.XDG_DATA_HOME||H.join(ws.homedir(),".local","share");return H.join(e,"opencode")},rd=e=>e[Math.floor(Math.random()*e.length)],id=()=>`${rd(_b)}-${rd(Tb)}`,xb=e=>String(e||"").trim().replace(/^refs\/heads\//,"").replace(/^heads\//,"").replace(/\s+/g,"-").replace(/^\/+|\/+$/g,"").split("/").join("-").replace(/[^A-Za-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,"").slice(0,80),vd=e=>{let s=String(e||"").split(`
`).map(i=>i.trim()),t=[],n=null;for(let i of s){if(!i){n?.worktree&&t.push(n),n=null;continue}if(i.startsWith("worktree ")){n?.worktree&&t.push(n),n={worktree:i.substring(9).trim()};continue}if(n){if(i.startsWith("HEAD ")){n.head=i.substring(5).trim();continue}if(i.startsWith("branch ")){let r=i.substring(7).trim();n.branchRef=r,n.branch=dt(r)}}}return n?.worktree&&t.push(n),t},Wo=async e=>{let s=H.resolve(e),t=await ee.promises.realpath(s).catch(()=>s),n=H.normalize(t);return process.platform==="win32"?n.toLowerCase():n},Ed=async e=>{try{return await ee.promises.stat(e),!0}catch{return!1}},Ad=e=>String(e||"").trim()||"HEAD",Gt=e=>{let s=String(e||"").trim();if(!s)return null;if(s.startsWith("refs/remotes/")){let n=s.substring(13),i=n.indexOf("/");return i<=0||i===n.length-1?null:{remote:n.slice(0,i),branch:n.slice(i+1),remoteRef:n,fullRef:`refs/remotes/${n}`}}if(s.startsWith("remotes/"))return Gt(`refs/${s}`);let t=s.indexOf("/");return t<=0||t===s.length-1?null:{remote:s.slice(0,t),branch:s.slice(t+1),remoteRef:s,fullRef:`refs/remotes/${s}`}},Ob=(e,s)=>{let t=String(e||"").trim(),n=String(s||"").trim();return!t||!n?null:{remote:t,branch:n,full:`${t}/${n}`}},Le=async(e,s)=>{let t=await F(s,e),n=[t.stderr,t.stdout].map(i=>String(i||"").trim()).filter(Boolean).join(`
`).trim();return{success:t.exitCode===0,exitCode:t.exitCode,stdout:String(t.stdout||""),stderr:String(t.stderr||""),message:n}},Ee=async(e,s,t)=>{let n=await Le(e,s);if(!n.success)throw new Error(n.message||t||"Git command failed");return n},Lb=async e=>{let s=H.join(e,".git"),t=H.join(s,"opencode"),n=await ee.promises.readFile(t,"utf8").then(a=>a.trim()).catch(()=>"");if(n)return n;let o=(await Ee(e,["rev-list","--max-parents=0","--all"],"Failed to resolve repository roots")).stdout.split(`
`).map(a=>a.trim()).filter(Boolean).sort((a,c)=>a.localeCompare(c))[0]||"";if(!o)throw new Error("Failed to derive OpenCode project ID");return await ee.promises.mkdir(s,{recursive:!0}).catch(()=>{}),await ee.promises.writeFile(t,o,"utf8").catch(()=>{}),o},Xo=async e=>{let s=Yo(e);if(!s)throw new Error("Directory is required");let t=await Ee(s,["rev-parse","--show-toplevel"],"Failed to resolve git top-level directory"),n=H.resolve(s,t.stdout.trim()),i=await Ee(n,["rev-parse","--git-common-dir"],"Failed to resolve git common directory"),r=H.resolve(n,i.stdout.trim()),o=H.dirname(r),a=await Lb(o),c=H.join(Zo(),"worktree",a);return{projectID:a,sandbox:n,primaryWorktree:o,worktreeRoot:c}},Rd=async e=>{let s=await Ee(e,["worktree","list","--porcelain"],"Failed to list git worktrees");return vd(s.stdout)},Nb=e=>{let s=xb(e||"");return s?Array.from({length:nd},(t,n)=>n===0?s:`${s}-${id()}`):Array.from({length:nd},()=>id())},Db=async(e,s,t,n)=>{let i=Nb(s);for(let r of i){let o=H.join(e,r);if(await Ed(o))continue;if(t)return{name:r,directory:o,branch:t};let a=`openchamber/${r}`,c=`refs/heads/${a}`;if(!(await Le(n,["show-ref","--verify","--quiet",c])).success)return{name:r,directory:o,branch:a}}throw new Error("Failed to generate a unique worktree name")},Ar=async(e,s,t)=>{let n=String(s||"").trim(),i=String(t||"").trim();if(!n||!i)return;let r=`+refs/heads/${i}:refs/remotes/${n}/${i}`;await Ee(e,["fetch",n,r],`Failed to fetch ${n}/${i}`)},Cd=async(e,s,t)=>{let n=String(s||"").trim();if(!n)throw new Error("existingBranch is required in existing mode");let i=dt(n),r=`refs/heads/${i}`;if((await Le(e,["show-ref","--verify","--quiet",r])).success)return{localBranch:i,checkoutRef:i,createLocalBranch:!1,remoteRef:null};let a=Gt(n);if(!a)throw new Error(`Branch not found: ${n}`);if(!(await Le(e,["show-ref","--verify","--quiet",a.fullRef])).success&&(await Ar(e,a.remote,a.branch).catch(()=>{}),!(await Le(e,["show-ref","--verify","--quiet",a.fullRef])).success))throw new Error(`Remote branch not found: ${n}`);let l=dt(t||a.branch||n);if(!l)throw new Error("Failed to resolve local branch name for existing branch worktree");return{localBranch:l,checkoutRef:a.remoteRef,createLocalBranch:!0,remoteRef:a}},zo=async(e,s)=>{if(!s)return null;let t=await Rd(e),n=`refs/heads/${s}`,i=dt(n);return t.find(r=>{let o=String(r.branchRef||"").trim(),a=dt(o||r.branch||"");return o===n||a===i})||null},od=async(e,s)=>{let t=String(s||"").trim();if(!t)return{success:!0};let n=await dd();if(process.platform==="win32")try{let{stdout:i,stderr:r}=await Ko("cmd",["/c",t],{cwd:e,env:n,maxBuffer:20971520});return{success:!0,stdout:String(i||""),stderr:String(r||"")}}catch(i){let r=i;return{success:!1,stdout:r.stdout,stderr:r.stderr,message:String(r.message||r.stderr||r.stdout||"Failed to run start command").trim()}}try{let{stdout:i,stderr:r}=await Ko("bash",["-lc",t],{cwd:e,env:n,maxBuffer:20971520});return{success:!0,stdout:String(i||""),stderr:String(r||"")}}catch(i){let r=i;return{success:!1,stdout:r.stdout,stderr:r.stderr,message:String(r.message||r.stderr||r.stdout||"Failed to run start command").trim()}}},Mb=async e=>{let s=H.join(Zo(),"storage","project",`${e}.json`);try{let t=await ee.promises.readFile(s,"utf8"),n=JSON.parse(t);return(typeof n?.commands?.start=="string"?n.commands.start.trim():"")||""}catch{return""}},$b=e=>H.join(Zo(),"storage","project",`${e}.json`),Pd=async(e,s,t)=>{let n=$b(e);await ee.promises.mkdir(H.dirname(n),{recursive:!0});let i=Date.now(),r={id:e,worktree:s,vcs:"git",sandboxes:[],time:{created:i,updated:i}},o=await ee.promises.readFile(n,"utf8").then(l=>JSON.parse(l)).catch(()=>null),a=o&&typeof o=="object"?{...r,...o}:r;a.id=String(a.id||e),a.worktree=String(a.worktree||s),a.vcs=a.vcs||"git",a.sandboxes=Array.isArray(a.sandboxes)?a.sandboxes.map(l=>String(l||"").trim()).filter(Boolean):[];let c=Number(a?.time?.created);a.time={created:Number.isFinite(c)&&c>0?c:i,updated:i},t(a),a.sandboxes=[...new Set(a.sandboxes.map(l=>String(l||"").trim()).filter(Boolean))],await ee.promises.writeFile(n,`${JSON.stringify(a,null,2)}
`,"utf8")},jb=async(e,s,t)=>{let n=String(t||"").trim();n&&await Pd(e,s,i=>{i.sandboxes.includes(n)||i.sandboxes.push(n)})},ad=async(e,s,t)=>{let n=String(t||"").trim();n&&await Pd(e,s,i=>{i.sandboxes=i.sandboxes.filter(r=>r!==n)})},Fb=(e,s,t)=>{setTimeout(()=>{(async()=>{let i=await Mb(s);if(i){let a=await od(e,i);if(!a.success){console.warn("[GitService] Worktree project start command failed:",a.message||a.stderr||a.stdout);return}}let r=String(t||"").trim();if(!r)return;let o=await od(e,r);o.success||console.warn("[GitService] Worktree start command failed:",o.message||o.stderr||o.stdout)})().catch(i=>{console.warn("[GitService] Worktree start script task failed:",i instanceof Error?i.message:String(i))})},0)},Vo=async(e,s,t)=>{let n=String(s||"").trim(),i=String(t||"").trim();if(!n||!i)return;let r=await Le(e,["remote","get-url",n]);if(r.success){String(r.stdout||"").trim()!==i&&await Ee(e,["remote","set-url",n,i],"Failed to update git remote URL");return}await Ee(e,["remote","add",n,i],"Failed to add git remote")},cd=async(e,s,t,n="")=>{let i=String(s||"").trim(),r=String(t||"").trim(),o=String(n||"").trim();if(!i||!r)return{success:!1,found:!1};let c=await Le(e,["ls-remote","--heads",o||i,`refs/heads/${r}`]);return c.success?{success:!0,found:!!String(c.stdout||"").trim()}:{success:!1,found:!1}},Bb=async(e,s,t)=>{await Ee(e,["config",`branch.${s}.remote`,t.remote],`Failed to set branch.${s}.remote`),await Ee(e,["config",`branch.${s}.merge`,`refs/heads/${t.branch}`],`Failed to set branch.${s}.merge`)},Ub=async e=>{let{primaryWorktree:s,worktreeDirectory:t,localBranch:n,setUpstream:i,upstreamRemote:r,upstreamBranch:o,ensureRemoteName:a,ensureRemoteUrl:c}=e;if(!i)return;a&&c&&await Vo(s,a,c);let l=Ob(r,o);if(!l||!n)return;let u=!0;try{await Ar(s,l.remote,l.branch)}catch{u=!1}if(u){await Ee(t,["branch",`--set-upstream-to=${l.full}`,n],`Failed to set upstream to ${l.full}`);return}await Bb(t,n,l)};async function Id(e){let s=Yo(e);if(!s||!ee.existsSync(s)||!ee.existsSync(H.join(s,".git")))return[];try{let t=await Ee(s,["worktree","list","--porcelain"],"Failed to list git worktrees");return vd(t.stdout).map(n=>({head:n.head||"",name:H.basename(n.worktree||""),branch:n.branch||"",path:n.worktree}))}catch(t){return console.warn("[GitService] Failed to list worktrees, returning empty list:",t instanceof Error?t.message:String(t)),[]}}async function _d(e,s={}){let t=s?.mode==="existing"?"existing":"new",n=[];try{let i=await Xo(e),r=dt(String(s?.branchName||"").trim()),o=Ad(s?.startRef),a=String(s?.ensureRemoteName||"").trim(),c=String(s?.ensureRemoteUrl||"").trim(),l="",u=null;if(t==="existing")try{let h=String(s?.existingBranch||"").trim(),f=Gt(h);if(f&&a&&c&&a===f.remote){let p=await Le(i.primaryWorktree,["ls-remote","--heads",c,`refs/heads/${f.branch}`]);if(!p.success)throw new Error(`Unable to query remote ${a}`);if(!String(p.stdout||"").trim())throw new Error(`Remote branch not found: ${f.remoteRef}`);l=dt(r||f.branch),u={remote:f.remote,branch:f.branch}}else{let p=await Cd(i.primaryWorktree,h,r);l=p.localBranch||"",p.remoteRef&&(u={remote:p.remoteRef.remote,branch:p.remoteRef.branch})}}catch(h){n.push({code:"branch_not_found",message:h instanceof Error?h.message:"Existing branch not found"})}else{r&&((await Le(i.primaryWorktree,["show-ref","--verify","--quiet",`refs/heads/${r}`])).success&&n.push({code:"branch_exists",message:`Branch already exists: ${r}`}),l=r);let h=Gt(o);if(o&&o!=="HEAD")if(h&&a&&c&&a===h.remote){let f=await cd(i.primaryWorktree,h.remote,h.branch,c);f.success?f.found||n.push({code:"start_ref_not_found",message:`Remote branch not found: ${h.remoteRef}`}):n.push({code:"remote_unreachable",message:`Unable to query remote ${a}`})}else if(h){let f=await cd(i.primaryWorktree,h.remote,h.branch);f.success?f.found||n.push({code:"start_ref_not_found",message:`Remote branch not found: ${h.remoteRef}`}):n.push({code:"remote_unreachable",message:`Unable to query remote ${h.remote}`})}else(await Le(i.primaryWorktree,["rev-parse","--verify","--quiet",o])).success||n.push({code:"start_ref_not_found",message:`Start ref not found: ${o}`});h&&(u={remote:h.remote,branch:h.branch})}if(l){let h=await zo(i.primaryWorktree,l);h&&n.push({code:"branch_in_use",message:`Branch is already checked out in ${h.worktree}`})}if((a&&!c||!a&&c)&&n.push({code:"invalid_remote_config",message:"Both ensureRemoteName and ensureRemoteUrl are required together"}),!!s?.setUpstream){let h=String(s?.upstreamRemote||u?.remote||"").trim(),f=String(s?.upstreamBranch||u?.branch||"").trim();!h||!f?n.push({code:"upstream_incomplete",message:"upstreamRemote and upstreamBranch are required when setUpstream is true"}):!(await Le(i.primaryWorktree,["remote","get-url",h])).success&&(!a||a!==h)&&n.push({code:"remote_not_found",message:`Remote not found: ${h}`})}return{ok:n.length===0,errors:n,resolved:{mode:t,localBranch:l||null}}}catch(i){return{ok:!1,errors:[{code:"validation_failed",message:i instanceof Error?i.message:"Failed to validate worktree creation"}]}}}async function Td(e,s={}){let t=s?.mode==="existing"?"existing":"new",n=await Xo(e);await ee.promises.mkdir(n.worktreeRoot,{recursive:!0});let i=String(s?.worktreeName||s?.name||"").trim(),r=dt(String(s?.branchName||"").trim()),o=Ad(s?.startRef),a=String(s?.ensureRemoteName||"").trim(),c=String(s?.ensureRemoteUrl||"").trim(),l=await Db(n.worktreeRoot,i,t==="new"&&r?r:"",n.primaryWorktree),u="",d=null,h=["worktree","add","--no-checkout"];if(t==="existing"){let S=String(s?.existingBranch||"").trim(),m=Gt(S);m&&a&&c&&m.remote===a&&(await Vo(n.primaryWorktree,a,c),await Ar(n.primaryWorktree,m.remote,m.branch));let b=await Cd(n.primaryWorktree,S,r);u=b.localBranch;let k=await zo(n.primaryWorktree,u);if(k)throw new Error(`Branch is already checked out in ${k.worktree}`);b.createLocalBranch&&h.push("-b",u),h.push(l.directory,b.checkoutRef),b.remoteRef&&(d={remote:b.remoteRef.remote,branch:b.remoteRef.branch})}else{if(u=l.branch,!u)throw new Error("Failed to resolve branch name for new worktree");if((await Le(n.primaryWorktree,["show-ref","--verify","--quiet",`refs/heads/${u}`])).success)throw new Error(`Branch already exists: ${u}`);let m=await zo(n.primaryWorktree,u);if(m)throw new Error(`Branch is already checked out in ${m.worktree}`);h.push("-b",u,l.directory),o&&o!=="HEAD"&&h.push(o);let b=Gt(o);b&&(d={remote:b.remote,branch:b.branch})}if(a&&c&&await Vo(n.primaryWorktree,a,c),t==="new"){let S=Gt(o);S&&await Ar(n.primaryWorktree,S.remote,S.branch)}await Ee(n.primaryWorktree,h,"Failed to create git worktree"),await Ee(l.directory,["reset","--hard"],"Failed to populate worktree");try{await jb(n.projectID,n.primaryWorktree,l.directory)}catch(S){console.warn("[GitService] Failed to sync OpenCode sandbox metadata (add):",S instanceof Error?S.message:String(S))}let f=!!s?.setUpstream,p=String(s?.upstreamRemote||d?.remote||"").trim(),g=String(s?.upstreamBranch||d?.branch||"").trim();f&&await Ub({primaryWorktree:n.primaryWorktree,worktreeDirectory:l.directory,localBranch:u,setUpstream:f,upstreamRemote:p,upstreamBranch:g,ensureRemoteName:a,ensureRemoteUrl:c}),Fb(l.directory,n.projectID,s?.startCommand);let y=await Le(l.directory,["rev-parse","HEAD"]);return{head:String(y.stdout||"").trim(),name:l.name,branch:u,path:l.directory}}async function xd(e,s){let t=Yo(s?.directory);if(!t)throw new Error("Worktree directory is required");let n=await Xo(e),i=s?.deleteLocalBranch===!0,r=await Wo(t),o=await Wo(n.primaryWorktree);if(r===o)throw new Error("Cannot remove the primary workspace");let a=await Rd(n.primaryWorktree),c=await(async()=>{for(let l of a){if(!l?.worktree)continue;if(await Wo(l.worktree)===r)return l}return null})();if(!c?.worktree){await Ed(t)&&await ee.promises.rm(t,{recursive:!0,force:!0});try{await ad(n.projectID,n.primaryWorktree,t)}catch(u){console.warn("[GitService] Failed to sync OpenCode sandbox metadata (remove):",u instanceof Error?u.message:String(u))}return!0}if(await Ee(n.primaryWorktree,["worktree","remove","--force",c.worktree],"Failed to remove git worktree"),i){let l=dt(String(c.branchRef||c.branch||"").trim());l&&await Ee(n.primaryWorktree,["branch","-D",l],`Failed to delete local branch ${l}`)}try{await ad(n.projectID,n.primaryWorktree,c.worktree)}catch(l){console.warn("[GitService] Failed to sync OpenCode sandbox metadata (remove):",l instanceof Error?l.message:String(l))}return!0}async function Od(e,s,t=!1,n){let i=["diff"];return t&&i.push("--cached"),typeof n=="number"&&i.push(`-U${n}`),i.push("--",s),{diff:(await F(i,e)).stdout}}async function Ld(e,s,t,n,i=3){let r=(s||"").trim(),o=(t||"").trim();if(!r||!o)return{diff:""};let a=r;try{(await F(["rev-parse","--verify",`refs/remotes/origin/${r}`],e)).exitCode===0&&(a=`origin/${r}`)}catch{}let c=["diff","--no-color",`-U${Math.max(0,i)}`,`${a}...${o}`,"--",n];return{diff:(await F(c,e)).stdout}}async function Nd(e,s,t){let n=(s||"").trim(),i=(t||"").trim();if(!n||!i)return[];let r=n;try{(await F(["rev-parse","--verify",`refs/remotes/origin/${n}`],e)).exitCode===0&&(r=`origin/${n}`)}catch{}let o=["diff","--name-only",`${r}...${i}`],a=await F(o,e);return a.exitCode!==0?[]:String(a.stdout||"").split(`
`).map(c=>c.trim()).filter(Boolean)}async function Dd(e,s,t=!1){let n=await Be(e);if(n)try{let i;if(t)i=await n.show("HEAD",s);else try{i=await n.show(":0:"+s,s)}catch{i=await n.show("HEAD",s)}let r=ut.Uri.file(H.join(e,s)),o=await ut.workspace.fs.readFile(r),a=Buffer.from(o).toString("utf8");return{original:i,modified:a,path:s}}catch(i){console.error("[GitService] Failed to get file diff:",i)}return{original:"",modified:"",path:s}}async function Md(e,s){let t=await Be(e);if(t)try{await t.revert([s]);return}catch(n){console.error("[GitService] Failed to revert via API:",n)}await F(["checkout","--",s],e)}async function $d(e,s,t){let n=await Be(e);if(n)try{t?.addAll?await n.add(["."]):t?.files?.length&&await n.add(t.files),await n.commit(s);let a=n.state.HEAD;return{success:!0,commit:a?.commit||"",branch:a?.name||"",summary:{changes:0,insertions:0,deletions:0}}}catch(a){console.error("[GitService] Failed to commit:",a)}if(t?.addAll?await F(["add","-A"],e):t?.files?.length&&await F(["add",...t.files],e),(await F(["commit","-m",s],e)).exitCode!==0)return{success:!1,commit:"",branch:"",summary:{changes:0,insertions:0,deletions:0}};let r=await F(["rev-parse","HEAD"],e),o=await F(["rev-parse","--abbrev-ref","HEAD"],e);return{success:!0,commit:r.stdout.trim(),branch:o.stdout.trim(),summary:{changes:0,insertions:0,deletions:0}}}function Jo(e){if(!e)return[];if(Array.isArray(e))return e;let s=[];for(let[t,n]of Object.entries(e))n===null||n===!0?s.push(t):n!==!1&&n!==void 0&&s.push(t,String(n));return s}function ld(e,s){return e?Array.isArray(e)?e.includes(s):s in e&&e[s]!==!1:!1}async function jd(e,s){let t=s?.remote?.trim(),n=s?.branch,i=s?.options,r=p=>String(p?.message||p?.stderr||p?.stdout||"").trim()||"Failed to push to remote",o=p=>{let g=Jo(p);return ld(g,"--set-upstream")||ld(g,"-u")?g:[...g,"--set-upstream"]},a=p=>{let g=String(p?.message||p?.stderr||"").toLowerCase();return g.includes("has no upstream")||g.includes("no upstream")||g.includes("set-upstream")||g.includes("set upstream")||g.includes("upstream")&&g.includes("push")&&g.includes("-u")},c=async()=>{let p=await F(["rev-parse","--abbrev-ref","HEAD"],e);return String(p.stdout||"").trim()},l=async()=>{let p=await F(["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],e);return p.exitCode===0&&!!String(p.stdout||"").trim()},u=async()=>{let p=await F(["remote"],e);return p.exitCode!==0?[]:String(p.stdout||"").split(`
`).map(g=>g.trim()).filter(Boolean)},d=async p=>{let g=await F(p,e);if(g.exitCode!==0)throw new Error(r(g))},h=(p,g)=>({success:!0,pushed:[{local:p,remote:g}],repo:e,ref:null});if(!t&&!n)try{let p=["push"],g=Jo(i);return g.length>0&&p.push(...g),await d(p),{success:!0,pushed:[],repo:e,ref:null}}catch(p){if(!a(p))throw new Error(r(p));let g=await c(),y=await u(),w=y.includes("origin")?"origin":y[0];if(!g||!w)throw new Error(r(p));let S=["push",...o(i),w,g];return await d(S),h(g,w)}let f=t||"origin";if(!n)try{let p=await c(),g=await l();if(p&&!g){let y=["push",...o(i),f,p];return await d(y),h(p,f)}}catch(p){console.warn("[GitService] Failed to determine upstream state before push:",p)}try{let p=["push",...Jo(i),f];return n&&p.push(n),await d(p),h(n||"",f)}catch(p){if(!a(p))throw new Error(r(p));let g=n||await c();if(!g)throw new Error(r(p));let y=["push",...o(i),f,g];return await d(y),h(g,f)}}async function Fd(e,s){let t=await Be(e);if(t)try{return await t.pull(),{success:!0,summary:{changes:0,insertions:0,deletions:0},files:[],insertions:0,deletions:0}}catch(r){console.error("[GitService] Failed to pull:",r)}let n=["pull"];return s?.remote&&n.push(s.remote),s?.branch&&n.push(s.branch),{success:(await F(n,e)).exitCode===0,summary:{changes:0,insertions:0,deletions:0},files:[],insertions:0,deletions:0}}async function Bd(e,s){let t=await Be(e);if(t)try{return await t.fetch({remote:s?.remote,ref:s?.branch}),{success:!0}}catch(r){console.error("[GitService] Failed to fetch:",r)}let n=["fetch"];return s?.remote&&n.push(s.remote),s?.branch&&n.push(s.branch),{success:(await F(n,e)).exitCode===0}}async function Ud(e,s){let n=["log",`--max-count=${s?.maxCount||50}`,"--format=%H|%aI|%s|%D|%b|%an|%ae","--shortstat"];s?.from&&s?.to&&n.push(`${s.from}..${s.to}`),s?.file&&n.push("--",s.file);let i=await F(n,e);if(i.exitCode!==0)return{all:[],latest:null,total:0};let r=[],o=i.stdout.split(`
`),a=null;for(let c of o)if(c.includes("|")&&!c.startsWith(" ")){a?.hash&&r.push(a);let l=c.split("|");a={hash:l[0]||"",date:l[1]||"",message:l[2]||"",refs:l[3]||"",body:l[4]||"",author_name:l[5]||"",author_email:l[6]||"",filesChanged:0,insertions:0,deletions:0}}else if(a&&c.includes("file")){let l=c.match(/(\d+)\s+files?\s+changed(?:,\s+(\d+)\s+insertions?)?(?:,\s+(\d+)\s+deletions?)?/);l&&(a.filesChanged=parseInt(l[1]||"0",10),a.insertions=parseInt(l[2]||"0",10),a.deletions=parseInt(l[3]||"0",10))}return a?.hash&&r.push(a),{all:r,latest:r[0]||null,total:r.length}}async function qd(e,s){let t=await F(["show","--numstat","--format=",s],e);if(t.exitCode!==0)return{files:[]};let n=[];for(let i of t.stdout.trim().split(`
`).filter(Boolean)){let r=i.split("	");if(r.length>=3){let o=r[0]==="-"&&r[1]==="-";n.push({path:r[2]||"",insertions:o?0:parseInt(r[0]||"0",10),deletions:o?0:parseInt(r[1]||"0",10),isBinary:o,changeType:"M"})}}return{files:n}}async function Gd(e){let s=await Be(e);if(s)try{let r=await s.getConfig("user.name").catch(()=>""),o=await s.getConfig("user.email").catch(()=>""),a=await s.getConfig("core.sshCommand").catch(()=>"");return{userName:r||null,userEmail:o||null,sshCommand:a||null}}catch(r){console.error("[GitService] Failed to get identity:",r)}let t=await F(["config","user.name"],e),n=await F(["config","user.email"],e),i=await F(["config","core.sshCommand"],e);return{userName:t.exitCode===0?t.stdout.trim():null,userEmail:n.exitCode===0?n.stdout.trim():null,sshCommand:i.exitCode===0?i.stdout.trim():null}}function qb(e){if(/[`$\\!"';&|<>(){}[\]*?#~]/.test(e))throw new Error(`SSH key path contains invalid characters: ${e}`);if(process.platform==="win32"){let n=e.replace(/\\/g,"/"),i=n.match(/^([A-Za-z]):\//);return i&&(n=`/${i[1].toLowerCase()}${n.slice(2)}`),`'${n}'`}else return`'${e.replace(/'/g,"'\\''")}'`}function Gb(e){return`ssh -i ${qb(e)} -o IdentitiesOnly=yes`}async function Hd(e,s,t,n){let i=await Be(e),r=n?Gb(n):null;if(i)try{return await i.setConfig("user.name",s),await i.setConfig("user.email",t),r&&await i.setConfig("core.sshCommand",r),{success:!0}}catch(o){console.error("[GitService] Failed to set identity:",o)}return await F(["config","user.name",s],e),await F(["config","user.email",t],e),r&&await F(["config","core.sshCommand",r],e),{success:!0}}async function Wd(e){let s=await F(["remote","-v"],e);if(s.exitCode!==0)return[];let t=new Map,n=s.stdout.split(`
`).filter(Boolean);for(let i of n){let r=i.match(/^(\S+)\s+(\S+)\s+\((fetch|push)\)$/);if(r){let[,o,a,c]=r;t.has(o)||t.set(o,{name:o,fetchUrl:"",pushUrl:""});let l=t.get(o);c==="fetch"?l.fetchUrl=a:l.pushUrl=a}}return Array.from(t.values())}async function Jd(e,s){let t=await F(["rebase",s.onto],e);if(t.exitCode===0)return{success:!0,conflict:!1};let n=(t.stdout+t.stderr).toLowerCase();if(n.includes("conflict")||n.includes("could not apply")||n.includes("merge conflict"))return{success:!1,conflict:!0,conflictFiles:(await F(["status","--porcelain"],e)).stdout.split(`
`).filter(a=>a.startsWith("UU")||a.startsWith("AA")||a.startsWith("DD")).map(a=>a.slice(3).trim())};throw new Error(t.stderr||"Rebase failed")}async function Kd(e){return{success:(await F(["rebase","--abort"],e)).exitCode===0}}async function zd(e,s){let t=await F(["merge",s.branch],e);if(t.exitCode===0)return{success:!0,conflict:!1};let n=(t.stdout+t.stderr).toLowerCase();if(n.includes("conflict")||n.includes("merge conflict")||n.includes("automatic merge failed"))return{success:!1,conflict:!0,conflictFiles:(await F(["status","--porcelain"],e)).stdout.split(`
`).filter(a=>a.startsWith("UU")||a.startsWith("AA")||a.startsWith("DD")).map(a=>a.slice(3).trim())};throw new Error(t.stderr||"Merge failed")}async function Vd(e){return{success:(await F(["merge","--abort"],e)).exitCode===0}}async function Yd(e){let s=await F(["rebase","--continue"],e);if(s.exitCode===0)return{success:!0,conflict:!1};let t=(s.stdout+s.stderr).toLowerCase();if(t.includes("conflict")||t.includes("needs merge")||t.includes("unmerged"))return{success:!1,conflict:!0,conflictFiles:(await F(["status","--porcelain"],e)).stdout.split(`
`).filter(o=>o.startsWith("UU")||o.startsWith("AA")||o.startsWith("DD")).map(o=>o.slice(3).trim())};throw new Error(s.stderr||"Continue rebase failed")}async function Zd(e){let s=await F(["commit","--no-edit"],e);if(s.exitCode===0)return{success:!0,conflict:!1};let t=(s.stdout+s.stderr).toLowerCase();if(t.includes("conflict")||t.includes("needs merge")||t.includes("unmerged"))return{success:!1,conflict:!0,conflictFiles:(await F(["status","--porcelain"],e)).stdout.split(`
`).filter(o=>o.startsWith("UU")||o.startsWith("AA")||o.startsWith("DD")).map(o=>o.slice(3).trim())};throw new Error(s.stderr||"Continue merge failed")}async function Xd(e,s){let t=["stash","push"];return s?.includeUntracked!==!1&&t.push("--include-untracked"),s?.message&&t.push("-m",s.message),{success:(await F(t,e)).exitCode===0}}async function Qd(e){return{success:(await F(["stash","pop"],e)).exitCode===0}}var ge=q(require("fs")),gn=q(require("os")),ce=q(require("path")),Ff=require("child_process"),Bf=require("util"),Uf=q(Ro()),uS=q(Lf());var dS=(0,Bf.promisify)(Ff.execFile),fS=6e4,pS=4*1024*1024,gS=/^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$/,hS=[{id:"anthropic",label:"Anthropic",description:"Anthropic's public skills repository",source:"anthropics/skills",defaultSubpath:"skills"},{id:"clawdhub",label:"ClawdHub",description:"Community skill registry with vector search",source:"clawdhub:registry"}],Nf="https://clawdhub.com/api/v1",Df=25,Mf=100,$f=0;function mS(e){return typeof e=="string"&&e.startsWith("clawdhub:")}async function yS(e,s){let n=null;for(let i=0;i<10;i++){let o=Date.now()-$f;o<Mf&&await new Promise(c=>setTimeout(c,Mf-o)),$f=Date.now();let a=await fetch(e,{...s,headers:{Accept:"application/json","User-Agent":"OpenChamber-VSCode/1.0",...s?.headers}});if(n=a,(a.status===429||a.status>=500)&&i<9){let c=50*(i+1);await new Promise(l=>setTimeout(l,c));continue}return a}return n}async function wS(){try{let e=[],s=null,t=20;for(let n=0;n<t;n++){let i=s?`${Nf}/skills?cursor=${encodeURIComponent(s)}&limit=${Df}`:`${Nf}/skills?limit=${Df}`,r;try{let o=await yS(i);if(!o.ok)throw new Error(`ClawdHub API error: ${o.status}`);r=await o.json()}catch(o){if(n>0&&e.length>0)break;throw o}for(let o of r.items||[]){let a=o.tags?.latest||o.latestVersion?.version||"1.0.0";e.push({repoSource:"clawdhub:registry",skillDir:o.slug,skillName:o.slug,frontmatterName:o.displayName||o.slug,description:o.summary||void 0,installable:!0,clawdhub:{slug:o.slug,version:a,displayName:o.displayName,owner:o.owner?.handle,downloads:o.stats?.downloads||0,stars:o.stats?.stars||0}})}if(!r.nextCursor)break;s=r.nextCursor}return e.sort((n,i)=>(i.clawdhub?.downloads||0)-(n.clawdhub?.downloads||0)),{ok:!0,items:e}}catch(e){return{ok:!1,error:{kind:"networkError",message:e instanceof Error?e.message:"Failed to fetch skills from ClawdHub"}}}}function qf(e){return e.length<1||e.length>64?!1:gS.test(e)}function bS(e){return/permission denied/i.test(e)||/publickey/i.test(e)||/could not read from remote repository/i.test(e)||/authentication failed/i.test(e)}async function Ue(e,s){try{let{stdout:t,stderr:n}=await dS("git",e,{cwd:s?.cwd,timeout:s?.timeoutMs??fS,maxBuffer:pS,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}});return{ok:!0,stdout:t||"",stderr:n||""}}catch(t){let n=t;return{ok:!1,stdout:typeof n.stdout=="string"?n.stdout:"",stderr:typeof n.stderr=="string"?n.stderr:"",message:typeof n.message=="string"?n.message:"Git command failed"}}}async function Gf(){return(await Ue(["--version"],{timeoutMs:5e3})).ok?{ok:!0}:{ok:!1,error:{kind:"gitUnavailable",message:"Git is not available in PATH"}}}function ra(e,s){let t=(e||"").trim();if(!t)return{ok:!1,error:{kind:"invalidSource",message:"Repository source is required"}};let n=s?.trim()?s.trim():null,i=t.match(/^git@github\.com:([^/\s]+)\/([^\s#]+)$/i);if(i){let a=i[1],c=i[2].replace(/\.git$/i,"");return{ok:!0,normalizedRepo:`${a}/${c}`,cloneUrlHttps:`https://github.com/${a}/${c}.git`,cloneUrlSsh:`git@github.com:${a}/${c}.git`,effectiveSubpath:n}}let r=t.match(/^https?:\/\/github\.com\/([^/\s]+)\/([^\s#]+)$/i);if(r){let a=r[1],c=r[2].replace(/\.git$/i,"");return{ok:!0,normalizedRepo:`${a}/${c}`,cloneUrlHttps:`https://github.com/${a}/${c}.git`,cloneUrlSsh:`git@github.com:${a}/${c}.git`,effectiveSubpath:n}}let o=t.match(/^([^/\s]+)\/([^/\s]+)(?:\/(.+))?$/);if(o){let a=o[1],c=o[2].replace(/\.git$/i,""),l=o[3]?.trim()||null;return{ok:!0,normalizedRepo:`${a}/${c}`,cloneUrlHttps:`https://github.com/${a}/${c}.git`,cloneUrlSsh:`git@github.com:${a}/${c}.git`,effectiveSubpath:n||l}}return{ok:!1,error:{kind:"invalidSource",message:"Unsupported repository source format"}}}function SS(e){let s=e.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n([\s\S]*)$/);if(!s)return{frontmatter:{},warnings:["Invalid SKILL.md: missing YAML frontmatter delimiter"]};try{let t=Uf.default.parse(s[1]);return{frontmatter:t&&typeof t=="object"?t:{},warnings:[]}}catch{return{frontmatter:{},warnings:["Invalid SKILL.md: failed to parse YAML frontmatter"]}}}async function Tr(e){try{await ge.default.promises.rm(e,{recursive:!0,force:!0})}catch{}}async function Hf(e,s){let t=["clone","--depth","1","--filter=blob:none","--no-checkout",e,s],n=["clone","--depth","1","--no-checkout",e,s];if((await Ue(t,{timeoutMs:6e4})).ok)return{ok:!0};let r=await Ue(n,{timeoutMs:6e4});if(r.ok)return{ok:!0};let o=`${r.stderr}
${r.message}`.trim();return bS(o)?{ok:!1,error:{kind:"authRequired",message:"Private repositories are not supported in VS Code yet. Use Desktop/Web.",sshOnly:!0}}:{ok:!1,error:{kind:"networkError",message:o||"Failed to clone repository"}}}async function ia(e){let s=await Gf();if(!s.ok)return{ok:!1,error:s.error};let t=ra(e.source,e.subpath);if(!t.ok)return{ok:!1,error:t.error};let n=t.effectiveSubpath||e.defaultSubpath||null,i=await ge.default.promises.mkdtemp(ce.default.join(gn.default.tmpdir(),"openchamber-vscode-skills-scan-"));try{let r=await Hf(t.cloneUrlHttps,i);if(!r.ok)return{ok:!1,error:r.error};let o=h=>ce.default.join(i,...h.split("/").filter(Boolean)),a=n?[`${n}/SKILL.md`,`${n}/**/SKILL.md`]:["SKILL.md","**/SKILL.md"],c=null;if((await Ue(["-C",i,"sparse-checkout","init","--no-cone"],{timeoutMs:15e3})).ok&&(await Ue(["-C",i,"sparse-checkout","set",...a],{timeoutMs:3e4})).ok&&(await Ue(["-C",i,"checkout","--force","HEAD"],{timeoutMs:6e4})).ok){let p=await Ue(["-C",i,"ls-files"],{timeoutMs:15e3});p.ok&&(c=p.stdout.split(/\r?\n/).map(g=>g.trim()).filter(Boolean).filter(g=>g.endsWith("/SKILL.md")||g==="SKILL.md"))}if(!Array.isArray(c)){let h=["-C",i,"ls-tree","-r","--name-only","HEAD"];n&&h.push("--",n);let f=await Ue(h,{timeoutMs:3e4});if(!f.ok)return{ok:!0,items:[]};c=f.stdout.split(/\r?\n/).map(p=>p.trim()).filter(Boolean).filter(p=>p.endsWith("/SKILL.md")||p==="SKILL.md")}let u=Array.from(new Set(c.filter(h=>h!=="SKILL.md").map(h=>ce.default.posix.dirname(h)))),d=[];for(let h of u){let f=ce.default.posix.basename(h),p=ce.default.posix.join(h,"SKILL.md"),g=[],y="";try{y=await ge.default.promises.readFile(o(p),"utf8")}catch{let k=await Ue(["-C",i,"show",`HEAD:${p}`],{timeoutMs:15e3});k.ok?y=k.stdout:g.push("Failed to read SKILL.md")}let w=SS(y);g.push(...w.warnings);let S=typeof w.frontmatter.description=="string"?w.frontmatter.description:void 0,m=typeof w.frontmatter.name=="string"?w.frontmatter.name:void 0,b=qf(f);b||g.push("Skill directory name is not a valid OpenCode skill name"),d.push({repoSource:e.source,repoSubpath:n||void 0,skillDir:h,skillName:f,frontmatterName:m,description:S,installable:b,warnings:g.length?g:void 0})}return d.sort((h,f)=>String(h.skillName).localeCompare(String(f.skillName))),{ok:!0,items:d}}finally{await Tr(i)}}async function kS(e,s){let t=await ge.default.promises.realpath(e),n=async r=>{await ge.default.promises.mkdir(r,{recursive:!0})},i=async(r,o)=>{let a=await ge.default.promises.readdir(r,{withFileTypes:!0});for(let c of a){let l=ce.default.join(r,c.name),u=ce.default.join(o,c.name),d=await ge.default.promises.lstat(l);if(d.isSymbolicLink())throw new Error("Symlinks are not supported in skills");if(!(await ge.default.promises.realpath(ce.default.dirname(l))).startsWith(t))throw new Error("Invalid source path traversal detected");if(d.isDirectory()){await n(u),await i(l,u);continue}if(d.isFile()){await n(ce.default.dirname(u)),await ge.default.promises.copyFile(l,u);try{await ge.default.promises.chmod(u,d.mode&511)}catch{}}}};await n(s),await i(e,s)}function vS(){let e=ce.default.join(gn.default.homedir(),".config","opencode","skills"),s=ce.default.join(gn.default.homedir(),".config","opencode","skill");return ge.default.existsSync(s)&&!ge.default.existsSync(e)?s:e}function ES(e,s){let t=s.split("/").filter(Boolean);return ce.default.join(e,...t)}async function Wf(e){let s=await Gf();if(!s.ok)return{ok:!1,error:s.error};if(e.scope==="project"&&!e.workingDirectory)return{ok:!1,error:{kind:"invalidSource",message:"Project installs require a directory parameter"}};let t=ra(e.source,e.subpath);if(!t.ok)return{ok:!1,error:t.error};let n=e.selections.map(c=>String(c.skillDir||"").trim()).filter(Boolean);if(n.length===0)return{ok:!1,error:{kind:"invalidSource",message:"No skills selected for installation"}};let i=vS(),r=n.map(c=>{let l=ce.default.posix.basename(c);return{skillDirPosix:c,skillName:l,installable:qf(l)}}),o=[];for(let c of r){if(!c.installable)continue;let l=e.scope==="user"?ce.default.join(i,c.skillName):ce.default.join(e.workingDirectory,".opencode","skills",c.skillName);if(ge.default.existsSync(l)){let u=e.conflictDecisions?.[c.skillName],d=e.conflictPolicy==="skipAll"||e.conflictPolicy==="overwriteAll";!u&&!d&&o.push({skillName:c.skillName,scope:e.scope})}}if(o.length>0)return{ok:!1,error:{kind:"conflicts",message:"Some skills already exist in the selected scope",conflicts:o}};let a=await ge.default.promises.mkdtemp(ce.default.join(gn.default.tmpdir(),"openchamber-vscode-skills-install-"));try{let c=await Hf(t.cloneUrlHttps,a);if(!c.ok)return{ok:!1,error:c.error};await Ue(["-C",a,"sparse-checkout","init","--cone"],{timeoutMs:15e3});let l=await Ue(["-C",a,"sparse-checkout","set",...n],{timeoutMs:3e4});if(!l.ok)return{ok:!1,error:{kind:"unknown",message:l.stderr||l.message||"Failed to configure sparse checkout"}};let u=await Ue(["-C",a,"checkout","--force","HEAD"],{timeoutMs:6e4});if(!u.ok)return{ok:!1,error:{kind:"unknown",message:u.stderr||u.message||"Failed to checkout repository"}};let d=[],h=[];for(let f of r){if(!f.installable){h.push({skillName:f.skillName,reason:"Invalid skill name (directory basename)"});continue}let p=ES(a,f.skillDirPosix),g=ce.default.join(p,"SKILL.md");if(!ge.default.existsSync(g)){h.push({skillName:f.skillName,reason:"SKILL.md not found in selected directory"});continue}let y=e.scope==="user"?ce.default.join(i,f.skillName):ce.default.join(e.workingDirectory,".opencode","skills",f.skillName),w=ge.default.existsSync(y),S=e.conflictDecisions?.[f.skillName]||null;if(S||(w&&e.conflictPolicy==="skipAll"&&(S="skip"),w&&e.conflictPolicy==="overwriteAll"&&(S="overwrite"),w||(S="overwrite")),w&&S==="skip"){h.push({skillName:f.skillName,reason:"Already installed (skipped)"});continue}w&&S==="overwrite"&&await Tr(y),await ge.default.promises.mkdir(ce.default.dirname(y),{recursive:!0});try{await kS(p,y),d.push({skillName:f.skillName,scope:e.scope})}catch(m){await Tr(y),h.push({skillName:f.skillName,reason:m instanceof Error?m.message:"Failed to copy skill files"})}}return{ok:!0,installed:d,skipped:h}}finally{await Tr(a)}}var vs=new Map,jf=30*60*1e3;async function Jf(e,s,t){let n=[...hS,...Array.isArray(t)?t:[]],i=kr(e),r=new Map(i.map(a=>[a.name,a])),o={};for(let a of n){if(mS(a.source)){let f="clawdhub:registry",p=s?null:vs.get(f);p&&Date.now()>=p.expiresAt&&(vs.delete(f),p=null);let g=[];if(p)g=p.items;else{let y=await wS();if(!y.ok){o[a.id]=[];continue}g=y.items||[],vs.set(f,{expiresAt:Date.now()+jf,items:g})}o[a.id]=g.map(y=>{let w=r.get(y.skillName);return{sourceId:a.id,...y,installed:w?{isInstalled:!0,scope:w.scope}:{isInstalled:!1}}});continue}let c=ra(a.source);if(!c.ok){o[a.id]=[];continue}let l=a.defaultSubpath||c.effectiveSubpath||"",u=`${c.normalizedRepo}::${l}`,d=s?null:vs.get(u);d&&Date.now()>=d.expiresAt&&(vs.delete(u),d=null);let h=[];if(d)h=d.items;else{let f=await ia({source:a.source,defaultSubpath:a.defaultSubpath});if(!f.ok){o[a.id]=[];continue}h=f.items||[],vs.set(u,{expiresAt:Date.now()+jf,items:h})}o[a.id]=h.map(f=>{let p=r.get(f.skillName);return{sourceId:a.id,...f,installed:p?{isInstalled:!0,scope:p.scope}:{isInstalled:!1}}})}return{ok:!0,sources:n,itemsBySource:o}}var L0=require("vscode"),Kf=q(require("path")),Ne=q(require("fs/promises")),AS="https://github.com/login/device/code",RS="https://github.com/login/oauth/access_token",CS="https://api.github.com/user",PS="https://api.github.com/user/emails",IS="urn:ietf:params:oauth:grant-type:device_code",oa="Ov23liNd8TxDcMXtAHHM",zf="repo read:org workflow read:user user:email",Wt=e=>Kf.join(e.globalStorageUri.fsPath,"github-auth.json"),Vf=e=>typeof e.accountId=="string"&&e.accountId.trim()?e.accountId.trim():e.user?.login?e.user.login.trim():typeof e.user?.id=="number"?String(e.user.id):e.accessToken?`token:${e.accessToken.slice(0,8)}`:"",_S=e=>{let s=!1,t=!1,n=e.map(i=>({...i,accountId:Vf(i),current:!!i.current})).filter(i=>!!i.accessToken);return n.forEach(i=>{i.current&&!t?t=!0:i.current&&t&&(i.current=!1,s=!0)}),!t&&n.length>0&&(n[0].current=!0,s=!0),{list:n,changed:s}},ft=async e=>{try{let s=await Ne.readFile(Wt(e),"utf8"),t=JSON.parse(s);if(!t)return[];let n=Array.isArray(t)?t:[t],{list:i,changed:r}=_S(n);return r&&await Ne.writeFile(Wt(e),JSON.stringify(i,null,2),"utf8"),i}catch{return[]}},qe=async e=>{let s=await ft(e);return s.length?s.find(t=>t.current)??s[0]??null:null},Yf=async(e,s)=>{let t=await ft(e),n={...s,accountId:Vf(s),current:!0},i=t.findIndex(r=>r.accountId===n.accountId);i>=0?t[i]=n:t.push(n),t.forEach(r=>{r.current=r.accountId===n.accountId}),await Ne.mkdir(e.globalStorageUri.fsPath,{recursive:!0}),await Ne.writeFile(Wt(e),JSON.stringify(t,null,2),"utf8");try{await Ne.chmod(Wt(e),384)}catch{}},Zf=async(e,s)=>{let t=await ft(e);if(!t.length)return!1;let n=s.trim();if(!n)return!1;let i=!1;return t.forEach(r=>{r.accountId===n?(r.current=!0,i=!0):r.current=!1}),i?(await Ne.writeFile(Wt(e),JSON.stringify(t,null,2),"utf8"),!0):!1},De=async e=>{try{let s=await ft(e);if(!s.length)return!0;let t=s.filter(n=>!n.current);return t.length?(t[0].current=!0,await Ne.writeFile(Wt(e),JSON.stringify(t,null,2),"utf8"),!0):(await Ne.rm(Wt(e)),!0)}catch(s){return!!(s&&typeof s=="object"&&"code"in s&&s.code==="ENOENT")}},Xf=async(e,s)=>{let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","User-Agent":"OpenChamber"},body:new URLSearchParams(s).toString()}),n=await t.json().catch(()=>null);if(!t.ok){let i=typeof n?.error_description=="string"?n.error_description:"",r=typeof n?.error=="string"?n.error:"";throw new Error(i||r||t.statusText)}return n},Qf=async(e,s)=>{let t=await Xf(AS,{client_id:e,scope:s});return{deviceCode:t.device_code,userCode:t.user_code,verificationUri:t.verification_uri,verificationUriComplete:t.verification_uri_complete,expiresIn:t.expires_in,interval:t.interval,scope:s}},ep=async(e,s)=>await Xf(RS,{client_id:e,device_code:s,grant_type:IS}),hn=async e=>{let s=await fetch(CS,{method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e}`,"User-Agent":"OpenChamber"}});if(s.status===401){let r=new Error("unauthorized");throw r.status=401,r}let t=await s.json().catch(()=>null);if(!s.ok||!t)throw new Error(`GitHub /user failed: ${s.statusText}`);let n=typeof t.name=="string"?t.name:void 0,i=typeof t.email=="string"?t.email:void 0;if(!i)try{let r=await fetch(PS,{method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e}`,"User-Agent":"OpenChamber"}});if(r.status===401){let a=new Error("unauthorized");throw a.status=401,a}let o=await r.json().catch(()=>null);if(r.ok&&Array.isArray(o)){let a=o.find(l=>!!l?.primary&&!!l?.verified&&typeof l?.email=="string"),c=o.find(l=>!!l?.verified&&typeof l?.email=="string");i=a?.email||c?.email}}catch{}return{login:String(t.login||""),id:typeof t.id=="number"?t.id:void 0,avatarUrl:typeof t.avatar_url=="string"?t.avatar_url:void 0,name:n,email:i}};var tp=require("node:child_process"),sp=require("node:util"),TS=(0,sp.promisify)(tp.execFile),Ge="https://api.github.com",xS=e=>{let s=e.trim();if(!s)return null;if(s.startsWith("git@github.com:")){let t=s.slice(15),n=t.endsWith(".git")?t.slice(0,-4):t,[i,r]=n.split("/");return!i||!r?null:{owner:i,repo:r,url:`https://github.com/${i}/${r}`}}if(s.startsWith("ssh://git@github.com/")){let t=s.slice(21),n=t.endsWith(".git")?t.slice(0,-4):t,[i,r]=n.split("/");return!i||!r?null:{owner:i,repo:r,url:`https://github.com/${i}/${r}`}}try{let t=new URL(s);if(t.hostname!=="github.com")return null;let n=t.pathname.replace(/^\/+/,"").replace(/\/+$/,""),i=n.endsWith(".git")?n.slice(0,-4):n,[r,o]=i.split("/");return!r||!o?null:{owner:r,repo:o,url:`https://github.com/${r}/${o}`}}catch{return null}},OS=async e=>{try{let{stdout:s}=await TS("git",["-C",e,"remote","get-url","origin"]);return String(s||"").trim()||null}catch{return null}},We=async e=>{let s=await OS(e);return s?xS(s):null},He=async(e,s,t)=>fetch(e,{...t,headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${s}`,"User-Agent":"OpenChamber",...t?.headers||{}}}),Ve=async e=>await e.json().catch(()=>null),K=e=>typeof e=="string"?e:"",np=async(e,s,t,n)=>{let i=await We(t);if(!i)return{connected:!0,repo:null,branch:n,pr:null,checks:null,canMerge:!1};let r=async y=>{let w=new URL(`${Ge}/repos/${i.owner}/${i.repo}/pulls`);w.searchParams.set("state",y),w.searchParams.set("head",`${i.owner}:${n}`),w.searchParams.set("per_page","10");let S=await He(w.toString(),e);if(S.status===401)return null;let m=await Ve(S);return S.ok&&Array.isArray(m)&&m.length>0?m[0].number:null},o=async y=>{let w=new URL(`${Ge}/repos/${i.owner}/${i.repo}/pulls`);w.searchParams.set("state",y),w.searchParams.set("per_page","100");let S=await He(w.toString(),e);if(S.status===401)return null;let m=await Ve(S);if(!S.ok||!Array.isArray(m))return null;let b=m.find(k=>{let v=k?.head&&typeof k.head=="object"?k.head:null;return K(v?.ref)===n});return b&&typeof b.number=="number"?b.number:null},a=await r("open");if(a||(a=await r("closed")),a||(a=await o("open")),a||(a=await o("closed")),a===null){let y=new URL(`${Ge}/repos/${i.owner}/${i.repo}/pulls`);if(y.searchParams.set("state","open"),y.searchParams.set("per_page","1"),(await He(y.toString(),e)).status===401)return{connected:!1}}if(!a)return{connected:!0,repo:i,branch:n,pr:null,checks:null,canMerge:!1};let c=await He(`${Ge}/repos/${i.owner}/${i.repo}/pulls/${a}`,e);if(c.status===401)return{connected:!1};let l=await Ve(c);if(!c.ok||!l)throw new Error("Failed to load PR");let u=!!(l.merged||l.merged_at),d=K(l.state),h=u?"merged":d==="closed"?"closed":"open",f={number:typeof l.number=="number"?l.number:0,title:K(l.title)||"",body:K(l.body)||"",url:K(l.html_url)||"",state:h,draft:!!l.draft,base:K(l.base?.ref)||"",head:K(l.head?.ref)||"",headSha:K(l.head?.sha)||void 0,mergeable:typeof l.mergeable=="boolean"?l.mergeable:null,mergeableState:K(l.mergeable_state)||void 0},p=null;if(f.headSha){let y=await He(`${Ge}/repos/${i.owner}/${i.repo}/commits/${f.headSha}/check-runs`,e),w=await Ve(y),S=Array.isArray(w?.check_runs)?w.check_runs:[];if(y.ok&&S.length>0){let m={success:0,failure:0,pending:0};S.forEach(v=>{let E=v&&typeof v=="object"?v:null,A=K(E?.status),R=K(E?.conclusion);if(A==="queued"||A==="in_progress"){m.pending+=1;return}if(!R){m.pending+=1;return}R==="success"||R==="neutral"||R==="skipped"?m.success+=1:m.failure+=1});let b=m.success+m.failure+m.pending;p={state:m.failure>0?"failure":m.pending>0?"pending":b>0?"success":"unknown",total:b,...m}}if(!p){let m=await He(`${Ge}/repos/${i.owner}/${i.repo}/commits/${f.headSha}/status`,e),b=await Ve(m);if(m.ok&&b){let k=Array.isArray(b.statuses)?b.statuses:[],v={success:0,failure:0,pending:0};k.forEach(R=>{let x=K(R?.state);x==="success"?v.success+=1:x==="failure"||x==="error"?v.failure+=1:x==="pending"&&(v.pending+=1)});let E=v.success+v.failure+v.pending;p={state:v.failure>0?"failure":v.pending>0?"pending":E>0?"success":"unknown",total:E,...v}}}}let g=!1;if(s){let y=await He(`${Ge}/repos/${i.owner}/${i.repo}/collaborators/${encodeURIComponent(s)}/permission`,e),w=await Ve(y),S=typeof w?.permission=="string"?w.permission:"";g=S==="admin"||S==="maintain"||S==="write"}return{connected:!0,repo:i,branch:n,pr:f,checks:p,canMerge:g}},rp=async(e,s,t)=>{let n=await We(s);if(!n)throw new Error("Unable to resolve GitHub repo from git remote");let i=await He(`${Ge}/repos/${n.owner}/${n.repo}/pulls`,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.title,head:t.head,base:t.base,...typeof t.body=="string"?{body:t.body}:{},...typeof t.draft=="boolean"?{draft:t.draft}:{}})}),r=await Ve(i);if(!i.ok||!r)throw new Error("Failed to create PR");return{number:typeof r.number=="number"?r.number:0,title:K(r.title)||"",body:K(r.body)||"",url:K(r.html_url)||"",state:K(r.state)==="closed"?"closed":"open",draft:!!r.draft,base:K(r.base?.ref)||t.base,head:K(r.head?.ref)||t.head,headSha:K(r.head?.sha)||void 0,mergeable:typeof r.mergeable=="boolean"?r.mergeable:null,mergeableState:K(r.mergeable_state)||void 0}},ip=async(e,s,t)=>{let n=await We(s);if(!n)throw new Error("Unable to resolve GitHub repo from git remote");let i=await He(`${Ge}/repos/${n.owner}/${n.repo}/pulls/${t.number}`,e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.title,...typeof t.body=="string"?{body:t.body}:{}})});if(i.status===403)throw new Error("Not authorized to edit this PR");if(i.status===401){let c=new Error("unauthorized");throw c.status=401,c}let r=await Ve(i);if(!i.ok||!r){let c=K(r?.message),l=Array.isArray(r?.errors)&&r.errors.length>0?K(r.errors[0]?.message||r.errors[0]?.code):"",u=[c,l].filter(Boolean).join(" \xB7 ");throw new Error(u||"Failed to update PR")}let a=!!(r.merged||r.merged_at)?"merged":K(r.state)==="closed"?"closed":"open";return{number:typeof r.number=="number"?r.number:t.number,title:K(r.title)||t.title,body:K(r.body)||"",url:K(r.html_url)||"",state:a,draft:!!r.draft,base:K(r.base?.ref)||"",head:K(r.head?.ref)||"",headSha:K(r.head?.sha)||void 0,mergeable:typeof r.mergeable=="boolean"?r.mergeable:null,mergeableState:K(r.mergeable_state)||void 0}},op=async(e,s,t)=>{let n=await We(s);if(!n)throw new Error("Unable to resolve GitHub repo from git remote");let i=await He(`${Ge}/repos/${n.owner}/${n.repo}/pulls/${t.number}/merge`,e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({merge_method:t.method})});if(i.status===403)throw new Error("Not authorized to merge this PR");if(i.status===405||i.status===409)return{merged:!1,message:"PR not mergeable"};let r=await Ve(i);if(!i.ok||!r)throw new Error("Failed to merge PR");return{merged:!!r.merged,message:K(r.message)||void 0}},ap=async(e,s,t)=>{let n=await We(s);if(!n)throw new Error("Unable to resolve GitHub repo from git remote");let i=await He(`${Ge}/repos/${n.owner}/${n.repo}/pulls/${t}`,e);if(i.status===401)return{ready:!1};let r=await Ve(i),o=typeof r?.node_id=="string"?r.node_id:"",a=!!r?.draft;if(!i.ok||!o)throw new Error("Failed to resolve PR node id");if(!a)return{ready:!0};let c=await He(`${Ge}/graphql`,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"mutation($pullRequestId: ID!) { markPullRequestReadyForReview(input: { pullRequestId: $pullRequestId }) { pullRequest { id isDraft } } }",variables:{pullRequestId:o}})});if(c.status===403)throw new Error("Not authorized to mark PR ready");if(c.status===401){let u=new Error("unauthorized");throw u.status=401,u}let l=await Ve(c);if(!c.ok||!l)throw new Error("Failed to mark PR ready");if(l.errors)throw new Error("GitHub GraphQL error");return{ready:!0}};var aa="https://api.github.com",ca=async(e,s,t)=>fetch(e,{...t,headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${s}`,"User-Agent":"OpenChamber",...t?.headers||{}}}),la=async e=>await e.json().catch(()=>null),ye=e=>typeof e=="string"?e:"",xr=e=>{let s=e&&typeof e=="object"?e:null,t=ye(s?.login);return t?{login:t,id:typeof s?.id=="number"?s.id:void 0,avatarUrl:ye(s?.avatar_url)||void 0,name:void 0,email:void 0}:null},cp=e=>(Array.isArray(e)?e:[]).map(t=>{let n=t&&typeof t=="object"?t:null,i=ye(n?.name);return i?{name:i,color:ye(n?.color)||void 0}:null}).filter(Boolean),lp=async(e,s,t=1)=>{let n=await We(s);if(!n)return{connected:!0,repo:null,issues:[]};let i=new URL(`${aa}/repos/${n.owner}/${n.repo}/issues`);i.searchParams.set("state","open"),i.searchParams.set("per_page","50"),i.searchParams.set("page",String(t));let r=await ca(i.toString(),e);if(r.status===401)return{connected:!1};let o=r.headers.get("link")||"",a=/rel="next"/.test(o),c=await la(r);if(!r.ok||!Array.isArray(c))throw new Error("Failed to load issues");let l=c.map(u=>{let d=u&&typeof u=="object"?u:null;if(!d||d.pull_request)return null;let h=typeof d.number=="number"?d.number:0;if(!h)return null;let f=ye(d.state)==="closed"?"closed":"open";return{number:h,title:ye(d.title)||"",url:ye(d.html_url)||"",state:f,author:xr(d.user),labels:cp(d.labels)}}).filter(Boolean);return{connected:!0,repo:n,issues:l||[],page:t,hasMore:a}},up=async(e,s,t)=>{let n=await We(s);if(!n)return{connected:!0,repo:null,issue:null};let i=await ca(`${aa}/repos/${n.owner}/${n.repo}/issues/${t}`,e);if(i.status===401)return{connected:!1};let r=await la(i);if(!i.ok||!r)throw new Error("Failed to load issue");if(r.pull_request)throw new Error("Not a GitHub issue");let o=ye(r.state)==="closed"?"closed":"open",c=(Array.isArray(r.assignees)?r.assignees:[]).map(xr).filter(Boolean);return{connected:!0,repo:n,issue:{number:typeof r.number=="number"?r.number:t,title:ye(r.title)||"",url:ye(r.html_url)||"",state:o,author:xr(r.user),labels:cp(r.labels),body:ye(r.body)||"",assignees:c,createdAt:ye(r.created_at)||void 0,updatedAt:ye(r.updated_at)||void 0}}},dp=async(e,s,t)=>{let n=await We(s);if(!n)return{connected:!0,repo:null,comments:[]};let i=new URL(`${aa}/repos/${n.owner}/${n.repo}/issues/${t}/comments`);i.searchParams.set("per_page","100");let r=await ca(i.toString(),e);if(r.status===401)return{connected:!1};let o=await la(r);if(!r.ok||!Array.isArray(o))throw new Error("Failed to load issue comments");let a=o.map(c=>{let l=c&&typeof c=="object"?c:null;if(!l)return null;let u=typeof l.id=="number"?l.id:0;return u?{id:u,url:ye(l.html_url)||"",body:ye(l.body)||"",author:xr(l.user),createdAt:ye(l.created_at)||void 0,updatedAt:ye(l.updated_at)||void 0}:null}).filter(Boolean);return{connected:!0,repo:n,comments:a||[]}};var st="https://api.github.com",pt=async(e,s,t)=>fetch(e,{...t,headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${s}`,"User-Agent":"OpenChamber",...t?.headers||{}}}),LS=async(e,s,t)=>fetch(e,{headers:{Accept:t,Authorization:`Bearer ${s}`,"User-Agent":"OpenChamber"}}),gt=async e=>await e.json().catch(()=>null),N=e=>typeof e=="string"?e:"",Or=e=>{let s=e&&typeof e=="object"?e:null,t=N(s?.login);return t?{login:t,id:typeof s?.id=="number"?s.id:void 0,avatarUrl:N(s?.avatar_url)||void 0,name:void 0,email:void 0}:null},fp=e=>{let s=e&&typeof e=="object"?e:null,t=N(s?.owner?.login),n=N(s?.name),i=N(s?.html_url);return!t||!n||!i?null:{owner:t,repo:n,url:i,cloneUrl:N(s?.clone_url)||void 0,sshUrl:N(s?.ssh_url)||void 0}},NS=async(e,s,t)=>{let n=await pt(`${st}/repos/${s.owner}/${s.repo}/commits/${t}/check-runs`,e);if(n.status===401)return{summary:null,runs:[]};let i=await gt(n),r=Array.isArray(i?.check_runs)?i.check_runs:[],o=r.map(f=>{let p=f&&typeof f=="object"?f:null,g=N(p?.name);if(!g)return null;let y=p?.output&&typeof p.output=="object"?p.output:null,w=p?.app&&typeof p.app=="object"?p.app:null;return{id:typeof p?.id=="number"?p.id:void 0,name:g,app:w?{name:N(w.name)||void 0,slug:N(w.slug)||void 0}:void 0,status:N(p?.status)||void 0,conclusion:p?.conclusion===null||typeof p?.conclusion=="string"?p?.conclusion:void 0,detailsUrl:N(p?.details_url)||void 0,output:y?{title:N(y.title)||void 0,summary:N(y.summary)||void 0,text:N(y.text)||void 0}:void 0}}).filter(Boolean);if(n.ok&&r.length>0){let f={success:0,failure:0,pending:0};r.forEach(y=>{let w=y&&typeof y=="object"?y:null,S=N(w?.status),m=N(w?.conclusion);if(S==="queued"||S==="in_progress"){f.pending+=1;return}if(!m){f.pending+=1;return}m==="success"||m==="neutral"||m==="skipped"?f.success+=1:f.failure+=1});let p=f.success+f.failure+f.pending;return{summary:{state:f.failure>0?"failure":f.pending>0?"pending":p>0?"success":"unknown",total:p,...f},runs:o}}let a=await pt(`${st}/repos/${s.owner}/${s.repo}/commits/${t}/status`,e),c=await gt(a);if(!a.ok||!c)return{summary:null,runs:o};let l=Array.isArray(c.statuses)?c.statuses:[],u={success:0,failure:0,pending:0};l.forEach(f=>{let p=N(f?.state);p==="success"?u.success+=1:p==="failure"||p==="error"?u.failure+=1:p==="pending"&&(u.pending+=1)});let d=u.success+u.failure+u.pending;return{summary:{state:u.failure>0?"failure":u.pending>0?"pending":d>0?"success":"unknown",total:d,...u},runs:o}},pp=async(e,s,t=1)=>{let n=await We(s);if(!n)return{connected:!0,repo:null,prs:[]};let i=new URL(`${st}/repos/${n.owner}/${n.repo}/pulls`);i.searchParams.set("state","open"),i.searchParams.set("per_page","50"),i.searchParams.set("page",String(t));let r=await pt(i.toString(),e);if(r.status===401)return{connected:!1};let o=r.headers.get("link")||"",a=/rel="next"/.test(o),c=await gt(r);if(!r.ok||!Array.isArray(c))throw new Error("Failed to load PRs");let l=c.map(u=>{let d=u&&typeof u=="object"?u:null,h=typeof d?.number=="number"?d.number:0,f=N(d?.merged_at),p=N(d?.state),g=f?"merged":p==="closed"?"closed":"open",y=d?.base&&typeof d.base=="object"?d.base:null,w=d?.head&&typeof d.head=="object"?d.head:null;return{number:h,title:N(d?.title)||"",url:N(d?.html_url)||"",state:g,draft:!!d?.draft,base:N(y?.ref)||"",head:N(w?.ref)||"",headSha:N(w?.sha)||void 0,mergeable:typeof d?.mergeable=="boolean"?d.mergeable:null,mergeableState:N(d?.mergeable_state)||void 0,author:Or(d?.user),headLabel:N(w?.label)||void 0,headRepo:fp(w?.repo)}});return{connected:!0,repo:n,prs:l,page:t,hasMore:a}},gp=async(e,s,t,n,i)=>{let r=await We(s);if(!r)return{connected:!0,repo:null,pr:null};let o=await pt(`${st}/repos/${r.owner}/${r.repo}/pulls/${t}`,e);if(o.status===401)return{connected:!1};let a=await gt(o);if(!o.ok||!a)throw new Error("Failed to load PR");let c=!!a.merged_at||!!a.merged,l=N(a.state),u=c?"merged":l==="closed"?"closed":"open",d=a.base&&typeof a.base=="object"?a.base:null,h=a.head&&typeof a.head=="object"?a.head:null,f={number:typeof a.number=="number"?a.number:t,title:N(a.title)||"",url:N(a.html_url)||"",state:u,draft:!!a.draft,base:N(d?.ref)||"",head:N(h?.ref)||"",headSha:N(h?.sha)||void 0,mergeable:typeof a.mergeable=="boolean"?a.mergeable:null,mergeableState:N(a.mergeable_state)||void 0,author:Or(a.user),headLabel:N(h?.label)||void 0,headRepo:fp(h?.repo),body:N(a.body)||"",createdAt:N(a.created_at)||void 0,updatedAt:N(a.updated_at)||void 0},p=await pt(`${st}/repos/${r.owner}/${r.repo}/issues/${t}/comments?per_page=100`,e);if(p.status===401)return{connected:!1};let g=await gt(p);if(!p.ok||!Array.isArray(g))throw new Error("Failed to load PR issue comments");let y=g.map(P=>{let I=P&&typeof P=="object"?P:null,B=typeof I?.id=="number"?I.id:0;return B?{id:B,url:N(I?.html_url)||"",body:N(I?.body)||"",author:Or(I?.user),createdAt:N(I?.created_at)||void 0,updatedAt:N(I?.updated_at)||void 0}:null}).filter(Boolean),w=await pt(`${st}/repos/${r.owner}/${r.repo}/pulls/${t}/comments?per_page=100`,e);if(w.status===401)return{connected:!1};let S=await gt(w);if(!w.ok||!Array.isArray(S))throw new Error("Failed to load PR review comments");let m=S.map(P=>{let I=P&&typeof P=="object"?P:null,B=typeof I?.id=="number"?I.id:0;return B?{id:B,url:N(I?.html_url)||"",body:N(I?.body)||"",author:Or(I?.user),path:N(I?.path)||void 0,line:typeof I?.line=="number"?I.line:null,position:typeof I?.position=="number"?I.position:null,createdAt:N(I?.created_at)||void 0,updatedAt:N(I?.updated_at)||void 0}:null}).filter(Boolean),b=await pt(`${st}/repos/${r.owner}/${r.repo}/pulls/${t}/files?per_page=100`,e);if(b.status===401)return{connected:!1};let k=await gt(b);if(!b.ok||!Array.isArray(k))throw new Error("Failed to load PR files");let v=k.map(P=>{let I=P&&typeof P=="object"?P:null,B=N(I?.filename);return B?{filename:B,status:N(I?.status)||void 0,additions:typeof I?.additions=="number"?I.additions:void 0,deletions:typeof I?.deletions=="number"?I.deletions:void 0,changes:typeof I?.changes=="number"?I.changes:void 0,patch:N(I?.patch)||void 0}:null}).filter(Boolean),E=f.headSha?await NS(e,r,f.headSha):{summary:null,runs:[]},A=E.summary,R=E.runs;if(i&&R.length>0){let P=$=>{if(!$)return{runId:null,jobId:null};let U=$.match(/\/actions\/runs\/(\d+)(?:\/job\/(\d+))?/);if(!U)return{runId:null,jobId:null};let X=Number(U[1]),j=U[2]?Number(U[2]):null;return{runId:Number.isFinite(X)&&X>0?X:null,jobId:j&&Number.isFinite(j)&&j>0?j:null}},I=new Map,B=new Set;R.forEach($=>{let U=P($.detailsUrl);U.runId&&B.add(U.runId)});for(let $ of B){let U=await pt(`${st}/repos/${r.owner}/${r.repo}/actions/runs/${$}/jobs?per_page=100`,e);if(U.status===401)return{connected:!1};let X=await gt(U),j=Array.isArray(X?.jobs)?X?.jobs:[];I.set($,j.filter(J=>J&&typeof J=="object"))}let D=new Map;for(let $ of R){let U=typeof $.id=="number"?$.id:0,X=($.conclusion||"").toLowerCase();if(!!!(U>0&&X&&!["success","neutral","skipped"].includes(X)))continue;let J=[];for(let Z=1;Z<=3;Z+=1){let re=await pt(`${st}/repos/${r.owner}/${r.repo}/check-runs/${U}/annotations?per_page=50&page=${Z}`,e);if(re.status===401)return{connected:!1};let we=await gt(re),_s=Array.isArray(we)?we:[];if(_s.forEach(Ur=>{let it=Ur&&typeof Ur=="object"?Ur:null,ya=N(it?.message);ya&&J.push({path:N(it?.path)||void 0,startLine:typeof it?.start_line=="number"?it.start_line:void 0,endLine:typeof it?.end_line=="number"?it.end_line:void 0,level:N(it?.annotation_level)||void 0,message:ya,title:N(it?.title)||void 0,rawDetails:N(it?.raw_details)||void 0})}),_s.length<50)break}J.length>0&&D.set(U,J)}for(let $ of R){$.id&&D.has($.id)&&($.annotations=D.get($.id));let U=P($.detailsUrl);if(!U.runId)continue;let X=I.get(U.runId)??[],j=U.jobId?X.find(re=>typeof re.id=="number"&&re.id===U.jobId):X.find(re=>N(re.name)===$.name);if(!j){$.job={runId:U.runId,...U.jobId?{jobId:U.jobId}:{},url:$.detailsUrl};continue}let Z=(Array.isArray(j.steps)?j.steps:[]).map(re=>{let we=re&&typeof re=="object"?re:null,_s=N(we?.name);return _s?{name:_s,status:N(we?.status)||void 0,conclusion:we?.conclusion===null||typeof we?.conclusion=="string"?we?.conclusion:void 0,number:typeof we?.number=="number"?we.number:void 0,startedAt:N(we?.started_at)||void 0,completedAt:N(we?.completed_at)||void 0}:null}).filter(Boolean);$.job={runId:U.runId,jobId:typeof j.id=="number"?j.id:void 0,url:N(j.html_url)||void 0,name:N(j.name)||void 0,conclusion:j.conclusion===null||typeof j.conclusion=="string"?j.conclusion:void 0,steps:Z.length>0?Z:void 0}}}let x;if(n){let P=await LS(`${st}/repos/${r.owner}/${r.repo}/pulls/${t}`,e,"application/vnd.github.v3.diff");if(P.status===401)return{connected:!1};P.ok&&(x=await P.text().catch(()=>{}))}return{connected:!0,repo:r,pr:f,issueComments:y,reviewComments:m,files:v,diff:x,checks:A,checkRuns:R}};var vp="openchamber.settings",Jt=800,DS=(0,kp.promisify)(Nr.execFile),MS=["gpgconf","/opt/homebrew/bin/gpgconf","/usr/local/bin/gpgconf"],fa=Y.join(Se.homedir(),".config","openchamber","settings.json"),Ep=()=>{try{let e=Kt.readFileSync(fa,"utf8"),s=JSON.parse(e);return s&&typeof s=="object"&&!Array.isArray(s)?s:{}}catch{return{}}},hp=async e=>{try{await Kt.promises.mkdir(Y.dirname(fa),{recursive:!0});let t={...Ep(),...e};await Kt.promises.writeFile(fa,JSON.stringify(t,null,2),"utf8")}catch{}},Es=e=>{let t={...e?.context?.globalState.get(vp)||{}};delete t.lastDirectory;let n=Ep(),i=typeof n.opencodeBinary=="string"?n.opencodeBinary.trim():"",r=T.workspace.workspaceFolders?.[0]?.uri.fsPath||"";return{themeVariant:T.window.activeColorTheme.kind===T.ColorThemeKind.Light||T.window.activeColorTheme.kind===T.ColorThemeKind.HighContrastLight?"light":"dark",lastDirectory:r,...t,opencodeBinary:typeof t.opencodeBinary=="string"?String(t.opencodeBinary).trim():i||void 0}},ne=(e,s)=>{if(!e||typeof e!="object")return"";let n=e[s];return typeof n=="string"?n.trim():""},ua=(e,s)=>{if(!e||typeof e!="object")return;let n=e[s];return typeof n=="boolean"?n:void 0},Tt=(e,s)=>{if(!e||typeof e!="object")return;let n=e[s];return typeof n=="number"&&Number.isFinite(n)?n:void 0},$S=e=>{let s=e.trim();return s==="merge"||s==="squash"||s==="rebase"?s:"merge"},jS=e=>{if(!e||typeof e!="object")return null;let t=e.output;if(!Array.isArray(t))return null;let n=t.find(a=>!a||typeof a!="object"?!1:a.type==="message");if(!n)return null;let i=n.content;if(!Array.isArray(i))return null;let r=i.find(a=>!a||typeof a!="object"?!1:a.type==="output_text");return(typeof r?.text=="string"?r.text.trim():"")||null},mp=e=>{try{let s=JSON.parse(e);return!s||typeof s!="object"||Array.isArray(s)?null:s}catch{return null}},FS=async(e,s)=>{let t=Es(s),n={...e||{}};delete n.lastDirectory;let i=new Set;for(let o of["defaultModel","defaultVariant","defaultAgent","defaultGitIdentityId","opencodeBinary"]){let a=n[o];typeof a=="string"&&a.trim().length===0&&(i.add(o),delete n[o])}typeof n.usageAutoRefresh!="boolean"&&delete n.usageAutoRefresh,typeof n.usageRefreshIntervalMs=="number"&&Number.isFinite(n.usageRefreshIntervalMs)?n.usageRefreshIntervalMs=Math.max(3e4,Math.min(3e5,Math.round(n.usageRefreshIntervalMs))):delete n.usageRefreshIntervalMs;let r={...t,...n,lastDirectory:t.lastDirectory};for(let o of i)delete r[o];return await s?.context?.globalState.update(vp,r),i.has("opencodeBinary")?await hp({opencodeBinary:""}):typeof n.opencodeBinary=="string"&&await hp({opencodeBinary:n.opencodeBinary.trim()}),r},Ae=e=>e.replace(/\\/g,"/"),da=async e=>{if(!e)return!1;try{let s=await Kt.promises.stat(e);return typeof s.isSocket=="function"&&s.isSocket()}catch{return!1}},BS=async()=>{let e=(process.env.SSH_AUTH_SOCK||"").trim();if(e)return e;if(process.platform==="win32")return;let s=Y.join(Se.homedir(),".gnupg","S.gpg-agent.ssh");if(await da(s))return s;let t=async i=>{for(let r of MS)try{let{stdout:o}=await DS(r,i);return String(o||"")}catch{continue}return""},n=(await t(["--list-dirs","agent-ssh-socket"])).trim();if(n&&await da(n))return n;if(n){await t(["--launch","gpg-agent"]);let i=(await t(["--list-dirs","agent-ssh-socket"])).trim();if(i&&await da(i))return i}},US=async()=>{let e={...process.env,GIT_TERMINAL_PROMPT:"0"};if(!e.SSH_AUTH_SOCK||!e.SSH_AUTH_SOCK.trim()){let s=await BS();s&&(e.SSH_AUTH_SOCK=s)}return e},xt=async(e,s)=>{let t=await US();return new Promise(n=>{let i=(0,Nr.spawn)("git",e,{cwd:s,stdio:["ignore","pipe","pipe"],env:t}),r="",o="";i.stdout?.on("data",a=>{r+=a.toString()}),i.stderr?.on("data",a=>{o+=a.toString()}),i.on("close",a=>{n({stdout:r,stderr:o,exitCode:a??0})}),i.on("error",a=>{n({stdout:"",stderr:a instanceof Error?a.message:String(a),exitCode:1})})})},qS=async(e,s)=>{if(s.length===0)return new Set;let t=await xt(["check-ignore","--",...s],e);return t.exitCode!==0||!t.stdout?new Set:new Set(t.stdout.split(`
`).map(n=>n.trim()).filter(Boolean))},GS=async(e,s)=>{if(s.length===0)return new Set;let t=await xt(["check-ignore","--",...s],e);return t.exitCode!==0||!t.stdout?new Set:new Set(t.stdout.split(`
`).map(n=>n.trim()).filter(Boolean))},HS=e=>{let s=(e||"").trim();return s&&(s==="~"?Se.homedir():s.startsWith("~/")||s.startsWith("~\\")?Y.join(Se.homedir(),s.slice(2)):s)},Ye=(e,s)=>{let t=HS(e);return!t||Y.isAbsolute(t)?t:Y.resolve(s,t)},WS=async e=>{let s=T.Uri.file(e);return(await T.workspace.fs.readDirectory(s)).map(([n,i])=>({name:n,path:Ae(T.Uri.joinPath(s,n).fsPath),isDirectory:i===T.FileType.Directory}))},JS=new Set(["node_modules",".git","dist","build",".next",".turbo",".cache","coverage","tmp","logs"]),KS=(e,s)=>e?!s&&e.startsWith(".")?!0:JS.has(e.toLowerCase()):!1,zS=(e,s)=>{if(!e)return 0;let t=e.toLowerCase(),n=s.toLowerCase();if(n.includes(t)){let a=n.indexOf(t),c=0;if(a===0)c=20;else{let l=n[a-1];(l==="/"||l==="_"||l==="-"||l==="."||l===" ")&&(c=15)}return 100+c-Math.min(a,20)-Math.floor(n.length/5)}let i=0,r=-1,o=0;for(let a=0;a<t.length;a++){let c=t[a];if(!c||c===" ")continue;let l=n.indexOf(c,r+1);if(l===-1)return null;let u=l-r-1;if(u===0?o++:o=0,i+=10,i+=Math.max(0,18-l),i-=Math.min(u,10),l===0)i+=12;else{let d=n[l-1];(d==="/"||d==="_"||d==="-"||d==="."||d===" ")&&(i+=10)}i+=o>0?12:0,r=l}return i+=Math.max(0,24-Math.floor(n.length/3)),i},yp=async(e,s,t,n,i,r)=>{let o=(s||"").trim().toLowerCase(),a=o.length===0,c=typeof r=="number"&&r>0?Date.now()+r:null,l=T.Uri.file(e),u=[l],d=new Set([Ae(l.fsPath)]),h=a?t:Math.max(t*3,200),f=[],p=10;for(;u.length>0&&f.length<h&&!(c&&Date.now()>c);){let g=u.splice(0,p),y=await Promise.all(g.map(w=>Promise.resolve(T.workspace.fs.readDirectory(w)).catch(()=>[])));for(let w=0;w<g.length&&!(c&&Date.now()>c);w+=1){let S=g[w],m=y[w],b=i?await qS(Ae(S.fsPath),m.map(([k])=>k)):new Set;for(let[k,v]of m){if(!k||!n&&k.startsWith(".")||i&&b.has(k))continue;let E=T.Uri.joinPath(S,k),A=Ae(E.fsPath);if(v===T.FileType.Directory){if(KS(k,n))continue;d.has(A)||(d.add(A),u.push(E));continue}if(v!==T.FileType.File)continue;let R=Ae(Y.relative(e,A)||Y.basename(A)),x=k.includes(".")?k.split(".").pop()?.toLowerCase():void 0;if(a)f.push({name:k,path:A,relativePath:R,extension:x,score:0});else{let P=zS(o,R);P!==null&&f.push({name:k,path:A,relativePath:R,extension:x,score:P})}if(f.length>=h){u.length=0;break}}if(f.length>=h)break}}return a||f.sort((g,y)=>y.score!==g.score?y.score-g.score:g.relativePath.length!==y.relativePath.length?g.relativePath.length-y.relativePath.length:g.relativePath.localeCompare(y.relativePath)),f.slice(0,t).map(({name:g,path:y,relativePath:w,extension:S})=>({name:g,path:y,relativePath:w,extension:S}))},VS=async(e,s,t=60,n=!1,i=!0)=>{let r=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),o=e?Ye(e,r):T.workspace.workspaceFolders?.[0]?.uri.fsPath||"";if(!o)return[];let a=s?.trim()||"";if(!a)return yp(o,"",t,n,i);let c=h=>h.replace(/[\\{}()?*]/g,"\\$&").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),l="**/{node_modules,.git,dist,build,.next,.turbo,.cache,coverage,tmp,logs}/**",u=h=>h.map(f=>{let p=Ae(f.fsPath),g=Ae(Y.relative(o,p)),y=Y.basename(p);return{name:y,path:p,relativePath:g||y,extension:y.includes(".")?y.split(".").pop()?.toLowerCase():void 0}}),d=async h=>{if(!i||h.length===0)return h;let f=h.map(g=>Ae(Y.relative(o,g.fsPath))||Y.basename(g.fsPath)),p=await GS(o,f);return p.size===0?h:h.filter((g,y)=>!p.has(f[y]))};try{let h=c(a),f=`**/*${h}*`,p=await T.workspace.findFiles(new T.RelativePattern(T.Uri.file(o),f),l,t);if(Array.isArray(p)&&p.length>0){let g=n?p:p.filter(w=>!Y.basename(w.fsPath).startsWith(".")),y=await d(g);if(y.length>0)return u(y)}if(a.length>=2&&a.length<=32){let g=`**/*${h.split("").join("*")}*`,y=await T.workspace.findFiles(new T.RelativePattern(T.Uri.file(o),g),l,t);if(Array.isArray(y)&&y.length>0){let w=n?y:y.filter(m=>!Y.basename(m.fsPath).startsWith(".")),S=await d(w);if(S.length>0)return u(S)}}}catch{}return yp(o,a,t,n,i,1500)},YS=async()=>{let e=typeof AbortController<"u"?new AbortController:void 0,s=e?setTimeout(()=>e.abort(),8e3):void 0;try{let t=await fetch("https://models.dev/api.json",{signal:e?.signal,headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`models.dev responded with ${t.status}`);return await t.json()}finally{s&&clearTimeout(s)}},Lr=e=>Buffer.from(e,"utf8").toString("base64"),wp=e=>{let s={};return e.forEach((t,n)=>{s[n]=t}),s},bp=()=>{let e=JSON.stringify({error:"OpenCode API unavailable"});return{status:503,headers:{"content-type":"application/json"},bodyBase64:Lr(e)}},Sp=e=>{let s={...e||{}};return delete s["content-length"],delete s.host,delete s.connection,s};async function As(e,s){let{id:t,type:n,payload:i}=e;try{switch(n){case"api:proxy":{let r=s?.manager?.getApiUrl();if(!r){let g=bp();return{id:t,type:n,success:!0,data:g}}let{method:o,path:a,headers:c,bodyBase64:l}=i||{},u=typeof o=="string"&&o.trim()?o.trim().toUpperCase():"GET",d=typeof a=="string"&&a.trim().length>0?a.trim().startsWith("/")?a.trim():`/${a.trim()}`:"/",h=`${r.replace(/\/+$/,"")}/`,f=new URL(d.replace(/^\/+/,""),h).toString(),p=Sp(c);(d==="/event"||d==="/global/event")&&(p.Accept||(p.Accept="text/event-stream"),p["Cache-Control"]=p["Cache-Control"]||"no-cache",p.Connection=p.Connection||"keep-alive");try{let g=await fetch(f,{method:u,headers:p,body:typeof l=="string"&&l.length>0&&u!=="GET"&&u!=="HEAD"?Buffer.from(l,"base64"):void 0}),y=await g.arrayBuffer(),w={status:g.status,headers:wp(g.headers),bodyBase64:Buffer.from(y).toString("base64")};return{id:t,type:n,success:!0,data:w}}catch(g){let y=JSON.stringify({error:g instanceof Error?g.message:"Failed to reach OpenCode API"}),w={status:502,headers:{"content-type":"application/json"},bodyBase64:Lr(y)};return{id:t,type:n,success:!0,data:w}}}case"api:session:message":{let r=s?.manager?.getApiUrl();if(!r){let f=bp();return{id:t,type:n,success:!0,data:f}}let{path:o,headers:a,bodyText:c}=i||{},l=typeof o=="string"&&o.trim().length>0?o.trim().startsWith("/")?o.trim():`/${o.trim()}`:"/";if(!/^\/session\/[^/]+\/message(?:\?.*)?$/.test(l)){let f=JSON.stringify({error:"Invalid session message proxy path"}),p={status:400,headers:{"content-type":"application/json"},bodyBase64:Lr(f)};return{id:t,type:n,success:!0,data:p}}let u=`${r.replace(/\/+$/,"")}/`,d=new URL(l.replace(/^\/+/,""),u).toString(),h=Sp(a);try{let f=await fetch(d,{method:"POST",headers:h,body:typeof c=="string"?c:"",signal:AbortSignal.timeout(45e3)}),p=await f.arrayBuffer(),g={status:f.status,headers:wp(f.headers),bodyBase64:Buffer.from(p).toString("base64")};return{id:t,type:n,success:!0,data:g}}catch(f){let p=f instanceof Error&&(f.name==="TimeoutError"||f.name==="AbortError"),g=JSON.stringify({error:p?"OpenCode message forward timed out":f instanceof Error?f.message:"OpenCode message forward failed"}),y={status:p?504:503,headers:{"content-type":"application/json"},bodyBase64:Lr(g)};return{id:t,type:n,success:!0,data:y}}}case"files:list":{let{path:r}=i,o=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),a=Ye(r,o),c=T.Uri.file(a),u=(await T.workspace.fs.readDirectory(c)).map(([d,h])=>({name:d,path:T.Uri.joinPath(c,d).fsPath,isDirectory:h===T.FileType.Directory}));return{id:t,type:n,success:!0,data:{directory:Ae(a),entries:u}}}case"files:search":{let{query:r,maxResults:o=50}=i,a=`**/*${r}*`,l=(await T.workspace.findFiles(a,"**/node_modules/**",o)).map(u=>({path:u.fsPath}));return{id:t,type:n,success:!0,data:l}}case"workspace:folder":{let r=T.workspace.workspaceFolders?.[0]?.uri.fsPath||"";return{id:t,type:n,success:!0,data:{folder:r}}}case"config:get":{let{key:r}=i,a=T.workspace.getConfiguration("openchamber").get(r);return{id:t,type:n,success:!0,data:{value:a}}}case"api:fs:list":{let r=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),{path:o,respectGitignore:a}=i||{},l=Ye(o||r,r)||r,u=await WS(l),d=Ae(l);if(!a)return{id:t,type:n,success:!0,data:{entries:u,directory:d,path:d}};let h=u.map(f=>f.name).filter(Boolean);if(h.length===0)return{id:t,type:n,success:!0,data:{entries:u,directory:d,path:d}};try{let f=await xt(["check-ignore","--",...h],d),p=new Set(f.stdout.split(`
`).map(y=>y.trim()).filter(Boolean)),g=u.filter(y=>!p.has(y.name));return{id:t,type:n,success:!0,data:{entries:g,directory:d,path:d}}}catch{return{id:t,type:n,success:!0,data:{entries:u,directory:d,path:d}}}}case"api:fs:search":{let{directory:r="",query:o="",limit:a,includeHidden:c,respectGitignore:l}=i||{},u=await VS(r,o,a,!!c,l!==!1);return{id:t,type:n,success:!0,data:{files:u}}}case"api:fs:mkdir":{let r=i?.path;if(!r)return{id:t,type:n,success:!1,error:"Path is required"};let o=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),a=Ye(r,o);return await T.workspace.fs.createDirectory(T.Uri.file(a)),{id:t,type:n,success:!0,data:{success:!0,path:Ae(a)}}}case"api:fs/home":return{id:t,type:n,success:!0,data:{home:Ae(Se.homedir())}};case"api:fs:read":{let r=i?.path;if(!r)return{id:t,type:n,success:!1,error:"Path is required"};try{let o=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),a=Ye(r,o),c=T.Uri.file(a),l=await T.workspace.fs.readFile(c),u=Buffer.from(l).toString("utf8");return{id:t,type:n,success:!0,data:{content:u,path:Ae(a)}}}catch(o){let a=o instanceof Error?o.message:"Failed to read file";return{id:t,type:n,success:!1,error:a}}}case"api:fs:write":{let{path:r,content:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Path is required"};if(typeof o!="string")return{id:t,type:n,success:!1,error:"Content is required"};try{let a=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),c=Ye(r,a),l=T.Uri.file(c),u=T.Uri.file(Y.dirname(c));try{await T.workspace.fs.createDirectory(u)}catch{}return await T.workspace.fs.writeFile(l,Buffer.from(o,"utf8")),{id:t,type:n,success:!0,data:{success:!0,path:Ae(c)}}}catch(a){let c=a instanceof Error?a.message:"Failed to write file";return{id:t,type:n,success:!1,error:c}}}case"api:fs:delete":{let r=i?.path;if(!r)return{id:t,type:n,success:!1,error:"Path is required"};try{let o=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),a=Ye(r,o),c=T.Uri.file(a);return await T.workspace.fs.delete(c,{recursive:!0,useTrash:!1}),{id:t,type:n,success:!0,data:{success:!0}}}catch(o){let a=o instanceof Error?o.message:"Failed to delete file";return{id:t,type:n,success:!1,error:a}}}case"api:fs:rename":{let{oldPath:r,newPath:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"oldPath is required"};if(!o)return{id:t,type:n,success:!1,error:"newPath is required"};try{let a=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),c=Ye(r,a),l=Ye(o,a),u=T.Uri.file(c),d=T.Uri.file(l);return await T.workspace.fs.rename(u,d,{overwrite:!1}),{id:t,type:n,success:!0,data:{success:!0,path:Ae(l)}}}catch(a){let c=a instanceof Error?a.message:"Failed to rename file";return{id:t,type:n,success:!1,error:c}}}case"api:fs:exec":{let{commands:r,cwd:o}=i||{};if(!Array.isArray(r)||r.length===0)return{id:t,type:n,success:!1,error:"Commands array is required"};if(!o)return{id:t,type:n,success:!1,error:"Working directory (cwd) is required"};try{let a=T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),c=Ye(o,a),{exec:l}=await import("child_process"),{promisify:u}=await import("util"),d=u(l),h=process.env.SHELL||(process.platform==="win32"?"cmd.exe":"/bin/sh"),f=process.platform==="win32"?"/c":"-c",p={...process.env,PATH:process.env.PATH},g=[];for(let w of r){if(typeof w!="string"||!w.trim()){g.push({command:w,success:!1,error:"Invalid command"});continue}try{let{stdout:S,stderr:m}=await d(`${h} ${f} "${w.replace(/"/g,'\\"')}"`,{cwd:c,env:p,timeout:3e5});g.push({command:w,success:!0,exitCode:0,stdout:(S||"").trim(),stderr:(m||"").trim()})}catch(S){let m=S;g.push({command:w,success:!1,exitCode:typeof m.code=="number"?m.code:1,stdout:(m.stdout||"").trim(),stderr:(m.stderr||"").trim(),error:m.message})}}let y=g.every(w=>w.success);return{id:t,type:n,success:!0,data:{success:y,results:g}}}catch(a){let c=a instanceof Error?a.message:"Failed to execute commands";return{id:t,type:n,success:!1,error:c}}}case"api:files/pick":{let o=i?.allowMany!==!1,a=T.workspace.workspaceFolders?.[0]?.uri,c=await T.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:o,defaultUri:a,openLabel:"Attach"});if(!c||c.length===0)return{id:t,type:n,success:!0,data:{files:[],skipped:[]}};let l=[],u=[],d=h=>{switch(h){case".png":case".jpg":case".jpeg":case".gif":case".bmp":case".webp":return`image/${h.replace(".","")}`;case".pdf":return"application/pdf";case".txt":case".log":return"text/plain";case".json":return"application/json";case".md":case".markdown":return"text/markdown";default:return"application/octet-stream"}};for(let h of c)try{let p=(await T.workspace.fs.stat(h)).size??0,g=Y.basename(h.fsPath);if(p>10485760){u.push({name:g,reason:"File exceeds 10MB limit"});continue}let y=await T.workspace.fs.readFile(h),w=Y.extname(g).toLowerCase(),S=d(w),m=Buffer.from(y).toString("base64"),b=`data:${S};base64,${m}`;l.push({name:g,mimeType:S,size:p,dataUrl:b})}catch(f){let p=Y.basename(h.fsPath);u.push({name:p,reason:f instanceof Error?f.message:"Failed to read file"})}return{id:t,type:n,success:!0,data:{files:l,skipped:u}}}case"api:config/settings:get":{let r=Es(s);return{id:t,type:n,success:!0,data:r}}case"api:config/settings:save":{let o=await FS(i||{},s);return{id:t,type:n,success:!0,data:o}}case"api:github/auth:status":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await ft(r),a=o.filter(l=>l.user&&l.accountId).map(l=>({id:l.accountId,user:l.user,scope:l.scope,current:!!l.current})),c=o.find(l=>l.current)||o[0];if(!c?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1,accounts:a}};try{let l=await hn(c.accessToken);return{id:t,type:n,success:!0,data:{connected:!0,user:l,scope:c.scope,accounts:a}}}catch(l){let u=l&&typeof l=="object"&&"status"in l?l.status:void 0,d=l instanceof Error?l.message:String(l);if(u===401||d==="unauthorized"){await De(r);let h=(await ft(r)).filter(f=>f.user&&f.accountId).map(f=>({id:f.accountId,user:f.user,scope:f.scope,current:!!f.current}));return{id:t,type:n,success:!0,data:{connected:!1,accounts:h}}}return{id:t,type:n,success:!1,error:d}}}case"api:github/auth:start":{if(!s?.context)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=Es(s),a=ne(o,"githubClientId")||oa,c=ne(o,"githubScopes")||zf,l=await Qf(a,c);return{id:t,type:n,success:!0,data:l}}case"api:github/auth:complete":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=ne(i,"deviceCode");if(!o)return{id:t,type:n,success:!1,error:"deviceCode is required"};let a=Es(s),c=ne(a,"githubClientId")||oa,l=await ep(c,o),u=l&&typeof l=="object"?l:null,d=typeof u?.error=="string"?u.error:"",h=typeof u?.error_description=="string"?u.error_description:"";if(d)return{id:t,type:n,success:!0,data:{connected:!1,status:d,error:h||d}};let f=typeof u?.access_token=="string"?u.access_token:"";if(!f)return{id:t,type:n,success:!1,error:"Missing access_token from GitHub"};let p=await hn(f);return await Yf(r,{accessToken:f,scope:typeof u?.scope=="string"?u.scope:void 0,tokenType:typeof u?.token_type=="string"?u.token_type:void 0,createdAt:Date.now(),user:p}),{id:t,type:n,success:!0,data:{connected:!0,user:p,scope:typeof u?.scope=="string"?u.scope:void 0}}}case"api:github/auth:disconnect":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await De(r);return{id:t,type:n,success:!0,data:{removed:o}}}case"api:github/auth:activate":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=ne(i,"accountId");if(!o)return{id:t,type:n,success:!1,error:"accountId is required"};if(!await Zf(r,o))return{id:t,type:n,success:!1,error:"GitHub account not found"};let c=await ft(r),l=c.filter(d=>d.user&&d.accountId).map(d=>({id:d.accountId,user:d.user,scope:d.scope,current:!!d.current})),u=c.find(d=>d.current)||c[0];if(!u?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1,accounts:l}};try{let d=await hn(u.accessToken);return{id:t,type:n,success:!0,data:{connected:!0,user:d,scope:u.scope,accounts:l}}}catch(d){let h=d&&typeof d=="object"&&"status"in d?d.status:void 0,f=d instanceof Error?d.message:String(d);if(h===401||f==="unauthorized"){await De(r);let p=(await ft(r)).filter(g=>g.user&&g.accountId).map(g=>({id:g.accountId,user:g.user,scope:g.scope,current:!!g.current}));return{id:t,type:n,success:!0,data:{connected:!1,accounts:p}}}return{id:t,type:n,success:!1,error:f}}}case"api:github/me":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!1,error:"GitHub not connected"};try{let a=await hn(o.accessToken);return{id:t,type:n,success:!0,data:a}}catch(a){let c=a&&typeof a=="object"&&"status"in a?a.status:void 0,l=a instanceof Error?a.message:String(a);return c===401||l==="unauthorized"?(await De(r),{id:t,type:n,success:!1,error:"GitHub token expired or revoked"}):{id:t,type:n,success:!1,error:l}}}case"api:github/pr:status":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=ne(i,"directory"),a=ne(i,"branch");if(!o||!a)return{id:t,type:n,success:!1,error:"directory and branch are required"};let c=await qe(r);if(!c?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};try{let l=await np(c.accessToken,c.user?.login||null,o,a);return l.connected===!1&&await De(r),{id:t,type:n,success:!0,data:l}}catch(l){let u=l instanceof Error?l.message:String(l);return{id:t,type:n,success:!1,error:u}}}case"api:github/pr:create":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!1,error:"GitHub not connected"};let a=ne(i,"directory"),c=ne(i,"title"),l=ne(i,"head"),u=ne(i,"base"),d=ne(i,"body"),h=ua(i,"draft");if(!a||!c||!l||!u)return{id:t,type:n,success:!1,error:"directory, title, head, base are required"};try{let f=await rp(o.accessToken,a,{directory:a,title:c,head:l,base:u,...d?{body:d}:{},...typeof h=="boolean"?{draft:h}:{}});return{id:t,type:n,success:!0,data:f}}catch(f){let p=f instanceof Error?f.message:String(f);return{id:t,type:n,success:!1,error:p}}}case"api:github/pr:update":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!1,error:"GitHub not connected"};let a=ne(i,"directory"),c=Tt(i,"number")??0,l=ne(i,"title"),u=ne(i,"body");if(!a||!c||!l)return{id:t,type:n,success:!1,error:"directory, number, title are required"};try{let d=await ip(o.accessToken,a,{directory:a,number:c,title:l,...typeof u=="string"?{body:u}:{}});return{id:t,type:n,success:!0,data:d}}catch(d){let h=d&&typeof d=="object"&&"status"in d?d.status:void 0,f=d instanceof Error?d.message:String(d);return(h===401||f==="unauthorized")&&await De(r),{id:t,type:n,success:!1,error:f}}}case"api:github/pr:merge":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!1,error:"GitHub not connected"};let a=ne(i,"directory"),c=$S(ne(i,"method")||"merge"),l=Tt(i,"number")??0;if(!a||!l)return{id:t,type:n,success:!1,error:"directory and number are required"};try{let u=await op(o.accessToken,a,{directory:a,number:l,method:c});return{id:t,type:n,success:!0,data:u}}catch(u){let d=u instanceof Error?u.message:String(u);return{id:t,type:n,success:!1,error:d}}}case"api:github/pr:ready":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!1,error:"GitHub not connected"};let a=ne(i,"directory"),c=Tt(i,"number")??0;if(!a||!c)return{id:t,type:n,success:!1,error:"directory and number are required"};try{let l=await ap(o.accessToken,a,c);return{id:t,type:n,success:!0,data:l}}catch(l){let u=l&&typeof l=="object"&&"status"in l?l.status:void 0,d=l instanceof Error?l.message:String(l);return(u===401||d==="unauthorized")&&await De(r),{id:t,type:n,success:!1,error:d}}}case"api:github/issues:list":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};let a=ne(i,"directory"),c=Tt(i,"page")??1;if(!a)return{id:t,type:n,success:!1,error:"directory is required"};try{let l=await lp(o.accessToken,a,c);return l.connected===!1&&await De(r),{id:t,type:n,success:!0,data:l}}catch(l){let u=l instanceof Error?l.message:String(l);return{id:t,type:n,success:!1,error:u}}}case"api:github/issues:get":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};let a=ne(i,"directory"),c=Tt(i,"number")??0;if(!a||!c)return{id:t,type:n,success:!1,error:"directory and number are required"};try{let l=await up(o.accessToken,a,c);return l.connected===!1&&await De(r),{id:t,type:n,success:!0,data:l}}catch(l){let u=l instanceof Error?l.message:String(l);return{id:t,type:n,success:!1,error:u}}}case"api:github/issues:comments":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};let a=ne(i,"directory"),c=Tt(i,"number")??0;if(!a||!c)return{id:t,type:n,success:!1,error:"directory and number are required"};try{let l=await dp(o.accessToken,a,c);return l.connected===!1&&await De(r),{id:t,type:n,success:!0,data:l}}catch(l){let u=l instanceof Error?l.message:String(l);return{id:t,type:n,success:!1,error:u}}}case"api:github/pulls:list":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};let a=ne(i,"directory"),c=Tt(i,"page")??1;if(!a)return{id:t,type:n,success:!1,error:"directory is required"};try{let l=await pp(o.accessToken,a,c);return l.connected===!1&&await De(r),{id:t,type:n,success:!0,data:l}}catch(l){let u=l instanceof Error?l.message:String(l);return{id:t,type:n,success:!1,error:u}}}case"api:github/pulls:context":{let r=s?.context;if(!r)return{id:t,type:n,success:!1,error:"Missing VS Code context"};let o=await qe(r);if(!o?.accessToken)return{id:t,type:n,success:!0,data:{connected:!1}};let a=ne(i,"directory"),c=Tt(i,"number")??0,l=ua(i,"includeDiff")??!1,u=ua(i,"includeCheckDetails")??!1;if(!a||!c)return{id:t,type:n,success:!1,error:"directory and number are required"};try{let d=await gp(o.accessToken,a,c,l,u);return d.connected===!1&&await De(r),{id:t,type:n,success:!0,data:d}}catch(d){let h=d instanceof Error?d.message:String(d);return{id:t,type:n,success:!1,error:h}}}case"api:config/reload":return await s?.manager?.restart(),{id:t,type:n,success:!0,data:{restarted:!0}};case"api:config/agents":{let{method:r,name:o,body:a,directory:c}=i||{},l=typeof o=="string"?o.trim():"";if(!l)return{id:t,type:n,success:!1,error:"Agent name is required"};let u=typeof c=="string"&&c.trim()?c.trim():s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,d=typeof r=="string"&&r.trim()?r.trim().toUpperCase():"GET";if(d==="GET"){let h=Au(l,u),f=h.md.exists?h.md.scope:h.json.exists?h.json.scope:null;return{id:t,type:n,success:!0,data:{name:l,sources:h,scope:f,isBuiltIn:!h.md.exists&&!h.json.exists}}}if(d==="POST"){let h=a?.scope,f=h==="project"?de.PROJECT:h==="user"?de.USER:void 0;return Ru(l,a||{},u,f),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Agent ${l} created successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}}return d==="PATCH"?(Cu(l,a||{},u),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Agent ${l} updated successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}):d==="DELETE"?(Pu(l,u),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Agent ${l} deleted successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}):{id:t,type:n,success:!1,error:`Unsupported method: ${d}`}}case"api:config/commands":{let{method:r,name:o,body:a,directory:c}=i||{},l=typeof o=="string"?o.trim():"";if(!l)return{id:t,type:n,success:!1,error:"Command name is required"};let u=typeof c=="string"&&c.trim()?c.trim():s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,d=typeof r=="string"&&r.trim()?r.trim().toUpperCase():"GET";if(d==="GET"){let h=Iu(l,u),f=h.md.exists?h.md.scope:h.json.exists?h.json.scope:null;return{id:t,type:n,success:!0,data:{name:l,sources:h,scope:f,isBuiltIn:!h.md.exists&&!h.json.exists}}}if(d==="POST"){let h=a?.scope,f=h==="project"?be.PROJECT:h==="user"?be.USER:void 0;return _u(l,a||{},u,f),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Command ${l} created successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}}return d==="PATCH"?(Tu(l,a||{},u),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Command ${l} updated successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}):d==="DELETE"?(Ou(l,u),await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!0,message:`Command ${l} deleted successfully. Reloading interface\u2026`,reloadDelayMs:Jt}}):{id:t,type:n,success:!1,error:`Unsupported method: ${d}`}}case"api:config/skills":{let{method:r,name:o,body:a}=i||{},c=s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,l=typeof r=="string"&&r.trim()?r.trim().toUpperCase():"GET";if(!o&&l==="GET"){let d=kr(c);return{id:t,type:n,success:!0,data:{skills:d}}}let u=typeof o=="string"?o.trim():"";if(!u)return{id:t,type:n,success:!1,error:"Skill name is required"};if(l==="GET"){let d=Mo(u,c);return{id:t,type:n,success:!0,data:{name:u,sources:d,scope:d.md.scope,source:d.md.source}}}if(l==="POST"){let d=a?.scope,h=d==="project"?ve.PROJECT:d==="user"?ve.USER:void 0;return Fu(u,a||{},c,h),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!1,message:`Skill ${u} created successfully`}}}return l==="PATCH"?(Bu(u,a||{},c),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!1,message:`Skill ${u} updated successfully`}}):l==="DELETE"?(Uu(u,c),{id:t,type:n,success:!0,data:{success:!0,requiresReload:!1,message:`Skill ${u} deleted successfully`}}):{id:t,type:n,success:!1,error:`Unsupported method: ${l}`}}case"api:config/skills:catalog":{let r=!!i?.refresh,o=s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,c=Es(s).skillCatalogs,l=Array.isArray(c)?c.map(d=>{if(!d||typeof d!="object")return null;let h=d,f=typeof h.id=="string"?h.id.trim():"",p=typeof h.label=="string"?h.label.trim():"",g=typeof h.source=="string"?h.source.trim():"",y=typeof h.subpath=="string"?h.subpath.trim():"";return!f||!p||!g?null:{id:f,label:p,description:g,source:g,...y?{defaultSubpath:y}:{}}}).filter(d=>d!==null):[],u=await Jf(o,r,l);return{id:t,type:n,success:!0,data:u}}case"api:config/skills:scan":{let r=i||{},o=await ia({source:String(r.source||""),subpath:r.subpath});return{id:t,type:n,success:!0,data:o}}case"api:config/skills:install":{let r=i||{},o=s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,a=await Wf({source:String(r.source||""),subpath:r.subpath,scope:r.scope==="project"?"project":"user",workingDirectory:r.scope==="project"?o:void 0,selections:Array.isArray(r.selections)?r.selections:[],conflictPolicy:r.conflictPolicy,conflictDecisions:r.conflictDecisions});return{id:t,type:n,success:!0,data:a}}case"api:config/skills/files":{let{method:r,name:o,filePath:a,content:c}=i||{},l=s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath,u=typeof o=="string"?o.trim():"";if(!u)return{id:t,type:n,success:!1,error:"Skill name is required"};let d=typeof a=="string"?a.trim():"";if(!d)return{id:t,type:n,success:!1,error:"File path is required"};let h=Mo(u,l);if(!h.md.dir)return{id:t,type:n,success:!1,error:`Skill "${u}" not found`};let f=h.md.dir,p=typeof r=="string"&&r.trim()?r.trim().toUpperCase():"GET";if(p==="GET"){let g=ju(f,d);return g===null?{id:t,type:n,success:!1,error:`File "${d}" not found in skill "${u}"`}:{id:t,type:n,success:!0,data:{content:g}}}return p==="PUT"?(vr(f,d,c||""),{id:t,type:n,success:!0,data:{success:!0}}):p==="DELETE"?($o(f,d),{id:t,type:n,success:!0,data:{success:!0}}):{id:t,type:n,success:!1,error:`Unsupported method: ${p}`}}case"api:opencode/directory":{let r=i?.path;if(!r)return{id:t,type:n,success:!1,error:"Path is required"};let o=s?.manager?.getWorkingDirectory()||T.workspace.workspaceFolders?.[0]?.uri.fsPath||Se.homedir(),a=Ye(r,o),c=await s?.manager?.setWorkingDirectory(a);return c?{id:t,type:n,success:!0,data:c}:{id:t,type:n,success:!1,error:"OpenCode manager unavailable"}}case"api:models/metadata":try{let r=await YS();return{id:t,type:n,success:!0,data:r}}catch(r){let o=r instanceof Error?r.message:String(r);return{id:t,type:n,success:!1,error:o}}case"editor:openFile":{let{path:r,line:o,column:a}=i;try{let c=await T.workspace.openTextDocument(r),l={};if(typeof o=="number"){let u=new T.Position(Math.max(0,o-1),a||0);l.selection=new T.Range(u,u)}return await T.window.showTextDocument(c,l),{id:t,type:n,success:!0}}catch(c){let l=c instanceof Error?c.message:String(c);return{id:t,type:n,success:!1,error:l}}}case"editor:openDiff":{let{original:r,modified:o,label:a}=i;try{let c=T.Uri.file(r),l=T.Uri.file(o),u=a||`${Y.basename(r)} \u2194 ${Y.basename(o)}`;return await T.commands.executeCommand("vscode.diff",c,l,u),{id:t,type:n,success:!0}}catch(c){let l=c instanceof Error?c.message:String(c);return{id:t,type:n,success:!1,error:l}}}case"api:provider/auth:delete":{let{providerId:r,scope:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Provider ID is required"};let a=typeof o=="string"?o:"auth";try{let c=!1;if(a==="auth")c=Bo(r);else if(a==="user"||a==="project"||a==="custom")c=dn(r,s?.manager?.getWorkingDirectory(),a);else if(a==="all"){let l=s?.manager?.getWorkingDirectory(),u=Bo(r),d=dn(r,l,"user"),h=l?dn(r,l,"project"):!1,f=dn(r,l,"custom");c=u||d||h||f}else return{id:t,type:n,success:!1,error:"Invalid scope"};return c&&await s?.manager?.restart(),{id:t,type:n,success:!0,data:{success:!0,removed:c,requiresReload:c,message:c?`Provider ${r} disconnected successfully. Reloading interface\u2026`:`Provider ${r} was not configured.`,reloadDelayMs:c?Jt:void 0}}}catch(c){let l=c instanceof Error?c.message:String(c);return{id:t,type:n,success:!1,error:l}}}case"api:provider/source:get":{let{providerId:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Provider ID is required"};try{let o=xu(r,s?.manager?.getWorkingDirectory()),a=Hu(r);return o.auth.exists=!!a,{id:t,type:n,success:!0,data:{providerId:r,sources:o}}}catch(o){let a=o instanceof Error?o.message:String(o);return{id:t,type:n,success:!1,error:a}}}case"api:quota:providers":try{let r=Xu();return{id:t,type:n,success:!0,data:{providers:r}}}catch(r){let o=r instanceof Error?r.message:String(r);return{id:t,type:n,success:!1,error:o}}case"api:quota:get":{let{providerId:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Provider ID is required"};try{let o=await sd(r);return{id:t,type:n,success:!0,data:o}}catch(o){let a=o instanceof Error?o.message:String(o);return{id:t,type:n,success:!1,error:a}}}case"vscode:command":{let{command:r,args:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Command is required"};try{let a=await T.commands.executeCommand(r,...o||[]);return{id:t,type:n,success:!0,data:{result:a}}}catch(a){let c=a instanceof Error?a.message:String(a);return{id:t,type:n,success:!1,error:c}}}case"api:git/check":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await pd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/worktree-type":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await gd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/status":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await hd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/branches":{let{directory:r,method:o,name:a,startPoint:c,force:l}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let u=typeof o=="string"?o.toUpperCase():"GET";if(u==="GET"){let d=await yd(r);return{id:t,type:n,success:!0,data:d}}if(u==="POST"){if(!a)return{id:t,type:n,success:!1,error:"Branch name is required"};let d=await bd(r,a,c);return{id:t,type:n,success:!0,data:d}}if(u==="DELETE"){if(!a)return{id:t,type:n,success:!1,error:"Branch name is required"};let d=await Sd(r,a,l);return{id:t,type:n,success:!0,data:d}}return{id:t,type:n,success:!1,error:`Unsupported method: ${u}`}}case"api:git/remote-branches":{let{directory:r,branch:o,remote:a}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and branch are required"};let c=await kd(r,o,a);return{id:t,type:n,success:!0,data:c}}case"api:git/checkout":{let{directory:r,branch:o}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and branch are required"};let a=await wd(r,o);return{id:t,type:n,success:!0,data:a}}case"api:git/worktrees":{let{directory:r,method:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let a=typeof o=="string"?o.toUpperCase():"GET";if(a==="GET"){let c=await Id(r);return{id:t,type:n,success:!0,data:c}}if(a==="POST"){let c=await Td(r,i||{});return{id:t,type:n,success:!0,data:c}}if(a==="DELETE"){let c=i,l=typeof c?.body?.directory=="string"?c.body.directory:"",u=typeof c?.directory=="string"?c.directory:"",d=l||u||"";if(!d)return{id:t,type:n,success:!1,error:"Worktree directory is required"};let h=await xd(r,{directory:d,deleteLocalBranch:c?.body?.deleteLocalBranch===!0||c?.deleteLocalBranch===!0});return{id:t,type:n,success:!0,data:{success:!!h}}}return{id:t,type:n,success:!1,error:`Unsupported method: ${a}`}}case"api:git/worktrees/validate":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await _d(r,i||{});return{id:t,type:n,success:!0,data:o}}case"api:git/diff":{let{directory:r,path:o,staged:a,contextLines:c}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and path are required"};let l=await Od(r,o,a,c);return{id:t,type:n,success:!0,data:l}}case"api:git/file-diff":{let{directory:r,path:o,staged:a}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and path are required"};let c=await Dd(r,o,a);return{id:t,type:n,success:!0,data:c}}case"api:git/revert":{let{directory:r,path:o}=i||{};return!r||!o?{id:t,type:n,success:!1,error:"Directory and path are required"}:(await Md(r,o),{id:t,type:n,success:!0,data:{success:!0}})}case"api:git/commit":{let{directory:r,message:o,addAll:a,files:c}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and message are required"};let l=await $d(r,o,{addAll:a,files:c});return{id:t,type:n,success:!0,data:l}}case"api:git/push":{let{directory:r,remote:o,branch:a,options:c}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let l=await jd(r,{remote:o,branch:a,options:c});return{id:t,type:n,success:!0,data:l}}case"api:git/pull":{let{directory:r,remote:o,branch:a}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let c=await Fd(r,{remote:o,branch:a});return{id:t,type:n,success:!0,data:c}}case"api:git/fetch":{let{directory:r,remote:o,branch:a}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let c=await Bd(r,{remote:o,branch:a});return{id:t,type:n,success:!0,data:c}}case"api:git/remotes":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Wd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/rebase":{let{directory:r,onto:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};if(!o)return{id:t,type:n,success:!1,error:"onto is required"};let a=await Jd(r,{onto:o});return{id:t,type:n,success:!0,data:a}}case"api:git/rebase/abort":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Kd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/merge":{let{directory:r,branch:o}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};if(!o)return{id:t,type:n,success:!1,error:"branch is required"};let a=await zd(r,{branch:o});return{id:t,type:n,success:!0,data:a}}case"api:git/merge/abort":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Vd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/rebase/continue":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Yd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/merge/continue":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Zd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/stash":{let{directory:r,message:o,includeUntracked:a}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let c=await Xd(r,{message:o,includeUntracked:a});return{id:t,type:n,success:!0,data:c}}case"api:git/stash/pop":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let o=await Qd(r);return{id:t,type:n,success:!0,data:o}}case"api:git/log":{let{directory:r,maxCount:o,from:a,to:c,file:l}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let u=await Ud(r,{maxCount:o,from:a,to:c,file:l});return{id:t,type:n,success:!0,data:u}}case"api:git/commit-files":{let{directory:r,hash:o}=i||{};if(!r||!o)return{id:t,type:n,success:!1,error:"Directory and hash are required"};let a=await qd(r,o);return{id:t,type:n,success:!0,data:a}}case"api:git/pr-description":{let{directory:r,base:o,head:a}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};if(!o||!a)return{id:t,type:n,success:!1,error:"base and head are required"};let c=[];try{let d=await Nd(r,o,a);c=Array.isArray(d)?d:[]}catch{c=[]}if(c.length===0)return{id:t,type:n,success:!1,error:"No diffs available for base...head"};let l="";for(let d of c)try{let h=await Ld(r,o,a,d,3),f=typeof h?.diff=="string"?h.diff:"";if(!f.trim())continue;l+=`FILE: ${d}
${f}

`}catch{}if(!l.trim())return{id:t,type:n,success:!1,error:"No diffs available for selected files"};let u=`You are drafting a GitHub Pull Request title + description. Respond in JSON of the shape {"title": string, "body": string} (ONLY JSON in response, no markdown fences) with these rules:
- title: concise, sentence case, <= 80 chars, no trailing punctuation, no commit-style prefixes (no "feat:", "fix:")
- body: GitHub-flavored markdown with these sections in this order: Summary, Testing, Notes
- Summary: 3-6 bullet points describing user-visible changes; avoid internal helper function names
- Testing: bullet list ("- Not tested" allowed)
- Notes: bullet list; include breaking/rollout notes only when relevant

Context:
- base branch: ${o}
- head branch: ${a}

Diff summary:
${l}`;try{let d=Es(s),h=typeof d?.zenModel=="string"?d.zenModel.trim():"",f=h.length>0?h:"gpt-5-nano",p=await fetch("https://opencode.ai/zen/v1/responses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:f,input:[{role:"user",content:u}],max_output_tokens:1200,stream:!1,reasoning:{effort:"low"}})});if(!p.ok)return{id:t,type:n,success:!1,error:"Failed to generate PR description"};let g=await p.json().catch(()=>null),y=jS(g);if(!y)return{id:t,type:n,success:!1,error:"No PR description returned by generator"};let w=String(y).trim().replace(/^```json\s*/i,"").replace(/^```\s*/i,"").replace(/```\s*$/i,"").trim(),S=mp(w)||mp(y);if(S){let m=typeof S.title=="string"?S.title:"",b=typeof S.body=="string"?S.body:"";return{id:t,type:n,success:!0,data:{title:m,body:b}}}return{id:t,type:n,success:!0,data:{title:"",body:String(y)}}}catch(d){let h=d instanceof Error?d.message:String(d);return{id:t,type:n,success:!1,error:h}}}case"api:git/identity":{let{directory:r,method:o,userName:a,userEmail:c,sshKey:l}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};let u=typeof o=="string"?o.toUpperCase():"GET";if(u==="GET"){let d=await Gd(r);return{id:t,type:n,success:!0,data:d}}if(u==="POST"){if(!a||!c)return{id:t,type:n,success:!1,error:"userName and userEmail are required"};let d=await Hd(r,a,c,l);return{id:t,type:n,success:!0,data:d}}return{id:t,type:n,success:!1,error:`Unsupported method: ${u}`}}case"api:git/ignore-openchamber":return{id:t,type:n,success:!0,data:{success:!0}};case"api:git/conflict-details":{let{directory:r}=i||{};if(!r)return{id:t,type:n,success:!1,error:"Directory is required"};try{let a=(await xt(["status","--porcelain"],r)).stdout,l=(await xt(["diff","--name-only","--diff-filter=U"],r)).stdout.split(`
`).map(y=>y.trim()).filter(Boolean),d=(await xt(["diff"],r)).stdout,h="merge",f="",p=await xt(["rev-parse","--verify","--quiet","MERGE_HEAD"],r);if(p.exitCode===0){h="merge";let y=p.stdout.trim(),w="";try{let S=Y.join(r,".git","MERGE_MSG");w=await Kt.promises.readFile(S,"utf8")}catch{}f=`MERGE_HEAD: ${y}${w?`
`+w:""}`}else{let y=await xt(["rev-parse","--verify","--quiet","REBASE_HEAD"],r);y.exitCode===0&&(h="rebase",f=`REBASE_HEAD: ${y.stdout.trim()}`)}return{id:t,type:n,success:!0,data:{statusPorcelain:a.trim(),unmergedFiles:l,diff:d.trim(),headInfo:f.trim(),operation:h}}}catch(o){let a=o instanceof Error?o.message:String(o);return{id:t,type:n,success:!1,error:a}}}default:return{id:t,type:n,success:!1,error:`Unknown message type: ${n}`}}}catch(r){let o=r instanceof Error?r.message:String(r);return{id:t,type:n,success:!1,error:o}}}var mn=q(require("vscode"));function nt(e){switch(e){case mn.ColorThemeKind.Light:case mn.ColorThemeKind.HighContrastLight:return"light";case mn.ColorThemeKind.Dark:case mn.ColorThemeKind.HighContrast:default:return"dark"}}var Me=q(require("vscode")),ZS=e=>{let s="",t=!1,n=null,i=!1,r=!1,o=!1;for(let a=0;a<e.length;a++){let c=e[a],l=e[a+1];if(r){c===`
`&&(r=!1,s+=c);continue}if(o){c==="*"&&l==="/"&&(o=!1,a++);continue}if(t){if(s+=c,i){i=!1;continue}if(c==="\\"){i=!0;continue}n&&c===n&&(t=!1,n=null);continue}if(c==="/"&&l==="/"){r=!0,a++;continue}if(c==="/"&&l==="*"){o=!0,a++;continue}if(c==='"'||c==="'"){t=!0,n=c,s+=c;continue}s+=c}return s},XS=e=>{let s="",t=!1,n=null,i=!1;for(let r=0;r<e.length;r++){let o=e[r];if(t){if(s+=o,i){i=!1;continue}if(o==="\\"){i=!0;continue}n&&o===n&&(t=!1,n=null);continue}if(o==='"'||o==="'"){t=!0,n=o,s+=o;continue}if(o===","){let a=r+1;for(;a<e.length&&/\s/.test(e[a]??"");)a++;let c=e[a];if(c==="}"||c==="]")continue}s+=o}return s},QS=e=>{try{let s=ZS(e),t=XS(s),n=JSON.parse(t);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}},pa=e=>Me.workspace.getConfiguration("workbench").get(e)||void 0,Ap=e=>e.trim().replace(/\s+/g," ").toLowerCase(),ek=e=>{let s=e.trim(),t=new Set([s]);return s.toLowerCase().startsWith("default ")&&t.add(s.slice(8)),Array.from(t)},tk=e=>{let s=ek(e).map(Ap);for(let t of Me.extensions.all){let i=t.packageJSON?.contributes?.themes;if(!Array.isArray(i))continue;let r=i.find(o=>o?.label&&s.includes(Ap(o.label)));if(r?.path)return{extension:t,theme:r}}return null},Rp=async e=>{let s=tk(e);if(!s)return null;try{let t=Me.Uri.joinPath(s.extension.extensionUri,s.theme.path),n=await Me.workspace.fs.readFile(t),i=new TextDecoder("utf-8").decode(n);return QS(i)}catch{return null}},Cp=(e,s)=>{let t=typeof e.name=="string"&&e.name.length>0?e.name:"VSCode Theme";return{...e,name:`${t} (${s})`}};async function Ot(){let e=pa("colorTheme"),s=pa("preferredLightColorTheme")||e,t=pa("preferredDarkColorTheme")||e,n=Me.window.activeColorTheme.kind===Me.ColorThemeKind.Light||Me.window.activeColorTheme.kind===Me.ColorThemeKind.HighContrastLight?"light":"dark",i=n==="light"?e:s,r=n==="dark"?e:t,[o,a]=await Promise.all([i?Rp(i):Promise.resolve(null),r?Rp(r):Promise.resolve(null)]),c=o??a,l=o??c,u=a??c;return!l&&!u?null:{light:l?Cp(l,"Light"):void 0,dark:u?Cp(u,"Dark"):void 0}}var Dr=q(require("vscode"));function Lt(e){let{webview:s,extensionUri:t,workspaceFolder:n,initialStatus:i,cliAvailable:r,panelType:o="chat",initialSessionId:a,viewMode:c="sidebar"}=e,l=Dr.Uri.joinPath(t,"dist","webview","assets","index.js"),u=s.asWebviewUri(l),d=nt(Dr.window.activeColorTheme.kind);return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${s.cspSource} 'unsafe-inline'; script-src ${s.cspSource} 'unsafe-inline' 'unsafe-eval'; connect-src * ws: wss: http: https:; img-src ${s.cspSource} data: https:; font-src ${s.cspSource} data:;">
  <style>
    html, body, #root { height: 100%; width: 100%; margin: 0; padding: 0; }
    body { 
      overflow: hidden; 
      background: var(--vscode-editor-background, var(--vscode-sideBar-background)); 
      font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
      color: var(--vscode-foreground);
    }
    
    /* Initial loading screen styles - uses VS Code theme variables */
    #initial-loading {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      z-index: 9999;
      background: var(--vscode-editor-background, var(--vscode-sideBar-background));
      transition: opacity 0.3s ease-out;
    }
    #initial-loading.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    /* Logo colors use VS Code foreground color */
    #initial-loading .logo-stroke {
      stroke: var(--vscode-foreground);
    }
    #initial-loading .logo-fill {
      fill: var(--vscode-foreground);
      opacity: 0.15;
    }
    #initial-loading .logo-fill-solid {
      fill: var(--vscode-foreground);
    }
    #initial-loading .logo-fill-dim {
      fill: var(--vscode-foreground);
      opacity: 0.4;
    }
    /* Animation on inner logo only, like OpenChamberLogo.tsx */
    #initial-loading .logo-inner {
      animation: logoPulse 3s ease-in-out infinite;
    }
    #initial-loading .status-text {
      font-size: 13px;
      color: var(--vscode-descriptionForeground, var(--vscode-foreground));
      text-align: center;
    }
    #initial-loading .error-text {
      font-size: 12px;
      color: var(--vscode-errorForeground, #f48771);
      text-align: center;
      max-width: 280px;
    }
    @keyframes logoPulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }
  </style>
  <title>OpenChamber</title>
</head>
<body>
  <!-- Initial loading screen with simplified OpenChamber logo -->
  <div id="initial-loading">
    <svg class="logo" width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Left face -->
      <path class="logo-fill logo-stroke" d="M50 50 L8.432 26 L8.432 74 L50 98 Z" stroke-width="2" stroke-linejoin="round"/>
      <!-- Right face -->
      <path class="logo-fill logo-stroke" d="M50 50 L91.568 26 L91.568 74 L50 98 Z" stroke-width="2" stroke-linejoin="round"/>
      <!-- Top face (no fill, stroke only) -->
      <path class="logo-stroke" d="M50 2 L8.432 26 L50 50 L91.568 26 Z" fill="none" stroke-width="2" stroke-linejoin="round"/>
      
      <!-- OpenCode logo on top face with pulse animation -->
      <g class="logo-inner" transform="matrix(0.866, 0.5, -0.866, 0.5, 50, 26) scale(0.75)">
        <path class="logo-fill-solid" fill-rule="evenodd" clip-rule="evenodd" d="M-16 -20 L16 -20 L16 20 L-16 20 Z M-8 -12 L-8 12 L8 12 L8 -12 Z"/>
        <path class="logo-fill-dim" d="M-8 -4 L8 -4 L8 12 L-8 12 Z"/>
      </g>
    </svg>
    <div class="status-text" id="loading-status">
      ${i==="connecting"?"Starting OpenCode API\u2026":i==="connected"?"Initializing\u2026":"Connecting\u2026"}
    </div>
    ${r?"":'<div class="error-text">OpenCode CLI not found. Please install it first.</div>'}
  </div>
  
  <div id="root"></div>
  <script>
    // Polyfill process for Node.js modules running in browser
    window.process = window.process || { env: { NODE_ENV: 'production' }, platform: '', version: '', browser: true };

    window.__VSCODE_CONFIG__ = {
      workspaceFolder: "${n.replace(/\\/g,"\\\\")}",
      theme: "${d}",
      connectionStatus: "${i}",
      cliAvailable: ${r},
      panelType: "${o}",
      viewMode: "${c}",
      initialSessionId: ${a?`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:"null"},
    };
    window.__OPENCHAMBER_HOME__ = "${n.replace(/\\/g,"\\\\")}";
    
    // Handle connection status updates to update loading screen
    window.addEventListener('message', function(event) {
      var msg = event.data;
      if (msg && msg.type === 'connectionStatus') {
        var statusEl = document.getElementById('loading-status');
        if (statusEl) {
          if (msg.status === 'connecting') {
            statusEl.textContent = 'Starting OpenCode API\u2026';
            statusEl.classList.remove('error-text');
          } else if (msg.status === 'connected') {
            statusEl.textContent = 'Connected!';
            statusEl.classList.remove('error-text');
          } else if (msg.status === 'error') {
            statusEl.textContent = msg.error || 'Connection error';
            statusEl.classList.add('error-text');
          } else {
            statusEl.textContent = 'Reconnecting\u2026';
            statusEl.classList.remove('error-text');
          }
        }
      }
    });
  </script>
  <script type="module" src="${u}"></script>
</body>
</html>`}var yn=class{constructor(s,t,n){this._context=s;this._extensionUri=t;this._openCodeManager=n}static viewType="openchamber.chatView";_view;isVisible(){return this._view?.visible??!1}_cachedStatus="connecting";_cachedError;_sseCounter=0;_sseStreams=new Map;_sseHeartbeats=new Map;resolveWebviewView(s){this._view=s;let t=zt.Uri.joinPath(this._extensionUri,"dist");s.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri,t]},s.webview.html=this._getHtmlForWebview(s.webview),this.updateTheme(zt.window.activeColorTheme.kind),this._sendCachedState(),s.webview.onDidReceiveMessage(async n=>{if(n.type==="restartApi"){await this._openCodeManager?.restart();return}if(n.type==="api:sse:start"){let r=await this._startSseProxy(n);s.webview.postMessage(r);return}if(n.type==="api:sse:stop"){let r=await this._stopSseProxy(n);s.webview.postMessage(r);return}let i=await As(n,{manager:this._openCodeManager,context:this._context});s.webview.postMessage(i)})}updateTheme(s){if(this._view){let t=nt(s);Ot().then(n=>{this._view?.webview.postMessage({type:"themeChange",theme:{kind:t,shikiThemes:n}})})}}updateConnectionStatus(s,t){this._cachedStatus=s,this._cachedError=t,this._sendCachedState()}addTextToInput(s){this._view&&(this._view.show(!0),this._view.webview.postMessage({type:"command",command:"addToContext",payload:{text:s}}))}createNewSessionWithPrompt(s){this._view&&(this._view.show(!0),this._view.webview.postMessage({type:"command",command:"createSessionWithPrompt",payload:{prompt:s}}))}createNewSession(){this._view&&(this._view.show(!0),this._view.webview.postMessage({type:"command",command:"newSession"}))}showSettings(){this._view&&(this._view.show(!0),this._view.webview.postMessage({type:"command",command:"showSettings"}))}postMessage(s){this._view&&this._view.webview.postMessage(s)}_sendCachedState(){this._view&&this._view.webview.postMessage({type:"connectionStatus",status:this._cachedStatus,error:this._cachedError})}_buildSseHeaders(s){return{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive",...s||{}}}_collectHeaders(s){let t={};return s.forEach((n,i)=>{t[i]=n}),t}async _startSseProxy(s){let{id:t,type:n,payload:i}=s,r=this._openCodeManager?.getApiUrl(),{path:o,headers:a}=i||{},c=typeof o=="string"&&o.trim().length>0?o.trim():"/event",l=c==="/event"||c==="/global/event";if(!r)return{id:t,type:n,success:!0,data:{status:503,headers:{"content-type":"application/json"},streamId:null}};let u=`sse_${++this._sseCounter}_${Date.now()}`,d=new AbortController,h=`${r.replace(/\/+$/,"")}/`,f=new URL(c.replace(/^\/+/,""),h).toString(),p,g=!1,y=this._buildSseHeaders(a||{});try{if(p=await fetch(f,{method:"GET",headers:y,signal:d.signal}),(!p.ok||!p.body)&&c==="/global/event"){let b=new URL("event",h).toString();p=await fetch(b,{method:"GET",headers:y,signal:d.signal}),p.ok&&p.body&&(g=!0)}}catch(b){let k=b instanceof Error?b.message:String(b);return{id:t,type:n,success:!0,data:{status:502,headers:{"content-type":"application/json"},streamId:null,error:k}}}let w=this._collectHeaders(p.headers),S=p.body;if(!p.ok||!S)return{id:t,type:n,success:!0,data:{status:p.status,headers:w,streamId:null,error:`SSE failed: ${p.status}`}};this._sseStreams.set(u,d);let m=this._openCodeManager?.getWorkingDirectory()||zt.workspace.workspaceFolders?.[0]?.uri.fsPath||"global";if(l){let b=setInterval(()=>{if(d.signal.aborted)return;let k=`${ik()}

`;this._view?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:k})},3e4);this._sseHeartbeats.set(u,b)}return(async()=>{try{let b=S.getReader(),k=new TextDecoder,v="";try{for(;;){let{done:A,value:R}=await b.read();if(A||d.signal.aborted)break;if(R&&R.length>0){let x=k.decode(R,{stream:!0});if(!x)continue;v+=l?x.replace(/\r\n/g,`
`):x;let P=v.split(`

`);if(v=P.pop()??"",P.length>0){let I=g?Pp(P,m):P,D=(l?Ip(I):I).map($=>`${$}

`).join("");this._view?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:D})}}}let E=k.decode();if(E&&(v+=l?E.replace(/\r\n/g,`
`):E),v)if(l){let A=g?Pp([v],m):[v],x=Ip(A).map(P=>`${P}

`).join("");this._view?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:x})}else this._view?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:v})}finally{try{b.releaseLock()}catch{}}this._view?.webview.postMessage({type:"api:sse:end",streamId:u})}catch(b){if(!d.signal.aborted){let k=b instanceof Error?b.message:String(b);this._view?.webview.postMessage({type:"api:sse:end",streamId:u,error:k})}}finally{this._sseStreams.delete(u);let b=this._sseHeartbeats.get(u);b&&(clearInterval(b),this._sseHeartbeats.delete(u))}})(),{id:t,type:n,success:!0,data:{status:p.status,headers:w,streamId:u}}}async _stopSseProxy(s){let{id:t,type:n,payload:i}=s,{streamId:r}=i||{};if(typeof r=="string"&&r.length>0){let o=this._sseStreams.get(r);o&&(o.abort(),this._sseStreams.delete(r));let a=this._sseHeartbeats.get(r);a&&(clearInterval(a),this._sseHeartbeats.delete(r))}return{id:t,type:n,success:!0,data:{stopped:!0}}}_getHtmlForWebview(s){let t=zt.workspace.workspaceFolders?.[0]?.uri.fsPath||"",n=this._cachedStatus,i=this._openCodeManager?.isCliAvailable()??!1;return Lt({webview:s,extensionUri:this._extensionUri,workspaceFolder:t,initialStatus:n,cliAvailable:i})}},sk=e=>{if(!e)return null;let s=e.split(`
`).filter(n=>n.startsWith("data:")).map(n=>n.slice(5).replace(/^\s/,""));if(s.length===0)return null;let t=s.join(`
`).trim();if(!t)return null;try{let n=JSON.parse(t);if(n&&typeof n=="object"){let i=n,r=i.payload;return r&&typeof r=="object"?r:i}return null}catch{return null}},nk=e=>{if(!e||typeof e!="object")return null;let s=e.type,t=e.properties;if(s==="session.status"){let n=t?.status,i=t?.sessionID??t?.sessionId,r=n?.type;if(typeof i=="string"&&i.length>0&&typeof r=="string")return{sessionId:i,phase:r==="busy"||r==="retry"?"busy":"idle"}}if(s==="message.updated"){let n=t?.info,i=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId,r=n?.role,o=n?.finish;if(typeof i=="string"&&i.length>0&&r==="assistant"&&o==="stop")return{sessionId:i,phase:"cooldown"}}if(s==="message.part.updated"){let n=t?.info,i=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId,r=n?.role,o=n?.finish;if(typeof i=="string"&&i.length>0&&r==="assistant"&&o==="stop")return{sessionId:i,phase:"cooldown"}}if(s==="session.idle"){let n=t?.sessionID??t?.sessionId;if(typeof n=="string"&&n.length>0)return{sessionId:n,phase:"idle"}}return null},rk=e=>`data: ${JSON.stringify({type:"openchamber:session-activity",properties:{sessionId:e.sessionId,phase:e.phase}})}`,ik=()=>`data: ${JSON.stringify({type:"openchamber:heartbeat",timestamp:Date.now()})}`,ok=e=>{if(!e)return null;let s=e.split(`
`),t=[],n;for(let r of s){if(r.startsWith("data:")){t.push(r.slice(5).replace(/^\s/,""));continue}if(r.startsWith("id:")){let o=r.slice(3).trim();o&&(n=o)}}if(t.length===0)return null;let i=t.join(`
`).trim();if(!i)return null;try{let r=JSON.parse(i);if(!r||typeof r!="object")return null;let o=r,a=o.payload,c=a&&typeof a=="object"?a:o;return n?{id:n,payload:c}:{payload:c}}catch{return null}},Pp=(e,s)=>{let t=typeof s=="string"&&s.trim().length>0?s.trim().replace(/\\/g,"/"):"global";return e.map(n=>{let i=ok(n);if(!i)return n;let r={directory:t,payload:i.payload};return`${i.id?`id: ${i.id}
`:""}data: ${JSON.stringify(r)}`})},Ip=e=>{let s=[];for(let t of e){s.push(t);let n=nk(sk(t));n&&s.push(rk(n))}return s};var Vt=q(require("vscode"));var _p=q(require("vscode")),wn=require("child_process"),Mr=class{_process=null;_binaryPath=null;constructor(s){}resolveBinary(){if(this._binaryPath)return this._binaryPath;let s=_p.workspace.getConfiguration("openchamber").get("claudeCodeBinary")?.trim();if(s)return this._binaryPath=s,this._binaryPath;try{let t=process.platform==="win32"?"where claude":"which claude",i=(0,wn.execSync)(t,{encoding:"utf-8",timeout:5e3}).trim().split(/\r?\n/)[0]?.trim();if(i)return this._binaryPath=i,this._binaryPath}catch{}return null}isAvailable(){return this.resolveBinary()!==null}getVersion(){let s=this.resolveBinary();if(!s)return null;try{return(0,wn.execSync)(`"${s}" --version`,{encoding:"utf-8",timeout:5e3}).trim()}catch{return null}}sendPrompt(s,t){let n=this.resolveBinary();if(!n){t.onError("Claude Code CLI not found. Install it or set openchamber.claudeCodeBinary in settings.");return}let i=["--output-format","stream-json","--input-format","stream-json","--verbose"];t.sessionId&&i.push("--resume",t.sessionId);let r={...process.env};delete r.CLAUDECODE,delete r.CLAUDE_CODE_SSE_PORT;let o=process.platform==="win32",a=(0,wn.spawn)(n,i,{cwd:t.cwd,env:r,stdio:["pipe","pipe","pipe"],shell:o});this._process=a;let c={type:"user",session_id:t.sessionId??"",message:{role:"user",content:[{type:"text",text:s}]}};a.stdin?.write(JSON.stringify(c)+`
`);let l="",u="";a.stdout?.on("data",d=>{u+=d.toString();let h=u.split(`
`);u=h.pop()??"";for(let f of h){let p=f.trim();if(p)try{let g=JSON.parse(p);g.type==="result"&&a.stdin&&!a.stdin.destroyed&&a.stdin.end(),t.onEvent(g)}catch{t.onEvent({type:"text",content:p})}}}),a.stderr?.on("data",d=>{l+=d.toString()}),a.on("close",d=>{if(u.trim())try{let h=JSON.parse(u.trim());t.onEvent(h)}catch{t.onEvent({type:"text",content:u.trim()})}this._process=null,d!==0&&d!==null&&l.trim()?t.onError(l.trim()):t.onDone()}),a.on("error",d=>{this._process=null,t.onError(d.message)})}abort(){this._process&&(this._process.kill("SIGTERM"),this._process=null)}dispose(){this.abort()}};var ga="openchamber.claudeCode.state",ak=100,Tp=500,bn=class{constructor(s,t){this._context=s;this._extensionUri=t;this._claudeManager=new Mr(s);let n=this._loadState();n&&(this._conversationId=n.conversationId,this._messages=n.messages)}static viewType="openchamber.claudeCodeView";_view;_conversationId=null;_claudeManager;_messages=[];_currentAssistantText="";_currentToolBlocks=new Map;resolveWebviewView(s){this._view=s;let t=Vt.Uri.joinPath(this._extensionUri,"dist");s.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri,t]},s.webview.html=this._getHtmlForWebview(s.webview),this.updateTheme(Vt.window.activeColorTheme.kind);let n=this._claudeManager.isAvailable();s.webview.postMessage({type:"claude:availability",available:n,version:n?this._claudeManager.getVersion():null}),this._messages.length>0&&s.webview.postMessage({type:"claude:restore",messages:this._messages,conversationId:this._conversationId}),s.webview.onDidReceiveMessage(i=>{switch(i.type){case"claude:send":{let r=i.payload?.prompt;if(!r?.trim())return;this._handleSendPrompt(r.trim());break}case"claude:abort":{this._claudeManager.abort(),this._view?.webview.postMessage({type:"claude:aborted"});break}case"claude:newConversation":{this._conversationId=null,this._messages=[],this._currentAssistantText="",this._currentToolBlocks.clear(),this._clearState(),this._view?.webview.postMessage({type:"claude:conversationReset"});break}case"claude:checkAvailability":{let r=this._claudeManager.isAvailable();this._view?.webview.postMessage({type:"claude:availability",available:r,version:r?this._claudeManager.getVersion():null});break}}}),s.onDidDispose(()=>{this._claudeManager.abort(),this._view=void 0})}updateTheme(s){if(this._view){let t=nt(s);Ot().then(n=>{this._view?.webview.postMessage({type:"themeChange",theme:{kind:t,shikiThemes:n}})})}}newConversation(){this._conversationId=null,this._messages=[],this._currentAssistantText="",this._currentToolBlocks.clear(),this._clearState(),this._claudeManager.abort(),this._view&&(this._view.show(!0),this._view.webview.postMessage({type:"claude:conversationReset"}))}dispose(){this._claudeManager.dispose()}_loadState(){return this._context.globalState.get(ga)??null}_saveState(){let t=this._messages.slice(-ak).map(n=>({role:n.role,content:n.content.map(i=>i.type==="tool_use"?{...i,result:i.result?i.result.slice(0,Tp):i.result,error:i.error?i.error.slice(0,Tp):i.error}:i)}));this._context.globalState.update(ga,{conversationId:this._conversationId,messages:t})}_clearState(){this._context.globalState.update(ga,void 0)}_handleSendPrompt(s){let t=Vt.workspace.workspaceFolders?.[0]?.uri.fsPath||process.cwd();this._messages.push({role:"user",content:[{type:"text",text:s}]}),this._currentAssistantText="",this._currentToolBlocks.clear(),this._claudeManager.sendPrompt(s,{cwd:t,sessionId:this._conversationId??void 0,onEvent:n=>{typeof n.session_id=="string"&&n.session_id&&(this._conversationId=n.session_id),this._trackEvent(n),this._view?.webview.postMessage({type:"claude:event",data:n})},onDone:()=>{this._finalizeAssistantMessage(),this._saveState(),this._view?.webview.postMessage({type:"claude:done"})},onError:n=>{this._finalizeAssistantMessage(),this._saveState(),this._view?.webview.postMessage({type:"claude:error",error:n})}})}_trackEvent(s){if(s.type==="stream_event"){let t=s.event;if(!t)return;if(t.type==="content_block_delta"&&t.delta?.type==="text_delta"&&typeof t.delta.text=="string"&&(this._currentAssistantText+=t.delta.text),t.type==="content_block_start"&&t.content_block?.type==="tool_use"){let n=t.content_block.id??`tool-${Date.now()}`;this._currentToolBlocks.set(n,{type:"tool_use",id:n,name:t.content_block.name??"unknown",input:{}})}}if(s.type==="assistant"){let t=s.message;if(t?.content){this._currentAssistantText="",this._currentToolBlocks.clear();for(let n of t.content)n.type==="text"&&typeof n.text=="string"?this._currentAssistantText+=n.text:n.type==="tool_use"&&n.id&&n.name&&this._currentToolBlocks.set(n.id,{type:"tool_use",id:n.id,name:n.name,input:n.input??{}})}}if(s.type==="tool_result"){let t=s.tool_use_id,n=s.content,i=s.is_error;if(t&&this._currentToolBlocks.has(t)){let r=this._currentToolBlocks.get(t),o="";typeof n=="string"?o=n:Array.isArray(n)&&(o=n.filter(a=>a.type==="text"&&typeof a.text=="string").map(a=>a.text).join("")),i?r.error=o||"Tool error":r.result=o}}s.type==="result"&&typeof s.result=="string"&&(this._currentAssistantText=s.result),s.type==="text"&&typeof s.content=="string"&&(this._currentAssistantText+=s.content+`
`)}_finalizeAssistantMessage(){let s=[];this._currentAssistantText.trim()&&s.push({type:"text",text:this._currentAssistantText});for(let t of this._currentToolBlocks.values())s.push(t);s.length>0&&this._messages.push({role:"assistant",content:s}),this._currentAssistantText="",this._currentToolBlocks.clear()}_getHtmlForWebview(s){let t=Vt.workspace.workspaceFolders?.[0]?.uri.fsPath||"";return Lt({webview:s,extensionUri:this._extensionUri,workspaceFolder:t,initialStatus:"connected",cliAvailable:!0,panelType:"claudeCode"})}};var $e=q(require("vscode"));var $r=class e{constructor(s,t,n){this._context=s;this._extensionUri=t;this._openCodeManager=n}static viewType="openchamber.agentManager";_panel;_cachedStatus="connecting";_cachedError;_sseCounter=0;_sseStreams=new Map;_sseHeartbeats=new Map;createOrShow(){if(this._panel){this._panel.reveal($e.ViewColumn.One);return}let s=$e.Uri.joinPath(this._extensionUri,"dist");this._panel=$e.window.createWebviewPanel(e.viewType,"Agent Manager",$e.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[this._extensionUri,s]}),this._panel.iconPath={light:$e.Uri.joinPath(this._extensionUri,"assets","icon.svg"),dark:$e.Uri.joinPath(this._extensionUri,"assets","icon-titlebar.svg")},this._panel.webview.html=this._getHtmlForWebview(this._panel.webview),this.updateTheme($e.window.activeColorTheme.kind),this._sendCachedState(),this._panel.onDidDispose(()=>{for(let t of this._sseStreams.values())t.abort();this._sseStreams.clear();for(let t of this._sseHeartbeats.values())clearInterval(t);this._sseHeartbeats.clear(),this._panel=void 0},null,this._context.subscriptions),this._panel.webview.onDidReceiveMessage(async t=>{if(t.type==="restartApi"){await this._openCodeManager?.restart();return}if(t.type==="api:sse:start"){let i=await this._startSseProxy(t);this._panel?.webview.postMessage(i);return}if(t.type==="api:sse:stop"){let i=await this._stopSseProxy(t);this._panel?.webview.postMessage(i);return}let n=await As(t,{manager:this._openCodeManager,context:this._context});this._panel?.webview.postMessage(n)},null,this._context.subscriptions)}updateTheme(s){if(this._panel){let t=nt(s);Ot().then(n=>{this._panel?.webview.postMessage({type:"themeChange",theme:{kind:t,shikiThemes:n}})})}}updateConnectionStatus(s,t){this._cachedStatus=s,this._cachedError=t,this._sendCachedState()}_sendCachedState(){this._panel&&this._panel.webview.postMessage({type:"connectionStatus",status:this._cachedStatus,error:this._cachedError})}_buildSseHeaders(s){return{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive",...s||{}}}_collectHeaders(s){let t={};return s.forEach((n,i)=>{t[i]=n}),t}async _startSseProxy(s){let{id:t,type:n,payload:i}=s,r=this._openCodeManager?.getApiUrl(),{path:o,headers:a}=i||{},c=typeof o=="string"&&o.trim().length>0?o.trim():"/event",l=c==="/event"||c==="/global/event";if(!r)return{id:t,type:n,success:!0,data:{status:503,headers:{"content-type":"application/json"},streamId:null}};let u=`sse_${++this._sseCounter}_${Date.now()}`,d=new AbortController,h=`${r.replace(/\/+$/,"")}/`,f=new URL(c.replace(/^\/+/,""),h).toString(),p,g=!1,y=this._buildSseHeaders(a||{});try{if(p=await fetch(f,{method:"GET",headers:y,signal:d.signal}),(!p.ok||!p.body)&&c==="/global/event"){let b=new URL("event",h).toString();p=await fetch(b,{method:"GET",headers:y,signal:d.signal}),p.ok&&p.body&&(g=!0)}}catch(b){let k=b instanceof Error?b.message:String(b);return{id:t,type:n,success:!0,data:{status:502,headers:{"content-type":"application/json"},streamId:null,error:k}}}let w=this._collectHeaders(p.headers),S=p.body;if(!p.ok||!S)return{id:t,type:n,success:!0,data:{status:p.status,headers:w,streamId:null,error:`SSE failed: ${p.status}`}};this._sseStreams.set(u,d);let m=this._openCodeManager?.getWorkingDirectory()||$e.workspace.workspaceFolders?.[0]?.uri.fsPath||"global";if(l){let b=setInterval(()=>{if(d.signal.aborted)return;let k=`${dk()}

`;this._panel?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:k})},3e4);this._sseHeartbeats.set(u,b)}return(async()=>{try{let b=S.getReader(),k=new TextDecoder,v="";try{for(;;){let{done:A,value:R}=await b.read();if(A||d.signal.aborted)break;if(R&&R.length>0){let x=k.decode(R,{stream:!0});if(!x)continue;v+=l?x.replace(/\r\n/g,`
`):x;let P=v.split(`

`);if(v=P.pop()??"",P.length>0){let I=g?xp(P,m):P,D=(l?Op(I):I).map($=>`${$}

`).join("");this._panel?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:D})}}}let E=k.decode();if(E&&(v+=l?E.replace(/\r\n/g,`
`):E),v)if(l){let A=g?xp([v],m):[v],x=Op(A).map(P=>`${P}

`).join("");this._panel?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:x})}else this._panel?.webview.postMessage({type:"api:sse:chunk",streamId:u,chunk:v})}finally{try{b.releaseLock()}catch{}}this._panel?.webview.postMessage({type:"api:sse:end",streamId:u})}catch(b){if(!d.signal.aborted){let k=b instanceof Error?b.message:String(b);this._panel?.webview.postMessage({type:"api:sse:end",streamId:u,error:k})}}finally{this._sseStreams.delete(u);let b=this._sseHeartbeats.get(u);b&&(clearInterval(b),this._sseHeartbeats.delete(u))}})(),{id:t,type:n,success:!0,data:{status:p.status,headers:w,streamId:u}}}async _stopSseProxy(s){let{id:t,type:n,payload:i}=s,{streamId:r}=i||{};if(typeof r=="string"&&r.length>0){let o=this._sseStreams.get(r);o&&(o.abort(),this._sseStreams.delete(r));let a=this._sseHeartbeats.get(r);a&&(clearInterval(a),this._sseHeartbeats.delete(r))}return{id:t,type:n,success:!0,data:{stopped:!0}}}_getHtmlForWebview(s){let t=$e.workspace.workspaceFolders?.[0]?.uri.fsPath||"",n=this._openCodeManager?.isCliAvailable()??!1;return Lt({webview:s,extensionUri:this._extensionUri,workspaceFolder:t,initialStatus:this._cachedStatus,cliAvailable:n,panelType:"agentManager"})}},ck=e=>{if(!e)return null;let s=e.split(`
`).filter(n=>n.startsWith("data:")).map(n=>n.slice(5).replace(/^\s/,""));if(s.length===0)return null;let t=s.join(`
`).trim();if(!t)return null;try{let n=JSON.parse(t);if(n&&typeof n=="object"){let i=n,r=i.payload;return r&&typeof r=="object"?r:i}return null}catch{return null}},lk=e=>{if(!e||typeof e!="object")return null;let s=e.type,t=e.properties;if(s==="session.status"){let n=t?.status,i=t?.sessionID??t?.sessionId,r=n?.type;if(typeof i=="string"&&i.length>0&&typeof r=="string")return{sessionId:i,phase:r==="busy"||r==="retry"?"busy":"idle"}}if(s==="message.updated"){let n=t?.info,i=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId,r=n?.role,o=n?.finish;if(typeof i=="string"&&i.length>0&&r==="assistant"&&o==="stop")return{sessionId:i,phase:"cooldown"}}if(s==="message.part.updated"){let n=t?.info,i=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId,r=n?.role,o=n?.finish;if(typeof i=="string"&&i.length>0&&r==="assistant"&&o==="stop")return{sessionId:i,phase:"cooldown"}}if(s==="session.idle"){let n=t?.sessionID??t?.sessionId;if(typeof n=="string"&&n.length>0)return{sessionId:n,phase:"idle"}}return null},uk=e=>`data: ${JSON.stringify({type:"openchamber:session-activity",properties:{sessionId:e.sessionId,phase:e.phase}})}`,dk=()=>`data: ${JSON.stringify({type:"openchamber:heartbeat",timestamp:Date.now()})}`,fk=e=>{if(!e)return null;let s=e.split(`
`),t=[],n;for(let r of s){if(r.startsWith("data:")){t.push(r.slice(5).replace(/^\s/,""));continue}if(r.startsWith("id:")){let o=r.slice(3).trim();o&&(n=o)}}if(t.length===0)return null;let i=t.join(`
`).trim();if(!i)return null;try{let r=JSON.parse(i);if(!r||typeof r!="object")return null;let o=r,a=o.payload,c=a&&typeof a=="object"?a:o;return n?{id:n,payload:c}:{payload:c}}catch{return null}},xp=(e,s)=>{let t=typeof s=="string"&&s.trim().length>0?s.trim().replace(/\\/g,"/"):"global";return e.map(n=>{let i=fk(n);if(!i)return n;let r={directory:t,payload:i.payload};return`${i.id?`id: ${i.id}
`:""}data: ${JSON.stringify(r)}`})},Op=e=>{let s=[];for(let t of e){s.push(t);let n=lk(ck(t));n&&s.push(uk(n))}return s};var je=q(require("vscode"));var jr=class e{constructor(s,t,n){this._context=s;this._extensionUri=t;this._openCodeManager=n}static viewType="openchamber.sessionEditor";_cachedStatus="connecting";_cachedError;_sseCounter=0;_panels=new Map;createOrShowNewSession(){let s=`new_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;this._createPanel(s,"New Session",null)}createOrShow(s,t){if(!s||typeof s!="string")return;let n=t&&t.trim().length>0?t.trim():"Session",i=this._panels.get(s);if(i){i.panel.title=n,i.panel.reveal(i.panel.viewColumn??je.ViewColumn.Active);return}this._createPanel(s,n,s)}_createPanel(s,t,n){let i=je.Uri.joinPath(this._extensionUri,"dist"),r=je.window.createWebviewPanel(e.viewType,t,je.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[this._extensionUri,i]});r.iconPath={light:je.Uri.joinPath(this._extensionUri,"assets","icon.svg"),dark:je.Uri.joinPath(this._extensionUri,"assets","icon-titlebar.svg")};let o={panel:r,sseStreams:new Map,sseHeartbeats:new Map};this._panels.set(s,o),r.webview.html=this._getHtmlForWebview(r.webview,n),this.updateTheme(je.window.activeColorTheme.kind),this._sendCachedStateToPanel(o),r.onDidDispose(()=>{this._disposePanel(s)},null,this._context.subscriptions),r.webview.onDidReceiveMessage(async a=>{if(a.type==="restartApi"){await this._openCodeManager?.restart();return}if(a.type==="api:sse:start"){let l=await this._startSseProxy(a,o);o.panel.webview.postMessage(l);return}if(a.type==="api:sse:stop"){let l=await this._stopSseProxy(a,o);o.panel.webview.postMessage(l);return}let c=await As(a,{manager:this._openCodeManager,context:this._context});o.panel.webview.postMessage(c)},null,this._context.subscriptions)}updateTheme(s){let t=nt(s);Ot().then(n=>{for(let i of this._panels.values())i.panel.webview.postMessage({type:"themeChange",theme:{kind:t,shikiThemes:n}})})}updateConnectionStatus(s,t){this._cachedStatus=s,this._cachedError=t;for(let n of this._panels.values())this._sendCachedStateToPanel(n)}_sendCachedStateToPanel(s){s.panel.webview.postMessage({type:"connectionStatus",status:this._cachedStatus,error:this._cachedError})}_disposePanel(s){let t=this._panels.get(s);if(t){for(let n of t.sseStreams.values())n.abort();t.sseStreams.clear();for(let n of t.sseHeartbeats.values())clearInterval(n);t.sseHeartbeats.clear(),this._panels.delete(s)}}_buildSseHeaders(s){return{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive",...s||{}}}_collectHeaders(s){let t={};return s.forEach((n,i)=>{t[i]=n}),t}async _startSseProxy(s,t){let{id:n,type:i,payload:r}=s,o=this._openCodeManager?.getApiUrl(),{path:a,headers:c}=r||{},l=typeof a=="string"&&a.trim().length>0?a.trim():"/event",u=l==="/event"||l==="/global/event";if(!o)return{id:n,type:i,success:!0,data:{status:503,headers:{"content-type":"application/json"},streamId:null}};let d=`sse_${++this._sseCounter}_${Date.now()}`,h=new AbortController,f=`${o.replace(/\/+$/,"")}/`,p=new URL(l.replace(/^\/+/,""),f).toString(),g,y=!1,w=this._buildSseHeaders(c||{});try{if(g=await fetch(p,{method:"GET",headers:w,signal:h.signal}),(!g.ok||!g.body)&&l==="/global/event"){let k=new URL("event",f).toString();g=await fetch(k,{method:"GET",headers:w,signal:h.signal}),g.ok&&g.body&&(y=!0)}}catch(k){let v=k instanceof Error?k.message:String(k);return{id:n,type:i,success:!0,data:{status:502,headers:{"content-type":"application/json"},streamId:null,error:v}}}let S=this._collectHeaders(g.headers),m=g.body;if(!g.ok||!m)return{id:n,type:i,success:!0,data:{status:g.status,headers:S,streamId:null,error:`SSE failed: ${g.status}`}};t.sseStreams.set(d,h);let b=this._openCodeManager?.getWorkingDirectory()||je.workspace.workspaceFolders?.[0]?.uri.fsPath||"global";if(u){let k=setInterval(()=>{if(h.signal.aborted)return;let v=`${hk()}

`;t.panel.webview.postMessage({type:"api:sse:chunk",streamId:d,chunk:v})},3e4);t.sseHeartbeats.set(d,k)}return(async()=>{try{let k=m.getReader(),v=new TextDecoder,E="";try{for(;;){let{done:R,value:x}=await k.read();if(R||h.signal.aborted)break;if(x&&x.length>0){let P=v.decode(x,{stream:!0});if(!P)continue;E+=u?P.replace(/\r\n/g,`
`):P;let I=E.split(`

`);if(E=I.pop()??"",I.length>0){let B=y?Np(I,b):I,$=(u?Lp(B):B).map(U=>`${U}

`).join("");t.panel.webview.postMessage({type:"api:sse:chunk",streamId:d,chunk:$})}}}let A=v.decode();if(A&&(E+=u?A.replace(/\r\n/g,`
`):A),E)if(u){let R=y?Np([E],b):[E],P=Lp(R).map(I=>`${I}

`).join("");t.panel.webview.postMessage({type:"api:sse:chunk",streamId:d,chunk:P})}else t.panel.webview.postMessage({type:"api:sse:chunk",streamId:d,chunk:E})}finally{try{k.releaseLock()}catch{}}t.panel.webview.postMessage({type:"api:sse:end",streamId:d})}catch(k){if(!h.signal.aborted){let v=k instanceof Error?k.message:String(k);t.panel.webview.postMessage({type:"api:sse:end",streamId:d,error:v})}}finally{t.sseStreams.delete(d);let k=t.sseHeartbeats.get(d);k&&(clearInterval(k),t.sseHeartbeats.delete(d))}})(),{id:n,type:i,success:!0,data:{status:g.status,headers:S,streamId:d}}}async _stopSseProxy(s,t){let{id:n,type:i,payload:r}=s,{streamId:o}=r||{};if(typeof o=="string"&&o.length>0){let a=t.sseStreams.get(o);a&&(a.abort(),t.sseStreams.delete(o));let c=t.sseHeartbeats.get(o);c&&(clearInterval(c),t.sseHeartbeats.delete(o))}return{id:n,type:i,success:!0,data:{stopped:!0}}}_getHtmlForWebview(s,t){let n=je.workspace.workspaceFolders?.[0]?.uri.fsPath||"",i=this._cachedStatus,r=this._openCodeManager?.isCliAvailable()??!1;return Lt({webview:s,extensionUri:this._extensionUri,workspaceFolder:n,initialStatus:i,cliAvailable:r,panelType:"chat",initialSessionId:t??void 0,viewMode:"editor"})}},Dp=e=>{if(!e)return null;let s=e.split(`
`).filter(n=>n.startsWith("data:")).map(n=>n.slice(5).replace(/^\s/,""));if(s.length===0)return null;let t=s.join(`
`).trim();if(!t)return null;try{let n=JSON.parse(t);if(n&&typeof n=="object"){let i=n,r=i.payload;return r&&typeof r=="object"?r:i}return null}catch{return null}},pk=e=>{if(!e||typeof e!="object")return null;let s=e.type,t=e.properties;if(s==="session.status"){let n=t?.status,i=t?.sessionID??t?.sessionId,r=n?.type;return typeof i=="string"&&i.length>0&&typeof r=="string"?{sessionId:i,phase:r==="busy"||r==="retry"?"busy":"idle"}:null}if(s==="message.updated"){let n=e.info,i=n?.role,r=n?.finish,o=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId;return typeof o=="string"&&o.length>0&&i==="assistant"&&r==="stop"?{sessionId:o,phase:"cooldown"}:null}if(s==="message.complete"){let n=e.info,i=n?.role,r=n?.finish,o=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId;return typeof o=="string"&&o.length>0&&i==="assistant"&&r==="stop"?{sessionId:o,phase:"cooldown"}:null}if(s==="session.idle"){let n=t?.sessionID??t?.sessionId;return typeof n=="string"&&n.length>0?{sessionId:n,phase:"idle"}:null}return null},gk=e=>["event: message",`data: ${JSON.stringify({type:"openchamber:session-activity",properties:{sessionId:e.sessionId,phase:e.phase,at:Date.now()}})}`].join(`
`),hk=()=>["event: message",`data: ${JSON.stringify({type:"openchamber:heartbeat",properties:{at:Date.now()}})}`].join(`
`),Lp=e=>{let s=[];for(let t of e){s.push(t);let n=pk(Dp(t));n&&s.push(gk(n))}return s},Np=(e,s)=>e.map(t=>{let n=Dp(t),i=n?{directory:s,payload:n}:{directory:s,payload:null},r=t.split(`
`).filter(o=>!o.startsWith("data:"));return r.push(`data: ${JSON.stringify(i)}`),r.join(`
`)});var Fr=new Map,Rs=new Map,mk=2e3,Cs=null,Yt=null,yk=(e,s)=>{if(!e)return;let t=Rs.get(e);if(t&&(clearTimeout(t),Rs.delete(e)),Fr.get(e)?.phase!==s&&(Fr.set(e,{phase:s,updatedAt:Date.now()}),Yt&&Yt.postMessage({type:"openchamber:session-activity",properties:{sessionId:e,phase:s}}),s==="cooldown")){let i=setTimeout(()=>{Fr.get(e)?.phase==="cooldown"&&(Fr.set(e,{phase:"idle",updatedAt:Date.now()}),Yt&&Yt.postMessage({type:"openchamber:session-activity",properties:{sessionId:e,phase:"idle"}})),Rs.delete(e)},mk);Rs.set(e,i)}},wk=e=>{if(!e||typeof e!="object")return null;let s=e.type,t=e.properties??e;if(s==="session.status"){let n=t?.status,i=t?.sessionID??t?.sessionId,r=n?.type;if(typeof i=="string"&&i.length>0&&typeof r=="string")return{sessionId:i,phase:r==="busy"||r==="retry"?"busy":"idle"}}if(s==="message.updated"||s==="message.part.updated"){let n=t?.info,i=n?.sessionID??n?.sessionId??t?.sessionID??t?.sessionId,r=n?.role,o=n?.finish;if(typeof i=="string"&&i.length>0&&r==="assistant"&&o==="stop")return{sessionId:i,phase:"cooldown"}}if(s==="session.idle"){let n=t?.sessionID??t?.sessionId;if(typeof n=="string"&&n.length>0)return{sessionId:n,phase:"idle"}}return null},bk=e=>{if(!e)return null;let s=e.split(`
`),t=[];for(let i of s)i.startsWith("data:")&&t.push(i.slice(5).replace(/^\s/,""));if(t.length===0)return null;let n=t.join(`
`).trim();if(!n)return null;try{return JSON.parse(n)}catch{return null}},Sk=async(e,s=3e4)=>{let t=Date.now();for(;Date.now()-t<s;){let n=e.getApiUrl();if(n)try{let i=new URL(n);if(i.port)return parseInt(i.port,10)}catch{}await new Promise(i=>setTimeout(i,500))}return null},kk=(e,s)=>`${s.replace(/\/+$/,"")}${e}`,ha=async(e,s)=>{if(Cs)return;if(Yt=s,!await Sk(e)){console.warn("[VSCode:Activity] OpenCode port unavailable; will retry"),setTimeout(()=>ha(e,s),2e3);return}Cs=new AbortController;let n=Cs.signal,i=0;(async()=>{for(;!n.aborted;){i+=1;let o=null,a=null;try{let l=e.getApiUrl();if(!l)throw new Error("OpenCode API URL not available");let u=kk("/global/event",l);if(o=await fetch(u,{headers:{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},signal:n}),!o.ok||!o.body)throw new Error(`bad status ${o.status}`);console.log("[VSCode:Activity] connected");let d=new TextDecoder;a=o.body.getReader();let h="";for(;!n.aborted;){let{value:f,done:p}=await a.read();if(p)break;h+=d.decode(f,{stream:!0}).replace(/\r\n/g,`
`);let g;for(;(g=h.indexOf(`

`))!==-1;){let y=h.slice(0,g);h=h.slice(g+2);let w=bk(y);if(w){let S=wk(w);S&&yk(S.sessionId,S.phase)}}}}catch(l){if(n.aborted)return;console.warn("[VSCode:Activity] disconnected",l instanceof Error?l.message:l)}finally{try{a?await a.cancel():o?.body&&!o.body.locked&&await o.body.cancel()}catch{}}let c=Math.min(1e3*Math.pow(2,Math.min(i,5)),3e4);await new Promise(l=>setTimeout(l,c))}})()},ma=()=>{if(Cs){try{Cs.abort()}catch{}Cs=null,Yt=null;for(let e of Rs.values())clearTimeout(e);Rs.clear()}},Mp=e=>{Yt=e};var Te,Zt,Is,rt,ke,Nt,Ps=null,Br=null,vk="openchamber.settings",$p=e=>{if(typeof e!="number"||!Number.isFinite(e))return"(none)";try{return new Date(e).toISOString()}catch{return String(e)}},Ek=e=>typeof e!="number"||!Number.isFinite(e)?"(none)":`${Math.round(e/100)/10}s`;async function Ak(e){Nt=L.window.createOutputChannel("OpenChamber");let s=!1,t=()=>/\bcursor\b/i.test(L.env.appName),n=async()=>{let c=await L.commands.getCommands(!0),l=["workbench.action.moveViewToSecondarySideBar","workbench.action.moveViewToSecondarySidebar","workbench.action.moveFocusedViewToSecondarySideBar","workbench.action.moveFocusedViewToSecondarySidebar","workbench.action.moveViewToAuxiliaryBar","workbench.action.moveFocusedViewToAuxiliaryBar"];for(let d of l)if(c.includes(d))return d;return c.find(d=>{let h=d.toLowerCase();return h.includes("workbench.action")&&h.includes("move")&&h.includes("view")?h.includes("secondary")&&h.includes("side")&&h.includes("bar")||h.includes("auxiliary")&&h.includes("bar"):!1})||null},i=async()=>{let c=await n();if(!c)return"unsupported";try{return await L.commands.executeCommand("openchamber.chatView.focus"),await L.commands.executeCommand(c),"moved"}catch(l){return Nt?.appendLine(`[OpenChamber] Failed moving chat view to right sidebar (command=${c}): ${l instanceof Error?l.message:String(l)}`),"failed"}},r=async()=>{t()||e.globalState.get("openchamber.sidebarAutoMoveAttempted")||(await e.globalState.update("openchamber.sidebarAutoMoveAttempted",!0),!s&&(s=!0,setTimeout(()=>{(async()=>{try{await i()}finally{s=!1}})()},800)))},o=L.workspace.getConfiguration("openchamber"),a=o.get("apiUrl")||"";/^https?:\/\/localhost:4768\d\/?$/.test(a.trim())&&await o.update("apiUrl","",L.ConfigurationTarget.Global),ke=Aa(e),Te=new yn(e,e.extensionUri,ke),e.subscriptions.push(L.window.registerWebviewViewProvider(yn.viewType,Te,{webviewOptions:{retainContextWhenHidden:!0}})),Zt=new bn(e,e.extensionUri),e.subscriptions.push(L.window.registerWebviewViewProvider(bn.viewType,Zt,{webviewOptions:{retainContextWhenHidden:!0}})),e.subscriptions.push(L.commands.registerCommand("openchamber.openSidebar",async()=>{try{await L.commands.executeCommand("workbench.view.extension.openchamber")}catch(c){Nt?.appendLine(`[OpenChamber] workbench.view.extension.openchamber failed: ${c}`)}try{await L.commands.executeCommand("openchamber.chatView.focus")}catch(c){Nt?.appendLine(`[OpenChamber] openchamber.chatView.focus failed: ${c}`),L.window.showErrorMessage(`OpenChamber: Failed to open sidebar - ${c}`)}})),e.subscriptions.push(L.commands.registerCommand("openchamber.focusChat",async()=>{await L.commands.executeCommand("openchamber.chatView.focus")})),r(),Is=new $r(e,e.extensionUri,ke),rt=new jr(e,e.extensionUri,ke),e.subscriptions.push(L.commands.registerCommand("openchamber.openAgentManager",()=>{Is?.createOrShow()})),e.subscriptions.push(L.commands.registerCommand("openchamber.setActiveSession",(c,l)=>{if(typeof c=="string"&&c.trim().length>0){Ps=c.trim(),Br=typeof l=="string"&&l.trim().length>0?l.trim():null;return}Ps=null,Br=null})),e.subscriptions.push(L.commands.registerCommand("openchamber.openActiveSessionInEditor",()=>{if(!Ps){L.window.showInformationMessage("OpenChamber: No active session");return}rt?.createOrShow(Ps,Br??void 0)})),e.subscriptions.push(L.commands.registerCommand("openchamber.openSessionInEditor",(c,l)=>{typeof c!="string"||c.trim().length===0||rt?.createOrShow(c.trim(),l)})),e.subscriptions.push(L.commands.registerCommand("openchamber.openNewSessionInEditor",()=>{rt?.createOrShowNewSession()})),e.subscriptions.push(L.commands.registerCommand("openchamber.openCurrentOrNewSessionInEditor",()=>{Ps?rt?.createOrShow(Ps,Br??void 0):rt?.createOrShowNewSession()})),e.subscriptions.push(L.commands.registerCommand("openchamber.restartApi",async()=>{try{await ke?.restart(),L.window.showInformationMessage("OpenChamber: API connection restarted")}catch(c){L.window.showErrorMessage(`OpenChamber: Failed to restart API - ${c}`)}})),e.subscriptions.push(L.commands.registerCommand("openchamber.addToContext",async()=>{let c=L.window.activeTextEditor;if(!c){L.window.showWarningMessage("OpenChamber [Add to Context]:No active editor");return}let l=c.selection,u=c.document.getText(l);if(!u){L.window.showWarningMessage("OpenChamber [Add to Context]: No text selected");return}let d=L.workspace.asRelativePath(c.document.uri),h=c.document.languageId,f=l.start.line+1,p=l.end.line+1,g=f===p?`${f}`:`${f}-${p}`,y=`${d}:${g}
\`\`\`${h}
${u}
\`\`\``;Te?.addTextToInput(y),L.commands.executeCommand("openchamber.focusChat")})),e.subscriptions.push(L.commands.registerCommand("openchamber.explain",async()=>{let c=L.window.activeTextEditor;if(!c){L.window.showWarningMessage("OpenChamber [Explain]: No active editor");return}let l=c.selection,u=c.document.getText(l),d=L.workspace.asRelativePath(c.document.uri),h=c.document.languageId,f;if(u){let p=l.start.line+1,g=l.end.line+1,y=p===g?`${p}`:`${p}-${g}`;f=`Explain the following Code / Text:

${d}:${y}
\`\`\`${h}
${u}
\`\`\``}else f=`Explain the following Code / Text:

${d}`;Te?.createNewSessionWithPrompt(f),L.commands.executeCommand("openchamber.focusChat")})),e.subscriptions.push(L.commands.registerCommand("openchamber.improveCode",async()=>{let c=L.window.activeTextEditor;if(!c){L.window.showWarningMessage("OpenChamber [Improve Code]: No active editor");return}let l=c.selection,u=c.document.getText(l);if(!u){L.window.showWarningMessage("OpenChamber [Improve Code]: No text selected");return}let d=L.workspace.asRelativePath(c.document.uri),h=c.document.languageId,f=l.start.line+1,p=l.end.line+1,g=f===p?`${f}`:`${f}-${p}`,y=`Improve the following Code:

${d}:${g}
\`\`\`${h}
${u}
\`\`\``;Te?.createNewSessionWithPrompt(y),L.commands.executeCommand("openchamber.focusChat")})),e.subscriptions.push(L.commands.registerCommand("openchamber.newSession",()=>{Te?.createNewSession()})),e.subscriptions.push(L.commands.registerCommand("openchamber.showSettings",()=>{Te?.showSettings()})),e.subscriptions.push(L.commands.registerCommand("openchamber.focusClaudeCode",async()=>{await L.commands.executeCommand("openchamber.claudeCodeView.focus")})),e.subscriptions.push(L.commands.registerCommand("openchamber.claudeCode.newConversation",()=>{Zt?.newConversation()})),e.subscriptions.push(L.commands.registerCommand("openchamber.showOpenCodeStatus",async()=>{let l=(L.workspace.getConfiguration("openchamber").get("apiUrl")||"").trim(),u=String(e.extension?.packageJSON?.version||""),d=(L.workspace.workspaceFolders||[]).map(R=>R.uri.fsPath),h=d[0]||"",f=ke?.getDebugInfo(),p=ke?.getApiUrl(),g=ke?.getWorkingDirectory()??"",y=!!(h&&g===h),w="";if(p)try{w=new URL(p).pathname||"/"}catch{w="(invalid url)"}let S=async(R,x=6e3)=>{let P=new AbortController,I=setTimeout(()=>P.abort(),x),B=Date.now();try{let D=await fetch(R,{method:"GET",headers:{Accept:"application/json"},signal:P.signal}),$=Date.now()-B,U=D.headers.get("content-type")||"",X=U.toLowerCase().includes("json")&&!U.toLowerCase().includes("text/html"),j="";if(X){let J=await D.json().catch(()=>null);if(Array.isArray(J))j=`json[array] len=${J.length}`;else if(J&&typeof J=="object"){let Z=Object.keys(J).slice(0,8);j=`json[object] keys=${Z.join(",")}${Object.keys(J).length>Z.length?",\u2026":""}`}else j=`json[${typeof J}]`}else j=U?`content-type=${U}`:"no content-type";return{ok:D.ok&&X,status:D.status,elapsedMs:$,summary:j}}catch(D){let $=Date.now()-B,X=P.signal.aborted||D instanceof Error&&(D.name==="AbortError"||D.message.toLowerCase().includes("aborted"))?`timeout after ${x}ms`:D instanceof Error?D.message:String(D);return{ok:!1,status:0,elapsedMs:$,summary:`error=${X}`}}finally{clearTimeout(I)}},m=(R,x=!0)=>{if(!p)return null;let P=`${p.replace(/\/+$/,"")}/`,I=new URL(R.replace(/^\/+/,""),P);return x&&g&&I.searchParams.set("directory",g),I.toString()},b=[{label:"health",path:"/global/health",includeDirectory:!1},{label:"config",path:"/config",includeDirectory:!0},{label:"providers",path:"/config/providers",includeDirectory:!0},{label:"agents",path:"/agent",includeDirectory:!0,timeoutMs:12e3},{label:"commands",path:"/command",includeDirectory:!0,timeoutMs:1e4},{label:"project",path:"/project/current",includeDirectory:!0},{label:"path",path:"/path",includeDirectory:!0},{label:"sessions",path:"/session",includeDirectory:!0,timeoutMs:12e3},{label:"sessionStatus",path:"/session/status",includeDirectory:!0}],k=p?await Promise.all(b.map(async R=>{let x=m(R.path,R.includeDirectory!==!1);if(!x)return{label:R.label,url:"(none)",result:null};let P=await S(x,typeof R.timeoutMs=="number"?R.timeoutMs:void 0);return{label:R.label,url:x,result:P}})):[],v=e.globalState.get(vk)||{},E=Object.keys(v).filter(R=>R!=="lastDirectory"),A=[`Time: ${new Date().toISOString()}`,`OpenChamber version: ${u||"(unknown)"}`,`OpenCode Version: ${f?.version??"(unknown)"}`,`VS Code version: ${L.version}`,`Platform: ${process.platform} ${process.arch}`,`Workspace folders: ${d.length}${d.length?` (${d.join(", ")})`:""}`,`Status: ${ke?.getStatus()??"unknown"}`,`Working directory: ${g}`,`Working dir matches workspace: ${y?"yes":"no"}`,`API URL (configured): ${l||"(none)"}`,`OpenCode binary (configured): ${(L.workspace.getConfiguration("openchamber").get("opencodeBinary")||"").trim()||"(none)"}`,`API URL (resolved): ${ke?.getApiUrl()??"(none)"}`,`API URL path: ${w||"(none)"}`,f?`OpenCode server URL: ${f.serverUrl??"(none)"}`:"OpenCode server URL: (unknown)",f?`OpenCode mode: ${f.mode} (starts=${f.startCount}, restarts=${f.restartCount})`:"OpenCode mode: (unknown)",f?`OpenCode CLI path: ${f.cliPath||"(not found - SDK manages process)"}`:"OpenCode CLI path: (unknown)",f?`OpenCode detected port: ${f.detectedPort??"(none)"}`:"OpenCode detected port: (unknown)",f?`OpenCode API prefix: ${f.apiPrefixDetected?f.apiPrefix||"(root)":"(unknown)"}`:"OpenCode API prefix: (unknown)",f?`Last start: ${$p(f.lastStartAt)}`:"Last start: (unknown)",f?`Last ready: ${f.lastReadyElapsedMs!==null?`${f.lastReadyElapsedMs}ms`:"(unknown)"}`:"Last ready: (unknown)",f?`Ready attempts: ${f.lastReadyAttempts??"(unknown)"}`:"Ready attempts: (unknown)",f?`Start attempts: ${f.lastStartAttempts??"(unknown)"}`:"Start attempts: (unknown)",f?`Last connected: ${$p(f.lastConnectedAt)}`:"Last connected: (unknown)",f&&f.lastConnectedAt?`Connected for: ${Ek(Date.now()-f.lastConnectedAt)}`:"Connected for: (n/a)",f&&f.lastExitCode!==null?`Last exit code: ${f.lastExitCode}`:"Last exit code: (none)",f?.lastError?`Last error: ${f.lastError}`:"Last error: (none)",`Settings keys (stored): ${E.length?E.join(", "):"(none)"}`,(k.length,""),...k.length?["OpenCode API probes:",...k.map(R=>{if(!R.result)return`- ${R.label}: (no url)`;let{ok:x,status:P,elapsedMs:I,summary:B}=R.result,D=x?"":` url=${R.url}`;return`- ${R.label}: ${x?"ok":"fail"} status=${P} time=${I}ms ${B}${D}`})]:[],""];Nt?.appendLine(A.join(`
`)),Nt?.show(!0)})),e.subscriptions.push(L.window.onDidChangeActiveColorTheme(c=>{Te?.updateTheme(c.kind),Zt?.updateTheme(c.kind),Is?.updateTheme(c.kind),rt?.updateTheme(c.kind)})),e.subscriptions.push(L.workspace.onDidChangeConfiguration(c=>{(c.affectsConfiguration("workbench.colorTheme")||c.affectsConfiguration("workbench.preferredLightColorTheme")||c.affectsConfiguration("workbench.preferredDarkColorTheme"))&&(Te?.updateTheme(L.window.activeColorTheme.kind),Zt?.updateTheme(L.window.activeColorTheme.kind),Is?.updateTheme(L.window.activeColorTheme.kind),rt?.updateTheme(L.window.activeColorTheme.kind))})),e.subscriptions.push(ke.onStatusChange((c,l)=>{Te?.updateConnectionStatus(c,l),Is?.updateConnectionStatus(c,l),rt?.updateConnectionStatus(c,l),c==="connected"&&Te&&ke?(Mp(Te),ha(ke,Te)):(c==="disconnected"||c==="error")&&ma()})),ke.start()}async function Rk(){ma(),await ke?.stop(),ke=void 0,Te=void 0,Zt?.dispose(),Zt=void 0,Is=void 0,rt=void 0,Nt?.dispose(),Nt=void 0}0&&(module.exports={activate,deactivate});
