import{_ as Cr}from"./index.js";function Mr(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(n,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const Et=n=>{let t;const e=new Set,r=(c,l)=>{const f=typeof c=="function"?c(t):c;if(!Object.is(f,t)){const p=t;t=l??(typeof f!="object"||f===null)?f:Object.assign({},t,f),e.forEach(h=>h(t,p))}},o=()=>t,s={setState:r,getState:o,getInitialState:()=>d,subscribe:c=>(e.add(c),()=>e.delete(c))},d=t=n(r,o,s);return s},Ar=(n=>n?Et(n):Et);function Er(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nt={exports:{}},A={};var _t;function _r(){if(_t)return A;_t=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),l=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator;function h(u){return u===null||typeof u!="object"?null:(u=p&&u[p]||u["@@iterator"],typeof u=="function"?u:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function w(u,b,_){this.props=u,this.context=b,this.refs=m,this.updater=_||g}w.prototype.isReactComponent={},w.prototype.setState=function(u,b){if(typeof u!="object"&&typeof u!="function"&&u!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,u,b,"setState")},w.prototype.forceUpdate=function(u){this.updater.enqueueForceUpdate(this,u,"forceUpdate")};function I(){}I.prototype=w.prototype;function k(u,b,_){this.props=u,this.context=b,this.refs=m,this.updater=_||g}var C=k.prototype=new I;C.constructor=k,y(C,w.prototype),C.isPureReactComponent=!0;var v=Array.isArray;function M(){}var D={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function B(u,b,_){var E=_.ref;return{$$typeof:n,type:u,key:b,ref:E!==void 0?E:null,props:_}}function rt(u,b){return B(u.type,b,u.props)}function he(u){return typeof u=="object"&&u!==null&&u.$$typeof===n}function Me(u){var b={"=":"=0",":":"=2"};return"$"+u.replace(/[=:]/g,function(_){return b[_]})}var Ae=/\/+/g;function me(u,b){return typeof u=="object"&&u!==null&&u.key!=null?Me(""+u.key):b.toString(36)}function le(u){switch(u.status){case"fulfilled":return u.value;case"rejected":throw u.reason;default:switch(typeof u.status=="string"?u.then(M,M):(u.status="pending",u.then(function(b){u.status==="pending"&&(u.status="fulfilled",u.value=b)},function(b){u.status==="pending"&&(u.status="rejected",u.reason=b)})),u.status){case"fulfilled":return u.value;case"rejected":throw u.reason}}throw u}function Z(u,b,_,E,P){var j=typeof u;(j==="undefined"||j==="boolean")&&(u=null);var x=!1;if(u===null)x=!0;else switch(j){case"bigint":case"string":case"number":x=!0;break;case"object":switch(u.$$typeof){case n:case t:x=!0;break;case l:return x=u._init,Z(x(u._payload),b,_,E,P)}}if(x)return P=P(u),x=E===""?"."+me(u,0):E,v(P)?(_="",x!=null&&(_=x.replace(Ae,"$&/")+"/"),Z(P,b,_,"",function(kr){return kr})):P!=null&&(he(P)&&(P=rt(P,_+(P.key==null||u&&u.key===P.key?"":(""+P.key).replace(Ae,"$&/")+"/")+x)),b.push(P)),1;x=0;var V=E===""?".":E+":";if(v(u))for(var z=0;z<u.length;z++)E=u[z],j=V+me(E,z),x+=Z(E,b,_,j,P);else if(z=h(u),typeof z=="function")for(u=z.call(u),z=0;!(E=u.next()).done;)E=E.value,j=V+me(E,z++),x+=Z(E,b,_,j,P);else if(j==="object"){if(typeof u.then=="function")return Z(le(u),b,_,E,P);throw b=String(u),Error("Objects are not valid as a React child (found: "+(b==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":b)+"). If you meant to render a collection of children, use an array instead.")}return x}function F(u,b,_){if(u==null)return u;var E=[],P=0;return Z(u,E,"","",function(j){return b.call(_,j,P++)}),E}function Ee(u){if(u._status===-1){var b=u._result;b=b(),b.then(function(_){(u._status===0||u._status===-1)&&(u._status=1,u._result=_)},function(_){(u._status===0||u._status===-1)&&(u._status=2,u._result=_)}),u._status===-1&&(u._status=0,u._result=b)}if(u._status===1)return u._result.default;throw u._result}var L=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var b=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(b))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},_e={map:F,forEach:function(u,b,_){F(u,function(){b.apply(this,arguments)},_)},count:function(u){var b=0;return F(u,function(){b++}),b},toArray:function(u){return F(u,function(b){return b})||[]},only:function(u){if(!he(u))throw Error("React.Children.only expected to receive a single React element child.");return u}};return A.Activity=f,A.Children=_e,A.Component=w,A.Fragment=e,A.Profiler=o,A.PureComponent=k,A.StrictMode=r,A.Suspense=d,A.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,A.__COMPILER_RUNTIME={__proto__:null,c:function(u){return D.H.useMemoCache(u)}},A.cache=function(u){return function(){return u.apply(null,arguments)}},A.cacheSignal=function(){return null},A.cloneElement=function(u,b,_){if(u==null)throw Error("The argument must be a React element, but you passed "+u+".");var E=y({},u.props),P=u.key;if(b!=null)for(j in b.key!==void 0&&(P=""+b.key),b)!R.call(b,j)||j==="key"||j==="__self"||j==="__source"||j==="ref"&&b.ref===void 0||(E[j]=b[j]);var j=arguments.length-2;if(j===1)E.children=_;else if(1<j){for(var x=Array(j),V=0;V<j;V++)x[V]=arguments[V+2];E.children=x}return B(u.type,P,E)},A.createContext=function(u){return u={$$typeof:a,_currentValue:u,_currentValue2:u,_threadCount:0,Provider:null,Consumer:null},u.Provider=u,u.Consumer={$$typeof:i,_context:u},u},A.createElement=function(u,b,_){var E,P={},j=null;if(b!=null)for(E in b.key!==void 0&&(j=""+b.key),b)R.call(b,E)&&E!=="key"&&E!=="__self"&&E!=="__source"&&(P[E]=b[E]);var x=arguments.length-2;if(x===1)P.children=_;else if(1<x){for(var V=Array(x),z=0;z<x;z++)V[z]=arguments[z+2];P.children=V}if(u&&u.defaultProps)for(E in x=u.defaultProps,x)P[E]===void 0&&(P[E]=x[E]);return B(u,j,P)},A.createRef=function(){return{current:null}},A.forwardRef=function(u){return{$$typeof:s,render:u}},A.isValidElement=he,A.lazy=function(u){return{$$typeof:l,_payload:{_status:-1,_result:u},_init:Ee}},A.memo=function(u,b){return{$$typeof:c,type:u,compare:b===void 0?null:b}},A.startTransition=function(u){var b=D.T,_={};D.T=_;try{var E=u(),P=D.S;P!==null&&P(_,E),typeof E=="object"&&E!==null&&typeof E.then=="function"&&E.then(M,L)}catch(j){L(j)}finally{b!==null&&_.types!==null&&(b.types=_.types),D.T=b}},A.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},A.use=function(u){return D.H.use(u)},A.useActionState=function(u,b,_){return D.H.useActionState(u,b,_)},A.useCallback=function(u,b){return D.H.useCallback(u,b)},A.useContext=function(u){return D.H.useContext(u)},A.useDebugValue=function(){},A.useDeferredValue=function(u,b){return D.H.useDeferredValue(u,b)},A.useEffect=function(u,b){return D.H.useEffect(u,b)},A.useEffectEvent=function(u){return D.H.useEffectEvent(u)},A.useId=function(){return D.H.useId()},A.useImperativeHandle=function(u,b,_){return D.H.useImperativeHandle(u,b,_)},A.useInsertionEffect=function(u,b){return D.H.useInsertionEffect(u,b)},A.useLayoutEffect=function(u,b){return D.H.useLayoutEffect(u,b)},A.useMemo=function(u,b){return D.H.useMemo(u,b)},A.useOptimistic=function(u,b){return D.H.useOptimistic(u,b)},A.useReducer=function(u,b,_){return D.H.useReducer(u,b,_)},A.useRef=function(u){return D.H.useRef(u)},A.useState=function(u){return D.H.useState(u)},A.useSyncExternalStore=function(u,b,_){return D.H.useSyncExternalStore(u,b,_)},A.useTransition=function(){return D.H.useTransition()},A.version="19.2.4",A}var Pt;function Pr(){return Pt||(Pt=1,nt.exports=_r()),nt.exports}var nr=Pr();const X=Er(nr),di=Mr({__proto__:null,default:X},[nr]),Tr=n=>n;function Or(n,t=Tr){const e=X.useSyncExternalStore(n.subscribe,X.useCallback(()=>t(n.getState()),[n,t]),X.useCallback(()=>t(n.getInitialState()),[n,t]));return X.useDebugValue(e),e}const Tt=n=>{const t=Ar(n),e=r=>Or(t,r);return Object.assign(e,t),e},Q=(n=>n?Tt(n):Tt),Ot={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_OPENCODE_URL:"/api"},jt=n=>!!n.dispatchFromDevtools&&typeof n.dispatch=="function",ve=new Map,Pe=n=>{const t=ve.get(n);return t?Object.fromEntries(Object.entries(t.stores).map(([e,r])=>[e,r.getState()])):{}},jr=(n,t,e)=>{if(n===void 0)return{type:"untracked",connection:t.connect(e)};const r=ve.get(e.name);if(r)return{type:"tracked",store:n,...r};const o={connection:t.connect(e),stores:{}};return ve.set(e.name,o),{type:"tracked",store:n,...o}},Rr=(n,t)=>{if(t===void 0)return;const e=ve.get(n);e&&(delete e.stores[t],Object.keys(e.stores).length===0&&ve.delete(n))},xr=n=>{var t,e;if(!n)return;const r=n.split(`
`),o=r.findIndex(a=>a.includes("api.setState"));if(o<0)return;const i=((t=r[o+1])==null?void 0:t.trim())||"";return(e=/.+ (.+) .+/.exec(i))==null?void 0:e[1]},Lr=(n,t={})=>(e,r,o)=>{const{enabled:i,anonymousActionType:a,store:s,...d}=t;let c;try{c=(i??(Ot?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!c)return n(e,r,o);const{connection:l,...f}=jr(s,c,d);let p=!0;o.setState=((y,m,w)=>{const I=e(y,m);if(!p)return I;const k=w===void 0?{type:a||xr(new Error().stack)||"anonymous"}:typeof w=="string"?{type:w}:w;return s===void 0?(l?.send(k,r()),I):(l?.send({...k,type:`${s}/${k.type}`},{...Pe(d.name),[s]:o.getState()}),I)}),o.devtools={cleanup:()=>{l&&typeof l.unsubscribe=="function"&&l.unsubscribe(),Rr(d.name,s)}};const h=(...y)=>{const m=p;p=!1,e(...y),p=m},g=n(o.setState,r,o);if(f.type==="untracked"?l?.init(g):(f.stores[f.store]=o,l?.init(Object.fromEntries(Object.entries(f.stores).map(([y,m])=>[y,y===f.store?g:m.getState()])))),jt(o)){let y=!1;const m=o.dispatch;o.dispatch=(...w)=>{(Ot?"production":void 0)!=="production"&&w[0].type==="__setState"&&!y&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),y=!0),m(...w)}}return l.subscribe(y=>{var m;switch(y.type){case"ACTION":if(typeof y.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return ot(y.payload,w=>{if(w.type==="__setState"){if(s===void 0){h(w.state);return}Object.keys(w.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const I=w.state[s];if(I==null)return;JSON.stringify(o.getState())!==JSON.stringify(I)&&h(I);return}jt(o)&&o.dispatch(w)});case"DISPATCH":switch(y.payload.type){case"RESET":return h(g),s===void 0?l?.init(o.getState()):l?.init(Pe(d.name));case"COMMIT":if(s===void 0){l?.init(o.getState());return}return l?.init(Pe(d.name));case"ROLLBACK":return ot(y.state,w=>{if(s===void 0){h(w),l?.init(o.getState());return}h(w[s]),l?.init(Pe(d.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return ot(y.state,w=>{if(s===void 0){h(w);return}JSON.stringify(o.getState())!==JSON.stringify(w[s])&&h(w[s])});case"IMPORT_STATE":{const{nextLiftedState:w}=y.payload,I=(m=w.computedStates.slice(-1)[0])==null?void 0:m.state;if(!I)return;h(s===void 0?I:I[s]),l?.send(null,w);return}case"PAUSE_RECORDING":return p=!p}return}}),g},Y=Lr,ot=(n,t)=>{let e;try{e=JSON.parse(n)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}e!==void 0&&t(e)};function ae(n,t){let e;try{e=n()}catch{return}return{getItem:o=>{var i;const a=d=>d===null?null:JSON.parse(d,void 0),s=(i=e.getItem(o))!=null?i:null;return s instanceof Promise?s.then(a):a(s)},setItem:(o,i)=>e.setItem(o,JSON.stringify(i,void 0)),removeItem:o=>e.removeItem(o)}}const ft=n=>t=>{try{const e=n(t);return e instanceof Promise?e:{then(r){return ft(r)(e)},catch(r){return this}}}catch(e){return{then(r){return this},catch(r){return ft(r)(e)}}}},zr=(n,t)=>(e,r,o)=>{let i={storage:ae(()=>window.localStorage),partialize:m=>m,version:0,merge:(m,w)=>({...w,...m}),...t},a=!1,s=0;const d=new Set,c=new Set;let l=i.storage;if(!l)return n((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),e(...m)},r,o);const f=()=>{const m=i.partialize({...r()});return l.setItem(i.name,{state:m,version:i.version})},p=o.setState;o.setState=(m,w)=>(p(m,w),f());const h=n((...m)=>(e(...m),f()),r,o);o.getInitialState=()=>h;let g;const y=()=>{var m,w;if(!l)return;const I=++s;a=!1,d.forEach(C=>{var v;return C((v=r())!=null?v:h)});const k=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(m=r())!=null?m:h))||void 0;return ft(l.getItem.bind(l))(i.name).then(C=>{if(C)if(typeof C.version=="number"&&C.version!==i.version){if(i.migrate){const v=i.migrate(C.state,C.version);return v instanceof Promise?v.then(M=>[!0,M]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,C.state];return[!1,void 0]}).then(C=>{var v;if(I!==s)return;const[M,D]=C;if(g=i.merge(D,(v=r())!=null?v:h),e(g,!0),M)return f()}).then(()=>{I===s&&(k?.(g,void 0),g=r(),a=!0,c.forEach(C=>C(g)))}).catch(C=>{I===s&&k?.(void 0,C)})};return o.persist={setOptions:m=>{i={...i,...m},m.storage&&(l=m.storage)},clearStorage:()=>{l?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>a,onHydrate:m=>(d.add(m),()=>{d.delete(m)}),onFinishHydration:m=>(c.add(m),()=>{c.delete(m)})},i.skipHydration||y(),g||h},ye=zr;let it=null,st=null;const Be=()=>{const n=new Map;return{getItem:t=>n.get(t)??null,setItem:(t,e)=>{n.set(t,e)},removeItem:t=>{n.delete(t)},clear:()=>{n.clear()},key:t=>Array.from(n.keys())[t]??null,get length(){return n.size}}},Fr=()=>{if(typeof window>"u"||!window.localStorage)return Be();const n=window.localStorage,t=Be();let e=!0;const r=()=>{e=!1};return{getItem:c=>{if(e)try{const l=n.getItem(c);if(l!==null)return l}catch{r()}return t.getItem(c)},setItem:(c,l)=>{if(e)try{n.setItem(c,l),t.removeItem(c);return}catch{r();try{n.removeItem(c)}catch{}}t.setItem(c,l)},removeItem:c=>{try{n.removeItem(c)}catch{r()}t.removeItem(c)},clear:()=>{try{n.clear()}catch{r()}t.clear()},key:c=>{if(e)try{return n.key(c)}catch{r()}return t.key(c)},get length(){if(e)try{return n.length+t.length}catch{r()}return t.length}}},H=()=>(it||(it=Fr()),it),qr=()=>{if(typeof window>"u"||!window.sessionStorage)return Be();const n=window.sessionStorage,t=Be();let e=!0;const r=()=>{e=!1};return{getItem:c=>{if(e)try{const l=n.getItem(c);if(l!==null)return l}catch{r()}return t.getItem(c)},setItem:(c,l)=>{if(e)try{n.setItem(c,l),t.removeItem(c);return}catch{r();try{n.removeItem(c)}catch{}}t.setItem(c,l)},removeItem:c=>{try{n.removeItem(c)}catch{r()}t.removeItem(c)},clear:()=>{try{n.clear()}catch{r()}t.clear()},key:c=>{if(e)try{return n.key(c)}catch{r()}return t.key(c)},get length(){if(e)try{return n.length+t.length}catch{r()}return t.length}}},ui=()=>(st||(st=qr()),st),Hr={markdown:"0.9375rem",code:"0.9063rem",uiHeader:"0.9375rem",uiLabel:"0.8750rem",meta:"0.875rem",micro:"0.875rem"},fi={markdown:"0.9063rem",code:"0.8750rem",uiHeader:"0.9063rem",uiLabel:"0.8438rem",meta:"0.8438rem",micro:"0.7813rem"};function Rt(n){return`--text-${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`}const Te={semanticMarkdown:{fontSize:"var(--text-markdown)"},semanticCode:{fontSize:"var(--text-code)"},uiHeader:{fontSize:"var(--text-ui-header)"},uiLabel:{fontSize:"var(--text-ui-label)"},meta:{fontSize:"var(--text-meta)"},micro:{fontSize:"var(--text-micro)"},ui:{button:{fontSize:"var(--text-ui-label)",lineHeight:"var(--ui-button-line-height)",letterSpacing:"var(--ui-button-letter-spacing)",fontWeight:"var(--ui-button-font-weight)"},buttonSmall:{fontSize:"var(--text-meta)",lineHeight:"var(--ui-button-small-line-height)",letterSpacing:"var(--ui-button-small-letter-spacing)",fontWeight:"var(--ui-button-small-font-weight)"},buttonLarge:{fontSize:"var(--text-ui-label)",lineHeight:"var(--ui-button-large-line-height)",letterSpacing:"var(--ui-button-large-letter-spacing)",fontWeight:"var(--ui-button-large-font-weight)"},label:{fontSize:"var(--text-meta)",lineHeight:"var(--ui-label-line-height)",letterSpacing:"var(--ui-label-letter-spacing)",fontWeight:"var(--ui-label-font-weight)"},caption:{fontSize:"var(--text-micro)",lineHeight:"var(--ui-caption-line-height)",letterSpacing:"var(--ui-caption-letter-spacing)",fontWeight:"var(--ui-caption-font-weight)"},badge:{fontSize:"var(--text-micro)",lineHeight:"var(--ui-badge-line-height)",letterSpacing:"var(--ui-badge-letter-spacing)",fontWeight:"var(--ui-badge-font-weight)"},tooltip:{fontSize:"var(--text-micro)",lineHeight:"var(--ui-tooltip-line-height)",letterSpacing:"var(--ui-tooltip-letter-spacing)",fontWeight:"var(--ui-tooltip-font-weight)"},input:{fontSize:"var(--text-ui-label)",lineHeight:"var(--ui-input-line-height)",letterSpacing:"var(--ui-input-letter-spacing)",fontWeight:"var(--ui-input-font-weight)"},helperText:{fontSize:"var(--text-meta)",lineHeight:"var(--ui-helper-text-line-height)",letterSpacing:"var(--ui-helper-text-letter-spacing)",fontWeight:"var(--ui-helper-text-font-weight)"}},code:{inline:{fontSize:"var(--text-code)",lineHeight:"var(--code-inline-line-height)",letterSpacing:"var(--code-inline-letter-spacing)",fontWeight:"var(--code-inline-font-weight)"},block:{fontSize:"var(--text-code)",lineHeight:"var(--code-block-line-height)",letterSpacing:"var(--code-block-letter-spacing)",fontWeight:"var(--code-block-font-weight)"},lineNumbers:{fontSize:"var(--text-micro)",lineHeight:"var(--code-line-numbers-line-height)",letterSpacing:"var(--code-line-numbers-letter-spacing)",fontWeight:"var(--code-line-numbers-font-weight)"}},markdown:{body:{fontSize:"var(--text-markdown)",lineHeight:"var(--markdown-body-line-height)",letterSpacing:"var(--markdown-body-letter-spacing)",fontWeight:"var(--markdown-body-font-weight)"},bodySmall:{fontSize:"var(--text-meta)",lineHeight:"var(--markdown-body-small-line-height)",letterSpacing:"var(--markdown-body-small-letter-spacing)",fontWeight:"var(--markdown-body-small-font-weight)"},bodyLarge:{fontSize:"var(--text-markdown)",lineHeight:"var(--markdown-body-large-line-height)",letterSpacing:"var(--markdown-body-large-letter-spacing)",fontWeight:"var(--markdown-body-large-font-weight)"},blockquote:{fontSize:"var(--text-markdown)",lineHeight:"var(--markdown-blockquote-line-height)",letterSpacing:"var(--markdown-blockquote-letter-spacing)",fontWeight:"var(--markdown-blockquote-font-weight)"},list:{fontSize:"var(--text-markdown)",lineHeight:"var(--markdown-list-line-height)",letterSpacing:"var(--markdown-list-letter-spacing)",fontWeight:"var(--markdown-list-font-weight)"},link:{fontSize:"var(--text-markdown)",lineHeight:"var(--markdown-link-line-height)",letterSpacing:"var(--markdown-link-letter-spacing)",fontWeight:"var(--markdown-link-font-weight)"},code:{fontSize:"var(--text-code)",lineHeight:"var(--markdown-code-line-height)",letterSpacing:"var(--markdown-code-letter-spacing)",fontWeight:"var(--markdown-code-font-weight)"},codeBlock:{fontSize:"var(--text-code)",lineHeight:"var(--markdown-code-block-line-height)",letterSpacing:"var(--markdown-code-block-letter-spacing)",fontWeight:"var(--markdown-code-block-font-weight)"}},tool:{collapsed:{fontSize:"var(--text-code)",lineHeight:"var(--code-block-line-height)",letterSpacing:"var(--code-block-letter-spacing)",fontWeight:"var(--code-block-font-weight)"},popup:{fontSize:"var(--text-code)",lineHeight:"var(--code-block-line-height)",letterSpacing:"var(--code-block-letter-spacing)",fontWeight:"var(--code-block-font-weight)"},inline:{fontSize:"var(--text-code)",lineHeight:"var(--code-inline-line-height)",letterSpacing:"var(--code-inline-letter-spacing)",fontWeight:"var(--code-inline-font-weight)"}}},at={padding:{collapsed:"0.375rem",popup:"0.75rem",popupContainer:"1rem"},backgroundOpacity:{muted:"30",mutedAlt:"50"},getCollapsedStyles:()=>({...Te.tool.collapsed,background:"transparent",backgroundColor:"transparent",margin:0,padding:at.padding.collapsed,borderRadius:0}),getPopupStyles:()=>({...Te.tool.popup,background:"transparent",backgroundColor:"transparent",margin:0,padding:at.padding.popup,borderRadius:"0.75rem"}),getPopupContainerStyles:()=>({...Te.tool.popup,background:"transparent",backgroundColor:"transparent",margin:0,padding:at.padding.popupContainer,borderRadius:"0.5rem",overflowX:"auto"}),getInlineStyles:()=>({...Te.tool.inline})},Oe={completion:{title:"{agent_name} is ready",message:"{last_message}"},error:{title:"Tool error",message:"{last_message}"},question:{title:"{agent_name} needs input",message:"{last_message}"},subtask:{title:"Subtask complete",message:"{last_message}"}},te={completion:{title:"",message:""},error:{title:"",message:""},question:{title:"",message:""},subtask:{title:"",message:""}},je=(n,t)=>n?n.title===t.title&&n.message===t.message:!1,Nr=n=>{if(!n||typeof n!="object")return!1;const t=n;return je(t.completion,Oe.completion)&&je(t.error,Oe.error)&&je(t.question,Oe.question)&&je(t.subtask,Oe.subtask)},Se=Q()(Y(ye((n,t)=>({theme:"system",isMultiRunLauncherOpen:!1,multiRunLauncherPrefillPrompt:"",isSidebarOpen:!0,sidebarWidth:264,hasManuallyResizedLeftSidebar:!1,isRightSidebarOpen:!1,rightSidebarWidth:420,hasManuallyResizedRightSidebar:!1,isBottomTerminalOpen:!1,bottomTerminalHeight:300,hasManuallyResizedBottomTerminal:!1,isSessionSwitcherOpen:!1,activeMainTab:"chat",mainTabGuard:null,sidebarOpenBeforeFullscreenTab:null,pendingDiffFile:null,isMobile:!1,isKeyboardOpen:!1,isCommandPaletteOpen:!1,isHelpDialogOpen:!1,isAboutDialogOpen:!1,isOpenCodeStatusDialogOpen:!1,openCodeStatusText:"",isSessionCreateDialogOpen:!1,isSettingsDialogOpen:!1,isModelSelectorOpen:!1,sidebarSection:"sessions",eventStreamStatus:"idle",eventStreamHint:null,showReasoningTraces:!0,showTextJustificationActivity:!1,autoDeleteEnabled:!1,autoDeleteAfterDays:30,autoDeleteLastRunAt:null,messageLimit:200,toolCallExpansion:"collapsed",fontSize:100,terminalFontSize:13,padding:100,cornerRadius:12,inputBarOffset:0,favoriteModels:[],recentModels:[],recentAgents:[],recentEfforts:{},diffLayoutPreference:"inline",diffFileLayout:{},diffWrapLines:!1,diffViewMode:"stacked",isTimelineDialogOpen:!1,isImagePreviewOpen:!1,nativeNotificationsEnabled:!1,notificationMode:"hidden-only",notifyOnSubtasks:!0,notifyOnCompletion:!0,notifyOnError:!0,notifyOnQuestion:!0,notificationTemplates:{completion:{...te.completion},error:{...te.error},question:{...te.question},subtask:{...te.subtask}},summarizeLastMessage:!1,summaryThreshold:200,summaryLength:100,maxLastMessageLength:250,showTerminalQuickKeysOnDesktop:!1,persistChatDraft:!0,isMobileSessionStatusBarCollapsed:!1,setTheme:e=>{n({theme:e}),t().applyTheme()},toggleSidebar:()=>{n(e=>{const r=!e.isSidebarOpen;if(r&&typeof window<"u"){const o=Math.floor(window.innerWidth*.2);return{isSidebarOpen:r,sidebarWidth:o,hasManuallyResizedLeftSidebar:!1}}return{isSidebarOpen:r}})},setSidebarOpen:e=>{n(()=>{if(e&&typeof window<"u"){const r=Math.floor(window.innerWidth*.2);return{isSidebarOpen:e,sidebarWidth:r,hasManuallyResizedLeftSidebar:!1}}return{isSidebarOpen:e}})},setSidebarWidth:e=>{n({sidebarWidth:e,hasManuallyResizedLeftSidebar:!0})},toggleRightSidebar:()=>{n(e=>{const r=!e.isRightSidebarOpen;if(r&&typeof window<"u"){const o=Math.floor(window.innerWidth*.28);return{isRightSidebarOpen:r,rightSidebarWidth:o,hasManuallyResizedRightSidebar:!1}}return{isRightSidebarOpen:r}})},setRightSidebarOpen:e=>{n(()=>{if(e&&typeof window<"u"){const r=Math.floor(window.innerWidth*.28);return{isRightSidebarOpen:e,rightSidebarWidth:r,hasManuallyResizedRightSidebar:!1}}return{isRightSidebarOpen:e}})},setRightSidebarWidth:e=>{n({rightSidebarWidth:e,hasManuallyResizedRightSidebar:!0})},toggleBottomTerminal:()=>{n(e=>{const r=!e.isBottomTerminalOpen;if(r&&typeof window<"u"){const o=Math.floor(window.innerHeight*.32);return{isBottomTerminalOpen:r,bottomTerminalHeight:o,hasManuallyResizedBottomTerminal:!1}}return{isBottomTerminalOpen:r}})},setBottomTerminalOpen:e=>{n(()=>{if(e&&typeof window<"u"){const r=Math.floor(window.innerHeight*.32);return{isBottomTerminalOpen:e,bottomTerminalHeight:r,hasManuallyResizedBottomTerminal:!1}}return{isBottomTerminalOpen:e}})},setBottomTerminalHeight:e=>{n({bottomTerminalHeight:e,hasManuallyResizedBottomTerminal:!0})},setSessionSwitcherOpen:e=>{n({isSessionSwitcherOpen:e})},setMainTabGuard:e=>{t().mainTabGuard!==e&&n({mainTabGuard:e})},setActiveMainTab:e=>{const r=t().mainTabGuard;if(r&&!r(e))return;const o=t(),i=o.activeMainTab,a=["files","diff"],s=a.includes(e)&&!a.includes(i),d=!a.includes(e)&&a.includes(i);if(s)n({activeMainTab:e,sidebarOpenBeforeFullscreenTab:o.isSidebarOpen,isSidebarOpen:!1});else if(d){const c=o.sidebarOpenBeforeFullscreenTab===!0;n({activeMainTab:e,sidebarOpenBeforeFullscreenTab:null,...c&&typeof window<"u"?{isSidebarOpen:!0,sidebarWidth:Math.floor(window.innerWidth*.2),hasManuallyResizedLeftSidebar:!1}:{}})}else n({activeMainTab:e})},setPendingDiffFile:e=>{n({pendingDiffFile:e})},navigateToDiff:e=>{const r=t().mainTabGuard;if(r&&!r("diff"))return;const o=t(),i=o.activeMainTab,s=!["files","diff"].includes(i);n(s?{pendingDiffFile:e,activeMainTab:"diff",sidebarOpenBeforeFullscreenTab:o.isSidebarOpen,isSidebarOpen:!1}:{pendingDiffFile:e,activeMainTab:"diff"})},consumePendingDiffFile:()=>{const{pendingDiffFile:e}=t();return e&&n({pendingDiffFile:null}),e},setIsMobile:e=>{n({isMobile:e})},toggleCommandPalette:()=>{n(e=>({isCommandPaletteOpen:!e.isCommandPaletteOpen}))},setCommandPaletteOpen:e=>{n({isCommandPaletteOpen:e})},toggleHelpDialog:()=>{n(e=>({isHelpDialogOpen:!e.isHelpDialogOpen}))},setHelpDialogOpen:e=>{n({isHelpDialogOpen:e})},setAboutDialogOpen:e=>{n({isAboutDialogOpen:e})},setOpenCodeStatusDialogOpen:e=>{n({isOpenCodeStatusDialogOpen:e})},setOpenCodeStatusText:e=>{n({openCodeStatusText:e})},setSessionCreateDialogOpen:e=>{n({isSessionCreateDialogOpen:e})},setSettingsDialogOpen:e=>{n({isSettingsDialogOpen:e})},setModelSelectorOpen:e=>{n({isModelSelectorOpen:e})},setSidebarSection:e=>{n({sidebarSection:e})},setEventStreamStatus:(e,r)=>{n({eventStreamStatus:e,eventStreamHint:r??null})},setShowReasoningTraces:e=>{n({showReasoningTraces:e})},setShowTextJustificationActivity:e=>{n({showTextJustificationActivity:e})},setAutoDeleteEnabled:e=>{n({autoDeleteEnabled:e})},setAutoDeleteAfterDays:e=>{const r=Math.max(1,Math.min(365,e));n({autoDeleteAfterDays:r})},setAutoDeleteLastRunAt:e=>{n({autoDeleteLastRunAt:e})},setMessageLimit:e=>{const r=Math.max(10,Math.min(500,Math.round(e)));n({messageLimit:r})},setToolCallExpansion:e=>{n({toolCallExpansion:e})},setFontSize:e=>{const r=Math.max(50,Math.min(200,e));n({fontSize:r}),t().applyTypography()},setTerminalFontSize:e=>{const r=Math.round(e),o=Math.max(9,Math.min(52,r));n({terminalFontSize:o})},setPadding:e=>{const r=Math.max(50,Math.min(200,e));n({padding:r}),t().applyPadding()},setCornerRadius:e=>{n({cornerRadius:e})},applyTypography:()=>{const{fontSize:e}=t(),r=document.documentElement,o=e/100,i=Object.entries(Hr);if(o===1){for(const[a]of i)r.style.removeProperty(Rt(a));return}for(const[a,s]of i){const d=parseFloat(s);Number.isFinite(d)&&r.style.setProperty(Rt(a),`${d*o}rem`)}},applyPadding:()=>{const{padding:e}=t(),r=document.documentElement,o=e/100;if(o===1){r.style.removeProperty("--padding-scale"),r.style.removeProperty("--line-height-tight"),r.style.removeProperty("--line-height-normal"),r.style.removeProperty("--line-height-relaxed"),r.style.removeProperty("--line-height-loose");return}const i=Math.sqrt(o);r.style.setProperty("--padding-scale",i.toString());const a=1+(o-1)*.15;r.style.setProperty("--line-height-tight",(1.25*a).toFixed(3)),r.style.setProperty("--line-height-normal",(1.5*a).toFixed(3)),r.style.setProperty("--line-height-relaxed",(1.625*a).toFixed(3)),r.style.setProperty("--line-height-loose",(2*a).toFixed(3))},setDiffLayoutPreference:e=>{n({diffLayoutPreference:e})},setDiffFileLayout:(e,r)=>{n(o=>({diffFileLayout:{...o.diffFileLayout,[e]:r}}))},setDiffWrapLines:e=>{n({diffWrapLines:e})},setDiffViewMode:e=>{n({diffViewMode:e})},setInputBarOffset:e=>{n({inputBarOffset:e})},setKeyboardOpen:e=>{n({isKeyboardOpen:e})},toggleFavoriteModel:(e,r)=>{n(o=>o.favoriteModels.some(a=>a.providerID===e&&a.modelID===r)?{favoriteModels:o.favoriteModels.filter(a=>!(a.providerID===e&&a.modelID===r))}:{favoriteModels:[{providerID:e,modelID:r},...o.favoriteModels]})},isFavoriteModel:(e,r)=>{const{favoriteModels:o}=t();return o.some(i=>i.providerID===e&&i.modelID===r)},addRecentModel:(e,r)=>{n(o=>{const i=o.recentModels.filter(a=>!(a.providerID===e&&a.modelID===r));return{recentModels:[{providerID:e,modelID:r},...i].slice(0,5)}})},addRecentAgent:e=>{const r=typeof e=="string"?e.trim():"";r&&n(o=>{if(o.recentAgents.includes(r))return o;const i=o.recentAgents;return{recentAgents:[r,...i].slice(0,5)}})},addRecentEffort:(e,r,o)=>{const i=typeof e=="string"?e.trim():"",a=typeof r=="string"?r.trim():"";if(!i||!a)return;const s=`${i}/${a}`,d=typeof o=="string"&&o.trim().length>0?o.trim():"default";n(c=>{const l=c.recentEfforts[s]??[];if(l.includes(d))return c;const f=l;return{recentEfforts:{...c.recentEfforts,[s]:[d,...f].slice(0,5)}}})},updateProportionalSidebarWidths:()=>{typeof window>"u"||n(e=>{const r={};return e.isSidebarOpen&&!e.hasManuallyResizedLeftSidebar&&(r.sidebarWidth=Math.floor(window.innerWidth*.2)),e.isRightSidebarOpen&&!e.hasManuallyResizedRightSidebar&&(r.rightSidebarWidth=Math.floor(window.innerWidth*.28)),e.isBottomTerminalOpen&&!e.hasManuallyResizedBottomTerminal&&(r.bottomTerminalHeight=Math.floor(window.innerHeight*.32)),r})},applyTheme:()=>{const{theme:e}=t(),r=document.documentElement;if(r.classList.remove("light","dark"),e==="system"){const o=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";r.classList.add(o)}else r.classList.add(e)},setMultiRunLauncherOpen:e=>{n(r=>({isMultiRunLauncherOpen:e,multiRunLauncherPrefillPrompt:e?r.multiRunLauncherPrefillPrompt:""}))},openMultiRunLauncher:()=>{n({isMultiRunLauncherOpen:!0,multiRunLauncherPrefillPrompt:"",isSessionSwitcherOpen:!1})},openMultiRunLauncherWithPrompt:e=>{n({isMultiRunLauncherOpen:!0,multiRunLauncherPrefillPrompt:e,isSessionSwitcherOpen:!1})},setTimelineDialogOpen:e=>{n({isTimelineDialogOpen:e})},setImagePreviewOpen:e=>{n({isImagePreviewOpen:e})},setNativeNotificationsEnabled:e=>{n({nativeNotificationsEnabled:e})},setNotificationMode:e=>{n({notificationMode:e})},setShowTerminalQuickKeysOnDesktop:e=>{n({showTerminalQuickKeysOnDesktop:e})},setNotifyOnSubtasks:e=>{n({notifyOnSubtasks:e})},setNotifyOnCompletion:e=>{n({notifyOnCompletion:e})},setNotifyOnError:e=>{n({notifyOnError:e})},setNotifyOnQuestion:e=>{n({notifyOnQuestion:e})},setNotificationTemplates:e=>{n({notificationTemplates:e})},setSummarizeLastMessage:e=>{n({summarizeLastMessage:e})},setSummaryThreshold:e=>{n({summaryThreshold:e})},setSummaryLength:e=>{n({summaryLength:e})},setMaxLastMessageLength:e=>{n({maxLastMessageLength:e})},setPersistChatDraft:e=>{n({persistChatDraft:e})},setIsMobileSessionStatusBarCollapsed:e=>{n({isMobileSessionStatusBarCollapsed:e})}}),{name:"ui-store",storage:ae(()=>H()),version:3,migrate:(n,t)=>{if(!n||typeof n!="object")return n;const e=n;if(t<1&&Nr(e.notificationTemplates)&&(e.notificationTemplates={completion:{...te.completion},error:{...te.error},question:{...te.question},subtask:{...te.subtask}}),t<3){const r=new Set([90,120,180,220]),o=e.memoryLimitHistorical,i=e.memoryLimitActiveSession;typeof o=="number"&&!r.has(o)?e.messageLimit=o:typeof i=="number"&&!r.has(i)&&(e.messageLimit=i),delete e.memoryLimitHistorical,delete e.memoryLimitViewport,delete e.memoryLimitActiveSession}return e},partialize:n=>({theme:n.theme,isSidebarOpen:n.isSidebarOpen,sidebarWidth:n.sidebarWidth,isRightSidebarOpen:n.isRightSidebarOpen,rightSidebarWidth:n.rightSidebarWidth,isBottomTerminalOpen:n.isBottomTerminalOpen,bottomTerminalHeight:n.bottomTerminalHeight,isSessionSwitcherOpen:n.isSessionSwitcherOpen,activeMainTab:n.activeMainTab,sidebarSection:n.sidebarSection,isSessionCreateDialogOpen:n.isSessionCreateDialogOpen,showReasoningTraces:n.showReasoningTraces,showTextJustificationActivity:n.showTextJustificationActivity,autoDeleteEnabled:n.autoDeleteEnabled,autoDeleteAfterDays:n.autoDeleteAfterDays,autoDeleteLastRunAt:n.autoDeleteLastRunAt,messageLimit:n.messageLimit,toolCallExpansion:n.toolCallExpansion,fontSize:n.fontSize,terminalFontSize:n.terminalFontSize,padding:n.padding,cornerRadius:n.cornerRadius,favoriteModels:n.favoriteModels,recentModels:n.recentModels,recentAgents:n.recentAgents,recentEfforts:n.recentEfforts,diffLayoutPreference:n.diffLayoutPreference,diffWrapLines:n.diffWrapLines,diffViewMode:n.diffViewMode,nativeNotificationsEnabled:n.nativeNotificationsEnabled,notificationMode:n.notificationMode,showTerminalQuickKeysOnDesktop:n.showTerminalQuickKeysOnDesktop,notifyOnSubtasks:n.notifyOnSubtasks,notifyOnCompletion:n.notifyOnCompletion,notifyOnError:n.notifyOnError,notifyOnQuestion:n.notifyOnQuestion,notificationTemplates:n.notificationTemplates,summarizeLastMessage:n.summarizeLastMessage,summaryThreshold:n.summaryThreshold,summaryLength:n.summaryLength,maxLastMessageLength:n.maxLastMessageLength,persistChatDraft:n.persistChatDraft,isMobileSessionStatusBarCollapsed:n.isMobileSessionStatusBarCollapsed})}),{name:"ui-store"})),$r=({onRequest:n,onSseError:t,onSseEvent:e,responseTransformer:r,responseValidator:o,sseDefaultRetryDelay:i,sseMaxRetryAttempts:a,sseMaxRetryDelay:s,sseSleepFn:d,url:c,...l})=>{let f;const p=d??(y=>new Promise(m=>setTimeout(m,y)));return{stream:async function*(){let y=i??3e3,m=0;const w=l.signal??new AbortController().signal;for(;!w.aborted;){m++;const I=l.headers instanceof Headers?l.headers:new Headers(l.headers);f!==void 0&&I.set("Last-Event-ID",f);try{const k={redirect:"follow",...l,body:l.serializedBody,headers:I,signal:w};let C=new Request(c,k);n&&(C=await n(c,k));const M=await(l.fetch??globalThis.fetch)(C);if(!M.ok)throw new Error(`SSE failed: ${M.status} ${M.statusText}`);if(!M.body)throw new Error("No body in SSE response");const D=M.body.pipeThrough(new TextDecoderStream).getReader();let R="";const B=()=>{try{D.cancel()}catch{}};w.addEventListener("abort",B);try{for(;;){const{done:rt,value:he}=await D.read();if(rt)break;R+=he,R=R.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const Me=R.split(`

`);R=Me.pop()??"";for(const Ae of Me){const me=Ae.split(`
`),le=[];let Z;for(const L of me)if(L.startsWith("data:"))le.push(L.replace(/^data:\s*/,""));else if(L.startsWith("event:"))Z=L.replace(/^event:\s*/,"");else if(L.startsWith("id:"))f=L.replace(/^id:\s*/,"");else if(L.startsWith("retry:")){const _e=Number.parseInt(L.replace(/^retry:\s*/,""),10);Number.isNaN(_e)||(y=_e)}let F,Ee=!1;if(le.length){const L=le.join(`
`);try{F=JSON.parse(L),Ee=!0}catch{F=L}}Ee&&(o&&await o(F),r&&(F=await r(F))),e?.({data:F,event:Z,id:f,retry:y}),le.length&&(yield F)}}}finally{w.removeEventListener("abort",B),D.releaseLock()}break}catch(k){if(t?.(k),a!==void 0&&m>=a)break;const C=Math.min(y*2**(m-1),s??3e4);await p(C)}}}()}},Br=n=>{switch(n){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}},Vr=n=>{switch(n){case"form":return",";case"pipeDelimited":return"|";case"spaceDelimited":return"%20";default:return","}},Ur=n=>{switch(n){case"label":return".";case"matrix":return";";case"simple":return",";default:return"&"}},or=({allowReserved:n,explode:t,name:e,style:r,value:o})=>{if(!t){const s=(n?o:o.map(d=>encodeURIComponent(d))).join(Vr(r));switch(r){case"label":return`.${s}`;case"matrix":return`;${e}=${s}`;case"simple":return s;default:return`${e}=${s}`}}const i=Br(r),a=o.map(s=>r==="label"||r==="simple"?n?s:encodeURIComponent(s):Je({allowReserved:n,name:e,value:s})).join(i);return r==="label"||r==="matrix"?i+a:a},Je=({allowReserved:n,name:t,value:e})=>{if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${n?e:encodeURIComponent(e)}`},ir=({allowReserved:n,explode:t,name:e,style:r,value:o,valueOnly:i})=>{if(o instanceof Date)return i?o.toISOString():`${e}=${o.toISOString()}`;if(r!=="deepObject"&&!t){let d=[];Object.entries(o).forEach(([l,f])=>{d=[...d,l,n?f:encodeURIComponent(f)]});const c=d.join(",");switch(r){case"form":return`${e}=${c}`;case"label":return`.${c}`;case"matrix":return`;${e}=${c}`;default:return c}}const a=Ur(r),s=Object.entries(o).map(([d,c])=>Je({allowReserved:n,name:r==="deepObject"?`${e}[${d}]`:d,value:c})).join(a);return r==="label"||r==="matrix"?a+s:s},Wr=/\{[^{}]+\}/g,Gr=({path:n,url:t})=>{let e=t;const r=t.match(Wr);if(r)for(const o of r){let i=!1,a=o.substring(1,o.length-1),s="simple";a.endsWith("*")&&(i=!0,a=a.substring(0,a.length-1)),a.startsWith(".")?(a=a.substring(1),s="label"):a.startsWith(";")&&(a=a.substring(1),s="matrix");const d=n[a];if(d==null)continue;if(Array.isArray(d)){e=e.replace(o,or({explode:i,name:a,style:s,value:d}));continue}if(typeof d=="object"){e=e.replace(o,ir({explode:i,name:a,style:s,value:d,valueOnly:!0}));continue}if(s==="matrix"){e=e.replace(o,`;${Je({name:a,value:d})}`);continue}const c=encodeURIComponent(s==="label"?`.${d}`:d);e=e.replace(o,c)}return e},Kr=({baseUrl:n,path:t,query:e,querySerializer:r,url:o})=>{const i=o.startsWith("/")?o:`/${o}`;let a=(n??"")+i;t&&(a=Gr({path:t,url:a}));let s=e?r(e):"";return s.startsWith("?")&&(s=s.substring(1)),s&&(a+=`?${s}`),a};function xt(n){const t=n.body!==void 0;if(t&&n.bodySerializer)return"serializedBody"in n?n.serializedBody!==void 0&&n.serializedBody!==""?n.serializedBody:null:n.body!==""?n.body:null;if(t)return n.body}const Jr=async(n,t)=>{const e=typeof t=="function"?await t(n):t;if(e)return n.scheme==="bearer"?`Bearer ${e}`:n.scheme==="basic"?`Basic ${btoa(e)}`:e},Qr={bodySerializer:n=>JSON.stringify(n,(t,e)=>typeof e=="bigint"?e.toString():e)},sr=({parameters:n={},...t}={})=>r=>{const o=[];if(r&&typeof r=="object")for(const i in r){const a=r[i];if(a==null)continue;const s=n[i]||t;if(Array.isArray(a)){const d=or({allowReserved:s.allowReserved,explode:!0,name:i,style:"form",value:a,...s.array});d&&o.push(d)}else if(typeof a=="object"){const d=ir({allowReserved:s.allowReserved,explode:!0,name:i,style:"deepObject",value:a,...s.object});d&&o.push(d)}else{const d=Je({allowReserved:s.allowReserved,name:i,value:a});d&&o.push(d)}}return o.join("&")},Yr=n=>{if(!n)return"stream";const t=n.split(";")[0]?.trim();if(t){if(t.startsWith("application/json")||t.endsWith("+json"))return"json";if(t==="multipart/form-data")return"formData";if(["application/","audio/","image/","video/"].some(e=>t.startsWith(e)))return"blob";if(t.startsWith("text/"))return"text"}},Zr=(n,t)=>t?!!(n.headers.has(t)||n.query?.[t]||n.headers.get("Cookie")?.includes(`${t}=`)):!1,Xr=async({security:n,...t})=>{for(const e of n){if(Zr(t,e.name))continue;const r=await Jr(e,t.auth);if(!r)continue;const o=e.name??"Authorization";switch(e.in){case"query":t.query||(t.query={}),t.query[o]=r;break;case"cookie":t.headers.append("Cookie",`${o}=${r}`);break;default:t.headers.set(o,r);break}}},Lt=n=>Kr({baseUrl:n.baseUrl,path:n.path,query:n.query,querySerializer:typeof n.querySerializer=="function"?n.querySerializer:sr(n.querySerializer),url:n.url}),zt=(n,t)=>{const e={...n,...t};return e.baseUrl?.endsWith("/")&&(e.baseUrl=e.baseUrl.substring(0,e.baseUrl.length-1)),e.headers=ar(n.headers,t.headers),e},en=n=>{const t=[];return n.forEach((e,r)=>{t.push([r,e])}),t},ar=(...n)=>{const t=new Headers;for(const e of n){if(!e)continue;const r=e instanceof Headers?en(e):Object.entries(e);for(const[o,i]of r)if(i===null)t.delete(o);else if(Array.isArray(i))for(const a of i)t.append(o,a);else i!==void 0&&t.set(o,typeof i=="object"?JSON.stringify(i):i)}return t};class ct{fns=[];clear(){this.fns=[]}eject(t){const e=this.getInterceptorIndex(t);this.fns[e]&&(this.fns[e]=null)}exists(t){const e=this.getInterceptorIndex(t);return!!this.fns[e]}getInterceptorIndex(t){return typeof t=="number"?this.fns[t]?t:-1:this.fns.indexOf(t)}update(t,e){const r=this.getInterceptorIndex(t);return this.fns[r]?(this.fns[r]=e,t):!1}use(t){return this.fns.push(t),this.fns.length-1}}const tn=()=>({error:new ct,request:new ct,response:new ct}),rn=sr({allowReserved:!1,array:{explode:!0,style:"form"},object:{explode:!0,style:"deepObject"}}),nn={"Content-Type":"application/json"},cr=(n={})=>({...Qr,headers:nn,parseAs:"auto",querySerializer:rn,...n}),lr=(n={})=>{let t=zt(cr(),n);const e=()=>({...t}),r=c=>(t=zt(t,c),e()),o=tn(),i=async c=>{const l={...t,...c,fetch:c.fetch??t.fetch??globalThis.fetch,headers:ar(t.headers,c.headers),serializedBody:void 0};l.security&&await Xr({...l,security:l.security}),l.requestValidator&&await l.requestValidator(l),l.body!==void 0&&l.bodySerializer&&(l.serializedBody=l.bodySerializer(l.body)),(l.body===void 0||l.serializedBody==="")&&l.headers.delete("Content-Type");const f=Lt(l);return{opts:l,url:f}},a=async c=>{const{opts:l,url:f}=await i(c),p={redirect:"follow",...l,body:xt(l)};let h=new Request(f,p);for(const v of o.request.fns)v&&(h=await v(h,l));const g=l.fetch;let y;try{y=await g(h)}catch(v){let M=v;for(const D of o.error.fns)D&&(M=await D(v,void 0,h,l));if(M=M||{},l.throwOnError)throw M;return l.responseStyle==="data"?void 0:{error:M,request:h,response:void 0}}for(const v of o.response.fns)v&&(y=await v(y,h,l));const m={request:h,response:y};if(y.ok){const v=(l.parseAs==="auto"?Yr(y.headers.get("Content-Type")):l.parseAs)??"json";if(y.status===204||y.headers.get("Content-Length")==="0"){let D;switch(v){case"arrayBuffer":case"blob":case"text":D=await y[v]();break;case"formData":D=new FormData;break;case"stream":D=y.body;break;default:D={};break}return l.responseStyle==="data"?D:{data:D,...m}}let M;switch(v){case"arrayBuffer":case"blob":case"formData":case"text":M=await y[v]();break;case"json":{const D=await y.text();M=D?JSON.parse(D):{};break}case"stream":return l.responseStyle==="data"?y.body:{data:y.body,...m}}return v==="json"&&(l.responseValidator&&await l.responseValidator(M),l.responseTransformer&&(M=await l.responseTransformer(M))),l.responseStyle==="data"?M:{data:M,...m}}const w=await y.text();let I;try{I=JSON.parse(w)}catch{}const k=I??w;let C=k;for(const v of o.error.fns)v&&(C=await v(k,y,h,l));if(C=C||{},l.throwOnError)throw C;return l.responseStyle==="data"?void 0:{error:C,...m}},s=c=>l=>a({...l,method:c}),d=c=>async l=>{const{opts:f,url:p}=await i(l);return $r({...f,body:f.body,headers:f.headers,method:c,onRequest:async(h,g)=>{let y=new Request(h,g);for(const m of o.request.fns)m&&(y=await m(y,f));return y},serializedBody:xt(f),url:p})};return{buildUrl:Lt,connect:s("CONNECT"),delete:s("DELETE"),get:s("GET"),getConfig:e,head:s("HEAD"),interceptors:o,options:s("OPTIONS"),patch:s("PATCH"),post:s("POST"),put:s("PUT"),request:a,setConfig:r,sse:{connect:d("CONNECT"),delete:d("DELETE"),get:d("GET"),head:d("HEAD"),options:d("OPTIONS"),patch:d("PATCH"),post:d("POST"),put:d("PUT"),trace:d("TRACE")},trace:s("TRACE")}},on={$body_:"body",$headers_:"headers",$path_:"path",$query_:"query"},sn=Object.entries(on),dr=(n,t)=>{t||(t=new Map);for(const e of n)"in"in e?e.key&&t.set(e.key,{in:e.in,map:e.map}):"key"in e?t.set(e.key,{map:e.map}):e.args&&dr(e.args,t);return t},an=n=>{for(const[t,e]of Object.entries(n))e&&typeof e=="object"&&!Object.keys(e).length&&delete n[t]},S=(n,t)=>{const e={body:{},headers:{},path:{},query:{}},r=dr(t);let o;for(const[i,a]of n.entries())if(t[i]&&(o=t[i]),!!o)if("in"in o)if(o.key){const s=r.get(o.key),d=s.map||o.key;s.in&&(e[s.in][d]=a)}else e.body=a;else for(const[s,d]of Object.entries(a??{})){const c=r.get(s);if(c)if(c.in){const l=c.map||s;e[c.in][l]=d}else e[c.map]=d;else{const l=sn.find(([f])=>s.startsWith(f));if(l){const[f,p]=l;e[p][s.slice(f.length)]=d}else if("allowExtra"in o&&o.allowExtra){for(const[f,p]of Object.entries(o.allowExtra))if(p){e[f][s]=d;break}}}}return an(e),e},cn=lr(cr({baseUrl:"http://localhost:4096"}));class T{client;constructor(t){this.client=t?.client??cn}}class ln{defaultKey="default";instances=new Map;get(t){const e=this.instances.get(t??this.defaultKey);if(!e)throw new Error('No SDK client found. Create one with "new OpencodeClient()" to fix this error.');return e}set(t,e){this.instances.set(e??this.defaultKey,t)}}class dn extends T{get(t){return(t?.client??this.client).get({url:"/global/config",...t})}update(t,e){const r=S([t],[{args:[{key:"config",map:"body"}]}]);return(e?.client??this.client).patch({url:"/global/config",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class un extends T{health(t){return(t?.client??this.client).get({url:"/global/health",...t})}event(t){return(t?.client??this.client).sse.get({url:"/global/event",...t})}dispose(t){return(t?.client??this.client).post({url:"/global/dispose",...t})}_config;get config(){return this._config??=new dn({client:this.client})}}class fn extends T{remove(t,e){const r=S([t],[{args:[{in:"path",key:"providerID"}]}]);return(e?.client??this.client).delete({url:"/auth/{providerID}",...e,...r})}set(t,e){const r=S([t],[{args:[{in:"path",key:"providerID"},{key:"auth",map:"body"}]}]);return(e?.client??this.client).put({url:"/auth/{providerID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class pn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/project",...e,...r})}current(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/project/current",...e,...r})}update(t,e){const r=S([t],[{args:[{in:"path",key:"projectID"},{in:"query",key:"directory"},{in:"body",key:"name"},{in:"body",key:"icon"},{in:"body",key:"commands"}]}]);return(e?.client??this.client).patch({url:"/project/{projectID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class yn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/pty",...e,...r})}create(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"command"},{in:"body",key:"args"},{in:"body",key:"cwd"},{in:"body",key:"title"},{in:"body",key:"env"}]}]);return(e?.client??this.client).post({url:"/pty",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}remove(t,e){const r=S([t],[{args:[{in:"path",key:"ptyID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).delete({url:"/pty/{ptyID}",...e,...r})}get(t,e){const r=S([t],[{args:[{in:"path",key:"ptyID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/pty/{ptyID}",...e,...r})}update(t,e){const r=S([t],[{args:[{in:"path",key:"ptyID"},{in:"query",key:"directory"},{in:"body",key:"title"},{in:"body",key:"size"}]}]);return(e?.client??this.client).put({url:"/pty/{ptyID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}connect(t,e){const r=S([t],[{args:[{in:"path",key:"ptyID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/pty/{ptyID}/connect",...e,...r})}}class hn extends T{get(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/config",...e,...r})}update(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"config",map:"body"}]}]);return(e?.client??this.client).patch({url:"/config",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}providers(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/config/providers",...e,...r})}}class mn extends T{ids(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/experimental/tool/ids",...e,...r})}list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"provider"},{in:"query",key:"model"}]}]);return(e?.client??this.client).get({url:"/experimental/tool",...e,...r})}}class gn extends T{remove(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"worktreeRemoveInput",map:"body"}]}]);return(e?.client??this.client).delete({url:"/experimental/worktree",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/experimental/worktree",...e,...r})}create(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"worktreeCreateInput",map:"body"}]}]);return(e?.client??this.client).post({url:"/experimental/worktree",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}reset(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"worktreeResetInput",map:"body"}]}]);return(e?.client??this.client).post({url:"/experimental/worktree/reset",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class Sn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/experimental/resource",...e,...r})}}class wn extends T{_resource;get resource(){return this._resource??=new Sn({client:this.client})}}class bn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"roots"},{in:"query",key:"start"},{in:"query",key:"search"},{in:"query",key:"limit"}]}]);return(e?.client??this.client).get({url:"/session",...e,...r})}create(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"parentID"},{in:"body",key:"title"},{in:"body",key:"permission"}]}]);return(e?.client??this.client).post({url:"/session",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}status(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/session/status",...e,...r})}delete(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).delete({url:"/session/{sessionID}",...e,...r})}get(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}",...e,...r})}update(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"title"},{in:"body",key:"time"}]}]);return(e?.client??this.client).patch({url:"/session/{sessionID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}children(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}/children",...e,...r})}todo(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}/todo",...e,...r})}init(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"modelID"},{in:"body",key:"providerID"},{in:"body",key:"messageID"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/init",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}fork(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"messageID"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/fork",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}abort(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/abort",...e,...r})}unshare(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).delete({url:"/session/{sessionID}/share",...e,...r})}share(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/share",...e,...r})}diff(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"query",key:"messageID"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}/diff",...e,...r})}summarize(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"providerID"},{in:"body",key:"modelID"},{in:"body",key:"auto"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/summarize",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}messages(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"query",key:"limit"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}/message",...e,...r})}prompt(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"messageID"},{in:"body",key:"model"},{in:"body",key:"agent"},{in:"body",key:"noReply"},{in:"body",key:"tools"},{in:"body",key:"format"},{in:"body",key:"system"},{in:"body",key:"variant"},{in:"body",key:"parts"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/message",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}message(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"path",key:"messageID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/session/{sessionID}/message/{messageID}",...e,...r})}promptAsync(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"messageID"},{in:"body",key:"model"},{in:"body",key:"agent"},{in:"body",key:"noReply"},{in:"body",key:"tools"},{in:"body",key:"format"},{in:"body",key:"system"},{in:"body",key:"variant"},{in:"body",key:"parts"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/prompt_async",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}command(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"messageID"},{in:"body",key:"agent"},{in:"body",key:"model"},{in:"body",key:"arguments"},{in:"body",key:"command"},{in:"body",key:"variant"},{in:"body",key:"parts"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/command",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}shell(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"agent"},{in:"body",key:"model"},{in:"body",key:"command"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/shell",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}revert(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"},{in:"body",key:"messageID"},{in:"body",key:"partID"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/revert",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}unrevert(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/unrevert",...e,...r})}}class vn extends T{delete(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"path",key:"messageID"},{in:"path",key:"partID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).delete({url:"/session/{sessionID}/message/{messageID}/part/{partID}",...e,...r})}update(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"path",key:"messageID"},{in:"path",key:"partID"},{in:"query",key:"directory"},{key:"part",map:"body"}]}]);return(e?.client??this.client).patch({url:"/session/{sessionID}/message/{messageID}/part/{partID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class In extends T{respond(t,e){const r=S([t],[{args:[{in:"path",key:"sessionID"},{in:"path",key:"permissionID"},{in:"query",key:"directory"},{in:"body",key:"response"}]}]);return(e?.client??this.client).post({url:"/session/{sessionID}/permissions/{permissionID}",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}reply(t,e){const r=S([t],[{args:[{in:"path",key:"requestID"},{in:"query",key:"directory"},{in:"body",key:"reply"},{in:"body",key:"message"}]}]);return(e?.client??this.client).post({url:"/permission/{requestID}/reply",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/permission",...e,...r})}}class Dn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/question",...e,...r})}reply(t,e){const r=S([t],[{args:[{in:"path",key:"requestID"},{in:"query",key:"directory"},{in:"body",key:"answers"}]}]);return(e?.client??this.client).post({url:"/question/{requestID}/reply",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}reject(t,e){const r=S([t],[{args:[{in:"path",key:"requestID"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/question/{requestID}/reject",...e,...r})}}class kn extends T{authorize(t,e){const r=S([t],[{args:[{in:"path",key:"providerID"},{in:"query",key:"directory"},{in:"body",key:"method"}]}]);return(e?.client??this.client).post({url:"/provider/{providerID}/oauth/authorize",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}callback(t,e){const r=S([t],[{args:[{in:"path",key:"providerID"},{in:"query",key:"directory"},{in:"body",key:"method"},{in:"body",key:"code"}]}]);return(e?.client??this.client).post({url:"/provider/{providerID}/oauth/callback",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class Cn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/provider",...e,...r})}auth(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/provider/auth",...e,...r})}_oauth;get oauth(){return this._oauth??=new kn({client:this.client})}}class Mn extends T{text(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"pattern"}]}]);return(e?.client??this.client).get({url:"/find",...e,...r})}files(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"query"},{in:"query",key:"dirs"},{in:"query",key:"type"},{in:"query",key:"limit"}]}]);return(e?.client??this.client).get({url:"/find/file",...e,...r})}symbols(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"query"}]}]);return(e?.client??this.client).get({url:"/find/symbol",...e,...r})}}class An extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"path"}]}]);return(e?.client??this.client).get({url:"/file",...e,...r})}read(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"query",key:"path"}]}]);return(e?.client??this.client).get({url:"/file/content",...e,...r})}status(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/file/status",...e,...r})}}class En extends T{remove(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).delete({url:"/mcp/{name}/auth",...e,...r})}start(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/mcp/{name}/auth",...e,...r})}callback(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"},{in:"body",key:"code"}]}]);return(e?.client??this.client).post({url:"/mcp/{name}/auth/callback",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}authenticate(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/mcp/{name}/auth/authenticate",...e,...r})}}class _n extends T{status(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/mcp",...e,...r})}add(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"name"},{in:"body",key:"config"}]}]);return(e?.client??this.client).post({url:"/mcp",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}connect(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/mcp/{name}/connect",...e,...r})}disconnect(t,e){const r=S([t],[{args:[{in:"path",key:"name"},{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/mcp/{name}/disconnect",...e,...r})}_auth;get auth(){return this._auth??=new En({client:this.client})}}class Pn extends T{next(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/tui/control/next",...e,...r})}response(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"body",map:"body"}]}]);return(e?.client??this.client).post({url:"/tui/control/response",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}}class Tn extends T{appendPrompt(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"text"}]}]);return(e?.client??this.client).post({url:"/tui/append-prompt",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}openHelp(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/open-help",...e,...r})}openSessions(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/open-sessions",...e,...r})}openThemes(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/open-themes",...e,...r})}openModels(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/open-models",...e,...r})}submitPrompt(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/submit-prompt",...e,...r})}clearPrompt(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/tui/clear-prompt",...e,...r})}executeCommand(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"command"}]}]);return(e?.client??this.client).post({url:"/tui/execute-command",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}showToast(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"title"},{in:"body",key:"message"},{in:"body",key:"variant"},{in:"body",key:"duration"}]}]);return(e?.client??this.client).post({url:"/tui/show-toast",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}publish(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{key:"body",map:"body"}]}]);return(e?.client??this.client).post({url:"/tui/publish",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}selectSession(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"sessionID"}]}]);return(e?.client??this.client).post({url:"/tui/select-session",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}_control;get control(){return this._control??=new Pn({client:this.client})}}class On extends T{dispose(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).post({url:"/instance/dispose",...e,...r})}}class jn extends T{get(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/path",...e,...r})}}class Rn extends T{get(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/vcs",...e,...r})}}class xn extends T{list(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/command",...e,...r})}}class Ln extends T{log(t,e){const r=S([t],[{args:[{in:"query",key:"directory"},{in:"body",key:"service"},{in:"body",key:"level"},{in:"body",key:"message"},{in:"body",key:"extra"}]}]);return(e?.client??this.client).post({url:"/log",...e,...r,headers:{"Content-Type":"application/json",...e?.headers,...r.headers}})}agents(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/agent",...e,...r})}skills(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/skill",...e,...r})}}class zn extends T{status(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/lsp",...e,...r})}}class Fn extends T{status(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).get({url:"/formatter",...e,...r})}}let qn=class extends T{subscribe(t,e){const r=S([t],[{args:[{in:"query",key:"directory"}]}]);return(e?.client??this.client).sse.get({url:"/event",...e,...r})}};class vt extends T{static __registry=new ln;constructor(t){super(t),vt.__registry.set(this,t?.key)}_global;get global(){return this._global??=new un({client:this.client})}_auth;get auth(){return this._auth??=new fn({client:this.client})}_project;get project(){return this._project??=new pn({client:this.client})}_pty;get pty(){return this._pty??=new yn({client:this.client})}_config;get config(){return this._config??=new hn({client:this.client})}_tool;get tool(){return this._tool??=new mn({client:this.client})}_worktree;get worktree(){return this._worktree??=new gn({client:this.client})}_experimental;get experimental(){return this._experimental??=new wn({client:this.client})}_session;get session(){return this._session??=new bn({client:this.client})}_part;get part(){return this._part??=new vn({client:this.client})}_permission;get permission(){return this._permission??=new In({client:this.client})}_question;get question(){return this._question??=new Dn({client:this.client})}_provider;get provider(){return this._provider??=new Cn({client:this.client})}_find;get find(){return this._find??=new Mn({client:this.client})}_file;get file(){return this._file??=new An({client:this.client})}_mcp;get mcp(){return this._mcp??=new _n({client:this.client})}_tui;get tui(){return this._tui??=new Tn({client:this.client})}_instance;get instance(){return this._instance??=new On({client:this.client})}_path;get path(){return this._path??=new jn({client:this.client})}_vcs;get vcs(){return this._vcs??=new Rn({client:this.client})}_command;get command(){return this._command??=new xn({client:this.client})}_app;get app(){return this._app??=new Ln({client:this.client})}_lsp;get lsp(){return this._lsp??=new zn({client:this.client})}_formatter;get formatter(){return this._formatter??=new Fn({client:this.client})}_event;get event(){return this._event??=new qn({client:this.client})}}function Ft(n){if(n?.fetch||(n={...n,fetch:r=>(r.timeout=!1,fetch(r))}),n?.directory){const r=/[^\x00-\x7F]/.test(n.directory)?encodeURIComponent(n.directory):n.directory;n.headers={...n.headers,"x-opencode-directory":r}}const t=lr(n);return new vt({client:t})}const ie=()=>typeof window>"u"?!1:typeof window.__TAURI__?.core?.invoke=="function",qt=n=>{const t=n.trim();if(!t)return null;try{return new URL(t).origin}catch{try{return new URL(t.endsWith("/")?t:`${t}/`).origin}catch{return null}}},ce=()=>{if(typeof window>"u")return!1;const n=typeof window.__OPENCHAMBER_LOCAL_ORIGIN__=="string"?window.__OPENCHAMBER_LOCAL_ORIGIN__:"",t=qt(n),e=qt(window.location.origin)||window.location.origin;return!!(t&&e&&t===e)},Hn=()=>typeof window>"u"?!1:typeof window.__OPENCHAMBER_LOCAL_ORIGIN__=="string"&&window.__OPENCHAMBER_LOCAL_ORIGIN__.length>0?!0:ie(),Ce=()=>typeof window>"u"?!1:window.__OPENCHAMBER_RUNTIME_APIS__?.runtime?.isVSCode===!0,Nn=()=>{if(typeof window>"u")return!1;const t=window.__OPENCHAMBER_RUNTIME_APIS__?.runtime?.platform;return t==="web"?!0:t==="desktop"||t==="vscode"?!1:!Ce()},It=async()=>{if(typeof window<"u"){const n=window.__OPENCHAMBER_HOME__;if(n&&n.length>0)return n}return null},$n=async n=>{if(ie()&&ce())try{const e=await window.__TAURI__?.dialog?.open?.({directory:!0,multiple:!1,title:"Select Working Directory"});return!e||typeof e!="string"?{success:!1,error:"Directory selection cancelled"}:{success:!0,path:e}}catch(t){return console.warn("Failed to request directory access (tauri)",t),{success:!1,error:t instanceof Error?t.message:String(t)}}return{success:!0,path:n}},Bn=async n=>({success:!0}),Vn=async n=>({success:!0}),Un=async()=>{if(!ie()||!ce())return null;try{return await window.__TAURI__?.core?.invoke?.("desktop_check_for_updates")}catch(n){return console.warn("Failed to check for updates (tauri)",n),null}},Wn=async n=>{if(!ie()||!ce())return!1;const t=window.__TAURI__;let e=null,r=0,o;try{return typeof n=="function"&&t?.event?.listen&&(e=await t.event.listen("openchamber:update-progress",i=>{const a=i?.payload;if(!a||typeof a!="object")return;const s=a,d=typeof s.event=="string"?s.event:null,c=s.data&&typeof s.data=="object"?s.data:null;if(d==="Started"){r=0,o=typeof c?.contentLength=="number"?c.contentLength:void 0,n({downloaded:r,total:o});return}if(d==="Progress"){const l=c?.downloaded,f=c?.total;typeof l=="number"&&(r=l),typeof f=="number"&&(o=f),n({downloaded:r,total:o});return}d==="Finished"&&n({downloaded:r,total:o})})),await t?.core?.invoke?.("desktop_download_and_install_update"),!0}catch(i){return console.warn("Failed to download update (tauri)",i),!1}finally{if(e)try{const i=e();i instanceof Promise&&await i}catch{}}},Gn=async()=>{if(!ie()||!ce())return!1;try{return await window.__TAURI__?.core?.invoke?.("desktop_restart"),!0}catch(n){return console.warn("Failed to restart for update (tauri)",n),!1}},Kn=async(n,t)=>{if(!ie()||!ce())return!1;const e=n?.trim();if(!e)return!1;try{return await window.__TAURI__?.core?.invoke?.("desktop_open_path",{path:e,app:typeof t=="string"&&t.trim().length>0?t.trim():void 0}),!0}catch(r){return console.warn("Failed to open path (tauri)",r),!1}},Jn=async(n,t)=>{if(!ie()||!ce())return{apps:[],success:!1,hasCache:!1,isCacheStale:!1};const e=Array.isArray(n)?n.filter(r=>typeof r=="string"):[];if(e.length===0)return{apps:[],success:!0,hasCache:!1,isCacheStale:!1};try{const o=await window.__TAURI__?.core?.invoke?.("desktop_get_installed_apps",{apps:e,force:t===!0?!0:void 0});if(!o||typeof o!="object")return{apps:[],success:!1,hasCache:!1,isCacheStale:!1};const i=o;return Array.isArray(i.apps)?{apps:i.apps.filter(s=>s&&typeof s=="object").map(s=>{const d=s;return{name:typeof d.name=="string"?d.name:"",iconDataUrl:typeof d.iconDataUrl=="string"?d.iconDataUrl:null}}).filter(s=>s.name.length>0),success:!0,hasCache:i.hasCache===!0,isCacheStale:i.isCacheStale===!0}:{apps:[],success:!1,hasCache:!1,isCacheStale:!1}}catch(r){return console.warn("Failed to fetch installed apps (tauri)",r),{apps:[],success:!1,hasCache:!1,isCacheStale:!1}}},yi=Object.freeze(Object.defineProperty({__proto__:null,checkForDesktopUpdates:Un,downloadDesktopUpdate:Wn,fetchDesktopInstalledApps:Jn,getDesktopHomeDirectory:It,isDesktopLocalOriginActive:ce,isDesktopShell:Hn,isTauriShell:ie,isVSCodeRuntime:Ce,isWebRuntime:Nn,openDesktopPath:Kn,requestDirectoryAccess:$n,restartToApplyUpdate:Gn,startAccessingDirectory:Bn,stopAccessingDirectory:Vn},Symbol.toStringTag,{value:"Module"})),Qn="/api",Yn=/^[a-zA-Z][a-zA-Z\d+\-.]*:\/\//,Zn=n=>{const t=typeof n=="string"&&n.trim().length>0?n.trim():"/api";if(Yn.test(t)||typeof window>"u")return t;const e=window.location?.href||window.location?.origin;if(!e)return t;try{return new URL(t,e).toString()}catch(r){return console.warn("Failed to normalize OpenCode base URL:",r),t}},Xn=()=>{if(typeof window>"u")return null;const n=window.__OPENCHAMBER_DESKTOP_SERVER__,t=!!window.__OPENCHAMBER_RUNTIME_APIS__?.runtime?.isDesktop;if(!n||!t)return null;const e=typeof n.origin=="string"&&n.origin.length>0?n.origin:null;return e?`${e}/api`:null},Re=n=>n.replace(/\\/g,"/"),lt=()=>{if(typeof window>"u")return null;const n=window.__OPENCHAMBER_RUNTIME_APIS__;return n&&n.runtime?.isDesktop&&n.files?n.files:null};class eo{client;baseUrl;scopedClients=new Map;sseAbortControllers=new Map;currentDirectory=void 0;globalSseAbortController=null;globalSseTask=null;globalSseLastEventId;globalSseIsConnected=!1;globalSseListeners=new Set;globalSseOpenListeners=new Set;globalSseErrorListeners=new Set;globalSseQueue=[];globalSseBuffer=[];globalSseCoalesced=new Map;globalSseFlushTimer=null;globalSseLastFlushAt=0;constructor(t=Qn){const r=Xn()||t;this.baseUrl=Zn(r),this.client=Ft({baseUrl:this.baseUrl})}getBaseUrl(){return this.baseUrl}getScopedApiClient(t){const e=this.normalizeCandidatePath(t)??t,r=e||"",o=this.scopedClients.get(r);if(o)return o;const i=Ft({baseUrl:this.baseUrl,directory:e});return this.scopedClients.set(r,i),i}normalizeCandidatePath(t){if(typeof t!="string")return null;const e=t.trim();if(!e)return null;const r=e.replace(/\\/g,"/");return(r.length>1?r.replace(/\/+$/,""):r)||null}deriveHomeDirectory(t){const e=t.match(/^([A-Za-z]:)(?:\/|$)/);if(e){const i=e[1],s=t.slice(i.length+(t.charAt(i.length)==="/"?1:0)).split("/").filter(Boolean);return s.length>=2?{homeDirectory:`${i}/${s[0]}/${s[1]}`,username:s[1]}:s.length===1?{homeDirectory:`${i}/${s[0]}`,username:s[0]}:{homeDirectory:i,username:void 0}}const r=t.startsWith("/"),o=t.split("/").filter(Boolean);return o.length>=2&&(o[0]==="Users"||o[0]==="home")?{homeDirectory:`${r?"/":""}${o[0]}/${o[1]}`,username:o[1]}:r?o.length===0?{homeDirectory:"/",username:void 0}:{homeDirectory:`/${o.join("/")}`,username:o[o.length-1]}:o.length>0?{homeDirectory:`/${o.join("/")}`,username:o[o.length-1]}:{homeDirectory:"/",username:void 0}}setDirectory(t){this.currentDirectory=t}getDirectory(){return this.currentDirectory}async withDirectory(t,e){if(t==null)return e();const r=this.currentDirectory;this.currentDirectory=t;try{return await e()}finally{this.currentDirectory=r}}getApiClient(){return this.client}async getSystemInfo(){const t=new Set,e=o=>{const i=this.normalizeCandidatePath(o);i&&t.add(i)};try{const i=(await this.client.path.get(this.currentDirectory?{directory:this.currentDirectory}:void 0)).data;i&&(e(i.directory),e(i.worktree),e(i.state))}catch(o){console.debug("Failed to load path info:",o)}if(!t.size)try{const o=await this.client.project.current(this.currentDirectory?{directory:this.currentDirectory}:void 0);e(o.data?.worktree)}catch(o){console.debug("Failed to load project info:",o)}if(!t.size)try{(await this.listSessions()).forEach(i=>e(i.directory))}catch(o){console.debug("Failed to inspect sessions for system info:",o)}if(e(this.currentDirectory),typeof window<"u")try{e(window.localStorage.getItem("lastDirectory")),e(window.localStorage.getItem("homeDirectory"))}catch{}if(!t.size&&typeof process<"u"&&typeof process.cwd=="function"&&e(process.cwd()),!t.size)return{homeDirectory:"/",username:void 0};const[r]=Array.from(t);return this.deriveHomeDirectory(r)}async probeDirectory(t){const e=this.normalizeCandidatePath(t);if(!e)return!1;try{const o=(await this.client.path.get({directory:e})).data,i=typeof o?.directory=="string"?o.directory:null;return!!(i&&i.trim().length>0)}catch{return!1}}async listSessions(){const t=await this.client.session.list(this.currentDirectory?{directory:this.currentDirectory}:void 0);return Array.isArray(t.data)?t.data:[]}async createSession(t){const e=await this.client.session.create({...this.currentDirectory?{directory:this.currentDirectory}:{},parentID:t?.parentID,title:t?.title});if(!e.data)throw new Error("Failed to create session");return e.data}async getSession(t){const e=await this.client.session.get({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{}});if(!e.data)throw new Error("Session not found");return e.data}async deleteSession(t){return(await this.client.session.delete({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{}})).data||!1}async updateSession(t,e){const r=await this.client.session.update({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},title:e});if(!r.data)throw new Error("Failed to update session");return r.data}async getSessionMessages(t,e){return(await this.client.session.messages({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},...typeof e=="number"?{limit:e}:{}})).data||[]}async getSessionTodos(t){try{const e=this.baseUrl.replace(/\/$/,""),r=new URL(`${e}/session/${encodeURIComponent(t)}/todo`);this.currentDirectory&&this.currentDirectory.length>0&&r.searchParams.set("directory",this.currentDirectory);const o=await fetch(r.toString(),{method:"GET",headers:{Accept:"application/json"}});if(!o.ok)return[];const i=await o.json().catch(()=>null);return!i||!Array.isArray(i)?[]:i}catch{return[]}}shouldNormalizeToTextPlain(t){if(!t)return!1;const e=t.toLowerCase();return e.startsWith("text/")&&e!=="text/plain"?!0:["application/json","application/xml","application/javascript","application/typescript","application/x-yaml","application/yaml","application/toml","application/x-sh","application/x-shellscript"].includes(e)}isHeicMime(t){if(!t)return!1;const e=t.toLowerCase();return e==="image/heic"||e==="image/heif"}async convertHeicToJpeg(t){try{const e=(await Cr(async()=>{const{default:f}=await import("./heic2any.js").then(p=>p.h);return{default:f}},[],import.meta.url)).default,r=t.url.indexOf(",");if(r===-1)return t;const o=t.url.substring(r+1),i=atob(o),a=new Uint8Array(i.length);for(let f=0;f<i.length;f++)a[f]=i.charCodeAt(f);const s=new Blob([a],{type:t.mime}),d=await e({blob:s,toType:"image/jpeg",quality:.9}),c=await new Promise((f,p)=>{const h=new FileReader;h.onload=()=>f(h.result),h.onerror=p,h.readAsDataURL(d)});let l=t.filename;return l&&(l=l.replace(/\.heic$/i,".jpg").replace(/\.heif$/i,".jpg")),{mime:"image/jpeg",filename:l,url:c}}catch(e){return console.warn("Failed to convert HEIC to JPEG:",e),t}}async normalizeFilePart(t){if(this.isHeicMime(t.mime))return this.convertHeicToJpeg(t);if(!this.shouldNormalizeToTextPlain(t.mime))return t;let e=t.url;if(t.url.startsWith("data:")){const r=t.url.indexOf(",");if(r!==-1){const o=t.url.substring(5,r),i=t.url.substring(r);e=`data:${o.replace(/^[^;,]+/,"text/plain")}${i}`}}return{mime:"text/plain",filename:t.filename,url:e}}async sendMessage(t){const e=Date.now(),r=t.messageId??`temp_${e}_${Math.random().toString(36).substring(2,9)}`,o=[];if(t.prefaceText&&t.prefaceText.trim()&&o.push({type:"text",text:t.prefaceText,synthetic:t.prefaceTextSynthetic!==!1}),t.text&&t.text.trim()){const i={type:"text",text:t.text};o.push(i)}if(t.files&&t.files.length>0)for(const i of t.files){const a=await this.normalizeFilePart(i),s={...i.id?{id:i.id}:{},type:"file",mime:a.mime,filename:a.filename,url:a.url};o.push(s)}if(t.additionalParts&&t.additionalParts.length>0){for(const i of t.additionalParts)if(i.text&&i.text.trim()&&o.push({type:"text",text:i.text,...i.synthetic?{synthetic:!0}:{}}),i.files&&i.files.length>0)for(const a of i.files){const s=await this.normalizeFilePart(a),d={...a.id?{id:a.id}:{},type:"file",mime:s.mime,filename:s.filename,url:s.url};o.push(d)}}if(t.agentMentions&&t.agentMentions.length>0){const[i]=t.agentMentions;i?.name&&o.push({type:"agent",name:i.name,...i.source?{source:i.source}:{}})}if(o.length===0)throw new Error("Message must have at least one part (text or file)");return await this.client.session.prompt({sessionID:t.id,...this.currentDirectory?{directory:this.currentDirectory}:{},model:{providerID:t.providerID,modelID:t.modelID},agent:t.agent,variant:t.variant,parts:o}),r}async abortSession(t){return!!(await this.client.session.abort({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{}},{throwOnError:!0})).data}async revertSession(t,e,r){const o=await this.client.session.revert({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},messageID:e,partID:r});if(!o.data)throw new Error("Failed to revert session");return o.data}async unrevertSession(t){const e=await this.client.session.unrevert({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{}});if(!e.data)throw new Error("Failed to unrevert session");return e.data}async forkSession(t,e){const r=await this.client.session.fork({sessionID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},messageID:e});if(!r.data)throw new Error("Failed to fork session");return r.data}async getSessionStatus(){return this.getSessionStatusForDirectory(this.currentDirectory??null)}async getSessionStatusForDirectory(t){try{const e=this.baseUrl.replace(/\/$/,""),r=new URL(`${e}/session/status`),o=typeof t=="string"?t.trim():"";o.length>0&&r.searchParams.set("directory",o);const i=await fetch(r.toString(),{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)return{};const a=await i.json().catch(()=>null);return!a||typeof a!="object"?{}:a}catch{return{}}}async getGlobalSessionStatus(){return this.getSessionStatusForDirectory(null)}async getWebServerSessionActivity(){try{const t=await fetch("/api/session-activity",{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)return null;const e=await t.json().catch(()=>null);return!e||typeof e!="object"?null:e}catch{return null}}async listToolIds(t){try{const e=typeof t?.directory=="string"?t.directory.trim():this.currentDirectory?this.currentDirectory.trim():"";return((await this.client.tool.ids(e?{directory:e}:void 0)).data||[]).filter(i=>typeof i=="string"&&i!=="invalid")}catch{return[]}}async replyToPermission(t,e,r){return(await this.client.permission.reply({requestID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},reply:e,...r?.message?{message:r.message}:{}})).data||!1}async listPendingPermissions(){try{return(await this.client.permission.list()).data||[]}catch{return[]}}async replyToQuestion(t,e){const r=!Array.isArray(e)||e.length===0?[]:Array.isArray(e[0])?e:[e];return(await this.client.question.reply({requestID:t,...this.currentDirectory?{directory:this.currentDirectory}:{},answers:r})).data||!1}async rejectQuestion(t){return(await this.client.question.reject({requestID:t,...this.currentDirectory?{directory:this.currentDirectory}:{}})).data||!1}async listPendingQuestions(t){const e=[],r=async d=>{try{const c=typeof d=="string"?d.trim():"";return(await this.client.question.list(c?{directory:c}:void 0)).data||[]}catch{return[]}};e.push(r(null));const o=new Set;for(const d of t?.directories??[]){const c=this.normalizeCandidatePath(d??null);c&&o.add(c)}for(const d of o)e.push(r(d));const i=await Promise.all(e),a=[],s=new Set;for(const d of i)for(const c of d){if(!c||typeof c!="object")continue;const l=c.id;typeof l!="string"||l.length===0||s.has(l)||(s.add(l),a.push(c))}return a}async getConfig(){const t=await this.client.config.get();if(!t.data)throw new Error("Failed to get config");return t.data}async updateConfig(t){const e=`${this.baseUrl}/config`,r=await fetch(e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const i=await r.text();throw console.error("[OpencodeClient] Failed to update config:",r.status,i),new Error(`Failed to update config: ${r.status} ${r.statusText}`)}return await r.json()}async updateConfigPartial(t){const e=await this.getConfig(),r=t(e);return await this.updateConfig(r)}async getProviders(){const t=await this.client.config.providers(this.currentDirectory?{directory:this.currentDirectory}:void 0);if(!t.data)throw new Error("Failed to get providers");return t.data}async getApp(){return{version:"0.0.3",config:await this.getConfig()}}async initApp(){try{return await this.checkHealth()}catch{return!1}}async listAgents(){try{return(await this.client.app.agents(this.currentDirectory?{directory:this.currentDirectory}:void 0)).data||[]}catch{return[]}}parseSseBlock(t){if(!t)return null;const e=t.split(`
`),r=[];let o;for(const a of e)if(a.startsWith("data:"))r.push(a.slice(5).replace(/^\s/,""));else if(a.startsWith("id:")){const s=a.slice(3).trim();s&&(o=s)}if(r.length===0)return null;const i=r.join(`
`).trim();if(!i)return null;try{return{data:JSON.parse(i),id:o}}catch{return null}}normalizeRoutedSsePayload(t){if(!t||typeof t!="object")return null;const e=t,r=typeof e.directory=="string"?e.directory:typeof e.properties=="object"&&e.properties!==null?e.properties.directory:null,o=typeof r=="string"?this.normalizeCandidatePath(r)??r.trim():null;if(typeof e.type=="string")return{directory:o&&o.length>0?o:"global",payload:e};const i=e.payload;if(i&&typeof i=="object"){const a=i;if(typeof a.type=="string")return{directory:o&&o.length>0?o:"global",payload:a}}return null}emitGlobalSseEvent(t){this.enqueueGlobalSseEvent(t)}notifyGlobalSseOpen(){for(const t of this.globalSseOpenListeners)try{t()}catch(e){console.warn("[OpencodeClient] Global SSE open handler error:",e)}}notifyGlobalSseError(t){for(const e of this.globalSseErrorListeners)try{e(t)}catch(r){console.warn("[OpencodeClient] Global SSE error handler failed:",r)}}ensureGlobalSseStarted(){if(this.globalSseTask)return;const t=new AbortController;this.globalSseAbortController=t,this.globalSseTask=this.runGlobalSseLoop(t).catch(e=>{e?.name==="AbortError"||t.signal.aborted||console.error("[OpencodeClient] Global SSE task failed:",e)}).finally(()=>{this.globalSseAbortController===t&&(this.globalSseAbortController=null),this.globalSseTask=null,this.globalSseIsConnected=!1})}maybeStopGlobalSse(){this.globalSseListeners.size>0||(this.globalSseAbortController&&!this.globalSseAbortController.signal.aborted&&this.globalSseAbortController.abort(),this.globalSseAbortController=null,this.clearGlobalSseQueue())}clearGlobalSseQueue(){this.globalSseFlushTimer&&(clearTimeout(this.globalSseFlushTimer),this.globalSseFlushTimer=null),this.globalSseQueue.length=0,this.globalSseBuffer.length=0,this.globalSseCoalesced.clear()}getGlobalSseCoalesceKey(t){const e=t.payload,r=typeof e.type=="string"?e.type:null;if(!r)return null;const o=typeof e.properties=="object"&&e.properties!==null?e.properties:null;if(r==="session.status"){const i=typeof o?.sessionID=="string"?o.sessionID:typeof o?.sessionId=="string"?o.sessionId:null;return i?`session.status:${t.directory}:${i}`:null}if(r==="openchamber:session-status"){const i=typeof o?.sessionId=="string"?o.sessionId:typeof o?.sessionID=="string"?o.sessionID:null;return i?`openchamber:session-status:${i}`:null}return null}flushGlobalSseQueue=()=>{if(this.globalSseFlushTimer&&(clearTimeout(this.globalSseFlushTimer),this.globalSseFlushTimer=null),this.globalSseQueue.length===0)return;const t=this.globalSseQueue;this.globalSseQueue=this.globalSseBuffer,this.globalSseBuffer=t,this.globalSseQueue.length=0,this.globalSseCoalesced.clear(),this.globalSseLastFlushAt=Date.now();for(const e of t)if(e)for(const r of this.globalSseListeners)try{r(e)}catch(o){console.warn("[OpencodeClient] Global SSE listener error:",o)}this.globalSseBuffer.length=0};scheduleGlobalSseFlush(){if(this.globalSseFlushTimer)return;const t=Date.now()-this.globalSseLastFlushAt,e=Math.max(0,16-t);this.globalSseFlushTimer=setTimeout(this.flushGlobalSseQueue,e)}enqueueGlobalSseEvent(t){const e=this.getGlobalSseCoalesceKey(t);if(e){const r=this.globalSseCoalesced.get(e);r!==void 0&&(this.globalSseQueue[r]=void 0),this.globalSseCoalesced.set(e,this.globalSseQueue.length)}this.globalSseQueue.push(t),this.scheduleGlobalSseFlush()}async runGlobalSseLoop(t){const e=`${this.baseUrl.replace(/\/+$/,"")}/global/event`;let r=0;for(;!t.signal.aborted;){try{const i={Accept:"text/event-stream","Cache-Control":"no-cache"};this.globalSseLastEventId&&(i["Last-Event-ID"]=this.globalSseLastEventId);const a=await fetch(e,{method:"GET",headers:i,signal:t.signal});if(!a.ok||!a.body)throw new Error(`Global SSE connect failed with status ${a.status}`);r=0,this.globalSseIsConnected=!0,t.signal.aborted||this.notifyGlobalSseOpen();const s=a.body.getReader(),d=new TextDecoder;let c="";for(;;){const{done:f,value:p}=await s.read();if(f||t.signal.aborted)break;if(!p||p.length===0)continue;c+=d.decode(p,{stream:!0}).replace(/\r\n/g,`
`);const h=c.split(`

`);c=h.pop()??"";for(const g of h){const y=this.parseSseBlock(g);if(!y)continue;y.id&&(this.globalSseLastEventId=y.id);const m=this.normalizeRoutedSsePayload(y.data);m&&this.emitGlobalSseEvent(m)}}const l=c.trim();if(l&&!t.signal.aborted){const f=this.parseSseBlock(l);f?.id&&(this.globalSseLastEventId=f.id);const p=f?this.normalizeRoutedSsePayload(f.data):null;p&&this.emitGlobalSseEvent(p)}this.globalSseIsConnected=!1}catch(i){if(this.globalSseIsConnected=!1,i?.name==="AbortError"||t.signal.aborted)return;console.error("[OpencodeClient] Global SSE stream error (will retry):",i),this.notifyGlobalSseError(i)}if(t.signal.aborted)break;r+=1;const o=Math.min(3e3*Math.pow(2,r),3e4);await new Promise(i=>setTimeout(i,o))}this.flushGlobalSseQueue()}subscribeToGlobalEvents(t,e,r,o){const i=this.normalizeCandidatePath(o?.directory??null),a=s=>{i&&s.directory!==i||t(s)};return this.globalSseListeners.add(a),r&&(this.globalSseOpenListeners.add(r),this.globalSseIsConnected&&setTimeout(()=>{if(this.globalSseOpenListeners.has(r))try{r()}catch(s){console.warn("[OpencodeClient] Global SSE open handler error:",s)}},0)),e&&this.globalSseErrorListeners.add(e),this.ensureGlobalSseStarted(),()=>{this.globalSseListeners.delete(a),r&&this.globalSseOpenListeners.delete(r),e&&this.globalSseErrorListeners.delete(e),this.maybeStopGlobalSse()}}subscribeToEvents(t,e,r,o,i){const a=i?.key??"default",s=i?.scope??"directory",d=this.sseAbortControllers.get(a);d&&d.abort();const c=new AbortController;this.sseAbortControllers.set(a,c);let l;if(s==="global"){let p=null;const h=y=>{if(y.directory==="global")return y.payload;const m=y.payload,w=typeof m.properties=="object"&&m.properties!==null?m.properties:{};return w.directory===y.directory?y.payload:{...m,properties:{...w,directory:y.directory}}},g=()=>{if(p){try{p()}catch{}p=null}this.sseAbortControllers.get(a)===c&&this.sseAbortControllers.delete(a)};return c.signal.addEventListener("abort",g,{once:!0}),p=this.subscribeToGlobalEvents(y=>{c.signal.aborted||t(h(y))},e?y=>{c.signal.aborted||e(y)}:void 0,r?()=>{c.signal.aborted||r()}:void 0),()=>{g(),c.abort()}}const f=p=>{if(!p||typeof p!="object")return null;const h=p;if(typeof h.type=="string")return h;const g=h.payload;if(g&&typeof g=="object"){const y=g;if(typeof y.type=="string"){if(typeof h.directory=="string"&&h.directory.length>0){const w={...(typeof y.properties=="object"&&y.properties!==null?y.properties:null)??{},directory:h.directory};return{...y,properties:w}}return y}}return null};return console.log("[OpencodeClient] Starting SSE subscription..."),(async()=>{const p=typeof o=="string"&&o.trim().length>0?o.trim():this.currentDirectory;console.log("[OpencodeClient] Connecting to SSE with directory:",p??"default");const h=async g=>{try{const y=p?{directory:p}:void 0,m={signal:c.signal,sseDefaultRetryDelay:3e3,sseMaxRetryDelay:3e4,onSseError:I=>{I instanceof Error&&I.name==="AbortError"||(console.error("[OpencodeClient] SSE error:",I),e&&!c.signal.aborted&&e(I))},onSseEvent:I=>{if(c.signal.aborted)return;I.id&&typeof I.id=="string"&&(l=I.id);const k=I.data,C=f(k);C&&t(C)}};l&&(m.headers={...m.headers||{},"Last-Event-ID":l});const w=await this.client.event.subscribe(y,m);r&&!c.signal.aborted&&(console.log("[OpencodeClient] SSE connection opened"),r());for await(const I of w.stream)if(c.signal.aborted){console.log("[OpencodeClient] SSE stream aborted");break}}catch(y){if(y?.name==="AbortError"||c.signal.aborted){console.log("[OpencodeClient] SSE stream aborted normally");return}console.error("[OpencodeClient] SSE stream error (will retry):",y),e&&e(y);const m=Math.min(3e3*Math.pow(2,g),3e4);await new Promise(w=>setTimeout(w,m)),c.signal.aborted||await h(g+1);return}if(!c.signal.aborted){const y=Math.min(3e3*Math.pow(2,g),3e4);await new Promise(m=>setTimeout(m,y)),await h(g+1)}};try{await h(0)}finally{console.log("[OpencodeClient] SSE subscription cleanup"),this.sseAbortControllers.get(a)===c&&this.sseAbortControllers.delete(a)}})(),()=>{this.sseAbortControllers.get(a)===c&&this.sseAbortControllers.delete(a),c.abort()}}async readFile(t){try{const e=await fetch(`${this.baseUrl}/files/read`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,directory:this.currentDirectory})});if(!e.ok)throw new Error(`Failed to read file: ${e.statusText}`);return await e.text()}catch{return`// Content of ${t}
// This would be loaded from the server`}}async listFiles(t){try{const e=t||this.currentDirectory||"/",r=await fetch(`${this.baseUrl}/files/list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({directory:e})});if(!r.ok)throw new Error(`Failed to list files: ${r.statusText}`);return await r.json()}catch{return[]}}async listCommands(){try{return((await this.client.command.list(this.currentDirectory?{directory:this.currentDirectory}:void 0)).data||[]).map(e=>({name:e.name,description:e.description,agent:e.agent,model:e.model}))}catch{return[]}}async listCommandsWithDetails(){try{return((await this.client.command.list(this.currentDirectory?{directory:this.currentDirectory}:void 0)).data||[]).map(e=>({name:e.name,description:e.description,agent:e.agent,model:e.model,template:e.template,subtask:e.subtask}))}catch{return[]}}async getCommandDetails(t){try{const e=await this.client.command.list(this.currentDirectory?{directory:this.currentDirectory}:void 0);if(e.data){const r=e.data.find(o=>o.name===t);if(r)return{name:r.name,template:r.template,description:r.description,agent:r.agent,model:r.model}}return null}catch{return null}}async checkHealth(){try{let t;const e=this.baseUrl.endsWith("/")?this.baseUrl.replace(/\/+$/,""):this.baseUrl;e==="/api"?t="/health":e.endsWith("/api")?t=`${e.slice(0,-4)}/health`:t=`${e}/health`;const r=await fetch(t);return!(!r.ok||(await r.json()).isOpenCodeReady===!1)}catch{return!1}}async createDirectory(t,e){const r=lt();if(r?.createDirectory)try{return await r.createDirectory(t)}catch(s){const d=s instanceof Error?s.message:String(s);throw new Error(d||"Failed to create directory")}const o={path:t,...e?.allowOutsideWorkspace?{allowOutsideWorkspace:!0}:{}},i=await fetch(`${this.baseUrl}/fs/mkdir`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const s=await i.json().catch(()=>({error:"Failed to create directory"}));throw new Error(s.error||"Failed to create directory")}return await i.json()}async listLocalDirectory(t,e){const r=lt();if(r)try{const o=await r.listDirectory(t||"",e);return!o||!Array.isArray(o.entries)?[]:o.entries.map(i=>({name:i.name,path:Re(i.path),isDirectory:!!i.isDirectory,isFile:!i.isDirectory,isSymbolicLink:!1}))}catch(o){throw console.error("Failed to list directory contents:",o),o}try{const o=new URLSearchParams;t&&t.trim().length>0&&o.set("path",t),e?.respectGitignore&&o.set("respectGitignore","true");const i=o.toString(),a=await fetch(`${this.baseUrl}/fs/list${i?`?${i}`:""}`);if(!a.ok){const d=await a.json().catch(()=>({})),c=typeof d.error=="string"?d.error:"Failed to list directory";throw new Error(c)}const s=await a.json();return!s||!Array.isArray(s.entries)?[]:s.entries}catch(o){throw console.error("Failed to list directory contents:",o),o}}async searchFiles(t,e){const r=lt(),o=typeof e?.directory=="string"&&e.directory.trim().length>0?e.directory.trim():this.currentDirectory,i=o?Re(o):null;if(r)try{const l=await r.search({directory:o||"",query:t,maxResults:e?.limit,includeHidden:e?.includeHidden,respectGitignore:e?.respectGitignore});return Array.isArray(l)?l.map(f=>{const p=Re(f.path),h=p.split("/").filter(Boolean).pop()||p,g=f.preview&&f.preview.length>0&&typeof f.preview[0]=="string"?Re(f.preview[0]):i&&p.startsWith(i)&&p.slice(i.length).replace(/^\/+/,"")||h;return{name:h,path:p,relativePath:g,extension:h.includes(".")?h.split(".").pop()?.toLowerCase():void 0}}):[]}catch(l){throw console.error("Failed to search files:",l),l}const a=new URLSearchParams;o&&o.length>0&&a.set("directory",o),typeof t=="string"&&a.set("q",t),typeof e?.limit=="number"&&Number.isFinite(e.limit)&&a.set("limit",String(e.limit)),e?.includeHidden&&a.set("includeHidden","true"),e?.respectGitignore===!1&&a.set("respectGitignore","false");const s=`${this.baseUrl}/fs/search${a.toString()?`?${a.toString()}`:""}`,d=await fetch(s,{method:"GET",headers:{Accept:"application/json"}});if(!d.ok){const l=await d.json().catch(()=>({})),f=typeof l.error=="string"?l.error:"Failed to search files";throw new Error(f)}const c=await d.json();return!c||!Array.isArray(c.files)?[]:c.files}async getFilesystemHome(){const t=await It();if(t)return t;try{const e=await fetch(`${this.baseUrl}/fs/home`,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok){const o=await e.json().catch(()=>({})),i=typeof o.error=="string"&&o.error.length>0?o.error:"Failed to resolve home directory";throw new Error(i)}const r=await e.json();return r&&typeof r.home=="string"&&r.home.length>0?r.home:null}catch(e){return console.warn("Failed to resolve filesystem home directory:",e),null}}async setOpenCodeWorkingDirectory(t){if(!t||typeof t!="string"||!t.trim())return console.warn("[OpencodeClient] setOpenCodeWorkingDirectory: invalid path",t),null;const e=`${this.baseUrl}/opencode/directory`;console.log("[OpencodeClient] POST",e,"with path:",t);try{const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})}),o=await r.json().catch(()=>null);if(!r.ok){const i=o??{},a=typeof i.error=="string"&&i.error.length>0?i.error:"Failed to update OpenCode working directory";throw new Error(a)}return o&&typeof o=="object"?o:{success:!0,restarted:!1,path:t}}catch(r){throw console.warn("Failed to update OpenCode working directory:",r),r}}}const O=new eo,hi=Object.freeze(Object.defineProperty({__proto__:null,opencodeClient:O},Symbol.toStringTag,{value:"Module"})),to=Q()(Y(ye((n,t)=>({queuedMessages:{},queueModeEnabled:!0,addToQueue:(e,r)=>{const i={id:`queued-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,content:r.content,attachments:r.attachments,createdAt:Date.now()};n(a=>{const s=a.queuedMessages[e]??[];return{queuedMessages:{...a.queuedMessages,[e]:[...s,i]}}})},removeFromQueue:(e,r)=>{n(o=>{const a=(o.queuedMessages[e]??[]).filter(s=>s.id!==r);if(a.length===0){const{[e]:s,...d}=o.queuedMessages;return{queuedMessages:d}}return{queuedMessages:{...o.queuedMessages,[e]:a}}})},popToInput:(e,r)=>{const a=(t().queuedMessages[e]??[]).find(s=>s.id===r);return a?(n(s=>{const c=(s.queuedMessages[e]??[]).filter(l=>l.id!==r);if(c.length===0){const{[e]:l,...f}=s.queuedMessages;return{queuedMessages:f}}return{queuedMessages:{...s.queuedMessages,[e]:c}}}),a):null},clearQueue:e=>{n(r=>{const{[e]:o,...i}=r.queuedMessages;return{queuedMessages:i}})},clearAllQueues:()=>{n({queuedMessages:{}})},setQueueMode:e=>{n({queueModeEnabled:e}),$({queueModeEnabled:e})},getQueueForSession:e=>t().queuedMessages[e]??[]}),{name:"message-queue-store",storage:ae(()=>H()),partialize:n=>({queuedMessages:n.queuedMessages,queueModeEnabled:n.queueModeEnabled})}),{name:"message-queue-store"})),ur="directoryTreeShowHidden",pt="directory-show-hidden-change",Ht=()=>{if(typeof window>"u")return!0;try{const n=H().getItem(ur);return n===null?!0:n==="true"}catch{return!0}},ro=()=>{typeof window>"u"||window.dispatchEvent(new Event(pt))},no=(n,t={})=>{if(!(typeof window>"u")){try{H().setItem(ur,n?"true":"false"),ro()}catch{}t.persist!==!1&&$({directoryShowHidden:n})}},mi=()=>{const[n,t]=X.useState(Ht);return X.useEffect(()=>{if(typeof window>"u")return;const e=()=>{t(Ht())};return window.addEventListener("storage",e),window.addEventListener(pt,e),()=>{window.removeEventListener("storage",e),window.removeEventListener(pt,e)}},[]),n},fr="filesViewShowGitignored",yt="files-view-show-gitignored-change",Nt=()=>{if(typeof window>"u")return!1;try{return H().getItem(fr)==="true"}catch{return!1}},oo=()=>{typeof window>"u"||window.dispatchEvent(new Event(yt))},io=(n,t={})=>{if(!(typeof window>"u")){try{H().setItem(fr,n?"true":"false"),oo()}catch{}t.persist!==!1&&$({filesViewShowGitignored:n})}},gi=()=>{const[n,t]=X.useState(Nt);return X.useEffect(()=>{if(typeof window>"u")return;const e=()=>{t(Nt())};return window.addEventListener("storage",e),window.addEventListener(yt,e),()=>{window.removeEventListener("storage",e),window.removeEventListener(yt,e)}},[]),n},so=n=>{if(!n||typeof n!="object")return null;const t={};return typeof n.showReasoningTraces=="boolean"&&(t.showReasoningTraces=n.showReasoningTraces),Object.keys(t).length>0?t:null},ao=n=>!n||typeof n!="object"?null:{showReasoningTraces:n.showReasoningTraces},co=n=>{const t=Se.getState();typeof n.showReasoningTraces=="boolean"&&t.setShowReasoningTraces(n.showReasoningTraces)},lo=async()=>{if(typeof window>"u")return null;const n=localStorage.getItem("appearance-preferences");if(!n)return null;try{const t=JSON.parse(n),e=ao(t);return so(e)}catch(t){return console.warn("Failed to parse stored appearance preferences:",t),null}};let pr=null;const Si=n=>{pr=n},yr=()=>pr,ht=n=>{if(!(typeof window>"u")){if(n.themeId&&localStorage.setItem("selectedThemeId",n.themeId),n.themeVariant&&localStorage.setItem("selectedThemeVariant",n.themeVariant),n.lightThemeId&&localStorage.setItem("lightThemeId",n.lightThemeId),n.darkThemeId&&localStorage.setItem("darkThemeId",n.darkThemeId),typeof n.useSystemTheme=="boolean"&&localStorage.setItem("useSystemTheme",String(n.useSystemTheme)),n.lastDirectory&&localStorage.setItem("lastDirectory",n.lastDirectory),n.homeDirectory&&(localStorage.setItem("homeDirectory",n.homeDirectory),window.__OPENCHAMBER_HOME__=n.homeDirectory),Array.isArray(n.projects)&&n.projects.length>0?localStorage.setItem("projects",JSON.stringify(n.projects)):localStorage.removeItem("projects"),n.activeProjectId?localStorage.setItem("activeProjectId",n.activeProjectId):localStorage.removeItem("activeProjectId"),Array.isArray(n.pinnedDirectories)&&n.pinnedDirectories.length>0?localStorage.setItem("pinnedDirectories",JSON.stringify(n.pinnedDirectories)):localStorage.removeItem("pinnedDirectories"),Array.isArray(n.projects)&&n.projects.length>0){const t=n.projects.filter(e=>e.sidebarCollapsed===!0).map(e=>e.id).filter(e=>typeof e=="string"&&e.length>0);t.length>0?localStorage.setItem("oc.sessions.projectCollapse",JSON.stringify(t)):localStorage.removeItem("oc.sessions.projectCollapse")}typeof n.gitmojiEnabled=="boolean"?localStorage.setItem("gitmojiEnabled",String(n.gitmojiEnabled)):localStorage.removeItem("gitmojiEnabled"),typeof n.directoryShowHidden=="boolean"&&localStorage.setItem("directoryTreeShowHidden",n.directoryShowHidden?"true":"false"),typeof n.filesViewShowGitignored=="boolean"&&localStorage.setItem("filesViewShowGitignored",n.filesViewShowGitignored?"true":"false"),typeof n.openInAppId=="string"&&n.openInAppId.length>0&&localStorage.setItem("openInAppId",n.openInAppId)}},uo=n=>{if(!Array.isArray(n))return;const t=[],e=new Set;for(const r of n){if(!r||typeof r!="object")continue;const o=r,i=typeof o.id=="string"?o.id.trim():"",a=typeof o.label=="string"?o.label.trim():"",s=typeof o.source=="string"?o.source.trim():"",d=typeof o.subpath=="string"?o.subpath.trim():"",c=typeof o.gitIdentityId=="string"?o.gitIdentityId.trim():"";!i||!a||!s||e.has(i)||(e.add(i),t.push({id:i,label:a,source:s,...d?{subpath:d}:{},...c?{gitIdentityId:c}:{}}))}return t},fo=n=>{if(!Array.isArray(n))return;const t=[],e=new Set,r=new Set;for(const o of n){if(!o||typeof o!="object")continue;const i=o,a=typeof i.id=="string"?i.id.trim():"",s=typeof i.path=="string"?i.path.trim():"";if(!a||!s)continue;const d=s==="/"?s:s.replace(/\\/g,"/").replace(/\/+$/,"");if(!d||e.has(a)||r.has(d))continue;e.add(a),r.add(d);const c={id:a,path:d};typeof i.label=="string"&&i.label.trim().length>0&&(c.label=i.label.trim()),typeof i.addedAt=="number"&&Number.isFinite(i.addedAt)&&i.addedAt>=0&&(c.addedAt=i.addedAt),typeof i.lastOpenedAt=="number"&&Number.isFinite(i.lastOpenedAt)&&i.lastOpenedAt>=0&&(c.lastOpenedAt=i.lastOpenedAt),typeof i.sidebarCollapsed=="boolean"&&(c.sidebarCollapsed=i.sidebarCollapsed),t.push(c)}return t.length>0?t:void 0},$t=(n,t)=>{if(!Array.isArray(n))return;const e=[],r=new Set;for(const o of n){if(!o||typeof o!="object")continue;const i=o,a=typeof i.providerID=="string"?i.providerID.trim():"",s=typeof i.modelID=="string"?i.modelID.trim():"";if(!a||!s)continue;const d=`${a}/${s}`;if(!r.has(d)&&(r.add(d),e.push({providerID:a,modelID:s}),e.length>=t))break}return e},hr=()=>{const n=Se.persist;if(n&&typeof n=="object")return n},mr=()=>yr()?.settings??null,mt=n=>{const t=Se.getState(),e=to.getState();if(typeof n.showReasoningTraces=="boolean"&&n.showReasoningTraces!==t.showReasoningTraces&&t.setShowReasoningTraces(n.showReasoningTraces),typeof n.autoDeleteEnabled=="boolean"&&n.autoDeleteEnabled!==t.autoDeleteEnabled&&t.setAutoDeleteEnabled(n.autoDeleteEnabled),typeof n.autoDeleteAfterDays=="number"&&Number.isFinite(n.autoDeleteAfterDays)){const o=Math.max(1,Math.min(365,n.autoDeleteAfterDays));o!==t.autoDeleteAfterDays&&t.setAutoDeleteAfterDays(o)}const r=new Set([90,120,180,220]);if(typeof n.messageLimit=="number"&&Number.isFinite(n.messageLimit)&&(r.has(n.messageLimit)||t.setMessageLimit(n.messageLimit)),typeof n.queueModeEnabled=="boolean"&&n.queueModeEnabled!==e.queueModeEnabled&&e.setQueueMode(n.queueModeEnabled),typeof n.showTextJustificationActivity=="boolean"&&n.showTextJustificationActivity!==t.showTextJustificationActivity&&t.setShowTextJustificationActivity(n.showTextJustificationActivity),typeof n.nativeNotificationsEnabled=="boolean"&&n.nativeNotificationsEnabled!==t.nativeNotificationsEnabled&&t.setNativeNotificationsEnabled(n.nativeNotificationsEnabled),typeof n.notificationMode=="string"&&(n.notificationMode==="always"||n.notificationMode==="hidden-only")&&n.notificationMode!==t.notificationMode&&t.setNotificationMode(n.notificationMode),typeof n.notifyOnSubtasks=="boolean"&&n.notifyOnSubtasks!==t.notifyOnSubtasks&&t.setNotifyOnSubtasks(n.notifyOnSubtasks),typeof n.notifyOnCompletion=="boolean"&&n.notifyOnCompletion!==t.notifyOnCompletion&&t.setNotifyOnCompletion(n.notifyOnCompletion),typeof n.notifyOnError=="boolean"&&n.notifyOnError!==t.notifyOnError&&t.setNotifyOnError(n.notifyOnError),typeof n.notifyOnQuestion=="boolean"&&n.notifyOnQuestion!==t.notifyOnQuestion&&t.setNotifyOnQuestion(n.notifyOnQuestion),n.notificationTemplates&&typeof n.notificationTemplates=="object"&&t.setNotificationTemplates(n.notificationTemplates),typeof n.summarizeLastMessage=="boolean"&&n.summarizeLastMessage!==t.summarizeLastMessage&&t.setSummarizeLastMessage(n.summarizeLastMessage),typeof n.summaryThreshold=="number"&&Number.isFinite(n.summaryThreshold)&&t.setSummaryThreshold(n.summaryThreshold),typeof n.summaryLength=="number"&&Number.isFinite(n.summaryLength)&&t.setSummaryLength(n.summaryLength),typeof n.maxLastMessageLength=="number"&&Number.isFinite(n.maxLastMessageLength)&&t.setMaxLastMessageLength(n.maxLastMessageLength),typeof n.toolCallExpansion=="string"&&(n.toolCallExpansion==="collapsed"||n.toolCallExpansion==="activity"||n.toolCallExpansion==="detailed")&&n.toolCallExpansion!==t.toolCallExpansion&&t.setToolCallExpansion(n.toolCallExpansion),typeof n.fontSize=="number"&&Number.isFinite(n.fontSize)&&n.fontSize!==t.fontSize&&t.setFontSize(n.fontSize),typeof n.terminalFontSize=="number"&&Number.isFinite(n.terminalFontSize)&&n.terminalFontSize!==t.terminalFontSize&&t.setTerminalFontSize(n.terminalFontSize),typeof n.padding=="number"&&Number.isFinite(n.padding)&&n.padding!==t.padding&&t.setPadding(n.padding),typeof n.cornerRadius=="number"&&Number.isFinite(n.cornerRadius)&&n.cornerRadius!==t.cornerRadius&&t.setCornerRadius(n.cornerRadius),typeof n.inputBarOffset=="number"&&Number.isFinite(n.inputBarOffset)&&n.inputBarOffset!==t.inputBarOffset&&t.setInputBarOffset(n.inputBarOffset),Array.isArray(n.favoriteModels)){const o=t.favoriteModels,i=n.favoriteModels;o.length===i.length&&o.every((s,d)=>s.providerID===i[d]?.providerID&&s.modelID===i[d]?.modelID)||Se.setState({favoriteModels:i})}if(Array.isArray(n.recentModels)){const o=t.recentModels,i=n.recentModels;o.length===i.length&&o.every((s,d)=>s.providerID===i[d]?.providerID&&s.modelID===i[d]?.modelID)||Se.setState({recentModels:i})}typeof n.diffLayoutPreference=="string"&&(n.diffLayoutPreference==="dynamic"||n.diffLayoutPreference==="inline"||n.diffLayoutPreference==="side-by-side")&&n.diffLayoutPreference!==t.diffLayoutPreference&&t.setDiffLayoutPreference(n.diffLayoutPreference),typeof n.diffViewMode=="string"&&(n.diffViewMode==="single"||n.diffViewMode==="stacked")&&n.diffViewMode!==t.diffViewMode&&t.setDiffViewMode(n.diffViewMode),typeof n.directoryShowHidden=="boolean"&&no(n.directoryShowHidden,{persist:!1}),typeof n.filesViewShowGitignored=="boolean"&&io(n.filesViewShowGitignored,{persist:!1})},Bt=n=>{if(!n||typeof n!="object")return null;const t=n,e={};if(typeof t.themeId=="string"&&t.themeId.length>0&&(e.themeId=t.themeId),(t.useSystemTheme===!0||t.useSystemTheme===!1)&&(e.useSystemTheme=t.useSystemTheme),typeof t.themeVariant=="string"&&(t.themeVariant==="light"||t.themeVariant==="dark")&&(e.themeVariant=t.themeVariant),typeof t.lightThemeId=="string"&&t.lightThemeId.length>0&&(e.lightThemeId=t.lightThemeId),typeof t.darkThemeId=="string"&&t.darkThemeId.length>0&&(e.darkThemeId=t.darkThemeId),typeof t.lastDirectory=="string"&&t.lastDirectory.length>0&&(e.lastDirectory=t.lastDirectory),typeof t.homeDirectory=="string"&&t.homeDirectory.length>0&&(e.homeDirectory=t.homeDirectory),typeof t.opencodeBinary=="string"){const s=t.opencodeBinary.trim();e.opencodeBinary=s.length>0?s:void 0}const r=fo(t.projects);if(r&&(e.projects=r),typeof t.activeProjectId=="string"&&t.activeProjectId.length>0&&(e.activeProjectId=t.activeProjectId),Array.isArray(t.approvedDirectories)&&(e.approvedDirectories=t.approvedDirectories.filter(s=>typeof s=="string"&&s.length>0)),Array.isArray(t.securityScopedBookmarks)&&(e.securityScopedBookmarks=t.securityScopedBookmarks.filter(s=>typeof s=="string"&&s.length>0)),Array.isArray(t.pinnedDirectories)&&(e.pinnedDirectories=Array.from(new Set(t.pinnedDirectories.filter(s=>typeof s=="string"&&s.length>0)))),typeof t.showReasoningTraces=="boolean"&&(e.showReasoningTraces=t.showReasoningTraces),typeof t.autoDeleteEnabled=="boolean"&&(e.autoDeleteEnabled=t.autoDeleteEnabled),typeof t.autoDeleteAfterDays=="number"&&Number.isFinite(t.autoDeleteAfterDays)&&(e.autoDeleteAfterDays=t.autoDeleteAfterDays),typeof t.defaultModel=="string"&&t.defaultModel.length>0&&(e.defaultModel=t.defaultModel),typeof t.defaultVariant=="string"&&t.defaultVariant.length>0&&(e.defaultVariant=t.defaultVariant),typeof t.defaultAgent=="string"&&t.defaultAgent.length>0&&(e.defaultAgent=t.defaultAgent),typeof t.autoCreateWorktree=="boolean"&&(e.autoCreateWorktree=t.autoCreateWorktree),typeof t.gitmojiEnabled=="boolean"&&(e.gitmojiEnabled=t.gitmojiEnabled),typeof t.queueModeEnabled=="boolean"&&(e.queueModeEnabled=t.queueModeEnabled),typeof t.showTextJustificationActivity=="boolean"&&(e.showTextJustificationActivity=t.showTextJustificationActivity),typeof t.nativeNotificationsEnabled=="boolean"&&(e.nativeNotificationsEnabled=t.nativeNotificationsEnabled),typeof t.notificationMode=="string"&&(t.notificationMode==="always"||t.notificationMode==="hidden-only")&&(e.notificationMode=t.notificationMode),typeof t.notifyOnSubtasks=="boolean"&&(e.notifyOnSubtasks=t.notifyOnSubtasks),typeof t.notifyOnCompletion=="boolean"&&(e.notifyOnCompletion=t.notifyOnCompletion),typeof t.notifyOnError=="boolean"&&(e.notifyOnError=t.notifyOnError),typeof t.notifyOnQuestion=="boolean"&&(e.notifyOnQuestion=t.notifyOnQuestion),t.notificationTemplates&&typeof t.notificationTemplates=="object"){const s=t.notificationTemplates,d=h=>{const g=s[h];if(!g||typeof g!="object")return;const y=g,m=typeof y.title=="string"?y.title:"",w=typeof y.message=="string"?y.message:"";return{title:m,message:w}},c=d("completion"),l=d("error"),f=d("question"),p=d("subtask");(c||l||f||p)&&(e.notificationTemplates={completion:c??{title:"Task Complete",message:"Your task has finished."},error:l??{title:"Error Occurred",message:"An error occurred while processing your task."},question:f??{title:"Input Needed",message:"Please provide input to continue."},subtask:p??{title:"Subtask Complete",message:"A subtask has finished."}})}if(typeof t.summarizeLastMessage=="boolean"&&(e.summarizeLastMessage=t.summarizeLastMessage),typeof t.summaryThreshold=="number"&&Number.isFinite(t.summaryThreshold)&&(e.summaryThreshold=Math.max(0,Math.round(t.summaryThreshold))),typeof t.summaryLength=="number"&&Number.isFinite(t.summaryLength)&&(e.summaryLength=Math.max(10,Math.round(t.summaryLength))),typeof t.maxLastMessageLength=="number"&&Number.isFinite(t.maxLastMessageLength)&&(e.maxLastMessageLength=Math.max(10,Math.round(t.maxLastMessageLength))),typeof t.usageAutoRefresh=="boolean"&&(e.usageAutoRefresh=t.usageAutoRefresh),typeof t.usageRefreshIntervalMs=="number"&&Number.isFinite(t.usageRefreshIntervalMs)&&(e.usageRefreshIntervalMs=t.usageRefreshIntervalMs),(t.usageDisplayMode==="usage"||t.usageDisplayMode==="remaining")&&(e.usageDisplayMode=t.usageDisplayMode),Array.isArray(t.usageDropdownProviders)&&(e.usageDropdownProviders=t.usageDropdownProviders.filter(s=>typeof s=="string"&&s.length>0)),t.usageSelectedModels&&typeof t.usageSelectedModels=="object"){const s={};for(const[d,c]of Object.entries(t.usageSelectedModels))Array.isArray(c)&&(s[d]=c.filter(l=>typeof l=="string"));Object.keys(s).length>0&&(e.usageSelectedModels=s)}if(t.usageCollapsedFamilies&&typeof t.usageCollapsedFamilies=="object"){const s={};for(const[d,c]of Object.entries(t.usageCollapsedFamilies))Array.isArray(c)&&(s[d]=c.filter(l=>typeof l=="string"));Object.keys(s).length>0&&(e.usageCollapsedFamilies=s)}if(t.usageExpandedFamilies&&typeof t.usageExpandedFamilies=="object"){const s={};for(const[d,c]of Object.entries(t.usageExpandedFamilies))Array.isArray(c)&&(s[d]=c.filter(l=>typeof l=="string"));Object.keys(s).length>0&&(e.usageExpandedFamilies=s)}if(t.usageModelGroups&&typeof t.usageModelGroups=="object"){const s={};for(const[d,c]of Object.entries(t.usageModelGroups))if(c&&typeof c=="object"){const l=c,f={};Array.isArray(l.customGroups)&&(f.customGroups=l.customGroups.filter(p=>p&&typeof p=="object").map(p=>({id:String(p.id??""),label:String(p.label??""),models:Array.isArray(p.models)?p.models.filter(h=>typeof h=="string"):[],order:typeof p.order=="number"?p.order:0}))),l.modelAssignments&&typeof l.modelAssignments=="object"&&(f.modelAssignments=Object.fromEntries(Object.entries(l.modelAssignments).filter(([,p])=>typeof p=="string").map(([p,h])=>[p,String(h)]))),l.renamedGroups&&typeof l.renamedGroups=="object"&&(f.renamedGroups=Object.fromEntries(Object.entries(l.renamedGroups).filter(([,p])=>typeof p=="string").map(([p,h])=>[p,String(h)]))),Object.keys(f).length>0&&(s[d]=f)}Object.keys(s).length>0&&(e.usageModelGroups=s)}typeof t.toolCallExpansion=="string"&&(t.toolCallExpansion==="collapsed"||t.toolCallExpansion==="activity"||t.toolCallExpansion==="detailed")&&(e.toolCallExpansion=t.toolCallExpansion),typeof t.fontSize=="number"&&Number.isFinite(t.fontSize)&&(e.fontSize=t.fontSize),typeof t.terminalFontSize=="number"&&Number.isFinite(t.terminalFontSize)&&(e.terminalFontSize=t.terminalFontSize),typeof t.padding=="number"&&Number.isFinite(t.padding)&&(e.padding=t.padding),typeof t.cornerRadius=="number"&&Number.isFinite(t.cornerRadius)&&(e.cornerRadius=t.cornerRadius),typeof t.inputBarOffset=="number"&&Number.isFinite(t.inputBarOffset)&&(e.inputBarOffset=t.inputBarOffset);const o=$t(t.favoriteModels,64);o&&(e.favoriteModels=o);const i=$t(t.recentModels,16);i&&(e.recentModels=i),typeof t.diffLayoutPreference=="string"&&(t.diffLayoutPreference==="dynamic"||t.diffLayoutPreference==="inline"||t.diffLayoutPreference==="side-by-side")&&(e.diffLayoutPreference=t.diffLayoutPreference),typeof t.diffViewMode=="string"&&(t.diffViewMode==="single"||t.diffViewMode==="stacked")&&(e.diffViewMode=t.diffViewMode),typeof t.directoryShowHidden=="boolean"&&(e.directoryShowHidden=t.directoryShowHidden),typeof t.filesViewShowGitignored=="boolean"&&(e.filesViewShowGitignored=t.filesViewShowGitignored),typeof t.openInAppId=="string"&&t.openInAppId.length>0&&(e.openInAppId=t.openInAppId),typeof t.messageLimit=="number"&&Number.isFinite(t.messageLimit)&&(e.messageLimit=t.messageLimit);const a=uo(t.skillCatalogs);return a&&(e.skillCatalogs=a),e},po=async()=>{const n=mr();if(n)try{const t=await n.load();return Bt(t.settings)}catch(t){console.warn("Failed to load shared settings from runtime settings API:",t)}try{const t=await fetch("/api/config/settings",{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)return null;const e=await t.json().catch(()=>null);return Bt(e)}catch(t){return console.warn("Failed to load shared settings from server:",t),null}},wi=async()=>{if(typeof window>"u")return;const n=hr(),t=e=>{ht(e);const r=()=>mt(e);if(n?.hasHydrated?.())r();else if(r(),n?.onFinishHydration){const o=n.onFinishHydration(()=>{o?.(),r()})}typeof window<"u"&&window.dispatchEvent(new CustomEvent("openchamber:settings-synced",{detail:e}))};try{const e=await po();e&&t(e)}catch(e){console.warn("Failed to synchronise settings:",e)}},$=async n=>{if(typeof window>"u")return;const t=mr();if(t)try{const e=await t.save(n);e&&(ht(e),mt(e));return}catch(e){console.warn("Failed to update settings via runtime settings API:",e)}try{const e=await fetch("/api/config/settings",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)});if(!e.ok){console.warn("Failed to update shared settings via API:",e.status,e.statusText);return}const r=await e.json().catch(()=>null);r&&(ht(r),mt(r))}catch(e){console.warn("Failed to update shared settings via API:",e)}},bi=async()=>{if(typeof window>"u")return;const n=hr();try{const t=await lo();if(!t)return;const e=()=>co(t);if(n?.hasHydrated?.()){e();return}if(e(),n?.onFinishHydration){const r=n.onFinishHydration(()=>{r?.(),e()})}}catch(t){console.warn("Failed to load appearance preferences:",t)}},yo=3e4,ho=40,mo=60,go=(n,t,e,r,o)=>{const i=n.trim(),a=t.trim().toLowerCase();return`${i}::${a}::${e}::${r?"1":"0"}::${o?"1":"0"}`},So=Q()(Y((n,t)=>({cache:{},cacheKeys:[],inFlight:{},async searchFiles(e,r,o=mo,i){if(!e||e.trim().length===0)return[];const a=e.trim(),s=typeof r=="string"?r.trim():"",d=!!i?.includeHidden,c=i?.respectGitignore??!0,l=go(a,s,o,d,c),f=Date.now(),p=t().cache[l];if(p&&f-p.timestamp<yo)return p.files;const h=t().inFlight[l];if(h)return h;const g=O.searchFiles(s,{directory:a,limit:o,includeHidden:d,respectGitignore:c}).then(y=>(n(m=>{const w={...m.cache,[l]:{files:y,timestamp:Date.now()}},I=m.cacheKeys.filter(k=>k!==l);for(I.push(l);I.length>ho;){const k=I.shift();k&&delete w[k]}return{cache:w,cacheKeys:I}}),y)).finally(()=>{n(y=>{const m={...y.inFlight};return delete m[l],{inFlight:m}})});return n(y=>({inFlight:{...y.inFlight,[l]:g}})),g},invalidateDirectory(e){if(!e||e.trim().length===0){n({cache:{},cacheKeys:[],inFlight:{}});return}const o=`${e.trim()}::`;n(i=>{const a={...i.cache},s=i.cacheKeys.filter(l=>l.startsWith(o)?(delete a[l],!1):!0),d=Object.entries(i.inFlight).filter(([l])=>!l.startsWith(o)),c=Object.fromEntries(d);return{cache:a,cacheKeys:s,inFlight:c}})}}),{name:"file-search-store"})),Qe=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem("openchamber_stream_debug")==="1"}catch{return!1}};var wo={};let W=null;const N=H(),Vt=N.getItem("lastDirectory"),bo=typeof Vt=="string"&&Vt.length>0,xe=n=>{try{So.getState().invalidateDirectory(n)}catch(t){console.warn("Failed to invalidate file search cache:",t)}},pe=n=>{const t=n.trim();if(!t)return t;const e=t.replace(/\\/g,"/");return e.length>1?e.replace(/\/+$/,""):e},vo=(n,t)=>{const e=n.trim();return e.startsWith("~")?e==="~"?t||e:(e.startsWith("~/")||e.startsWith("~\\"))&&t?`${t}${e.slice(1)}`:e:e},He=(n,t)=>{const e=vo(n,t);return pe(e)},Io=()=>{const n=N.getItem("homeDirectory");if(typeof n!="string"||n.trim().length===0)return null;const t=pe(n);return t.length>0?t:null},Do=()=>{const n=N.getItem("lastDirectory");if(typeof n!="string"||n.trim().length===0)return null;const t=pe(n);return t.length>0?t:null},ko=()=>{if(typeof process>"u")return null;const n=wo,t=n?.HOME||n?.USERPROFILE||(n?.HOMEDRIVE&&n?.HOMEPATH?`${n.HOMEDRIVE}${n.HOMEPATH}`:void 0);if(typeof t=="string"&&t.trim().length>0){const r=pe(t);return r.length>0?r:null}const e=process?.cwd?.();if(typeof e=="string"&&e.trim().length>0){const r=pe(e);return r.length>0?r:null}return null},Ve=()=>{if(typeof window<"u"){if(W)return W;const t=typeof window.__OPENCHAMBER_HOME__=="string"&&window.__OPENCHAMBER_HOME__.length>0?window.__OPENCHAMBER_HOME__:null;if(t&&t.length>0)return W=t,N.setItem("homeDirectory",t),t;const e=Io();if(e&&!Ce())return W=e,e}const n=ko();return n||"/"},Co=n=>{if(typeof n!="string")return null;const t=n.trim();if(!t)return null;const e=t.replace(/\\/g,"/");if(e.length>1){const r=e.replace(/\/+$/,"");if(r&&r.length>0)return r==="/"?null:r}return e==="/"||e.length===0?null:e},Mo=n=>(W=n,typeof window<"u"&&N.setItem("homeDirectory",n),$({homeDirectory:n}),n),gr=async()=>{const n=r=>{const o=Co(r);return o?Mo(o):null};try{const r=await O.getFilesystemHome(),o=n(r);if(o)return o}catch(r){console.warn("Failed to obtain filesystem home directory:",r)}try{const r=await O.getSystemInfo(),o=n(r?.homeDirectory);if(o)return o}catch(r){console.warn("Failed to get home directory from system info:",r)}try{const r=await It(),o=n(r);if(o)return o}catch(r){console.warn("Failed to obtain desktop-integrated home directory:",r)}const t=Ve(),e=n(t);return e||t},Ao=()=>{if(!Ce())return null;const n=window.__VSCODE_CONFIG__?.workspaceFolder;if(typeof n!="string"||n.trim().length===0)return null;const t=pe(n);return t.length>0?t:null},Ie=Ao()||Ve(),Ue=(()=>{const n=Do();return n&&!Ce()?He(n,Ie):Ie})();Ue&&O.setDirectory(Ue);const Eo=!!(Ie&&Ie!=="/"),ne=Q()(Y((n,t)=>({currentDirectory:Ue,directoryHistory:[Ue],historyIndex:0,homeDirectory:Ie,hasPersistedDirectory:bo,isHomeReady:Eo,isSwitchingDirectory:!1,setDirectory:(e,r)=>{const o=W||t().homeDirectory||N.getItem("homeDirectory"),i=He(e,o);Qe()&&console.log("[DirectoryStore] setDirectory called with path:",i),O.setDirectory(i),xe(),n(a=>{const s=[...a.directoryHistory.slice(0,a.historyIndex+1),i];return N.setItem("lastDirectory",i),$({lastDirectory:i}),{currentDirectory:i,directoryHistory:s,historyIndex:s.length-1,hasPersistedDirectory:!0,isHomeReady:!0,isSwitchingDirectory:!1}})},goBack:()=>{const e=t();if(e.historyIndex>0){const r=e.historyIndex-1,o=e.directoryHistory[r];O.setDirectory(o),xe(),N.setItem("lastDirectory",o),$({lastDirectory:o}),n({currentDirectory:o,historyIndex:r,hasPersistedDirectory:!0,isHomeReady:!0,isSwitchingDirectory:!1})}},goForward:()=>{const e=t();if(e.historyIndex<e.directoryHistory.length-1){const r=e.historyIndex+1,o=e.directoryHistory[r];O.setDirectory(o),xe(),N.setItem("lastDirectory",o),$({lastDirectory:o}),n({currentDirectory:o,historyIndex:r,hasPersistedDirectory:!0,isHomeReady:!0,isSwitchingDirectory:!1})}},goToParent:()=>{const{currentDirectory:e,setDirectory:r}=t(),o=W||t().homeDirectory||Ve();if(e===o||e==="/")return;const i=e.endsWith("/")?e.slice(0,-1):e,a=i.lastIndexOf("/");if(a===-1){const s=W||Ve();r(s)}else r(a===0?"/":i.substring(0,a))},goHome:async()=>{const e=W||t().homeDirectory||await gr();t().setDirectory(e)},synchronizeHomeDirectory:e=>{const r=t(),o=e;W=o;const i=r.homeDirectory!==o,a=N.getItem("lastDirectory"),s=typeof a=="string"&&a.length>0,d=!s&&(r.currentDirectory==="/"||r.currentDirectory===r.homeDirectory||!r.currentDirectory);if(!i&&!d){r.isHomeReady||n({isHomeReady:!0});return}const c=typeof o=="string"&&o!==""&&o!=="/",l=r.currentDirectory?He(r.currentDirectory,o):r.currentDirectory,f=r.directoryHistory.map(y=>He(y,o)),p=f.some((y,m)=>y!==r.directoryHistory[m]),h=!!(l&&l!==r.currentDirectory),g={homeDirectory:o,hasPersistedDirectory:s,isHomeReady:c};if(d?(g.currentDirectory=o,g.directoryHistory=[o],g.historyIndex=0,g.isSwitchingDirectory=!1):(h||p)&&(g.currentDirectory=l,g.directoryHistory=f,g.historyIndex=Math.min(r.historyIndex,f.length-1),g.isSwitchingDirectory=!1),n(()=>g),(d||h)&&c){const y=d?o:l;O.setDirectory(y),xe(),N.setItem("lastDirectory",y),$({lastDirectory:y})}$({homeDirectory:o})}}),{name:"directory-store"}));typeof window<"u"&&gr().then(n=>{ne.getState().synchronizeHomeDirectory(n)});const ue=H(),Sr="projects",gt="activeProjectId",_o=(n,t)=>{const e=n.trim();return!e.startsWith("~")||!t?e:e==="~"?t:e.startsWith("~/")||e.startsWith("~\\")?`${t}${e.slice(1)}`:e},Ye=n=>{const t=n.trim();if(!t)return"";const e=ue.getItem("homeDirectory")||ne.getState().homeDirectory||"",o=_o(t,e).replace(/\\/g,"/");return o==="/"?"/":o.length>1?o.replace(/\/+$/,""):o},wr=n=>{const t=Ye(n);if(!t||t==="/")return"Root";const e=t.split("/").filter(Boolean);return e[e.length-1]||t},Po=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`proj_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,br=n=>{if(!Array.isArray(n))return[];const t=[],e=new Set,r=new Set;for(const o of n){if(!o||typeof o!="object")continue;const i=o,a=typeof i.id=="string"?i.id.trim():"",s=typeof i.path=="string"?i.path.trim():"";if(!a||!s)continue;const d=Ye(s);if(!d||e.has(a)||r.has(d))continue;e.add(a),r.add(d);const c={id:a,path:d};typeof i.label=="string"&&i.label.trim().length>0&&(c.label=i.label.trim()),typeof i.addedAt=="number"&&Number.isFinite(i.addedAt)&&i.addedAt>=0&&(c.addedAt=i.addedAt),typeof i.lastOpenedAt=="number"&&Number.isFinite(i.lastOpenedAt)&&i.lastOpenedAt>=0&&(c.lastOpenedAt=i.lastOpenedAt),typeof i.sidebarCollapsed=="boolean"&&(c.sidebarCollapsed=i.sidebarCollapsed),t.push(c)}return t},To=()=>{try{const n=ue.getItem(Sr);return n?br(JSON.parse(n)):[]}catch{return[]}},Oo=()=>{try{const n=ue.getItem(gt);if(typeof n=="string"&&n.trim().length>0)return n.trim()}catch{return null}return null},Dt=(n,t)=>{try{ue.setItem(Sr,JSON.stringify(n))}catch{}try{t?ue.setItem(gt,t):ue.removeItem(gt)}catch{}},ge=(n,t)=>{Dt(n,t),$({projects:n,activeProjectId:t??void 0})},jo=To(),Ro=()=>{if(typeof window>"u"||!window.__OPENCHAMBER_RUNTIME_APIS__?.runtime?.isVSCode)return null;const t=window.__VSCODE_CONFIG__?.workspaceFolder;if(typeof t!="string"||t.trim().length===0)return null;const e=Ye(t);if(!e)return null;const r=`vscode:${e}`,o={id:r,path:e,label:wr(e),addedAt:Date.now(),lastOpenedAt:Date.now()};return Qe()&&console.log("[OpenChamber][VSCode][projects] Using workspace fallback project",o),{projects:[o],activeProjectId:r}},U=Ro(),kt=U?.projects??jo,vr=U?.activeProjectId??Oo()??kt[0]?.id??null;U&&Dt(kt,vr);const Ze=Q()(Y((n,t)=>({projects:kt,activeProjectId:vr,validateProjectPath:e=>{if(typeof e!="string"||e.trim().length===0)return{ok:!1,reason:"Provide a directory path."};const r=Ye(e);return r?{ok:!0,normalizedPath:r}:{ok:!1,reason:"Directory path cannot be empty."}},addProject:(e,r)=>{if(U)return null;const{validateProjectPath:o}=t(),i=o(e);if(!i.ok||!i.normalizedPath)return null;const a=i.normalizedPath,s=t().projects.find(g=>g.path===a);if(s)return t().setActiveProject(s.id),s;const d=Date.now(),c=r?.label?.trim()||wr(a),l=r?.id?.trim(),p={id:l&&!t().projects.some(g=>g.id===l)?l:Po(),path:a,label:c,addedAt:d,lastOpenedAt:d},h=[...t().projects,p];return n({projects:h}),Qe()&&console.info("[ProjectsStore] Added project",p),t().setActiveProject(p.id),p},removeProject:e=>{if(U)return;const r=t(),o=r.projects.filter(a=>a.id!==e);let i=r.activeProjectId;if(r.activeProjectId===e&&(i=o[0]?.id??null),n({projects:o,activeProjectId:i}),ge(o,i),i){const a=o.find(s=>s.id===i);a&&(O.setDirectory(a.path),ne.getState().setDirectory(a.path,{showOverlay:!1}))}else ne.getState().goHome()},setActiveProject:e=>{if(U)return;const{projects:r,activeProjectId:o}=t();if(o===e)return;const i=r.find(d=>d.id===e);if(!i)return;const a=Date.now(),s=r.map(d=>d.id===e?{...d,lastOpenedAt:a}:d);n({projects:s,activeProjectId:e}),ge(s,e),O.setDirectory(i.path),ne.getState().setDirectory(i.path,{showOverlay:!1})},setActiveProjectIdOnly:e=>{if(U)return;const{projects:r,activeProjectId:o}=t();if(o===e||!r.find(d=>d.id===e))return;const a=Date.now(),s=r.map(d=>d.id===e?{...d,lastOpenedAt:a}:d);n({projects:s,activeProjectId:e}),ge(s,e)},renameProject:(e,r)=>{if(U)return;const o=r.trim();if(!o)return;const{projects:i,activeProjectId:a}=t(),s=i.map(d=>d.id===e?{...d,label:o}:d);n({projects:s}),ge(s,a)},reorderProjects:(e,r)=>{if(U)return;const{projects:o,activeProjectId:i}=t();if(e<0||e>=o.length||r<0||r>=o.length||e===r)return;const a=[...o],[s]=a.splice(e,1);a.splice(r,0,s),n({projects:a}),ge(a,i)},synchronizeFromSettings:e=>{if(U)return;const r=br(e.projects??[]),o=typeof e.activeProjectId=="string"&&e.activeProjectId.trim()?e.activeProjectId.trim():null,i=t(),a=JSON.stringify(i.projects)!==JSON.stringify(r),s=i.activeProjectId!==o;if(!(!a&&!s)&&(n({projects:r,activeProjectId:o}),Dt(r,o),o)){const d=r.find(c=>c.id===o);d&&(O.setDirectory(d.path),ne.getState().setDirectory(d.path,{showOverlay:!1}))}},getActiveProject:()=>{const{projects:e,activeProjectId:r}=t();return r?e.find(o=>o.id===r)??null:null}}),{name:"projects-store"}));typeof window<"u"&&window.addEventListener("openchamber:settings-synced",n=>{const t=n.detail;t&&typeof t=="object"&&Ze.getState().synchronizeFromSettings(t)});const St=new Set;function Xe(n){return St.add(n),()=>{St.delete(n)}}function G(n,t){const e=Array.isArray(n)?n:[n],r=Array.from(new Set(e));if(r.length===0)return;r.includes("all")&&r.splice(0,r.length,"all");const o={scopes:r,source:t?.source,timestamp:Date.now()};for(const i of St)try{const a=i(o);a instanceof Promise&&a.catch(s=>{console.error("[ConfigSync] Async listener failed:",s)})}catch(a){console.error("[ConfigSync] Listener threw:",a)}}function De(n,t){return n.scopes.includes("all")||n.scopes.includes(t)}const Ct="Updating OpenCode configuration...";let K=0,oe=Ct;const wt=new Set;function We(){const n={isUpdating:K>0,message:oe};wt.forEach(t=>t(n))}function J(n){K+=1,K===1?(oe=n||Ct,We()):n&&(oe=n,We())}function q(){K!==0&&(K-=1,K===0&&(oe=Ct,We()))}function ee(n){oe===n&&K>0||(oe=n,K>0&&We())}function vi(n){return wt.add(n),n({isUpdating:K>0,message:oe}),()=>{wt.delete(n)}}function Ii(){return{isUpdating:K>0,message:oe}}const xo=new Set(["init","review"]),Di=n=>xo.has(n.name),we="useCommandsStore",bt=n=>new Promise(t=>setTimeout(t,n)),Le=()=>{try{const t=Ze.getState().getActiveProject?.();if(t?.path?.trim())return t.path.trim();const e=O.getDirectory();if(e?.trim())return e.trim()}catch(n){console.warn("[CommandsStore] Error resolving config directory:",n)}return null},Lo=2e4,Ut=300,Wt=4,zo=800,Fo=200,qo=2e3,et=Q()(Y(ye((n,t)=>({selectedCommandName:null,commands:[],isLoading:!1,commandDraft:null,setSelectedCommand:e=>{n({selectedCommandName:e})},setCommandDraft:e=>{n({commandDraft:e})},loadCommands:async()=>{n({isLoading:!0});const e=t().commands;let r=null;for(let o=0;o<3;o++)try{const i=Le(),a=i?`?directory=${encodeURIComponent(i)}`:"",s=await O.withDirectory(i,()=>O.listCommandsWithDetails()),d=await Promise.all(s.map(async c=>{try{const l=await fetch(`/api/config/commands/${encodeURIComponent(c.name)}${a}`,{headers:{"Cache-Control":"no-cache",...i?{"x-opencode-directory":i}:{}}});if(l.ok){const f=await l.json();let p=f.scope;if(!p&&f.sources){const h=f.sources;p=(h.md?.exists?h.md.scope:void 0)??(h.json?.exists?h.json.scope:void 0)??h.md?.scope??h.json?.scope}return p==="project"||p==="user"?{...c,scope:p}:{...c,scope:void 0}}}catch(l){console.warn(`[CommandsStore] Failed to fetch config for command ${c.name}:`,l)}return c}));return JSON.stringify(e)!==JSON.stringify(d)?n({commands:d,isLoading:!1}):n({isLoading:!1}),!0}catch(i){r=i;const a=200*(o+1);await new Promise(s=>setTimeout(s,a))}return console.error("Failed to load commands:",r),n({commands:e,isLoading:!1}),!1},createCommand:async e=>{J("Creating command configurationâ€¦");let r=!1;try{console.log("[CommandsStore] Creating command:",e.name);const o={template:e.template||""};e.description&&(o.description=e.description),e.agent&&(o.agent=e.agent),e.model&&(o.model=e.model),e.subtask!==void 0&&(o.subtask=e.subtask),e.scope&&(o.scope=e.scope),console.log("[CommandsStore] Command config to save:",o);const i=Le(),a=i?`?directory=${encodeURIComponent(i)}`:"",s=await fetch(`/api/config/commands/${encodeURIComponent(e.name)}${a}`,{method:"POST",headers:{"Content-Type":"application/json",...i?{"x-opencode-directory":i}:{}},body:JSON.stringify(o)}),d=await s.json().catch(()=>null);if(!s.ok){const f=d?.error||"Failed to create command";throw new Error(f)}if(console.log("[CommandsStore] Command created successfully"),d?.requiresReload??!0)return r=!0,await dt({message:d?.message,delayMs:d?.reloadDelayMs}),!0;const l=await t().loadCommands();return l&&G("commands",{source:we}),l}catch(o){return console.error("[CommandsStore] Failed to create command:",o),!1}finally{r||q()}},updateCommand:async(e,r)=>{J("Updating command configurationâ€¦");let o=!1;try{console.log("[CommandsStore] Updating command:",e),console.log("[CommandsStore] Config received:",r);const i={};r.description!==void 0&&(i.description=r.description),r.agent!==void 0&&(i.agent=r.agent),r.model!==void 0&&(i.model=r.model),r.template!==void 0&&(i.template=r.template),r.subtask!==void 0&&(i.subtask=r.subtask),console.log("[CommandsStore] Command config to update:",i);const a=Le(),s=a?`?directory=${encodeURIComponent(a)}`:"",d=await fetch(`/api/config/commands/${encodeURIComponent(e)}${s}`,{method:"PATCH",headers:{"Content-Type":"application/json",...a?{"x-opencode-directory":a}:{}},body:JSON.stringify(i)}),c=await d.json().catch(()=>null);if(!d.ok){const p=c?.error||"Failed to update command";throw new Error(p)}if(console.log("[CommandsStore] Command updated successfully"),c?.requiresReload??!0)return o=!0,await dt({message:c?.message,delayMs:c?.reloadDelayMs}),!0;const f=await t().loadCommands();return f&&G("commands",{source:we}),f}catch(i){return console.error("[CommandsStore] Failed to update command:",i),!1}finally{o||q()}},deleteCommand:async e=>{J("Deleting command configurationâ€¦");let r=!1;try{const o=Le(),i=o?`?directory=${encodeURIComponent(o)}`:"",a=await fetch(`/api/config/commands/${encodeURIComponent(e)}${i}`,{method:"DELETE",headers:o?{"x-opencode-directory":o}:void 0}),s=await a.json().catch(()=>null);if(!a.ok){const l=s?.error||"Failed to delete command";throw new Error(l)}if(console.log("[CommandsStore] Command deleted successfully"),s?.requiresReload??!0)return r=!0,await dt({message:s?.message,delayMs:s?.reloadDelayMs}),!0;const c=await t().loadCommands();return c&&G("commands",{source:we}),t().selectedCommandName===e&&n({selectedCommandName:null}),c}catch(o){return console.error("Failed to delete command:",o),!1}finally{r||q()}},getCommandByName:e=>{const{commands:r}=t();return r.find(o=>o.name===e)}}),{name:"commands-store",storage:ae(()=>H()),partialize:n=>({selectedCommandName:n.selectedCommandName})}),{name:"commands-store"}));typeof window<"u"&&(window.__zustand_commands_store__=et);async function Ho(n){const t=typeof n=="number"&&n>0?Math.min(n,Ut):0;t>0&&await bt(t);const e=Date.now();let r=0,o=null;for(;Date.now()-e<Lo;){r+=1,ee(`Waiting for OpenCodeâ€¦ (attempt ${r})`);try{if(await O.checkHealth())return;o=new Error("OpenCode health check reported not ready")}catch(s){o=s}const i=Date.now()-e,a=r<=Wt&&i<1200?Ut:Math.min(zo+Math.max(0,r-Wt)*Fo,qo);await bt(a)}throw o||new Error("OpenCode did not become ready in time")}async function dt(n={}){const{message:t,delayMs:e}=n;try{ee(t||"Refreshing commandsâ€¦")}catch{}try{await Ho(e),ee("Refreshing commandsâ€¦"),await et.getState().loadCommands(),G("commands",{source:we})}catch(r){console.error("[CommandsStore] Failed to refresh configuration after OpenCode restart:",r),ee("OpenCode refresh failed. Please retry refreshing configuration manually."),await bt(1500)}finally{q()}}let Gt=null;Gt||(Gt=Xe(n=>{if(n.source!==we&&De(n,"commands")){const{loadCommands:t}=et.getState();t()}}));const re=()=>{const n=O.getDirectory();if(typeof n=="string"&&n.trim().length>0)return n;try{const t=window.__zustand_directory_store__;if(t)return t.getState().currentDirectory}catch{}return null},Ne="useSkillsStore",tt=Q()(Y(ye((n,t)=>({selectedSkillName:null,skills:[],isLoading:!1,skillDraft:null,setSelectedSkill:e=>{n({selectedSkillName:e})},setSkillDraft:e=>{n({skillDraft:e})},loadSkills:async()=>{n({isLoading:!0});const e=t().skills;let r=null;for(let o=0;o<3;o++)try{const i=re(),a=i?`?directory=${encodeURIComponent(i)}`:"",s=await fetch(`/api/config/skills${a}`);if(!s.ok)throw new Error(`Failed to list skills: ${s.status}`);const l=((await s.json()).skills||[]).map(f=>({name:f.name,path:f.path,scope:f.scope??"user",source:f.source??"opencode",description:f.sources?.md?.description||""}));return n({skills:l,isLoading:!1}),!0}catch(i){r=i;const a=200*(o+1);await new Promise(s=>setTimeout(s,a))}return console.error("Failed to load skills:",r),n({skills:e,isLoading:!1}),!1},getSkillDetail:async e=>{try{const r=re(),o=r?`?directory=${encodeURIComponent(r)}`:"",i=await fetch(`/api/config/skills/${encodeURIComponent(e)}${o}`);return i.ok?await i.json():null}catch{return null}},createSkill:async e=>{J("Creating skill...");try{const r={name:e.name,description:e.description};e.instructions&&(r.instructions=e.instructions),e.scope&&(r.scope=e.scope),e.supportingFiles&&(r.supportingFiles=e.supportingFiles);const o=re(),i=o?`?directory=${encodeURIComponent(o)}`:"",a=await fetch(`/api/config/skills/${encodeURIComponent(e.name)}${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await a.json().catch(()=>null);if(!a.ok){const c=s?.error||"Failed to create skill";throw new Error(c)}const d=await t().loadSkills();return d&&G("skills",{source:Ne}),d}catch{return!1}finally{q()}},updateSkill:async(e,r)=>{J("Updating skill...");try{const o={};r.description!==void 0&&(o.description=r.description),r.instructions!==void 0&&(o.instructions=r.instructions),r.supportingFiles!==void 0&&(o.supportingFiles=r.supportingFiles);const i=re(),a=i?`?directory=${encodeURIComponent(i)}`:"",s=await fetch(`/api/config/skills/${encodeURIComponent(e)}${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),d=await s.json().catch(()=>null);if(!s.ok){const l=d?.error||"Failed to update skill";throw new Error(l)}const c=await t().loadSkills();return c&&G("skills",{source:Ne}),c}catch{return!1}finally{q()}},deleteSkill:async e=>{J("Deleting skill...");try{const r=re(),o=r?`?directory=${encodeURIComponent(r)}`:"",i=await fetch(`/api/config/skills/${encodeURIComponent(e)}${o}`,{method:"DELETE"}),a=await i.json().catch(()=>null);if(!i.ok){const d=a?.error||"Failed to delete skill";throw new Error(d)}const s=await t().loadSkills();return s&&G("skills",{source:Ne}),t().selectedSkillName===e&&n({selectedSkillName:null}),s}catch{return!1}finally{q()}},getSkillByName:e=>{const{skills:r}=t();return r.find(o=>o.name===e)},readSupportingFile:async(e,r)=>{try{const o=re(),i=o?`&directory=${encodeURIComponent(o)}`:"",a=await fetch(`/api/config/skills/${encodeURIComponent(e)}/files/${encodeURIComponent(r)}?${i.slice(1)}`);return a.ok?(await a.json()).content??null:null}catch{return null}},writeSupportingFile:async(e,r,o)=>{try{const i=re(),a=i?`?directory=${encodeURIComponent(i)}`:"";return(await fetch(`/api/config/skills/${encodeURIComponent(e)}/files/${encodeURIComponent(r)}${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})})).ok}catch{return!1}},deleteSupportingFile:async(e,r)=>{try{const o=re(),i=o?`?directory=${encodeURIComponent(o)}`:"";return(await fetch(`/api/config/skills/${encodeURIComponent(e)}/files/${encodeURIComponent(r)}${i}`,{method:"DELETE"})).ok}catch{return!1}}}),{name:"skills-store",storage:ae(()=>H()),partialize:n=>({selectedSkillName:n.selectedSkillName})}),{name:"skills-store"}));typeof window<"u"&&(window.__zustand_skills_store__=tt);let Kt=null;Kt||(Kt=Xe(n=>{if(n.source!==Ne&&De(n,"skills")){const{loadSkills:t}=tt.getState();t()}}));const Jt=[{id:"anthropic",label:"Anthropic",description:"Anthropic's public skills repository",source:"anthropics/skills",defaultSubpath:"skills",sourceType:"github"},{id:"clawdhub",label:"ClawdHub",description:"Community skill registry with vector search",source:"clawdhub:registry",sourceType:"clawdhub"}],ze=()=>{const n=O.getDirectory();if(typeof n=="string"&&n.trim().length>0)return n;try{const t=window.__zustand_directory_store__;if(t)return t.getState().currentDirectory}catch{}return null},No=Q()(Y((n,t)=>({sources:Jt,itemsBySource:{},selectedSourceId:Jt[0]?.id??null,pageInfoBySource:{},loadedSourceIds:{},clawdhubHasMoreBySource:{},isLoadingCatalog:!1,isLoadingSource:!1,isLoadingMore:!1,isScanning:!1,isInstalling:!1,lastCatalogError:null,lastScanError:null,lastInstallError:null,scanResults:null,setSelectedSource:e=>n({selectedSourceId:e}),loadCatalog:async e=>{n({isLoadingCatalog:!0,lastCatalogError:null});const r={sources:t().sources,itemsBySource:t().itemsBySource,pageInfoBySource:t().pageInfoBySource,loadedSourceIds:t().loadedSourceIds,clawdhubHasMoreBySource:t().clawdhubHasMoreBySource};let o=null;try{const i=e?.refresh?"?refresh=true":"",a=new AbortController,s=window.setTimeout(()=>a.abort(),3e3);try{const d=await fetch(`/api/config/skills/catalog${i}`,{method:"GET",headers:{Accept:"application/json"},signal:a.signal}),c=await d.json().catch(()=>null);if(!d.ok||!c?.ok)throw o=c?.error||{kind:"unknown",message:`Failed to load catalog (${d.status})`},new Error(o.message);const l=c.sources&&c.sources.length>0?c.sources:r.sources,f=e?.refresh?{}:t().itemsBySource||{},p=e?.refresh?{}:t().pageInfoBySource||{},h=e?.refresh?{}:t().loadedSourceIds||{},g=e?.refresh?{}:t().clawdhubHasMoreBySource||{},y=t().selectedSourceId,m=y&&l.some(w=>w.id===y)?y:l[0]?.id??null;return n({sources:l,itemsBySource:f,pageInfoBySource:p,loadedSourceIds:h,clawdhubHasMoreBySource:g,selectedSourceId:m}),!0}finally{window.clearTimeout(s)}}catch(i){return o=o||{kind:"unknown",message:i instanceof Error?i.message:String(i)},n({sources:r.sources,itemsBySource:r.itemsBySource,pageInfoBySource:r.pageInfoBySource,loadedSourceIds:r.loadedSourceIds,clawdhubHasMoreBySource:r.clawdhubHasMoreBySource,lastCatalogError:o||{kind:"unknown",message:"Failed to load catalog"}}),!1}finally{n({isLoadingCatalog:!1})}},loadSource:async(e,r)=>{if(!e)return!1;n({isLoadingSource:!0,lastCatalogError:null});try{const o=ze(),i=r?.refresh?"&refresh=true":"",a=o?`?directory=${encodeURIComponent(o)}&sourceId=${encodeURIComponent(e)}${i}`:`?sourceId=${encodeURIComponent(e)}${i}`,s=await fetch(`/api/config/skills/catalog/source${a}`,{method:"GET",headers:{Accept:"application/json"}}),d=await s.json().catch(()=>null),c=Array.isArray(d?.items);if(!s.ok||!d?.ok&&!c){const p=await fetch(`/api/config/skills/catalog${a}`,{method:"GET",headers:{Accept:"application/json"}}),h=await p.json().catch(()=>null),g=h?.itemsBySource?.[e];return p.ok&&h?.ok&&Array.isArray(g)?(n(y=>({itemsBySource:{...y.itemsBySource,[e]:g},pageInfoBySource:{...y.pageInfoBySource,[e]:{nextCursor:null}},loadedSourceIds:{...y.loadedSourceIds,[e]:!0},clawdhubHasMoreBySource:{...y.clawdhubHasMoreBySource,[e]:!1}})),!0):(n({lastCatalogError:d?.error||{kind:"unknown",message:`Failed to load source (${s.status})`}}),!1)}const l=d?.items||[],f=d?.nextCursor??null;return n(p=>({itemsBySource:{...p.itemsBySource,[e]:l},pageInfoBySource:{...p.pageInfoBySource,[e]:{nextCursor:f}},loadedSourceIds:{...p.loadedSourceIds,[e]:!0},clawdhubHasMoreBySource:{...p.clawdhubHasMoreBySource,[e]:l.length>0}})),!0}catch(o){return n({lastCatalogError:{kind:"unknown",message:o instanceof Error?o.message:String(o)}}),!1}finally{n({isLoadingSource:!1})}},loadMoreClawdHub:async()=>{const e=t().selectedSourceId;if(!e)return!1;const o=t().pageInfoBySource[e]?.nextCursor||null;n({isLoadingMore:!0});try{const i=ze(),a=[`sourceId=${encodeURIComponent(e)}`];i&&a.push(`directory=${encodeURIComponent(i)}`),o&&a.push(`cursor=${encodeURIComponent(o)}`);const s=`?${a.join("&")}`,d=await fetch(`/api/config/skills/catalog/source${s}`,{method:"GET",headers:{Accept:"application/json"}}),c=await d.json().catch(()=>null);if(!d.ok||!c?.ok)return!1;const l=c.nextCursor??null,f=t().itemsBySource[e]||[],p=c.items||[],h=new Map(f.map(m=>[`${m.sourceId}:${m.skillDir}`,m]));let g=0;for(const m of p){const w=`${m.sourceId}:${m.skillDir}`;h.has(w)||(g+=1),h.set(w,m)}const y=p.length===0||g===0;return n(m=>({itemsBySource:{...m.itemsBySource,[e]:Array.from(h.values())},pageInfoBySource:{...m.pageInfoBySource,[e]:{nextCursor:l}},clawdhubHasMoreBySource:{...m.clawdhubHasMoreBySource,[e]:!y}})),!0}catch{return!1}finally{n({isLoadingMore:!1})}},scanRepo:async e=>{n({isScanning:!0,lastScanError:null,scanResults:null});try{const r=ze(),o=r?`?directory=${encodeURIComponent(r)}`:"",i=await fetch(`/api/config/skills/scan${o}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),a=await i.json().catch(()=>null);if(!i.ok||!a){const s=a?.error||{kind:"unknown",message:"Failed to scan repository"};return n({lastScanError:s}),{ok:!1,error:s}}return a.ok?(n({scanResults:a.items||[]}),a):(n({lastScanError:a.error||{kind:"unknown",message:"Failed to scan repository"}}),a)}finally{n({isScanning:!1})}},installSkills:async e=>{n({isInstalling:!0,lastInstallError:null});try{const r=ze(),o=r?`?directory=${encodeURIComponent(r)}`:"",i=await fetch(`/api/config/skills/install${o}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),a=await i.json().catch(()=>null);if(!a){const s={kind:"unknown",message:"Failed to install skills"};return n({lastInstallError:s}),{ok:!1,error:s}}if(!i.ok||!a.ok){const s=a.error||{kind:"unknown",message:"Failed to install skills"};return n({lastInstallError:s}),{ok:!1,error:s}}return tt.getState().loadSkills(),a}catch(r){const o={kind:"unknown",message:r instanceof Error?r.message:String(r)};return n({lastInstallError:o}),{ok:!1,error:o}}finally{n({isInstalling:!1})}}}),{name:"skills-catalog-store"})),$o=()=>{const n=O.getDirectory();if(typeof n=="string"&&n.trim().length>0)return n;try{const t=window.__zustand_directory_store__;if(t)return t.getState().currentDirectory}catch{}return null},Fe=()=>{try{const t=Ze.getState().getActiveProject?.();if(t?.path?.trim())return t.path.trim();const e=O.getDirectory();if(e?.trim())return e.trim()}catch(n){console.warn("[AgentsStore] Error resolving config directory:",n)}return null},ki=n=>{const t=n;return t.native===!0||t.builtIn===!0},Bo=n=>{const t=n;return t.hidden===!0||t.options?.hidden===!0},Ir=n=>n.filter(t=>!Bo(t)),$e="useAgentsStore",Ge=n=>new Promise(t=>setTimeout(t,n)),Vo=2e4,Qt=300,Yt=4,Uo=800,Wo=200,Go=2e3,Mt=Q()(Y(ye((n,t)=>({selectedAgentName:null,agents:[],isLoading:!1,agentDraft:null,setSelectedAgent:e=>{n({selectedAgentName:e})},setAgentDraft:e=>{n({agentDraft:e})},loadAgents:async()=>{n({isLoading:!0});const e=t().agents;for(let r=0;r<3;r++)try{const o=Fe(),i=o?`?directory=${encodeURIComponent(o)}`:"",a=await O.withDirectory(o,()=>O.listAgents()),s=await Promise.all(a.map(async d=>{try{const c=await fetch(`/api/config/agents/${encodeURIComponent(d.name)}${i}`,{headers:{"Cache-Control":"no-cache",...o?{"x-opencode-directory":o}:{}}});if(c.ok){const l=await c.json();let f=l.scope;if(!f&&l.sources){const p=l.sources;f=(p.md?.exists?p.md.scope:void 0)??(p.json?.exists?p.json.scope:void 0)??p.md?.scope??p.json?.scope}return f==="project"||f==="user"?{...d,scope:f}:{...d,scope:void 0}}}catch(c){console.warn(`[AgentsStore] Failed to fetch config for agent ${d.name}:`,c)}return d}));return JSON.stringify(e)!==JSON.stringify(s)?n({agents:s,isLoading:!1}):n({isLoading:!1}),!0}catch{}return n({isLoading:!1}),!1},createAgent:async e=>{J("Creating agent configurationâ€¦");let r=!1;try{console.log("[AgentsStore] Creating agent:",e.name);const o={mode:e.mode||"subagent"};e.description&&(o.description=e.description),e.model&&(o.model=e.model),e.temperature!==void 0&&(o.temperature=e.temperature),e.top_p!==void 0&&(o.top_p=e.top_p),e.prompt&&(o.prompt=e.prompt),e.permission&&(o.permission=e.permission),e.disable!==void 0&&(o.disable=e.disable),e.scope&&(o.scope=e.scope),console.log("[AgentsStore] Agent config to save:",o);const i=Fe(),a=i?`?directory=${encodeURIComponent(i)}`:"",s=await fetch(`/api/config/agents/${encodeURIComponent(e.name)}${a}`,{method:"POST",headers:{"Content-Type":"application/json",...i?{"x-opencode-directory":i}:{}},body:JSON.stringify(o)}),d=await s.json().catch(()=>null);if(!s.ok){const f=d?.error||"Failed to create agent";throw new Error(f)}if(d?.requiresReload??!0)return r=!0,await be({message:d?.message,delayMs:d?.reloadDelayMs,scopes:["agents"],mode:"active"}),!0;const l=await t().loadAgents();return l&&G("agents",{source:$e}),l}catch(o){return console.error("Failed to create agent:",o),!1}finally{r||q()}},updateAgent:async(e,r)=>{J("Updating agent configurationâ€¦");let o=!1;try{const i={};r.mode!==void 0&&(i.mode=r.mode),r.description!==void 0&&(i.description=r.description),r.model!==void 0&&(i.model=r.model),r.temperature!==void 0&&(i.temperature=r.temperature),r.top_p!==void 0&&(i.top_p=r.top_p),r.prompt!==void 0&&(i.prompt=r.prompt),r.permission!==void 0&&(i.permission=r.permission),r.disable!==void 0&&(i.disable=r.disable);const a=Fe(),s=a?`?directory=${encodeURIComponent(a)}`:"",d=await fetch(`/api/config/agents/${encodeURIComponent(e)}${s}`,{method:"PATCH",headers:{"Content-Type":"application/json",...a?{"x-opencode-directory":a}:{}},body:JSON.stringify(i)}),c=await d.json().catch(()=>null);if(!d.ok){const p=c?.error||"Failed to update agent";throw new Error(p)}if(c?.requiresReload??!0)return o=!0,await be({message:c?.message,delayMs:c?.reloadDelayMs,scopes:["agents"],mode:"active"}),!0;const f=await t().loadAgents();return f&&G("agents",{source:$e}),f}catch(i){throw console.error("Failed to update agent:",i),i}finally{o||q()}},deleteAgent:async e=>{J("Deleting agent configurationâ€¦");let r=!1;try{const o=Fe(),i=o?`?directory=${encodeURIComponent(o)}`:"",a=await fetch(`/api/config/agents/${encodeURIComponent(e)}${i}`,{method:"DELETE",headers:o?{"x-opencode-directory":o}:void 0}),s=await a.json().catch(()=>null);if(!a.ok){const l=s?.error||"Failed to delete agent";throw new Error(l)}if(s?.requiresReload??!0)return r=!0,await be({message:s?.message,delayMs:s?.reloadDelayMs,scopes:["agents"],mode:"active"}),!0;const c=await t().loadAgents();return c&&G("agents",{source:$e}),t().selectedAgentName===e&&n({selectedAgentName:null}),c}catch{return!1}finally{r||q()}},getAgentByName:e=>{const{agents:r}=t();return r.find(o=>o.name===e)},getVisibleAgents:()=>{const{agents:e}=t();return Ir(e)}}),{name:"agents-store",storage:ae(()=>H()),partialize:n=>({selectedAgentName:n.selectedAgentName})}),{name:"agents-store"}));typeof window<"u"&&(window.__zustand_agents_store__=Mt);async function Ko(n){const t=typeof n=="number"&&n>0?Math.min(n,Qt):0;t>0&&await Ge(t);const e=Date.now();let r=0,o=null;for(;Date.now()-e<Vo;){r+=1,ee(`Waiting for OpenCodeâ€¦ (attempt ${r})`);try{if(await O.checkHealth())return;o=new Error("OpenCode health check reported not ready")}catch(s){o=s}const i=Date.now()-e,a=r<=Yt&&i<1200?Qt:Math.min(Uo+Math.max(0,r-Yt)*Wo,Go);await Ge(a)}throw o||new Error("OpenCode did not become ready in time")}const Jo=n=>{if(!n||n.length===0)return["all"];const t=Array.from(new Set(n));return t.includes("all")?["all"]:t};async function Qo(n={}){const{message:t,delayMs:e}=n,r=Jo(n.scopes),o=n.mode??(r.includes("all")?"projects":"active");try{ee(t||"Refreshing configurationâ€¦")}catch{}try{await Ko(e);const i=se.getState(),a=Mt.getState(),s=et.getState(),d=tt.getState(),c=No.getState(),l=r.includes("all")||r.includes("providers"),f=r.includes("all")||r.includes("agents"),p=r.includes("all")||r.includes("agents"),h=r.includes("all")||r.includes("commands"),g=r.includes("all")||r.includes("skills"),y=$o(),m=o==="projects"?Ze.getState().projects:[],w=Array.from(new Set([...y?[y]:[],...m.map(C=>C.path).filter(Boolean)]));r.includes("all")&&o==="projects"&&se.setState({directoryScoped:{}});const I=[];for(const C of w)l&&I.push(i.loadProviders({directory:C}).then(()=>{})),f&&I.push(i.loadAgents({directory:C}).then(()=>{}));const k=[];p&&k.push(a.loadAgents().then(()=>{})),h&&k.push(s.loadCommands().then(()=>{})),g&&(k.push(d.loadSkills().then(()=>{})),k.push(c.loadCatalog().then(()=>{}))),ee("Refreshing configurationâ€¦"),await Promise.all([...I,...k])}catch{ee("OpenCode refresh failed. Please retry."),await Ge(1500)}finally{q()}}async function be(n){await Qo(n)}async function Ci(n){J(n?.message||"Reloading OpenCode configurationâ€¦");try{const t=await fetch("/api/config/reload",{method:"POST",headers:{"Content-Type":"application/json"}}),e=await t.json().catch(()=>null);if(!t.ok){const o=e?.error||"Failed to reload configuration";throw new Error(o)}const r={...n,scopes:n?.scopes??["all"],mode:n?.mode??"projects"};e?.requiresReload?await be({...r,message:e.message,delayMs:e.reloadDelayMs}):await be(r)}catch(t){throw console.error("[reloadOpenCodeConfiguration] Failed:",t),ee("Failed to reload configuration. Please try again."),await Ge(2e3),q(),t}}let Zt=null;Zt||(Zt=Xe(n=>{if(n.source!==$e&&De(n,"agents")){const{loadAgents:t}=Mt.getState();t()}}));const Yo="https://models.dev/api.json",Zo="/api/openchamber/models-metadata",Xt="opencode",er="big-pickle",Xo=async()=>{try{const n=yr()?.settings;if(n)try{const c=(await n.load())?.settings;if(c){const l=typeof c?.defaultModel=="string"?c.defaultModel.trim():"",f=typeof c?.defaultVariant=="string"?c.defaultVariant.trim():"",p=typeof c?.defaultAgent=="string"?c.defaultAgent.trim():"",h=typeof c?.gitmojiEnabled=="boolean"?c.gitmojiEnabled:void 0,g=typeof c?.zenModel=="string"?c.zenModel.trim():"";return{defaultModel:l.length>0?l:void 0,defaultVariant:f.length>0?f:void 0,defaultAgent:p.length>0?p:void 0,autoCreateWorktree:typeof c?.autoCreateWorktree=="boolean"?c.autoCreateWorktree:void 0,gitmojiEnabled:h,zenModel:g.length>0?g:void 0}}}catch{}const t=await fetch("/api/config/settings",{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)return{};const e=await t.json(),r=typeof e?.defaultModel=="string"?e.defaultModel.trim():"",o=typeof e?.defaultVariant=="string"?e.defaultVariant.trim():"",i=typeof e?.defaultAgent=="string"?e.defaultAgent.trim():"",a=typeof e?.gitmojiEnabled=="boolean"?e.gitmojiEnabled:void 0,s=typeof e?.zenModel=="string"?e.zenModel.trim():"";return{defaultModel:r.length>0?r:void 0,defaultVariant:o.length>0?o:void 0,defaultAgent:i.length>0?i:void 0,autoCreateWorktree:typeof e?.autoCreateWorktree=="boolean"?e.autoCreateWorktree:void 0,gitmojiEnabled:a,zenModel:s.length>0?s:void 0}}catch{return{}}},qe=n=>{if(!n||typeof n!="string")return null;const t=n.split("/");return t.length!==2||!t[0]||!t[1]?null:{providerId:t[0],modelId:t[1]}},ei=n=>n?.toLowerCase?.()??"",ti=n=>n==="primary"||n==="all"||n===void 0||n===null,ke=n=>typeof n=="object"&&n!==null,Ke=n=>Array.isArray(n)&&n.every(t=>typeof t=="string"),ri=n=>{if(!ke(n))return!1;const t=n;if(t.modalities){const{input:e,output:r}=t.modalities;if(e&&!Ke(e)||r&&!Ke(r))return!1}return!0},ni=n=>{if(!ke(n))return!1;const t=n;return t.models===void 0||ke(t.models)},Dr=(n,t)=>{const e=ei(n);return!e||!t?"":`${e}/${t}`},oi=n=>{const t=new Map;if(!ke(n))return t;for(const[e,r]of Object.entries(n)){if(!ni(r))continue;const o=typeof r.id=="string"&&r.id.length>0?r.id:e,i=r.models;if(!(!i||!ke(i)))for(const[a,s]of Object.entries(i)){if(!ri(s))continue;const d=typeof a=="string"&&a.length>0?a:s.id;if(!d||typeof d!="string"||d.length===0)continue;const c={id:typeof s.id=="string"&&s.id.length>0?s.id:d,providerId:o,name:typeof s.name=="string"?s.name:void 0,tool_call:typeof s.tool_call=="boolean"?s.tool_call:void 0,reasoning:typeof s.reasoning=="boolean"?s.reasoning:void 0,temperature:typeof s.temperature=="boolean"?s.temperature:void 0,attachment:typeof s.attachment=="boolean"?s.attachment:void 0,modalities:s.modalities?{input:Ke(s.modalities.input)?s.modalities.input:void 0,output:Ke(s.modalities.output)?s.modalities.output:void 0}:void 0,cost:s.cost,limit:s.limit,knowledge:typeof s.knowledge=="string"?s.knowledge:void 0,release_date:typeof s.release_date=="string"?s.release_date:void 0,last_updated:typeof s.last_updated=="string"?s.last_updated:void 0},l=Dr(o,d);l&&t.set(l,c)}}return t},ii=async()=>{if(typeof fetch!="function")return new Map;const n=[Zo,Yo];for(const t of n){const e=typeof AbortController<"u"?new AbortController:void 0,r=e?setTimeout(()=>e.abort(),8e3):void 0;try{const o=/^https?:\/\//i.test(t),i={signal:e?.signal,headers:{Accept:"application/json"},cache:"no-store"};o?i.mode="cors":i.credentials="same-origin";const a=await fetch(t,i);if(!a.ok)throw new Error(`Metadata request to ${t} returned status ${a.status}`);const s=await a.json();return oi(s)}catch(o){o?.name==="AbortError"?console.warn(`Model metadata request aborted (${t})`):console.warn(`Failed to fetch model metadata from ${t}:`,o)}finally{r&&clearTimeout(r)}}return new Map};let ut=null;const si=(n,t)=>{n().size>0||ut||(ut=ii().then(r=>(r.size>0&&t(r),r)).catch(()=>new Map).finally(()=>{ut=null}))},ai=n=>new Promise(t=>setTimeout(t,n)),At="__global__",fe=n=>{const t=typeof n=="string"?n.trim():"";return t.length>0?t:At},de=n=>n===At?null:n,ci=()=>{if(typeof window>"u")return At;const n=O.getDirectory()??ne.getState().currentDirectory;return fe(n)},se=Q()(Y(ye((n,t)=>({activeDirectoryKey:ci(),directoryScoped:{},providers:[],agents:[],currentProviderId:"",currentModelId:"",currentVariant:void 0,currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{},isConnected:!1,isInitialized:!1,modelsMetadata:new Map,settingsDefaultModel:void 0,settingsDefaultVariant:void 0,settingsDefaultAgent:void 0,settingsAutoCreateWorktree:!1,settingsGitmojiEnabled:!1,settingsZenModel:void 0,voiceProvider:(()=>{if(typeof window<"u"){const e=localStorage.getItem("voiceProvider");if(e==="openai"||e==="browser"||e==="say")return e}return"browser"})(),speechRate:(()=>{if(typeof window<"u"){const e=localStorage.getItem("speechRate");if(e){const r=parseFloat(e);if(!isNaN(r)&&r>=.5&&r<=2)return r}}return 1})(),speechPitch:(()=>{if(typeof window<"u"){const e=localStorage.getItem("speechPitch");if(e){const r=parseFloat(e);if(!isNaN(r)&&r>=.5&&r<=2)return r}}return 1})(),speechVolume:(()=>{if(typeof window<"u"){const e=localStorage.getItem("speechVolume");if(e){const r=parseFloat(e);if(!isNaN(r)&&r>=0&&r<=1)return r}}return 1})(),sayVoice:(()=>{if(typeof window<"u"){const e=localStorage.getItem("sayVoice");if(e)return e}return"Samantha"})(),browserVoice:(()=>{if(typeof window<"u"){const e=localStorage.getItem("browserVoice");if(e)return e}return""})(),openaiVoice:(()=>{if(typeof window<"u"){const e=localStorage.getItem("openaiVoice");if(e)return e}return"nova"})(),openaiApiKey:(()=>{if(typeof window<"u"){const e=localStorage.getItem("openaiApiKey");if(e)return e}return""})(),showMessageTTSButtons:typeof window<"u"&&localStorage.getItem("showMessageTTSButtons")==="true",voiceModeEnabled:typeof window<"u"&&localStorage.getItem("voiceModeEnabled")==="true",summarizeMessageTTS:typeof window<"u"&&localStorage.getItem("summarizeMessageTTS")==="true",summarizeVoiceConversation:typeof window<"u"&&localStorage.getItem("summarizeVoiceConversation")==="true",summarizeCharacterThreshold:(()=>{if(typeof window<"u"){const e=localStorage.getItem("summarizeCharacterThreshold");if(e){const r=parseInt(e,10);if(!isNaN(r)&&r>=50&&r<=2e3)return r}}return 200})(),summarizeMaxLength:(()=>{if(typeof window<"u"){const e=localStorage.getItem("summarizeMaxLength");if(e){const r=parseInt(e,10);if(!isNaN(r)&&r>=50&&r<=2e3)return r}}return 500})(),activateDirectory:async e=>{const r=fe(e);n(o=>{const i=o.directoryScoped[r];return i?{activeDirectoryKey:r,providers:i.providers,agents:i.agents,currentProviderId:i.currentProviderId,currentModelId:i.currentModelId,currentVariant:i.currentVariant,currentAgentName:i.currentAgentName,selectedProviderId:i.selectedProviderId,agentModelSelections:i.agentModelSelections,defaultProviders:i.defaultProviders}:{activeDirectoryKey:r,providers:[],agents:[],currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}}}),t().isConnected&&(await t().loadProviders({directory:de(r)}),await t().loadAgents({directory:de(r)}))},loadProviders:async e=>{const r=fe(e?.directory??de(t().activeDirectoryKey)),o=t().directoryScoped[r],i=o?.providers??(t().activeDirectoryKey===r?t().providers:[]),a=o?.defaultProviders??(t().activeDirectoryKey===r?t().defaultProviders:{});let s=null;for(let d=0;d<3;d++)try{si(()=>t().modelsMetadata,h=>n({modelsMetadata:h}));const c=await O.withDirectory(de(r),()=>O.getProviders()),l=Array.isArray(c?.providers)?c.providers:[],f=c?.default||{},p=l.map(h=>{const g=h.models??{},y=Object.keys(g).map(m=>g[m]);return{...h,models:y}});n(h=>{const y={...h.directoryScoped[r]??{providers:[],agents:[],currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},providers:p,defaultProviders:f},m={directoryScoped:{...h.directoryScoped,[r]:y}};if(h.activeDirectoryKey===r&&(m.providers=p,m.defaultProviders=f,!h.currentProviderId&&!h.currentModelId&&h.settingsDefaultModel)){const w=qe(h.settingsDefaultModel);if(w){const I=p.find(k=>k.id===w.providerId);if(I?.models.some(k=>k.id===w.modelId)){const k=I.models.find(v=>v.id===w.modelId),C=h.settingsDefaultVariant&&k?.variants?.[h.settingsDefaultVariant]?h.settingsDefaultVariant:void 0;m.currentProviderId=w.providerId,m.currentModelId=w.modelId,m.currentVariant=C,m.selectedProviderId=w.providerId,y.currentProviderId=w.providerId,y.currentModelId=w.modelId,y.currentVariant=C,y.selectedProviderId=w.providerId}}}return m});return}catch(c){s=c;const l=200*(d+1);await new Promise(f=>setTimeout(f,l))}console.error("Failed to load providers:",s),n(d=>{const l={...d.directoryScoped[r]??{providers:[],agents:[],currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},providers:i,defaultProviders:a},f={directoryScoped:{...d.directoryScoped,[r]:l}};if(d.activeDirectoryKey===r&&(f.providers=i,f.defaultProviders=a,!d.currentProviderId&&!d.currentModelId&&d.settingsDefaultModel)){const p=qe(d.settingsDefaultModel);if(p){const h=i.find(g=>g.id===p.providerId);if(h?.models.some(g=>g.id===p.modelId)){const g=h.models.find(m=>m.id===p.modelId),y=d.settingsDefaultVariant&&g?.variants?.[d.settingsDefaultVariant]?d.settingsDefaultVariant:void 0;f.currentProviderId=p.providerId,f.currentModelId=p.modelId,f.currentVariant=y,f.selectedProviderId=p.providerId,l.currentProviderId=p.providerId,l.currentModelId=p.modelId,l.currentVariant=y,l.selectedProviderId=p.providerId}}}return f})},setProvider:e=>{const{providers:r}=t(),o=r.find(s=>s.id===e);if(!o)return;const a=o.models[0]?.id||"";n(s=>{const d=s.activeDirectoryKey,l={...s.directoryScoped[d]??{providers:s.providers,agents:s.agents,currentProviderId:s.currentProviderId,currentModelId:s.currentModelId,currentVariant:s.currentVariant,currentAgentName:s.currentAgentName,selectedProviderId:s.selectedProviderId,agentModelSelections:s.agentModelSelections,defaultProviders:s.defaultProviders},currentProviderId:e,currentModelId:a,selectedProviderId:e};return{currentProviderId:e,currentModelId:a,selectedProviderId:e,directoryScoped:{...s.directoryScoped,[d]:l}}})},setModel:e=>{n(r=>{const o=r.activeDirectoryKey,a={...r.directoryScoped[o]??{providers:r.providers,agents:r.agents,currentProviderId:r.currentProviderId,currentModelId:r.currentModelId,currentVariant:r.currentVariant,currentAgentName:r.currentAgentName,selectedProviderId:r.selectedProviderId,agentModelSelections:r.agentModelSelections,defaultProviders:r.defaultProviders},currentModelId:e};return{currentModelId:e,directoryScoped:{...r.directoryScoped,[o]:a}}})},setCurrentVariant:e=>{n(r=>{if(r.currentVariant===e)return r;const o=r.activeDirectoryKey,a={...r.directoryScoped[o]??{providers:r.providers,agents:r.agents,currentProviderId:r.currentProviderId,currentModelId:r.currentModelId,currentVariant:r.currentVariant,currentAgentName:r.currentAgentName,selectedProviderId:r.selectedProviderId,agentModelSelections:r.agentModelSelections,defaultProviders:r.defaultProviders},currentVariant:e};return{currentVariant:e,directoryScoped:{...r.directoryScoped,[o]:a}}})},getCurrentModelVariants:()=>{const r=t().getCurrentModel()?.variants;return r?Object.keys(r):[]},cycleCurrentVariant:()=>{const e=t().getCurrentModelVariants();if(e.length===0)return;const r=t().currentVariant;if(!r){t().setCurrentVariant(e[0]);return}const o=e.indexOf(r);if(o===-1||o===e.length-1){t().setCurrentVariant(void 0);return}t().setCurrentVariant(e[o+1])},setSelectedProvider:e=>{n(r=>{const o=r.activeDirectoryKey,a={...r.directoryScoped[o]??{providers:r.providers,agents:r.agents,currentProviderId:r.currentProviderId,currentModelId:r.currentModelId,currentAgentName:r.currentAgentName,selectedProviderId:r.selectedProviderId,agentModelSelections:r.agentModelSelections,defaultProviders:r.defaultProviders},selectedProviderId:e};return{selectedProviderId:e,directoryScoped:{...r.directoryScoped,[o]:a}}})},saveAgentModelSelection:(e,r,o)=>{n(i=>{const a=i.activeDirectoryKey,s={...i.agentModelSelections,[e]:{providerId:r,modelId:o}},c={...i.directoryScoped[a]??{providers:i.providers,agents:i.agents,currentProviderId:i.currentProviderId,currentModelId:i.currentModelId,currentAgentName:i.currentAgentName,selectedProviderId:i.selectedProviderId,agentModelSelections:i.agentModelSelections,defaultProviders:i.defaultProviders},agentModelSelections:s};return{agentModelSelections:s,directoryScoped:{...i.directoryScoped,[a]:c}}})},getAgentModelSelection:e=>{const{agentModelSelections:r}=t();return r[e]||null},loadAgents:async e=>{const r=fe(e?.directory??de(t().activeDirectoryKey)),i=t().directoryScoped[r]?.agents??(t().activeDirectoryKey===r?t().agents:[]);let a=null;for(let s=0;s<3;s++)try{const[d,c]=await Promise.all([O.withDirectory(de(r),()=>O.listAgents()),Xo()]),l=Array.isArray(d)?d:[],f=t().activeDirectoryKey===r?t().providers:t().directoryScoped[r]?.providers??[];if(n(v=>{const D={...v.directoryScoped[r]??{providers:f,agents:i,currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},providers:f,agents:l},R={settingsDefaultModel:c.defaultModel,settingsDefaultVariant:c.defaultVariant,settingsDefaultAgent:c.defaultAgent,settingsAutoCreateWorktree:c.autoCreateWorktree??!1,settingsGitmojiEnabled:c.gitmojiEnabled??!1,settingsZenModel:c.zenModel,directoryScoped:{...v.directoryScoped,[r]:D}};return v.activeDirectoryKey===r&&(R.agents=l),R}),l.length===0)return n(v=>{const D={...v.directoryScoped[r]??{providers:f,agents:[],currentProviderId:"",currentModelId:"",currentVariant:void 0,currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},providers:f,agents:[],currentAgentName:void 0},R={directoryScoped:{...v.directoryScoped,[r]:D}};return v.activeDirectoryKey===r&&(R.currentAgentName=void 0),R}),!0;const p=(v,M)=>{const D=f.find(R=>R.id===v);return D?D.models.some(R=>R.id===M):!1},h=l.filter(v=>ti(v.mode));let m=h.find(v=>v.name==="build")||h[0]||l[0];const w={};if(c.defaultAgent){const v=l.find(M=>M.name===c.defaultAgent);v?m=v:w.defaultAgent=""}let I,k,C;if(c.defaultModel){const v=qe(c.defaultModel);if(v&&p(v.providerId,v.modelId)){if(I=v.providerId,k=v.modelId,c.defaultVariant){const R=f.find(B=>B.id===v.providerId)?.models.find(B=>B.id===v.modelId)?.variants;R&&Object.prototype.hasOwnProperty.call(R,c.defaultVariant)?C=c.defaultVariant:w.defaultVariant=""}}else w.defaultModel=""}if(!I&&m?.model?.providerID&&m?.model?.modelID){const{providerID:v,modelID:M}=m.model;p(v,M)&&(I=v,k=M)}if(!I)if(p(Xt,er))I=Xt,k=er;else{const v=f[0],M=v?.models[0];v&&M&&(I=v.id,k=M.id)}return n(v=>{const M=v.directoryScoped[r]??{providers:f,agents:l,currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},D={...M,providers:f,agents:l,currentAgentName:m.name,currentProviderId:I??M.currentProviderId,currentModelId:k??M.currentModelId,currentVariant:C},R={directoryScoped:{...v.directoryScoped,[r]:D}};return v.activeDirectoryKey===r&&(R.currentAgentName=m.name,I&&k&&(R.currentProviderId=I,R.currentModelId=k,R.currentVariant=C)),R}),Object.keys(w).length>0&&(n({settingsDefaultModel:w.defaultModel!==void 0?void 0:t().settingsDefaultModel,settingsDefaultVariant:w.defaultVariant!==void 0?void 0:t().settingsDefaultVariant,settingsDefaultAgent:w.defaultAgent!==void 0?void 0:t().settingsDefaultAgent}),$(w).catch(()=>{})),!0}catch(d){a=d;const c=200*(s+1);await new Promise(l=>setTimeout(l,c))}return console.error("Failed to load agents:",a),n(s=>{const d=s.activeDirectoryKey===r?s.providers:s.directoryScoped[r]?.providers??[],l={...s.directoryScoped[r]??{providers:d,agents:[],currentProviderId:"",currentModelId:"",currentAgentName:void 0,selectedProviderId:"",agentModelSelections:{},defaultProviders:{}},providers:d,agents:i},f={directoryScoped:{...s.directoryScoped,[r]:l}};return s.activeDirectoryKey===r&&(f.agents=i),f}),!1},setAgent:e=>{const{agents:r,providers:o,settingsDefaultModel:i,settingsDefaultVariant:a}=t();if(n(s=>{const d=s.activeDirectoryKey,l={...s.directoryScoped[d]??{providers:s.providers,agents:s.agents,currentProviderId:s.currentProviderId,currentModelId:s.currentModelId,currentAgentName:s.currentAgentName,selectedProviderId:s.selectedProviderId,agentModelSelections:s.agentModelSelections,defaultProviders:s.defaultProviders},currentAgentName:e};return{currentAgentName:e,directoryScoped:{...s.directoryScoped,[d]:l}}}),e&&typeof window<"u"){const s=window.__zustand_session_store__;if(s){const d=s.getState(),{currentSessionId:c,isOpenChamberCreatedSession:l,initializeNewOpenChamberSession:f,getAgentModelForSession:p}=d;c&&s.setState(h=>{const g=new Map(h.currentAgentContext);return g.set(c,e),{currentAgentContext:g}}),c&&l(c)&&(p(c,e)||f(c,r))}}if(e&&typeof window<"u"){const s=window.__zustand_session_store__;if(s?.getState){const{currentSessionId:l,getAgentModelForSession:f}=s.getState();if(l&&f(l,e))return}if(i){const l=qe(i);if(l&&o.find(p=>p.id===l.providerId)?.models.some(p=>p.id===l.modelId)){n(p=>{const h=p.activeDirectoryKey,g=p.directoryScoped[h]??{providers:p.providers,agents:p.agents,currentProviderId:p.currentProviderId,currentModelId:p.currentModelId,currentVariant:p.currentVariant,currentAgentName:p.currentAgentName,selectedProviderId:p.selectedProviderId,agentModelSelections:p.agentModelSelections,defaultProviders:p.defaultProviders};let y;if(a){const k=o.find(C=>C.id===l.providerId)?.models.find(C=>C.id===l.modelId)?.variants;k&&Object.prototype.hasOwnProperty.call(k,a)&&(y=a)}const m={...g,currentProviderId:l.providerId,currentModelId:l.modelId,currentVariant:y};return{currentProviderId:l.providerId,currentModelId:l.modelId,currentVariant:y,directoryScoped:{...p.directoryScoped,[h]:m}}});return}}const c=r.find(l=>l.name===e)?.model;if(c?.providerID&&c?.modelID){const{providerID:l,modelID:f}=c;o.find(g=>g.id===l)?.models.find(g=>g.id===f)&&n(g=>{const y=g.activeDirectoryKey,w={...g.directoryScoped[y]??{providers:g.providers,agents:g.agents,currentProviderId:g.currentProviderId,currentModelId:g.currentModelId,currentAgentName:g.currentAgentName,selectedProviderId:g.selectedProviderId,agentModelSelections:g.agentModelSelections,defaultProviders:g.defaultProviders},currentProviderId:l,currentModelId:f,selectedProviderId:l};return{currentProviderId:l,currentModelId:f,selectedProviderId:l,directoryScoped:{...g.directoryScoped,[y]:w}}})}}},setSettingsDefaultModel:e=>{n({settingsDefaultModel:e})},setSettingsDefaultVariant:e=>{n({settingsDefaultVariant:e})},setSettingsDefaultAgent:e=>{n({settingsDefaultAgent:e})},setSettingsAutoCreateWorktree:e=>{n({settingsAutoCreateWorktree:e})},setSettingsGitmojiEnabled:e=>{n({settingsGitmojiEnabled:e})},setSettingsZenModel:e=>{n({settingsZenModel:e})},setVoiceProvider:e=>{n({voiceProvider:e}),typeof window<"u"&&localStorage.setItem("voiceProvider",e)},setSpeechRate:e=>{const r=Math.max(.5,Math.min(2,e));n({speechRate:r}),typeof window<"u"&&localStorage.setItem("speechRate",String(r))},setSpeechPitch:e=>{const r=Math.max(.5,Math.min(2,e));n({speechPitch:r}),typeof window<"u"&&localStorage.setItem("speechPitch",String(r))},setSpeechVolume:e=>{const r=Math.max(0,Math.min(1,e));n({speechVolume:r}),typeof window<"u"&&localStorage.setItem("speechVolume",String(r))},setSayVoice:e=>{n({sayVoice:e}),typeof window<"u"&&localStorage.setItem("sayVoice",e)},setBrowserVoice:e=>{n({browserVoice:e}),typeof window<"u"&&localStorage.setItem("browserVoice",e)},setOpenaiVoice:e=>{n({openaiVoice:e}),typeof window<"u"&&localStorage.setItem("openaiVoice",e)},setOpenaiApiKey:e=>{n({openaiApiKey:e}),typeof window<"u"&&localStorage.setItem("openaiApiKey",e)},setShowMessageTTSButtons:e=>{n({showMessageTTSButtons:e}),typeof window<"u"&&localStorage.setItem("showMessageTTSButtons",String(e))},setVoiceModeEnabled:e=>{n({voiceModeEnabled:e}),typeof window<"u"&&localStorage.setItem("voiceModeEnabled",String(e))},setSummarizeMessageTTS:e=>{n({summarizeMessageTTS:e}),typeof window<"u"&&localStorage.setItem("summarizeMessageTTS",String(e))},setSummarizeVoiceConversation:e=>{n({summarizeVoiceConversation:e}),typeof window<"u"&&localStorage.setItem("summarizeVoiceConversation",String(e))},setSummarizeCharacterThreshold:e=>{const r=Math.max(50,Math.min(2e3,e));n({summarizeCharacterThreshold:r}),typeof window<"u"&&localStorage.setItem("summarizeCharacterThreshold",String(r))},setSummarizeMaxLength:e=>{const r=Math.max(50,Math.min(2e3,e));n({summarizeMaxLength:r}),typeof window<"u"&&localStorage.setItem("summarizeMaxLength",String(r))},checkConnection:async()=>{let r=0,o=null;for(;r<5;)try{const i=await O.checkHealth();return n({isConnected:i}),i}catch(i){o=i,r+=1;const a=400*r;await ai(a)}return o&&console.warn("[ConfigStore] Failed to reach OpenCode after retrying:",o),n({isConnected:!1}),!1},initializeApp:async()=>{try{const e=Qe();e&&console.log("Starting app initialization...");const r=await t().checkConnection();if(e&&console.log("Connection check result:",r),!r){e&&console.log("Server not connected"),n({isConnected:!1});return}e&&console.log("Initializing app..."),await O.initApp(),e&&console.log("Loading providers..."),await t().loadProviders(),e&&console.log("Loading agents..."),await t().loadAgents(),n({isInitialized:!0,isConnected:!0}),e&&console.log("App initialized successfully")}catch(e){console.error("Failed to initialize app:",e),n({isInitialized:!1,isConnected:!1})}},getCurrentProvider:()=>{const{providers:e,currentProviderId:r}=t();return e.find(o=>o.id===r)},getCurrentModel:()=>{const e=t().getCurrentProvider(),{currentModelId:r}=t();if(e)return e.models.find(o=>o.id===r)},getCurrentAgent:()=>{const{agents:e,currentAgentName:r}=t();if(r)return e.find(o=>o.name===r)},getModelMetadata:(e,r)=>{const o=Dr(e,r);if(!o)return;const{modelsMetadata:i}=t();return i.get(o)},getVisibleAgents:()=>{const{agents:e}=t();return Ir(e)}}),{name:"config-store",storage:ae(()=>H()),partialize:n=>({activeDirectoryKey:n.activeDirectoryKey,directoryScoped:n.directoryScoped,currentProviderId:n.currentProviderId,currentModelId:n.currentModelId,currentVariant:n.currentVariant,currentAgentName:n.currentAgentName,selectedProviderId:n.selectedProviderId,agentModelSelections:n.agentModelSelections,defaultProviders:n.defaultProviders,settingsDefaultModel:n.settingsDefaultModel,settingsDefaultVariant:n.settingsDefaultVariant,settingsDefaultAgent:n.settingsDefaultAgent,settingsAutoCreateWorktree:n.settingsAutoCreateWorktree,settingsGitmojiEnabled:n.settingsGitmojiEnabled,settingsZenModel:n.settingsZenModel,speechRate:n.speechRate,speechPitch:n.speechPitch,speechVolume:n.speechVolume})})));typeof window<"u"&&(window.__zustand_config_store__=se);let tr=null;tr||(tr=Xe(async n=>{const t=[];if(De(n,"agents")){const{loadAgents:e}=se.getState();t.push(e().then(()=>{}))}if(De(n,"providers")){const{loadProviders:e}=se.getState();t.push(e())}t.length>0&&await Promise.all(t)}));let rr=null;typeof window<"u"&&!rr&&(rr=ne.subscribe((n,t)=>{const e=fe(n.currentDirectory),r=fe(t.currentDirectory);e!==r&&se.getState().activateDirectory(n.currentDirectory)}));const Mi=Object.freeze(Object.defineProperty({__proto__:null,useConfigStore:se},Symbol.toStringTag,{value:"Module"}));export{Si as $,Hn as A,Jn as B,Kn as C,J as D,q as E,$n as F,Bn as G,Vn as H,mi as I,no as J,to as K,So as L,gi as M,et as N,Mt as O,ki as P,tt as Q,X as R,Te as S,ui as T,Bo as U,Di as V,No as W,Ci as X,io as Y,Ii as Z,vi as _,Pr as a,wi as a0,bi as a1,fi as a2,Hr as a3,yi as a4,hi as a5,Mi as a6,It as b,H as c,Q as d,Y as e,ae as f,Er as g,ne as h,Ce as i,Ze as j,se as k,di as l,ie as m,Gn as n,O as o,ye as p,Wn as q,nr as r,Qe as s,at as t,Se as u,Un as v,ce as w,Nn as x,$ as y,yr as z};
