import{j as e,x as F,y as $,R,z as A,A as w,B as T,F as H,G as V,H as p,I as O,J as B,K,M as G,S as q,N as J,O as Q,P as U,Q as Y,T as X,U as Z,V as ee,W as D,X as te,Y as re,Z as E,_ as ne,$ as ae,a0 as oe,a1 as se,a2 as ie,a3 as le}from"./mermaid-VLURNSYL.js";import{R as c,t as v}from"./useConfigStore.js";import{r as de}from"./index2.js";import"./index.js";import"./useSessionStore.js";const ce=t=>{const s="h-3.5 w-3.5 flex-shrink-0",r=t.toLowerCase();return r==="reasoning"?e.jsx(X,{className:s}):r==="image-preview"?e.jsx(Z,{className:s}):r==="edit"||r==="multiedit"||r==="apply_patch"||r==="str_replace"||r==="str_replace_based_edit_tool"?e.jsx(ee,{className:s}):r==="write"||r==="create"||r==="file_write"?e.jsx(D,{className:s}):r==="read"||r==="view"||r==="file_read"||r==="cat"?e.jsx(D,{className:s}):r==="bash"||r==="shell"||r==="cmd"||r==="terminal"?e.jsx(te,{className:s}):r==="list"||r==="ls"||r==="dir"||r==="list_files"?e.jsx(re,{className:s}):r==="search"||r==="grep"||r==="find"||r==="ripgrep"?e.jsx(E,{className:s}):r==="glob"?e.jsx(ne,{className:s}):r==="fetch"||r==="curl"||r==="wget"||r==="webfetch"?e.jsx(ae,{className:s}):r==="web-search"||r==="websearch"||r==="search_web"||r==="google"||r==="bing"||r==="duckduckgo"?e.jsx(E,{className:s}):r==="todowrite"||r==="todoread"?e.jsx(oe,{className:s}):r==="plan_enter"?e.jsx(se,{className:s}):r==="plan_exit"?e.jsx(ie,{className:s}):r.startsWith("git")?e.jsx(le,{className:s}):e.jsx(R,{className:s})},M=150,ue=({popup:t,onOpenChange:s,isMobile:r})=>{const i=c.useMemo(()=>{const o=t.image;if(!o)return[];const d=Array.isArray(o.gallery)?o.gallery.filter(b=>!!b?.url):[];return d.length>0?d:[{url:o.url,mimeType:o.mimeType,filename:o.filename,size:o.size}]},[t.image]),[P,j]=c.useState(0),[n,h]=c.useState(null),[a,m]=c.useState(t.open),[l,g]=c.useState(t.open),[f,u]=c.useState(!1),[x,k]=c.useState({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0});c.useEffect(()=>{if(!t.open||i.length===0)return;const o=typeof t.image?.index=="number"?t.image.index:-1;if(o>=0&&o<i.length){j(o);return}const d=t.image?.url?i.findIndex(b=>b.url===t.image?.url):-1;j(d>=0?d:0)},[i,t.image?.index,t.image?.url,t.open]);const N=i[P]??i[0]??t.image,S=N?.filename||t.title||"Image preview",C=i.length>1,I=c.useCallback(()=>{i.length<=1||j(o=>(o-1+i.length)%i.length)},[i.length]),z=c.useCallback(()=>{i.length<=1||j(o=>(o+1)%i.length)},[i.length]);c.useEffect(()=>{if(t.open){if(m(!0),u(!0),typeof window>"u"){g(!0);return}const d=window.requestAnimationFrame(()=>{g(!0)}),b=window.setTimeout(()=>{u(!1)},M);return()=>{window.cancelAnimationFrame(d),window.clearTimeout(b)}}if(g(!1),u(!0),typeof window>"u"){m(!1);return}const o=window.setTimeout(()=>{m(!1),u(!1)},M);return()=>{window.clearTimeout(o)}},[t.open]),c.useEffect(()=>{if(!t.open)return;const o=d=>{if(d.key==="Escape"){s(!1);return}if(d.key==="ArrowLeft"&&C){d.preventDefault(),I();return}d.key==="ArrowRight"&&C&&(d.preventDefault(),z())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[C,s,t.open,z,I]),c.useEffect(()=>{if(!t.open||typeof window>"u")return;const o=()=>{k({width:window.innerWidth,height:window.innerHeight})};return o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[t.open]),c.useEffect(()=>{h(null)},[N?.url]);const _=c.useMemo(()=>{const o=Math.max(160,x.width*(r?.86:.75)),d=Math.max(160,x.height*(r?.72:.75));if(!n)return{width:Math.round(o),height:Math.round(d)};const b=o/n.width,L=d/n.height,y=Math.min(b,L);return{width:Math.max(1,Math.round(n.width*y)),height:Math.max(1,Math.round(n.height*y))}},[n,r,x.height,x.width]);if(!a||!N||typeof document>"u")return null;const W=e.jsxs("div",{className:p("fixed inset-0 z-50",t.open?"pointer-events-auto":"pointer-events-none"),children:[e.jsx("div",{"aria-hidden":"true",className:p("absolute inset-0 bg-black/25 backdrop-blur-md",f&&"transition-opacity duration-150 ease-out",l?"opacity-100":"opacity-0"),onMouseDown:()=>s(!1)}),C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onMouseDown:o=>o.stopPropagation(),onClick:I,className:"absolute left-3 top-1/2 -translate-y-1/2 z-10 h-10 w-10 flex items-center justify-center rounded-full bg-black/25 text-foreground/90 backdrop-blur-sm hover:bg-black/35 focus:outline-none focus:ring-2 focus:ring-primary/60","aria-label":"Previous image",children:e.jsx(Q,{className:"h-6 w-6"})}),e.jsx("button",{type:"button",onMouseDown:o=>o.stopPropagation(),onClick:z,className:"absolute right-3 top-1/2 -translate-y-1/2 z-10 h-10 w-10 flex items-center justify-center rounded-full bg-black/25 text-foreground/90 backdrop-blur-sm hover:bg-black/35 focus:outline-none focus:ring-2 focus:ring-primary/60","aria-label":"Next image",children:e.jsx(U,{className:"h-6 w-6"})})]}),e.jsx("div",{className:p("absolute inset-0 flex items-center justify-center pointer-events-none",r?"p-2.5":"p-4"),children:e.jsxs("div",{className:p("pointer-events-auto flex flex-col gap-2",f&&"transition-opacity duration-150 ease-out",l?"opacity-100":"opacity-0"),style:{width:`${_.width}px`},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"min-w-0 flex-1 text-foreground typography-ui-header font-semibold truncate",title:S,children:S}),e.jsx("button",{type:"button",className:"h-8 w-8 flex items-center justify-center rounded-lg text-muted-foreground/80 hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary/60",onClick:()=>s(!1),"aria-label":"Close image preview",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx("img",{src:N.url,alt:S,className:"block object-contain",style:{width:`${_.width}px`,height:`${_.height}px`},loading:"lazy",onLoad:o=>{const d=o.currentTarget,b=d.naturalWidth,L=d.naturalHeight;b>0&&L>0&&h(y=>y&&y.width===b&&y.height===L?y:{width:b,height:L})}})]})})]});return de.createPortal(W,document.body)},xe=({popup:t,onOpenChange:s,syntaxTheme:r,isMobile:i})=>{const[P,j]=c.useState(i?"unified":"side-by-side");return t.image?e.jsx(ue,{popup:t,onOpenChange:s,isMobile:i}):e.jsx(F,{open:t.open,onOpenChange:s,children:e.jsxs($,{className:p("overflow-hidden flex flex-col min-h-0 pt-3 pb-4 px-4 gap-1","[&>button]:top-1.5",i?"w-[95vw] max-w-[95vw]":"max-w-5xl",i?"[&>button]:right-1":"[&>button]:top-2.5 [&>button]:right-4"),style:{maxHeight:"90vh"},children:[e.jsx("div",{className:"flex-shrink-0 pb-1",children:e.jsxs("div",{className:"flex items-start gap-2 text-foreground typography-ui-header font-semibold",children:[t.metadata?.tool?ce(t.metadata.tool):e.jsx(R,{className:"h-3.5 w-3.5 text-foreground flex-shrink-0"}),e.jsx("span",{className:"break-words flex-1 leading-tight",children:t.title}),t.isDiff&&e.jsx(A,{mode:P,onModeChange:j,className:"mr-8 flex-shrink-0"})]})}),e.jsx("div",{className:"flex-1 min-h-0 rounded-xl border border-border/30 bg-muted/10 overflow-hidden",children:e.jsxs("div",{className:"tool-output-surface h-full max-h-[75vh] overflow-y-auto px-3 pr-4",children:[t.metadata?.input&&typeof t.metadata.input=="object"&&Object.keys(t.metadata.input).length>0&&t.metadata?.tool!=="todowrite"&&t.metadata?.tool!=="todoread"&&t.metadata?.tool!=="apply_patch"?(()=>{const n=t.metadata,h=n.input,a=m=>{const l=h[m];return typeof l=="string"?l:typeof l=="number"?String(l):null};return e.jsxs("div",{className:"border-b border-border/20 p-4 -mx-3",children:[e.jsx("div",{className:"typography-markdown font-medium text-muted-foreground mb-2 px-3",children:n.tool==="bash"?"Command:":n.tool==="task"?"Task Details:":"Input:"}),n.tool==="bash"&&a("command")?e.jsx("div",{className:"tool-input-surface bg-transparent rounded-xl border border-border/20 mx-3",children:e.jsx(w,{style:r,language:"bash",PreTag:"div",customStyle:v.getPopupStyles(),codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},wrapLongLines:!0,children:a("command")})}):n.tool==="task"&&a("prompt")?e.jsxs("div",{className:"tool-input-surface bg-transparent rounded-xl border border-border/20 font-mono whitespace-pre-wrap text-foreground/90 mx-3",style:v.getPopupStyles(),children:[a("description")?`Task: ${a("description")}
`:"",a("subagent_type")?`Agent Type: ${a("subagent_type")}
`:"",`Instructions:
${a("prompt")}`]}):n.tool==="write"&&a("content")?e.jsx("div",{className:"tool-input-surface bg-transparent rounded-xl border border-border/20 mx-3",children:e.jsx(w,{style:r,language:T(a("filePath")||a("file_path")||"")||"text",PreTag:"div",customStyle:v.getPopupStyles(),codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},wrapLongLines:!0,children:a("content")})}):e.jsx("div",{className:"tool-input-surface bg-transparent rounded-xl border border-border/20 font-mono whitespace-pre-wrap text-foreground/90 mx-3",style:v.getPopupStyles(),children:H(h,n.tool)})]})})():null,t.isDiff?P==="unified"?e.jsx("div",{className:"typography-code",children:V(t.content).map((n,h)=>e.jsxs("div",{className:"border-b border-border/20 last:border-b-0",children:[e.jsx("div",{className:p("bg-muted/20 px-3 py-2 font-medium text-muted-foreground border-b border-border/10 sticky top-0 z-10 break-words -mx-3",i?"typography-micro":"typography-markdown"),children:`${n.file} (line ${n.oldStart})`}),e.jsx("div",{children:n.lines.map((a,m)=>e.jsxs("div",{className:p("typography-code font-mono px-3 py-0.5 flex",a.type==="context"&&"bg-transparent",a.type==="removed"&&"bg-transparent",a.type==="added"&&"bg-transparent"),style:{lineHeight:"1.1",...a.type==="removed"?{backgroundColor:"var(--tools-edit-removed-bg)"}:a.type==="added"?{backgroundColor:"var(--tools-edit-added-bg)"}:{}},children:[e.jsx("span",{className:"w-12 flex-shrink-0 text-right pr-3 select-none border-r mr-3 -my-0.5 py-0.5",style:{color:"var(--tools-edit-line-number)",borderColor:"var(--tools-border)"},children:a.lineNumber||""}),e.jsx("div",{className:"flex-1 min-w-0",children:(()=>{const l=typeof t.metadata?.input=="object"&&t.metadata.input!==null?t.metadata.input.file_path||t.metadata.input.filePath:null,g=typeof l=="string"?l:"",f=typeof n=="object"&&n!==null&&"file"in n?n.file:null,x=g||(typeof f=="string"?f:"")||"";return e.jsx(w,{style:r,language:T(x)||"text",PreTag:"div",wrapLines:!0,wrapLongLines:!0,customStyle:{margin:0,padding:0,fontSize:"inherit",background:"transparent",backgroundColor:"transparent",borderRadius:0,overflow:"visible",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere"},codeTagProps:{style:{background:"transparent",backgroundColor:"transparent"}},children:a.content})})()})]},m))})]},h))}):t.diffHunks?e.jsx("div",{className:"typography-code",children:t.diffHunks.map((n,h)=>e.jsxs("div",{className:"border-b border-border/20 last:border-b-0",children:[e.jsx("div",{className:p("bg-muted/20 px-3 py-2 font-medium text-muted-foreground border-b border-border/10 sticky top-0 z-10 break-words -mx-3",i?"typography-micro":"typography-markdown"),children:`${n.file} (line ${n.oldStart})`}),e.jsx("div",{children:n.lines.map((a,m)=>e.jsxs("div",{className:"grid grid-cols-2 divide-x divide-border/20",children:[e.jsx("div",{className:p("typography-code font-mono px-3 py-0.5 overflow-hidden",a.leftLine.type==="context"&&"bg-transparent",a.leftLine.type==="empty"&&"bg-transparent"),style:{lineHeight:"1.1",...a.leftLine.type==="removed"?{backgroundColor:"var(--tools-edit-removed-bg)"}:{}},children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"w-12 flex-shrink-0 text-right pr-3 select-none border-r mr-3 -my-0.5 py-0.5",style:{color:"var(--tools-edit-line-number)",borderColor:"var(--tools-border)"},children:a.leftLine.lineNumber||""}),e.jsx("div",{className:"flex-1 min-w-0",children:a.leftLine.content&&e.jsx(w,{style:r,language:(()=>{const l=t.metadata?.input,g=typeof l=="object"&&l!==null?l:{},f=g.file_path||g.filePath,u=n.file;return T(typeof f=="string"?f:u)||"text"})(),PreTag:"div",wrapLines:!0,wrapLongLines:!0,customStyle:{margin:0,padding:0,fontSize:"inherit",background:"transparent",backgroundColor:"transparent",borderRadius:0,overflow:"visible",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere"},codeTagProps:{style:{background:"transparent",backgroundColor:"transparent"}},children:a.leftLine.content})})]})}),e.jsx("div",{className:p("typography-code font-mono px-3 py-0.5 overflow-hidden",a.rightLine.type==="context"&&"bg-transparent",a.rightLine.type==="empty"&&"bg-transparent"),style:{lineHeight:"1.1",...a.rightLine.type==="added"?{backgroundColor:"var(--tools-edit-added-bg)"}:{}},children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"w-12 flex-shrink-0 text-right pr-3 select-none border-r mr-3 -my-0.5 py-0.5",style:{color:"var(--tools-edit-line-number)",borderColor:"var(--tools-border)"},children:a.rightLine.lineNumber||""}),e.jsx("div",{className:"flex-1 min-w-0",children:a.rightLine.content&&e.jsx(w,{style:r,language:(()=>{const l=t.metadata?.input,g=typeof l=="object"&&l!==null?l:{},f=g.file_path||g.filePath,u=n.file;return T(typeof f=="string"?f:u)||"text"})(),PreTag:"div",wrapLines:!0,wrapLongLines:!0,customStyle:{margin:0,padding:0,fontSize:"inherit",background:"transparent",backgroundColor:"transparent",borderRadius:0,overflow:"visible",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere"},codeTagProps:{style:{background:"transparent",backgroundColor:"transparent"}},children:a.rightLine.content})})]})})]},m))})]},h))}):null:t.content?e.jsx("div",{className:"p-4",children:(()=>{const n=t.metadata?.tool;if(n==="todowrite"||n==="todoread")return O(t.content)||e.jsx(w,{style:r,language:"json",PreTag:"div",wrapLongLines:!0,customStyle:v.getPopupContainerStyles(),codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},children:t.content});if(n==="list")return B(t.content)||e.jsx("pre",{className:"typography-markdown bg-muted/30 p-2 rounded-xl border border-border/20 font-mono whitespace-pre-wrap",children:t.content});if(n==="grep")return K(t.content,i)||e.jsx("pre",{className:"typography-code bg-muted/30 p-2 rounded-xl border border-border/20 font-mono whitespace-pre-wrap",children:t.content});if(n==="glob")return G(t.content,i)||e.jsx("pre",{className:"typography-code bg-muted/30 p-2 rounded-xl border border-border/20 font-mono whitespace-pre-wrap",children:t.content});if(n==="task"||n==="reasoning")return e.jsx("div",{className:n==="reasoning"?"text-muted-foreground/70":"",children:e.jsx(q,{content:t.content,variant:"tool"})});if(n==="web-search"||n==="websearch"||n==="search_web")return J(t.content)||e.jsx(w,{style:r,language:"text",PreTag:"div",wrapLongLines:!0,customStyle:v.getPopupContainerStyles(),codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},children:t.content});if(n==="read"){const h=t.content.split(`
`),a=t.metadata?.input,m=typeof a=="object"&&a!==null?a:{},l=typeof m.offset=="number"?m.offset:0,g=typeof m.limit=="number"?m.limit:void 0,f=u=>u.trim().startsWith("(");return e.jsx("div",{children:h.map((u,x)=>{const k=f(u),N=l+x+1,S=!k&&(g===void 0||x<g);return e.jsxs("div",{className:`typography-code font-mono flex ${k?"text-muted-foreground/70 italic":""}`,children:[e.jsx("span",{className:"w-12 flex-shrink-0 text-right pr-3 select-none border-r mr-3 -my-0.5 py-0.5",style:{color:"var(--tools-edit-line-number)",borderColor:"var(--tools-border)"},children:S?N:""}),e.jsx("div",{className:"flex-1 min-w-0",children:k?e.jsx("div",{className:"whitespace-pre-wrap break-words",children:u}):e.jsx(w,{style:r,language:t.language||"text",PreTag:"div",wrapLines:!0,wrapLongLines:!0,customStyle:{margin:0,padding:0,fontSize:"inherit",background:"transparent",backgroundColor:"transparent",borderRadius:0,overflow:"visible",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere"},codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},children:u})})]},x)})})}return e.jsx(w,{style:r,language:t.language||"text",PreTag:"div",wrapLongLines:!0,customStyle:v.getPopupContainerStyles(),codeTagProps:{style:{background:"transparent",backgroundColor:"transparent",fontSize:"inherit"}},children:t.content})})()}):e.jsxs("div",{className:"p-8 text-muted-foreground typography-ui-header",children:[e.jsx("div",{className:"mb-2",children:"Command completed successfully"}),e.jsx("div",{className:"typography-meta",children:"No output was produced"})]})]})})]})})};export{xe as default};
